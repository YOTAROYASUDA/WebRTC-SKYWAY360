(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var B_=Object.create,El=Object.defineProperty,H_=Object.defineProperties,j_=Object.getOwnPropertyDescriptor,V_=Object.getOwnPropertyDescriptors,Lu=Object.getOwnPropertyNames,Eh=Object.getOwnPropertySymbols,z_=Object.getPrototypeOf,jf=Object.prototype.hasOwnProperty,G_=Object.prototype.propertyIsEnumerable,qa=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Fu=t=>{throw TypeError(t)},Fs=Math.pow,nu=(t,e,i)=>e in t?El(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ne=(t,e)=>{for(var i in e||(e={}))jf.call(e,i)&&nu(t,i,e[i]);if(Eh)for(var i of Eh(e))G_.call(e,i)&&nu(t,i,e[i]);return t},we=(t,e)=>H_(t,V_(e)),q_=(t,e)=>function(){return t&&(e=(0,t[Lu(t)[0]])(t=0)),e},Ce=(t,e)=>function(){return e||(0,t[Lu(t)[0]])((e={exports:{}}).exports,e),e.exports},W_=(t,e)=>{for(var i in e)El(t,i,{get:e[i],enumerable:!0})},K_=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Lu(e))!jf.call(t,r)&&r!==i&&El(t,r,{get:()=>e[r],enumerable:!(n=j_(e,r))||n.enumerable});return t},qn=(t,e,i)=>(i=t!=null?B_(z_(t)):{},K_(!t||!t.__esModule?El(i,"default",{value:t,enumerable:!0}):i,t)),le=(t,e,i)=>nu(t,typeof e!="symbol"?e+"":e,i),Vf=(t,e,i)=>e.has(t)||Fu("Cannot "+i),Jt=(t,e,i)=>(Vf(t,e,"read from private field"),i?i.call(t):e.get(t)),gn=(t,e,i)=>e.has(t)?Fu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),Li=(t,e,i,n)=>(Vf(t,e,"write to private field"),e.set(t,i),i),B=(t,e,i)=>new Promise((n,r)=>{var s=h=>{try{c(i.next(h))}catch(l){r(l)}},o=h=>{try{c(i.throw(h))}catch(l){r(l)}},c=h=>h.done?n(h.value):Promise.resolve(h.value).then(s,o);c((i=i.apply(t,e)).next())}),$a=function(t,e){this[0]=t,this[1]=e},zf=(t,e,i)=>{var n=(o,c,h,l)=>{try{var p=i[o](c),g=(c=p.value)instanceof $a,f=p.done;Promise.resolve(g?c[0]:c).then(y=>g?n(o==="return"?o:"next",c[1]?{done:y.done,value:y.value}:y,h,l):h({value:y,done:f})).catch(y=>n("throw",y,h,l))}catch(y){l(y)}},r=o=>s[o]=c=>new Promise((h,l)=>n(o,c,h,l)),s={};return i=i.apply(t,e),s[qa("asyncIterator")]=()=>s,r("next"),r("throw"),r("return"),s},Gf=t=>{var e=t[qa("asyncIterator")],i=!1,n,r={};return e==null?(e=t[qa("iterator")](),n=s=>r[s]=o=>e[s](o)):(e=e.call(t),n=s=>r[s]=o=>{if(i){if(i=!1,s==="throw")throw o;return o}return i=!0,{done:!1,value:new $a(new Promise(c=>{var h=e[s](o);h instanceof Object||Fu("Object expected"),c(h)}),1)}}),r[qa("iterator")]=()=>r,n("next"),"throw"in e?n("throw"):r.throw=s=>{throw s},"return"in e&&n("return"),r},X_=(t,e,i)=>(e=t[qa("asyncIterator")])?e.call(t):(t=t[qa("iterator")](),e={},i=(n,r)=>(r=t[n])&&(e[n]=s=>new Promise((o,c,h)=>(s=r.call(t,s),h=s.done,Promise.resolve(s.value).then(l=>o({value:l,done:h}),c)))),i("next"),i("return"),e),Wa,Q=q_({"shims/process.js"(){Wa=void 0}}),$_=Ce({"../../node_modules/bowser/es5.js"(t,e){Q(),function(i,n){typeof t=="object"&&typeof e=="object"?e.exports=n():typeof define=="function"&&define.amd?define([],n):typeof t=="object"?t.bowser=n():i.bowser=n()}(t,function(){return function(i){var n={};function r(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return i[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=i,r.c=n,r.d=function(s,o,c){r.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:c})},r.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,o){if(1&o&&(s=r(s)),8&o||4&o&&typeof s=="object"&&s&&s.__esModule)return s;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:s}),2&o&&typeof s!="string")for(var h in s)r.d(c,h,(function(l){return s[l]}).bind(null,h));return c},r.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(o,"a",o),o},r.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},r.p="",r(r.s=90)}({17:function(i,n,r){n.__esModule=!0,n.default=void 0;var s=r(18),o=function(){function c(){}return c.getFirstMatch=function(h,l){var p=l.match(h);return p&&p.length>0&&p[1]||""},c.getSecondMatch=function(h,l){var p=l.match(h);return p&&p.length>1&&p[2]||""},c.matchAndReturnConst=function(h,l,p){if(h.test(l))return p},c.getWindowsVersionName=function(h){switch(h){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},c.getMacOSVersionName=function(h){var l=h.split(".").splice(0,2).map(function(p){return parseInt(p,10)||0});if(l.push(0),l[0]===10)switch(l[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},c.getAndroidVersionName=function(h){var l=h.split(".").splice(0,2).map(function(p){return parseInt(p,10)||0});if(l.push(0),!(l[0]===1&&l[1]<5))return l[0]===1&&l[1]<6?"Cupcake":l[0]===1&&l[1]>=6?"Donut":l[0]===2&&l[1]<2?"Eclair":l[0]===2&&l[1]===2?"Froyo":l[0]===2&&l[1]>2?"Gingerbread":l[0]===3?"Honeycomb":l[0]===4&&l[1]<1?"Ice Cream Sandwich":l[0]===4&&l[1]<4?"Jelly Bean":l[0]===4&&l[1]>=4?"KitKat":l[0]===5?"Lollipop":l[0]===6?"Marshmallow":l[0]===7?"Nougat":l[0]===8?"Oreo":l[0]===9?"Pie":void 0},c.getVersionPrecision=function(h){return h.split(".").length},c.compareVersions=function(h,l,p){p===void 0&&(p=!1);var g=c.getVersionPrecision(h),f=c.getVersionPrecision(l),y=Math.max(g,f),x=0,S=c.map([h,l],function(v){var m=y-c.getVersionPrecision(v),w=v+new Array(m+1).join(".0");return c.map(w.split("."),function(b){return new Array(20-b.length).join("0")+b}).reverse()});for(p&&(x=y-Math.min(g,f)),y-=1;y>=x;){if(S[0][y]>S[1][y])return 1;if(S[0][y]===S[1][y]){if(y===x)return 0;y-=1}else if(S[0][y]<S[1][y])return-1}},c.map=function(h,l){var p,g=[];if(Array.prototype.map)return Array.prototype.map.call(h,l);for(p=0;p<h.length;p+=1)g.push(l(h[p]));return g},c.find=function(h,l){var p,g;if(Array.prototype.find)return Array.prototype.find.call(h,l);for(p=0,g=h.length;p<g;p+=1){var f=h[p];if(l(f,p))return f}},c.assign=function(h){for(var l,p,g=h,f=arguments.length,y=new Array(f>1?f-1:0),x=1;x<f;x++)y[x-1]=arguments[x];if(Object.assign)return Object.assign.apply(Object,[h].concat(y));var S=function(){var v=y[l];typeof v=="object"&&v!==null&&Object.keys(v).forEach(function(m){g[m]=v[m]})};for(l=0,p=y.length;l<p;l+=1)S();return h},c.getBrowserAlias=function(h){return s.BROWSER_ALIASES_MAP[h]},c.getBrowserTypeByAlias=function(h){return s.BROWSER_MAP[h]||""},c}();n.default=o,i.exports=n.default},18:function(i,n,r){n.__esModule=!0,n.ENGINE_MAP=n.OS_MAP=n.PLATFORMS_MAP=n.BROWSER_MAP=n.BROWSER_ALIASES_MAP=void 0,n.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},n.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},n.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},n.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},n.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(i,n,r){n.__esModule=!0,n.default=void 0;var s,o=(s=r(91))&&s.__esModule?s:{default:s},c=r(18);function h(p,g){for(var f=0;f<g.length;f++){var y=g[f];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(p,y.key,y)}}var l=function(){function p(){}var g,f,y;return p.getParser=function(x,S){if(S===void 0&&(S=!1),typeof x!="string")throw new Error("UserAgent should be a string");return new o.default(x,S)},p.parse=function(x){return new o.default(x).getResult()},g=p,y=[{key:"BROWSER_MAP",get:function(){return c.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return c.ENGINE_MAP}},{key:"OS_MAP",get:function(){return c.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return c.PLATFORMS_MAP}}],(f=null)&&h(g.prototype,f),y&&h(g,y),p}();n.default=l,i.exports=n.default},91:function(i,n,r){n.__esModule=!0,n.default=void 0;var s=p(r(92)),o=p(r(93)),c=p(r(94)),h=p(r(95)),l=p(r(17));function p(f){return f&&f.__esModule?f:{default:f}}var g=function(){function f(x,S){if(S===void 0&&(S=!1),x==null||x==="")throw new Error("UserAgent parameter can't be empty");this._ua=x,this.parsedResult={},S!==!0&&this.parse()}var y=f.prototype;return y.getUA=function(){return this._ua},y.test=function(x){return x.test(this._ua)},y.parseBrowser=function(){var x=this;this.parsedResult.browser={};var S=l.default.find(s.default,function(v){if(typeof v.test=="function")return v.test(x);if(v.test instanceof Array)return v.test.some(function(m){return x.test(m)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.browser=S.describe(this.getUA())),this.parsedResult.browser},y.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},y.getBrowserName=function(x){return x?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},y.getBrowserVersion=function(){return this.getBrowser().version},y.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},y.parseOS=function(){var x=this;this.parsedResult.os={};var S=l.default.find(o.default,function(v){if(typeof v.test=="function")return v.test(x);if(v.test instanceof Array)return v.test.some(function(m){return x.test(m)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.os=S.describe(this.getUA())),this.parsedResult.os},y.getOSName=function(x){var S=this.getOS().name;return x?String(S).toLowerCase()||"":S||""},y.getOSVersion=function(){return this.getOS().version},y.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},y.getPlatformType=function(x){x===void 0&&(x=!1);var S=this.getPlatform().type;return x?String(S).toLowerCase()||"":S||""},y.parsePlatform=function(){var x=this;this.parsedResult.platform={};var S=l.default.find(c.default,function(v){if(typeof v.test=="function")return v.test(x);if(v.test instanceof Array)return v.test.some(function(m){return x.test(m)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.platform=S.describe(this.getUA())),this.parsedResult.platform},y.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},y.getEngineName=function(x){return x?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},y.parseEngine=function(){var x=this;this.parsedResult.engine={};var S=l.default.find(h.default,function(v){if(typeof v.test=="function")return v.test(x);if(v.test instanceof Array)return v.test.some(function(m){return x.test(m)});throw new Error("Browser's test function is not valid")});return S&&(this.parsedResult.engine=S.describe(this.getUA())),this.parsedResult.engine},y.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},y.getResult=function(){return l.default.assign({},this.parsedResult)},y.satisfies=function(x){var S=this,v={},m=0,w={},b=0;if(Object.keys(x).forEach(function(K){var X=x[K];typeof X=="string"?(w[K]=X,b+=1):typeof X=="object"&&(v[K]=X,m+=1)}),m>0){var C=Object.keys(v),A=l.default.find(C,function(K){return S.isOS(K)});if(A){var M=this.satisfies(v[A]);if(M!==void 0)return M}var F=l.default.find(C,function(K){return S.isPlatform(K)});if(F){var N=this.satisfies(v[F]);if(N!==void 0)return N}}if(b>0){var P=Object.keys(w),j=l.default.find(P,function(K){return S.isBrowser(K,!0)});if(j!==void 0)return this.compareVersion(w[j])}},y.isBrowser=function(x,S){S===void 0&&(S=!1);var v=this.getBrowserName().toLowerCase(),m=x.toLowerCase(),w=l.default.getBrowserTypeByAlias(m);return S&&w&&(m=w.toLowerCase()),m===v},y.compareVersion=function(x){var S=[0],v=x,m=!1,w=this.getBrowserVersion();if(typeof w=="string")return x[0]===">"||x[0]==="<"?(v=x.substr(1),x[1]==="="?(m=!0,v=x.substr(2)):S=[],x[0]===">"?S.push(1):S.push(-1)):x[0]==="="?v=x.substr(1):x[0]==="~"&&(m=!0,v=x.substr(1)),S.indexOf(l.default.compareVersions(w,v,m))>-1},y.isOS=function(x){return this.getOSName(!0)===String(x).toLowerCase()},y.isPlatform=function(x){return this.getPlatformType(!0)===String(x).toLowerCase()},y.isEngine=function(x){return this.getEngineName(!0)===String(x).toLowerCase()},y.is=function(x,S){return S===void 0&&(S=!1),this.isBrowser(x,S)||this.isOS(x)||this.isPlatform(x)},y.some=function(x){var S=this;return x===void 0&&(x=[]),x.some(function(v){return S.is(v)})},f}();n.default=g,i.exports=n.default},92:function(i,n,r){n.__esModule=!0,n.default=void 0;var s,o=(s=r(17))&&s.__esModule?s:{default:s},c=/version\/(\d+(\.?_?\d+)+)/i,h=[{test:[/googlebot/i],describe:function(l){var p={name:"Googlebot"},g=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/opera/i],describe:function(l){var p={name:"Opera"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/opr\/|opios/i],describe:function(l){var p={name:"Opera"},g=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/SamsungBrowser/i],describe:function(l){var p={name:"Samsung Internet for Android"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/Whale/i],describe:function(l){var p={name:"NAVER Whale Browser"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/MZBrowser/i],describe:function(l){var p={name:"MZ Browser"},g=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/focus/i],describe:function(l){var p={name:"Focus"},g=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/swing/i],describe:function(l){var p={name:"Swing"},g=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/coast/i],describe:function(l){var p={name:"Opera Coast"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(l){var p={name:"Opera Touch"},g=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/yabrowser/i],describe:function(l){var p={name:"Yandex Browser"},g=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/ucbrowser/i],describe:function(l){var p={name:"UC Browser"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/Maxthon|mxios/i],describe:function(l){var p={name:"Maxthon"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/epiphany/i],describe:function(l){var p={name:"Epiphany"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/puffin/i],describe:function(l){var p={name:"Puffin"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/sleipnir/i],describe:function(l){var p={name:"Sleipnir"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/k-meleon/i],describe:function(l){var p={name:"K-Meleon"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/micromessenger/i],describe:function(l){var p={name:"WeChat"},g=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/qqbrowser/i],describe:function(l){var p={name:/qqbrowserlite/i.test(l)?"QQ Browser Lite":"QQ Browser"},g=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/msie|trident/i],describe:function(l){var p={name:"Internet Explorer"},g=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/\sedg\//i],describe:function(l){var p={name:"Microsoft Edge"},g=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/edg([ea]|ios)/i],describe:function(l){var p={name:"Microsoft Edge"},g=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/vivaldi/i],describe:function(l){var p={name:"Vivaldi"},g=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/seamonkey/i],describe:function(l){var p={name:"SeaMonkey"},g=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/sailfish/i],describe:function(l){var p={name:"Sailfish"},g=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,l);return g&&(p.version=g),p}},{test:[/silk/i],describe:function(l){var p={name:"Amazon Silk"},g=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/phantom/i],describe:function(l){var p={name:"PhantomJS"},g=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/slimerjs/i],describe:function(l){var p={name:"SlimerJS"},g=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var p={name:"BlackBerry"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var p={name:"WebOS Browser"},g=o.default.getFirstMatch(c,l)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/bada/i],describe:function(l){var p={name:"Bada"},g=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/tizen/i],describe:function(l){var p={name:"Tizen"},g=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/qupzilla/i],describe:function(l){var p={name:"QupZilla"},g=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/firefox|iceweasel|fxios/i],describe:function(l){var p={name:"Firefox"},g=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/electron/i],describe:function(l){var p={name:"Electron"},g=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/MiuiBrowser/i],describe:function(l){var p={name:"Miui"},g=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/chromium/i],describe:function(l){var p={name:"Chromium"},g=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/chrome|crios|crmo/i],describe:function(l){var p={name:"Chrome"},g=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/GSA/i],describe:function(l){var p={name:"Google Search"},g=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:function(l){var p=!l.test(/like android/i),g=l.test(/android/i);return p&&g},describe:function(l){var p={name:"Android Browser"},g=o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/playstation 4/i],describe:function(l){var p={name:"PlayStation 4"},g=o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/safari|applewebkit/i],describe:function(l){var p={name:"Safari"},g=o.default.getFirstMatch(c,l);return g&&(p.version=g),p}},{test:[/.*/i],describe:function(l){var p=l.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(p,l),version:o.default.getSecondMatch(p,l)}}}];n.default=h,i.exports=n.default},93:function(i,n,r){n.__esModule=!0,n.default=void 0;var s,o=(s=r(17))&&s.__esModule?s:{default:s},c=r(18),h=[{test:[/Roku\/DVP/],describe:function(l){var p=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,l);return{name:c.OS_MAP.Roku,version:p}}},{test:[/windows phone/i],describe:function(l){var p=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,l);return{name:c.OS_MAP.WindowsPhone,version:p}}},{test:[/windows /i],describe:function(l){var p=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,l),g=o.default.getWindowsVersionName(p);return{name:c.OS_MAP.Windows,version:p,versionName:g}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(l){var p={name:c.OS_MAP.iOS},g=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,l);return g&&(p.version=g),p}},{test:[/macintosh/i],describe:function(l){var p=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,l).replace(/[_\s]/g,"."),g=o.default.getMacOSVersionName(p),f={name:c.OS_MAP.MacOS,version:p};return g&&(f.versionName=g),f}},{test:[/(ipod|iphone|ipad)/i],describe:function(l){var p=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,l).replace(/[_\s]/g,".");return{name:c.OS_MAP.iOS,version:p}}},{test:function(l){var p=!l.test(/like android/i),g=l.test(/android/i);return p&&g},describe:function(l){var p=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,l),g=o.default.getAndroidVersionName(p),f={name:c.OS_MAP.Android,version:p};return g&&(f.versionName=g),f}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var p=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,l),g={name:c.OS_MAP.WebOS};return p&&p.length&&(g.version=p),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var p=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,l)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,l)||o.default.getFirstMatch(/\bbb(\d+)/i,l);return{name:c.OS_MAP.BlackBerry,version:p}}},{test:[/bada/i],describe:function(l){var p=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,l);return{name:c.OS_MAP.Bada,version:p}}},{test:[/tizen/i],describe:function(l){var p=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,l);return{name:c.OS_MAP.Tizen,version:p}}},{test:[/linux/i],describe:function(){return{name:c.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:c.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(l){var p=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,l);return{name:c.OS_MAP.PlayStation4,version:p}}}];n.default=h,i.exports=n.default},94:function(i,n,r){n.__esModule=!0,n.default=void 0;var s,o=(s=r(17))&&s.__esModule?s:{default:s},c=r(18),h=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(l){var p=o.default.getFirstMatch(/(can-l01)/i,l)&&"Nova",g={type:c.PLATFORMS_MAP.mobile,vendor:"Huawei"};return p&&(g.model=p),g}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:c.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:c.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:c.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:c.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:c.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:c.PLATFORMS_MAP.tablet}}},{test:function(l){var p=l.test(/ipod|iphone/i),g=l.test(/like (ipod|iphone)/i);return p&&!g},describe:function(l){var p=o.default.getFirstMatch(/(ipod|iphone)/i,l);return{type:c.PLATFORMS_MAP.mobile,vendor:"Apple",model:p}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:c.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:c.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName(!0)==="blackberry"},describe:function(){return{type:c.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(l){return l.getBrowserName(!0)==="bada"},describe:function(){return{type:c.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName()==="windows phone"},describe:function(){return{type:c.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(l){var p=Number(String(l.getOSVersion()).split(".")[0]);return l.getOSName(!0)==="android"&&p>=3},describe:function(){return{type:c.PLATFORMS_MAP.tablet}}},{test:function(l){return l.getOSName(!0)==="android"},describe:function(){return{type:c.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getOSName(!0)==="macos"},describe:function(){return{type:c.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(l){return l.getOSName(!0)==="windows"},describe:function(){return{type:c.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="linux"},describe:function(){return{type:c.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="playstation 4"},describe:function(){return{type:c.PLATFORMS_MAP.tv}}},{test:function(l){return l.getOSName(!0)==="roku"},describe:function(){return{type:c.PLATFORMS_MAP.tv}}}];n.default=h,i.exports=n.default},95:function(i,n,r){n.__esModule=!0,n.default=void 0;var s,o=(s=r(17))&&s.__esModule?s:{default:s},c=r(18),h=[{test:function(l){return l.getBrowserName(!0)==="microsoft edge"},describe:function(l){if(/\sedg\//i.test(l))return{name:c.ENGINE_MAP.Blink};var p=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,l);return{name:c.ENGINE_MAP.EdgeHTML,version:p}}},{test:[/trident/i],describe:function(l){var p={name:c.ENGINE_MAP.Trident},g=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:function(l){return l.test(/presto/i)},describe:function(l){var p={name:c.ENGINE_MAP.Presto},g=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:function(l){var p=l.test(/gecko/i),g=l.test(/like gecko/i);return p&&!g},describe:function(l){var p={name:c.ENGINE_MAP.Gecko},g=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:c.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(l){var p={name:c.ENGINE_MAP.WebKit},g=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,l);return g&&(p.version=g),p}}];n.default=h,i.exports=n.default}})})}}),ku=Ce({"../../node_modules/sdp-transform/lib/grammar.js"(t,e){Q();var i=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(n){return n.encoding?"rtpmap:%d %s/%s/%s":n.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(n){return n.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(n){return n.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(n){return"extmap:%d"+(n.direction?"/%s":"%v")+(n["encrypt-uri"]?" %s":"%v")+" %s"+(n.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(n){return n.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(n){var r="candidate:%s %d %s %d %s %d typ %s";return r+=n.raddr!=null?" raddr %s rport %d":"%v%v",r+=n.tcptype!=null?" tcptype %s":"%v",n.generation!=null&&(r+=" generation %d"),r+=n["network-id"]!=null?" network-id %d":"%v",r+=n["network-cost"]!=null?" network-cost %d":"%v",r}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(n){var r="ssrc:%d";return n.attribute!=null&&(r+=" %s",n.value!=null&&(r+=":%s")),r}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(n){return n.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(n){return n.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(n){return"imageattr:%s %s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(n){return"simulcast:%s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(n){return"ts-refclk:%s"+(n.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(n){var r="mediaclk:";return r+=n.id!=null?"id=%s %s":"%v%s",r+=n.mediaClockValue!=null?"=%s":"",r+=n.rateNumerator!=null?" rate=%s":"",r+=n.rateDenominator!=null?"/%s":"",r}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach(function(n){var r=i[n];r.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})})}}),Z_=Ce({"../../node_modules/sdp-transform/lib/parser.js"(t){Q();var e=function(c){return String(Number(c))===c?Number(c):c},i=function(c,h,l,p){if(p&&!l)h[p]=e(c[1]);else for(var g=0;g<l.length;g+=1)c[g+1]!=null&&(h[l[g]]=e(c[g+1]))},n=function(c,h,l){var p=c.name&&c.names;c.push&&!h[c.push]?h[c.push]=[]:p&&!h[c.name]&&(h[c.name]={});var g=c.push?{}:p?h[c.name]:h;i(l.match(c.reg),g,c.names,c.name),c.push&&h[c.push].push(g)},r=ku(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(c){var h={},l=[],p=h;return c.split(/(\r\n|\r|\n)/).filter(s).forEach(function(g){var f=g[0],y=g.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),p=l[l.length-1]);for(var x=0;x<(r[f]||[]).length;x+=1){var S=r[f][x];if(S.reg.test(y))return n(S,p,y)}}),h.media=l,h};var o=function(c,h){var l=h.split(/=(.+)/,2);return l.length===2?c[l[0]]=e(l[1]):l.length===1&&h.length>1&&(c[l[0]]=void 0),c};t.parseParams=function(c){return c.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(c){return c.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(c){for(var h=[],l=c.split(" ").map(e),p=0;p<l.length;p+=3)h.push({component:l[p],ip:l[p+1],port:l[p+2]});return h},t.parseImageAttributes=function(c){return c.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(c){return c.split(";").map(function(h){return h.split(",").map(function(l){var p,g=!1;return l[0]!=="~"?p=e(l):(p=e(l.substring(1,l.length)),g=!0),{scid:p,paused:g}})})}}}),Y_=Ce({"../../node_modules/sdp-transform/lib/writer.js"(t,e){Q();var i=ku(),n=/%[sdv%]/g,r=function(h){var l=1,p=arguments,g=p.length;return h.replace(n,function(f){if(l>=g)return f;var y=p[l];switch(l+=1,f){case"%%":return"%";case"%s":return String(y);case"%d":return Number(y);case"%v":return""}})},s=function(h,l,p){var g=l.format instanceof Function?l.format(l.push?p:p[l.name]):l.format,f=[h+"="+g];if(l.names)for(var y=0;y<l.names.length;y+=1){var x=l.names[y];l.name?f.push(p[l.name][x]):f.push(p[l.names[y]])}else f.push(p[l.name]);return r.apply(null,f)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(h,l){l=l||{},h.version==null&&(h.version=0),h.name==null&&(h.name=" "),h.media.forEach(function(y){y.payloads==null&&(y.payloads="")});var p=l.outerOrder||o,g=l.innerOrder||c,f=[];return p.forEach(function(y){i[y].forEach(function(x){x.name in h&&h[x.name]!=null?f.push(s(y,x,h)):x.push in h&&h[x.push]!=null&&h[x.push].forEach(function(S){f.push(s(y,x,S))})})}),h.media.forEach(function(y){f.push(s("m",i.m[0],y)),g.forEach(function(x){i[x].forEach(function(S){S.name in y&&y[S.name]!=null?f.push(s(x,S,y)):S.push in y&&y[S.push]!=null&&y[S.push].forEach(function(v){f.push(s(x,S,v))})})})}),f.join(`\r
`)+`\r
`}}}),hn=Ce({"../../node_modules/sdp-transform/lib/index.js"(t){Q();var e=Z_(),i=Y_(),n=ku();t.grammar=n,t.write=i,t.parse=e.parse,t.parseParams=e.parseParams,t.parseFmtpConfig=e.parseFmtpConfig,t.parsePayloads=e.parsePayloads,t.parseRemoteCandidates=e.parseRemoteCandidates,t.parseImageAttributes=e.parseImageAttributes,t.parseSimulcastStreamList=e.parseSimulcastStreamList}}),J_=Ce({"../../node_modules/ua-parser-js/src/ua-parser.js"(t,e){Q(),function(i,n){var r="1.0.40",s="",o="?",c="function",h="undefined",l="object",p="string",g="major",f="model",y="name",x="type",S="vendor",v="version",m="architecture",w="console",b="mobile",C="tablet",A="smarttv",M="wearable",F="embedded",N=500,P="Amazon",j="Apple",K="ASUS",X="BlackBerry",ie="Browser",q="Chrome",ae="Edge",pe="Firefox",ue="Google",xe="Huawei",Ee="LG",ye="Microsoft",ge="Motorola",Te="Opera",rt="Samsung",et="Sharp",tt="Sony",gt="Xiaomi",Lt="Zebra",St="Facebook",Kt="Chromium OS",Ei="Mac OS",Ut=" Browser",Pe=function(He,Oe){var Fe={};for(var it in He)Oe[it]&&Oe[it].length%2===0?Fe[it]=Oe[it].concat(He[it]):Fe[it]=He[it];return Fe},_i=function(He){for(var Oe={},Fe=0;Fe<He.length;Fe++)Oe[He[Fe].toUpperCase()]=He[Fe];return Oe},Mt=function(He,Oe){return typeof He===p?xt(Oe).indexOf(xt(He))!==-1:!1},xt=function(He){return He.toLowerCase()},Bt=function(He){return typeof He===p?He.replace(/[^\d\.]/g,s).split(".")[0]:n},li=function(He,Oe){if(typeof He===p)return He=He.replace(/^\s\s*/,s),typeof Oe===h?He:He.substring(0,N)},Ot=function(He,Oe){for(var Fe=0,it,$e,st,de,ke,Ve;Fe<Oe.length&&!ke;){var Ct=Oe[Fe],Tt=Oe[Fe+1];for(it=$e=0;it<Ct.length&&!ke&&Ct[it];)if(ke=Ct[it++].exec(He),ke)for(st=0;st<Tt.length;st++)Ve=ke[++$e],de=Tt[st],typeof de===l&&de.length>0?de.length===2?typeof de[1]==c?this[de[0]]=de[1].call(this,Ve):this[de[0]]=de[1]:de.length===3?typeof de[1]===c&&!(de[1].exec&&de[1].test)?this[de[0]]=Ve?de[1].call(this,Ve,de[2]):n:this[de[0]]=Ve?Ve.replace(de[1],de[2]):n:de.length===4&&(this[de[0]]=Ve?de[3].call(this,Ve.replace(de[1],de[2])):n):this[de]=Ve||n;Fe+=2}},Ht=function(He,Oe){for(var Fe in Oe)if(typeof Oe[Fe]===l&&Oe[Fe].length>0){for(var it=0;it<Oe[Fe].length;it++)if(Mt(Oe[Fe][it],He))return Fe===o?n:Fe}else if(Mt(Oe[Fe],He))return Fe===o?n:Fe;return Oe.hasOwnProperty("*")?Oe["*"]:He},ei={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ci={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},yi={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,v],[/opios[\/ ]+([\w\.]+)/i],[v,[y,Te+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[v,[y,Te+" GX"]],[/\bopr\/([\w\.]+)/i],[v,[y,Te]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[v,[y,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[v,[y,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,v],[/quark(?:pc)?\/([-\w\.]+)/i],[v,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[v,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[y,"UC"+ie]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[v,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[v,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[v,[y,"Smart Lenovo "+ie]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+ie],v],[/\bfocus\/([\w\.]+)/i],[v,[y,pe+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[y,Te+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[y,Te+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[y,"MIUI"+Ut]],[/fxios\/([\w\.-]+)/i],[v,[y,pe]],[/\bqihoobrowser\/?([\w\.]*)/i],[v,[y,"360"]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],v],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+Ut],v],[/samsungbrowser\/([\w\.]+)/i],[v,[y,rt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[v,[y,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,"Sogou Mobile"],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[y,v],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[y],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[v,y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,St],v],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[y,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[v,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[y,q+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,q+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[y,"Android "+ie]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[v,Ht,ei]],[/(webkit|khtml)\/([\w\.]+)/i],[y,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],v],[/(wolvic|librewolf)\/([\w\.]+)/i],[y,v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[y,pe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[y,[v,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,xt]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,s,xt]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,xt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[S,rt],[x,C]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[S,rt],[x,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[S,j],[x,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[S,j],[x,C]],[/(macintosh);/i],[f,[S,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[S,et],[x,b]],[/(?:honor)([-\w ]+)[;\)]/i],[f,[S,"Honor"],[x,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[S,xe],[x,C]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[S,xe],[x,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[f,/_/g," "],[S,gt],[x,b]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[S,gt],[x,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[S,"OPPO"],[x,b]],[/\b(opd2\d{3}a?) bui/i],[f,[S,"OPPO"],[x,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[S,"Vivo"],[x,b]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[S,"Realme"],[x,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[S,ge],[x,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[S,ge],[x,C]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[S,Ee],[x,C]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[S,Ee],[x,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[S,"Lenovo"],[x,C]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[S,"Nokia"],[x,b]],[/(pixel c)\b/i],[f,[S,ue],[x,C]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[S,ue],[x,b]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[S,tt],[x,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[S,tt],[x,C]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[S,"OnePlus"],[x,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[S,P],[x,C]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[S,P],[x,b]],[/(playbook);[-\w\),; ]+(rim)/i],[f,S,[x,C]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[S,X],[x,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[S,K],[x,C]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[S,K],[x,b]],[/(nexus 9)/i],[f,[S,"HTC"],[x,C]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[f,/_/g," "],[x,b]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[S,"TCL"],[x,C]],[/(itel) ((\w+))/i],[[S,xt],f,[x,Ht,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[S,"Acer"],[x,C]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[S,"Meizu"],[x,b]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[S,"Ulefone"],[x,b]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[S,"Energizer"],[x,b]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[S,"Cat"],[x,b]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[S,"Smartfren"],[x,b]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[S,"Nothing"],[x,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,f,[x,b]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,f,[x,C]],[/(surface duo)/i],[f,[S,ye],[x,C]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[S,"Fairphone"],[x,b]],[/(u304aa)/i],[f,[S,"AT&T"],[x,b]],[/\bsie-(\w*)/i],[f,[S,"Siemens"],[x,b]],[/\b(rct\w+) b/i],[f,[S,"RCA"],[x,C]],[/\b(venue[\d ]{2,7}) b/i],[f,[S,"Dell"],[x,C]],[/\b(q(?:mv|ta)\w+) b/i],[f,[S,"Verizon"],[x,C]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[S,"Barnes & Noble"],[x,C]],[/\b(tm\d{3}\w+) b/i],[f,[S,"NuVision"],[x,C]],[/\b(k88) b/i],[f,[S,"ZTE"],[x,C]],[/\b(nx\d{3}j) b/i],[f,[S,"ZTE"],[x,b]],[/\b(gen\d{3}) b.+49h/i],[f,[S,"Swiss"],[x,b]],[/\b(zur\d{3}) b/i],[f,[S,"Swiss"],[x,C]],[/\b((zeki)?tb.*\b) b/i],[f,[S,"Zeki"],[x,C]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],f,[x,C]],[/\b(ns-?\w{0,9}) b/i],[f,[S,"Insignia"],[x,C]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[S,"NextBook"],[x,C]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],f,[x,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],f,[x,b]],[/\b(ph-1) /i],[f,[S,"Essential"],[x,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[S,"Envizen"],[x,C]],[/\b(trio[-\w\. ]+) b/i],[f,[S,"MachSpeed"],[x,C]],[/\btu_(1491) b/i],[f,[S,"Rotor"],[x,C]],[/(shield[\w ]+) b/i],[f,[S,"Nvidia"],[x,C]],[/(sprint) (\w+)/i],[S,f,[x,b]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[S,ye],[x,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[S,Lt],[x,C]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[S,Lt],[x,b]],[/smart-tv.+(samsung)/i],[S,[x,A]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[S,rt],[x,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Ee],[x,A]],[/(apple) ?tv/i],[S,[f,j+" TV"],[x,A]],[/crkey/i],[[f,q+"cast"],[S,ue],[x,A]],[/droid.+aft(\w+)( bui|\))/i],[f,[S,P],[x,A]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[S,et],[x,A]],[/(bravia[\w ]+)( bui|\))/i],[f,[S,tt],[x,A]],[/(mitv-\w{5}) bui/i],[f,[S,gt],[x,A]],[/Hbbtv.*(technisat) (.*);/i],[S,f,[x,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,li],[f,li],[x,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,A]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,f,[x,w]],[/droid.+; (shield) bui/i],[f,[S,"Nvidia"],[x,w]],[/(playstation [345portablevi]+)/i],[f,[S,tt],[x,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[S,ye],[x,w]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[f,[S,rt],[x,M]],[/((pebble))app/i],[S,f,[x,M]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[S,j],[x,M]],[/droid.+; (glass) \d/i],[f,[S,ue],[x,M]],[/droid.+; (wt63?0{2,3})\)/i],[f,[S,Lt],[x,M]],[/droid.+; (glass) \d/i],[f,[S,ue],[x,M]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,f,[x,M]],[/; (quest( \d| pro)?)/i],[f,[S,St],[x,M]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[x,F]],[/(aeobc)\b/i],[f,[S,P],[x,F]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[x,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[x,C]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,C]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,b]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[y,ae+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[y,v],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,v],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[y,[v,Ht,Ci]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,Ht,Ci],[y,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Ei],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,v],[/\(bb(10);/i],[v,[y,X]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[y,pe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[y,q+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,Kt],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,v],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,v]]},ce=function(He,Oe){if(typeof He===l&&(Oe=He,He=n),!(this instanceof ce))return new ce(He,Oe).getResult();var Fe=typeof i!==h&&i.navigator?i.navigator:n,it=He||(Fe&&Fe.userAgent?Fe.userAgent:s),$e=Fe&&Fe.userAgentData?Fe.userAgentData:n,st=Oe?Pe(yi,Oe):yi,de=Fe&&Fe.userAgent==it;return this.getBrowser=function(){var ke={};return ke[y]=n,ke[v]=n,Ot.call(ke,it,st.browser),ke[g]=Bt(ke[v]),de&&Fe&&Fe.brave&&typeof Fe.brave.isBrave==c&&(ke[y]="Brave"),ke},this.getCPU=function(){var ke={};return ke[m]=n,Ot.call(ke,it,st.cpu),ke},this.getDevice=function(){var ke={};return ke[S]=n,ke[f]=n,ke[x]=n,Ot.call(ke,it,st.device),de&&!ke[x]&&$e&&$e.mobile&&(ke[x]=b),de&&ke[f]=="Macintosh"&&Fe&&typeof Fe.standalone!==h&&Fe.maxTouchPoints&&Fe.maxTouchPoints>2&&(ke[f]="iPad",ke[x]=C),ke},this.getEngine=function(){var ke={};return ke[y]=n,ke[v]=n,Ot.call(ke,it,st.engine),ke},this.getOS=function(){var ke={};return ke[y]=n,ke[v]=n,Ot.call(ke,it,st.os),de&&!ke[y]&&$e&&$e.platform&&$e.platform!="Unknown"&&(ke[y]=$e.platform.replace(/chrome os/i,Kt).replace(/macos/i,Ei)),ke},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return it},this.setUA=function(ke){return it=typeof ke===p&&ke.length>N?li(ke,N):ke,this},this.setUA(it),this};ce.VERSION=r,ce.BROWSER=_i([y,v,g]),ce.CPU=_i([m]),ce.DEVICE=_i([f,S,x,w,b,A,C,M,F]),ce.ENGINE=ce.OS=_i([y,v]),typeof t!==h?(typeof e!==h&&e.exports&&(t=e.exports=ce),t.UAParser=ce):typeof define===c&&define.amd?define(function(){return ce}):typeof i!==h&&(i.UAParser=ce);var te=typeof i!==h&&(i.jQuery||i.Zepto);if(te&&!te.ua){var De=new ce;te.ua=De.getResult(),te.ua.get=function(){return De.getUA()},te.ua.set=function(He){De.setUA(He);var Oe=De.getResult();for(var Fe in Oe)te.ua[Fe]=Oe[Fe]}}}(typeof window=="object"?window:t)}}),Q_=Ce({"../../node_modules/jsrsasign/lib/jsrsasign.js"(t){Q();var e={};e.userAgent=!1;var i={},n="11.1.0",r="jsrsasign(all) 11.1.0 (2024-02-01) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license",s=s||function(a,d){var u={},_=u.lib={},T=_.Base=function(){function D(){}return{extend:function(U){D.prototype=this;var k=new D;return U&&k.mixIn(U),k.hasOwnProperty("init")||(k.init=function(){k.$super.init.apply(this,arguments)}),k.init.prototype=k,k.$super=this,k},create:function(){var U=this.extend();return U.init.apply(U,arguments),U},init:function(){},mixIn:function(U){for(var k in U)U.hasOwnProperty(k)&&(this[k]=U[k]);U.hasOwnProperty("toString")&&(this.toString=U.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=_.WordArray=T.extend({init:function(D,U){D=this.words=D||[],U!=d?this.sigBytes=U:this.sigBytes=D.length*4},toString:function(D){return(D||I).stringify(this)},concat:function(D){var U=this.words,k=D.words,H=this.sigBytes,G=D.sigBytes;if(this.clamp(),H%4)for(var $=0;$<G;$++){var se=k[$>>>2]>>>24-$%4*8&255;U[H+$>>>2]|=se<<24-(H+$)%4*8}else for(var $=0;$<G;$+=4)U[H+$>>>2]=k[$>>>2];return this.sigBytes+=G,this},clamp:function(){var D=this.words,U=this.sigBytes;D[U>>>2]&=4294967295<<32-U%4*8,D.length=a.ceil(U/4)},clone:function(){var D=T.clone.call(this);return D.words=this.words.slice(0),D},random:function(D){for(var U=[],k=0;k<D;k+=4)U.push(a.random()*4294967296|0);return new E.init(U,D)}}),L=u.enc={},I=L.Hex={stringify:function(D){for(var U=D.words,k=D.sigBytes,H=[],G=0;G<k;G++){var $=U[G>>>2]>>>24-G%4*8&255;H.push(($>>>4).toString(16)),H.push(($&15).toString(16))}return H.join("")},parse:function(D){for(var U=D.length,k=[],H=0;H<U;H+=2)k[H>>>3]|=parseInt(D.substr(H,2),16)<<24-H%8*4;return new E.init(k,U/2)}},V=L.Latin1={stringify:function(D){for(var U=D.words,k=D.sigBytes,H=[],G=0;G<k;G++){var $=U[G>>>2]>>>24-G%4*8&255;H.push(String.fromCharCode($))}return H.join("")},parse:function(D){for(var U=D.length,k=[],H=0;H<U;H++)k[H>>>2]|=(D.charCodeAt(H)&255)<<24-H%4*8;return new E.init(k,U)}},O=L.Utf8={stringify:function(D){try{return decodeURIComponent(escape(V.stringify(D)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(D){return V.parse(unescape(encodeURIComponent(D)))}},W=_.BufferedBlockAlgorithm=T.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(D){typeof D=="string"&&(D=O.parse(D)),this._data.concat(D),this._nDataBytes+=D.sigBytes},_process:function(D){var U=this._data,k=U.words,H=U.sigBytes,G=this.blockSize,$=G*4,se=H/$;D?se=a.ceil(se):se=a.max((se|0)-this._minBufferSize,0);var me=se*G,fe=a.min(me*4,H);if(me){for(var _e=0;_e<me;_e+=G)this._doProcessBlock(k,_e);var Z=k.splice(0,me);U.sigBytes-=fe}return new E.init(Z,fe)},clone:function(){var D=T.clone.call(this);return D._data=this._data.clone(),D},_minBufferSize:0});_.Hasher=W.extend({cfg:T.extend(),init:function(D){this.cfg=this.cfg.extend(D),this.reset()},reset:function(){W.reset.call(this),this._doReset()},update:function(D){return this._append(D),this._process(),this},finalize:function(D){D&&this._append(D);var U=this._doFinalize();return U},blockSize:512/32,_createHelper:function(D){return function(U,k){return new D.init(k).finalize(U)}},_createHmacHelper:function(D){return function(U,k){return new z.HMAC.init(D,k).finalize(U)}}});var z=u.algo={};return u}(Math);(function(a){var T=s,d=T.lib,u=d.Base,_=d.WordArray,T=T.x64={};T.Word=u.extend({init:function(E,L){this.high=E,this.low=L}}),T.WordArray=u.extend({init:function(E,L){E=this.words=E||[],this.sigBytes=L!=a?L:8*E.length},toX32:function(){for(var E=this.words,L=E.length,I=[],V=0;V<L;V++){var O=E[V];I.push(O.high),I.push(O.low)}return _.create(I,this.sigBytes)},clone:function(){for(var E=u.clone.call(this),L=E.words=this.words.slice(0),I=L.length,V=0;V<I;V++)L[V]=L[V].clone();return E}})})(),s.lib.Cipher||function(a){var U=s,d=U.lib,u=d.Base,_=d.WordArray,T=d.BufferedBlockAlgorithm,E=U.enc.Base64,L=U.algo.EvpKDF,I=d.Cipher=T.extend({cfg:u.extend(),createEncryptor:function(H,G){return this.create(this._ENC_XFORM_MODE,H,G)},createDecryptor:function(H,G){return this.create(this._DEC_XFORM_MODE,H,G)},init:function(H,G,$){this.cfg=this.cfg.extend($),this._xformMode=H,this._key=G,this.reset()},reset:function(){T.reset.call(this),this._doReset()},process:function(H){return this._append(H),this._process()},finalize:function(H){return H&&this._append(H),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(H){return{encrypt:function(G,$,se){return(typeof $=="string"?k:D).encrypt(H,G,$,se)},decrypt:function(G,$,se){return(typeof $=="string"?k:D).decrypt(H,G,$,se)}}}});d.StreamCipher=I.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var z=U.mode={},V=function(H,G,$){var se=this._iv;se?this._iv=a:se=this._prevBlock;for(var me=0;me<$;me++)H[G+me]^=se[me]},O=(d.BlockCipherMode=u.extend({createEncryptor:function(H,G){return this.Encryptor.create(H,G)},createDecryptor:function(H,G){return this.Decryptor.create(H,G)},init:function(H,G){this._cipher=H,this._iv=G}})).extend();O.Encryptor=O.extend({processBlock:function(H,G){var $=this._cipher,se=$.blockSize;V.call(this,H,G,se),$.encryptBlock(H,G),this._prevBlock=H.slice(G,G+se)}}),O.Decryptor=O.extend({processBlock:function(H,G){var $=this._cipher,se=$.blockSize,me=H.slice(G,G+se);$.decryptBlock(H,G),V.call(this,H,G,se),this._prevBlock=me}}),z=z.CBC=O,O=(U.pad={}).Pkcs7={pad:function(H,G){for(var $=4*G,$=$-H.sigBytes%$,se=$<<24|$<<16|$<<8|$,me=[],fe=0;fe<$;fe+=4)me.push(se);$=_.create(me,$),H.concat($)},unpad:function(H){H.sigBytes-=H.words[H.sigBytes-1>>>2]&255}},d.BlockCipher=I.extend({cfg:I.cfg.extend({mode:z,padding:O}),reset:function(){I.reset.call(this);var G=this.cfg,H=G.iv,G=G.mode;if(this._xformMode==this._ENC_XFORM_MODE)var $=G.createEncryptor;else $=G.createDecryptor,this._minBufferSize=1;this._mode=$.call(G,this,H&&H.words)},_doProcessBlock:function(H,G){this._mode.processBlock(H,G)},_doFinalize:function(){var H=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){H.pad(this._data,this.blockSize);var G=this._process(!0)}else G=this._process(!0),H.unpad(G);return G},blockSize:4});var W=d.CipherParams=u.extend({init:function(H){this.mixIn(H)},toString:function(H){return(H||this.formatter).stringify(this)}}),z=(U.format={}).OpenSSL={stringify:function(H){var G=H.ciphertext;return H=H.salt,(H?_.create([1398893684,1701076831]).concat(H).concat(G):G).toString(E)},parse:function(H){H=E.parse(H);var G=H.words;if(G[0]==1398893684&&G[1]==1701076831){var $=_.create(G.slice(2,4));G.splice(0,4),H.sigBytes-=16}return W.create({ciphertext:H,salt:$})}},D=d.SerializableCipher=u.extend({cfg:u.extend({format:z}),encrypt:function(H,G,$,se){se=this.cfg.extend(se);var me=H.createEncryptor($,se);return G=me.finalize(G),me=me.cfg,W.create({ciphertext:G,key:$,iv:me.iv,algorithm:H,mode:me.mode,padding:me.padding,blockSize:H.blockSize,formatter:se.format})},decrypt:function(H,G,$,se){return se=this.cfg.extend(se),G=this._parse(G,se.format),H.createDecryptor($,se).finalize(G.ciphertext)},_parse:function(H,G){return typeof H=="string"?G.parse(H,this):H}}),U=(U.kdf={}).OpenSSL={execute:function(H,G,$,se){return se||(se=_.random(8)),H=L.create({keySize:G+$}).compute(H,se),$=_.create(H.words.slice(G),4*$),H.sigBytes=4*G,W.create({key:H,iv:$,salt:se})}},k=d.PasswordBasedCipher=D.extend({cfg:D.cfg.extend({kdf:U}),encrypt:function(H,G,$,se){return se=this.cfg.extend(se),$=se.kdf.execute($,H.keySize,H.ivSize),se.iv=$.iv,H=D.encrypt.call(this,H,G,$.key,se),H.mixIn($),H},decrypt:function(H,G,$,se){return se=this.cfg.extend(se),G=this._parse(G,se.format),$=se.kdf.execute($,H.keySize,H.ivSize,G.salt),se.iv=$.iv,D.decrypt.call(this,H,G,$.key,se)}})}(),function(){for(var a=s,d=a.lib.BlockCipher,Z=a.algo,u=[],_=[],T=[],E=[],L=[],I=[],V=[],O=[],W=[],z=[],D=[],U=0;256>U;U++)D[U]=128>U?U<<1:U<<1^283;for(var k=0,H=0,U=0;256>U;U++){var G=H^H<<1^H<<2^H<<3^H<<4,G=G>>>8^G&255^99;u[k]=G,_[G]=k;var $=D[k],se=D[$],me=D[se],fe=257*D[G]^16843008*G;T[k]=fe<<24|fe>>>8,E[k]=fe<<16|fe>>>16,L[k]=fe<<8|fe>>>24,I[k]=fe,fe=16843009*me^65537*se^257*$^16843008*k,V[G]=fe<<24|fe>>>8,O[G]=fe<<16|fe>>>16,W[G]=fe<<8|fe>>>24,z[G]=fe,k?(k=$^D[D[D[me^$]]],H^=D[D[H]]):k=H=1}var _e=[0,1,2,4,8,16,32,64,128,27,54],Z=Z.AES=d.extend({_doReset:function(){for(var Y=this._key,J=Y.words,ee=Y.sigBytes/4,Y=4*((this._nRounds=ee+6)+1),re=this._keySchedule=[],ve=0;ve<Y;ve++)if(ve<ee)re[ve]=J[ve];else{var Se=re[ve-1];ve%ee?6<ee&&ve%ee==4&&(Se=u[Se>>>24]<<24|u[Se>>>16&255]<<16|u[Se>>>8&255]<<8|u[Se&255]):(Se=Se<<8|Se>>>24,Se=u[Se>>>24]<<24|u[Se>>>16&255]<<16|u[Se>>>8&255]<<8|u[Se&255],Se^=_e[ve/ee|0]<<24),re[ve]=re[ve-ee]^Se}for(J=this._invKeySchedule=[],ee=0;ee<Y;ee++)ve=Y-ee,Se=ee%4?re[ve]:re[ve-4],J[ee]=4>ee||4>=ve?Se:V[u[Se>>>24]]^O[u[Se>>>16&255]]^W[u[Se>>>8&255]]^z[u[Se&255]]},encryptBlock:function(J,ee){this._doCryptBlock(J,ee,this._keySchedule,T,E,L,I,u)},decryptBlock:function(J,ee){var Y=J[ee+1];J[ee+1]=J[ee+3],J[ee+3]=Y,this._doCryptBlock(J,ee,this._invKeySchedule,V,O,W,z,_),Y=J[ee+1],J[ee+1]=J[ee+3],J[ee+3]=Y},_doCryptBlock:function(J,ee,Y,re,ve,Se,ze,be){for(var Re=this._nRounds,tn=J[ee]^Y[0],an=J[ee+1]^Y[1],nn=J[ee+2]^Y[2],zi=J[ee+3]^Y[3],Ge=4,We=1;We<Re;We++)var mn=re[tn>>>24]^ve[an>>>16&255]^Se[nn>>>8&255]^ze[zi&255]^Y[Ge++],Fi=re[an>>>24]^ve[nn>>>16&255]^Se[zi>>>8&255]^ze[tn&255]^Y[Ge++],Ti=re[nn>>>24]^ve[zi>>>16&255]^Se[tn>>>8&255]^ze[an&255]^Y[Ge++],zi=re[zi>>>24]^ve[tn>>>16&255]^Se[an>>>8&255]^ze[nn&255]^Y[Ge++],tn=mn,an=Fi,nn=Ti;mn=(be[tn>>>24]<<24|be[an>>>16&255]<<16|be[nn>>>8&255]<<8|be[zi&255])^Y[Ge++],Fi=(be[an>>>24]<<24|be[nn>>>16&255]<<16|be[zi>>>8&255]<<8|be[tn&255])^Y[Ge++],Ti=(be[nn>>>24]<<24|be[zi>>>16&255]<<16|be[tn>>>8&255]<<8|be[an&255])^Y[Ge++],zi=(be[zi>>>24]<<24|be[tn>>>16&255]<<16|be[an>>>8&255]<<8|be[nn&255])^Y[Ge++],J[ee]=mn,J[ee+1]=Fi,J[ee+2]=Ti,J[ee+3]=zi},keySize:8});a.AES=d._createHelper(Z)}(),function(){function a(D,U){var k=(this._lBlock>>>D^this._rBlock)&U;this._rBlock^=k,this._lBlock^=k<<D}function d(D,U){var k=(this._rBlock>>>D^this._lBlock)&U;this._lBlock^=k,this._rBlock^=k<<D}var u=s,T=u.lib,_=T.WordArray,T=T.BlockCipher,E=u.algo,L=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],I=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],V=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],O=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],W=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],z=E.DES=T.extend({_doReset:function(){for(var D=this._key.words,U=[],k=0;56>k;k++){var H=L[k]-1;U[k]=D[H>>>5]>>>31-H%32&1}for(D=this._subKeys=[],H=0;16>H;H++){for(var G=D[H]=[],$=V[H],k=0;24>k;k++)G[k/6|0]|=U[(I[k]-1+$)%28]<<31-k%6,G[4+(k/6|0)]|=U[28+(I[k+24]-1+$)%28]<<31-k%6;for(G[0]=G[0]<<1|G[0]>>>31,k=1;7>k;k++)G[k]>>>=4*(k-1)+3;G[7]=G[7]<<5|G[7]>>>27}for(U=this._invSubKeys=[],k=0;16>k;k++)U[k]=D[15-k]},encryptBlock:function(D,U){this._doCryptBlock(D,U,this._subKeys)},decryptBlock:function(D,U){this._doCryptBlock(D,U,this._invSubKeys)},_doCryptBlock:function(D,U,k){this._lBlock=D[U],this._rBlock=D[U+1],a.call(this,4,252645135),a.call(this,16,65535),d.call(this,2,858993459),d.call(this,8,16711935),a.call(this,1,1431655765);for(var H=0;16>H;H++){for(var G=k[H],$=this._lBlock,se=this._rBlock,me=0,fe=0;8>fe;fe++)me|=O[fe][((se^G[fe])&W[fe])>>>0];this._lBlock=se,this._rBlock=$^me}k=this._lBlock,this._lBlock=this._rBlock,this._rBlock=k,a.call(this,1,1431655765),d.call(this,8,16711935),d.call(this,2,858993459),a.call(this,16,65535),a.call(this,4,252645135),D[U]=this._lBlock,D[U+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});u.DES=T._createHelper(z),E=E.TripleDES=T.extend({_doReset:function(){var D=this._key.words;this._des1=z.createEncryptor(_.create(D.slice(0,2))),this._des2=z.createEncryptor(_.create(D.slice(2,4))),this._des3=z.createEncryptor(_.create(D.slice(4,6)))},encryptBlock:function(D,U){this._des1.encryptBlock(D,U),this._des2.decryptBlock(D,U),this._des3.encryptBlock(D,U)},decryptBlock:function(D,U){this._des3.decryptBlock(D,U),this._des2.encryptBlock(D,U),this._des1.decryptBlock(D,U)},keySize:6,ivSize:2,blockSize:2}),u.TripleDES=T._createHelper(E)}(),function(){var a=s,d=a.lib.WordArray;a.enc.Base64={stringify:function(u){var _=u.words,T=u.sigBytes,E=this._map;u.clamp(),u=[];for(var L=0;L<T;L+=3)for(var I=(_[L>>>2]>>>24-8*(L%4)&255)<<16|(_[L+1>>>2]>>>24-8*((L+1)%4)&255)<<8|_[L+2>>>2]>>>24-8*((L+2)%4)&255,V=0;4>V&&L+.75*V<T;V++)u.push(E.charAt(I>>>6*(3-V)&63));if(_=E.charAt(64))for(;u.length%4;)u.push(_);return u.join("")},parse:function(u){var _=u.length,T=this._map,E=T.charAt(64);E&&(E=u.indexOf(E),E!=-1&&(_=E));for(var E=[],L=0,I=0;I<_;I++)if(I%4){var V=T.indexOf(u.charAt(I-1))<<2*(I%4),O=T.indexOf(u.charAt(I))>>>6-2*(I%4);E[L>>>2]|=(V|O)<<24-8*(L%4),L++}return d.create(E,L)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(a){function d(z,D,U,k,H,G,$){return z=z+(D&U|~D&k)+H+$,(z<<G|z>>>32-G)+D}function u(z,D,U,k,H,G,$){return z=z+(D&k|U&~k)+H+$,(z<<G|z>>>32-G)+D}function _(z,D,U,k,H,G,$){return z=z+(D^U^k)+H+$,(z<<G|z>>>32-G)+D}function T(z,D,U,k,H,G,$){return z=z+(U^(D|~k))+H+$,(z<<G|z>>>32-G)+D}for(var E=s,V=E.lib,L=V.WordArray,I=V.Hasher,V=E.algo,O=[],W=0;64>W;W++)O[W]=4294967296*a.abs(a.sin(W+1))|0;V=V.MD5=I.extend({_doReset:function(){this._hash=new L.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(z,D){for(var U=0;16>U;U++){var k=D+U,H=z[k];z[k]=(H<<8|H>>>24)&16711935|(H<<24|H>>>8)&4278255360}var U=this._hash.words,k=z[D+0],H=z[D+1],G=z[D+2],$=z[D+3],se=z[D+4],me=z[D+5],fe=z[D+6],_e=z[D+7],Z=z[D+8],J=z[D+9],ee=z[D+10],Y=z[D+11],re=z[D+12],ve=z[D+13],Se=z[D+14],ze=z[D+15],be=U[0],We=U[1],Ge=U[2],Re=U[3],be=d(be,We,Ge,Re,k,7,O[0]),Re=d(Re,be,We,Ge,H,12,O[1]),Ge=d(Ge,Re,be,We,G,17,O[2]),We=d(We,Ge,Re,be,$,22,O[3]),be=d(be,We,Ge,Re,se,7,O[4]),Re=d(Re,be,We,Ge,me,12,O[5]),Ge=d(Ge,Re,be,We,fe,17,O[6]),We=d(We,Ge,Re,be,_e,22,O[7]),be=d(be,We,Ge,Re,Z,7,O[8]),Re=d(Re,be,We,Ge,J,12,O[9]),Ge=d(Ge,Re,be,We,ee,17,O[10]),We=d(We,Ge,Re,be,Y,22,O[11]),be=d(be,We,Ge,Re,re,7,O[12]),Re=d(Re,be,We,Ge,ve,12,O[13]),Ge=d(Ge,Re,be,We,Se,17,O[14]),We=d(We,Ge,Re,be,ze,22,O[15]),be=u(be,We,Ge,Re,H,5,O[16]),Re=u(Re,be,We,Ge,fe,9,O[17]),Ge=u(Ge,Re,be,We,Y,14,O[18]),We=u(We,Ge,Re,be,k,20,O[19]),be=u(be,We,Ge,Re,me,5,O[20]),Re=u(Re,be,We,Ge,ee,9,O[21]),Ge=u(Ge,Re,be,We,ze,14,O[22]),We=u(We,Ge,Re,be,se,20,O[23]),be=u(be,We,Ge,Re,J,5,O[24]),Re=u(Re,be,We,Ge,Se,9,O[25]),Ge=u(Ge,Re,be,We,$,14,O[26]),We=u(We,Ge,Re,be,Z,20,O[27]),be=u(be,We,Ge,Re,ve,5,O[28]),Re=u(Re,be,We,Ge,G,9,O[29]),Ge=u(Ge,Re,be,We,_e,14,O[30]),We=u(We,Ge,Re,be,re,20,O[31]),be=_(be,We,Ge,Re,me,4,O[32]),Re=_(Re,be,We,Ge,Z,11,O[33]),Ge=_(Ge,Re,be,We,Y,16,O[34]),We=_(We,Ge,Re,be,Se,23,O[35]),be=_(be,We,Ge,Re,H,4,O[36]),Re=_(Re,be,We,Ge,se,11,O[37]),Ge=_(Ge,Re,be,We,_e,16,O[38]),We=_(We,Ge,Re,be,ee,23,O[39]),be=_(be,We,Ge,Re,ve,4,O[40]),Re=_(Re,be,We,Ge,k,11,O[41]),Ge=_(Ge,Re,be,We,$,16,O[42]),We=_(We,Ge,Re,be,fe,23,O[43]),be=_(be,We,Ge,Re,J,4,O[44]),Re=_(Re,be,We,Ge,re,11,O[45]),Ge=_(Ge,Re,be,We,ze,16,O[46]),We=_(We,Ge,Re,be,G,23,O[47]),be=T(be,We,Ge,Re,k,6,O[48]),Re=T(Re,be,We,Ge,_e,10,O[49]),Ge=T(Ge,Re,be,We,Se,15,O[50]),We=T(We,Ge,Re,be,me,21,O[51]),be=T(be,We,Ge,Re,re,6,O[52]),Re=T(Re,be,We,Ge,$,10,O[53]),Ge=T(Ge,Re,be,We,ee,15,O[54]),We=T(We,Ge,Re,be,H,21,O[55]),be=T(be,We,Ge,Re,Z,6,O[56]),Re=T(Re,be,We,Ge,ze,10,O[57]),Ge=T(Ge,Re,be,We,fe,15,O[58]),We=T(We,Ge,Re,be,ve,21,O[59]),be=T(be,We,Ge,Re,se,6,O[60]),Re=T(Re,be,We,Ge,Y,10,O[61]),Ge=T(Ge,Re,be,We,G,15,O[62]),We=T(We,Ge,Re,be,J,21,O[63]);U[0]=U[0]+be|0,U[1]=U[1]+We|0,U[2]=U[2]+Ge|0,U[3]=U[3]+Re|0},_doFinalize:function(){var z=this._data,D=z.words,U=8*this._nDataBytes,k=8*z.sigBytes;D[k>>>5]|=128<<24-k%32;var H=a.floor(U/4294967296);for(D[(k+64>>>9<<4)+15]=(H<<8|H>>>24)&16711935|(H<<24|H>>>8)&4278255360,D[(k+64>>>9<<4)+14]=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360,z.sigBytes=4*(D.length+1),this._process(),z=this._hash,D=z.words,U=0;4>U;U++)k=D[U],D[U]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360;return z},clone:function(){var z=I.clone.call(this);return z._hash=this._hash.clone(),z}}),E.MD5=I._createHelper(V),E.HmacMD5=I._createHmacHelper(V)}(Math),function(){var a=s,T=a.lib,d=T.WordArray,u=T.Hasher,_=[],T=a.algo.SHA1=u.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,L){for(var I=this._hash.words,V=I[0],O=I[1],W=I[2],z=I[3],D=I[4],U=0;80>U;U++){if(16>U)_[U]=E[L+U]|0;else{var k=_[U-3]^_[U-8]^_[U-14]^_[U-16];_[U]=k<<1|k>>>31}k=(V<<5|V>>>27)+D+_[U],k=20>U?k+((O&W|~O&z)+1518500249):40>U?k+((O^W^z)+1859775393):60>U?k+((O&W|O&z|W&z)-1894007588):k+((O^W^z)-899497514),D=z,z=W,W=O<<30|O>>>2,O=V,V=k}I[0]=I[0]+V|0,I[1]=I[1]+O|0,I[2]=I[2]+W|0,I[3]=I[3]+z|0,I[4]=I[4]+D|0},_doFinalize:function(){var E=this._data,L=E.words,I=8*this._nDataBytes,V=8*E.sigBytes;return L[V>>>5]|=128<<24-V%32,L[(V+64>>>9<<4)+14]=Math.floor(I/4294967296),L[(V+64>>>9<<4)+15]=I,E.sigBytes=4*L.length,this._process(),this._hash},clone:function(){var E=u.clone.call(this);return E._hash=this._hash.clone(),E}});a.SHA1=u._createHelper(T),a.HmacSHA1=u._createHmacHelper(T)}(),function(a){for(var d=s,U=d.lib,u=U.WordArray,_=U.Hasher,U=d.algo,T=[],E=[],L=function(H){return 4294967296*(H-(H|0))|0},I=2,V=0;64>V;){var O;e:{O=I;for(var W=a.sqrt(O),z=2;z<=W;z++)if(!(O%z)){O=!1;break e}O=!0}O&&(8>V&&(T[V]=L(a.pow(I,.5))),E[V]=L(a.pow(I,1/3)),V++),I++}var D=[],U=U.SHA256=_.extend({_doReset:function(){this._hash=new u.init(T.slice(0))},_doProcessBlock:function(k,H){for(var G=this._hash.words,$=G[0],se=G[1],me=G[2],fe=G[3],_e=G[4],Z=G[5],J=G[6],ee=G[7],Y=0;64>Y;Y++){if(16>Y)D[Y]=k[H+Y]|0;else{var re=D[Y-15],ve=D[Y-2];D[Y]=((re<<25|re>>>7)^(re<<14|re>>>18)^re>>>3)+D[Y-7]+((ve<<15|ve>>>17)^(ve<<13|ve>>>19)^ve>>>10)+D[Y-16]}re=ee+((_e<<26|_e>>>6)^(_e<<21|_e>>>11)^(_e<<7|_e>>>25))+(_e&Z^~_e&J)+E[Y]+D[Y],ve=(($<<30|$>>>2)^($<<19|$>>>13)^($<<10|$>>>22))+($&se^$&me^se&me),ee=J,J=Z,Z=_e,_e=fe+re|0,fe=me,me=se,se=$,$=re+ve|0}G[0]=G[0]+$|0,G[1]=G[1]+se|0,G[2]=G[2]+me|0,G[3]=G[3]+fe|0,G[4]=G[4]+_e|0,G[5]=G[5]+Z|0,G[6]=G[6]+J|0,G[7]=G[7]+ee|0},_doFinalize:function(){var k=this._data,H=k.words,G=8*this._nDataBytes,$=8*k.sigBytes;return H[$>>>5]|=128<<24-$%32,H[($+64>>>9<<4)+14]=a.floor(G/4294967296),H[($+64>>>9<<4)+15]=G,k.sigBytes=4*H.length,this._process(),this._hash},clone:function(){var k=_.clone.call(this);return k._hash=this._hash.clone(),k}});d.SHA256=_._createHelper(U),d.HmacSHA256=_._createHmacHelper(U)}(Math),function(){var a=s,d=a.lib.WordArray,_=a.algo,u=_.SHA256,_=_.SHA224=u.extend({_doReset:function(){this._hash=new d.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var T=u._doFinalize.call(this);return T.sigBytes-=4,T}});a.SHA224=u._createHelper(_),a.HmacSHA224=u._createHmacHelper(_)}(),function(){function a(){return _.create.apply(_,arguments)}for(var d=s,u=d.lib.Hasher,E=d.x64,_=E.Word,T=E.WordArray,E=d.algo,L=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],I=[],V=0;80>V;V++)I[V]=a();E=E.SHA512=u.extend({_doReset:function(){this._hash=new T.init([new _.init(1779033703,4089235720),new _.init(3144134277,2227873595),new _.init(1013904242,4271175723),new _.init(2773480762,1595750129),new _.init(1359893119,2917565137),new _.init(2600822924,725511199),new _.init(528734635,4215389547),new _.init(1541459225,327033209)])},_doProcessBlock:function(O,W){for(var se=this._hash.words,z=se[0],D=se[1],U=se[2],k=se[3],H=se[4],G=se[5],$=se[6],se=se[7],me=z.high,fe=z.low,_e=D.high,Z=D.low,J=U.high,ee=U.low,Y=k.high,re=k.low,ve=H.high,Se=H.low,ze=G.high,be=G.low,Re=$.high,Ge=$.low,We=se.high,mn=se.low,Fi=me,Ti=fe,zi=_e,tn=Z,an=J,nn=ee,go=Y,xn=re,ci=ve,bi=Se,ki=ze,Ni=be,On=Re,Hi=Ge,vo=We,qs=mn,br=0;80>br;br++){var _s=I[br];if(16>br)var cr=_s.high=O[W+2*br]|0,fi=_s.low=O[W+2*br+1]|0;else{var cr=I[br-15],fi=cr.high,jr=cr.low,cr=(fi>>>1|jr<<31)^(fi>>>8|jr<<24)^fi>>>7,jr=(jr>>>1|fi<<31)^(jr>>>8|fi<<24)^(jr>>>7|fi<<25),Ws=I[br-2],fi=Ws.high,Pi=Ws.low,Ws=(fi>>>19|Pi<<13)^(fi<<3|Pi>>>29)^fi>>>6,Pi=(Pi>>>19|fi<<13)^(Pi<<3|fi>>>29)^(Pi>>>6|fi<<26),fi=I[br-7],dd=fi.high,vs=I[br-16],Vr=vs.high,vs=vs.low,fi=jr+fi.low,cr=cr+dd+(fi>>>0<jr>>>0?1:0),fi=fi+Pi,cr=cr+Ws+(fi>>>0<Pi>>>0?1:0),fi=fi+vs,cr=cr+Vr+(fi>>>0<vs>>>0?1:0);_s.high=cr,_s.low=fi}var dd=ci&ki^~ci&On,vs=bi&Ni^~bi&Hi,_s=Fi&zi^Fi&an^zi&an,O_=Ti&tn^Ti&nn^tn&nn,jr=(Fi>>>28|Ti<<4)^(Fi<<30|Ti>>>2)^(Fi<<25|Ti>>>7),Ws=(Ti>>>28|Fi<<4)^(Ti<<30|Fi>>>2)^(Ti<<25|Fi>>>7),Pi=L[br],U_=Pi.high,xh=Pi.low,Pi=qs+((bi>>>14|ci<<18)^(bi>>>18|ci<<14)^(bi<<23|ci>>>9)),Vr=vo+((ci>>>14|bi<<18)^(ci>>>18|bi<<14)^(ci<<23|bi>>>9))+(Pi>>>0<qs>>>0?1:0),Pi=Pi+vs,Vr=Vr+dd+(Pi>>>0<vs>>>0?1:0),Pi=Pi+xh,Vr=Vr+U_+(Pi>>>0<xh>>>0?1:0),Pi=Pi+fi,Vr=Vr+cr+(Pi>>>0<fi>>>0?1:0),fi=Ws+O_,_s=jr+_s+(fi>>>0<Ws>>>0?1:0),vo=On,qs=Hi,On=ki,Hi=Ni,ki=ci,Ni=bi,bi=xn+Pi|0,ci=go+Vr+(bi>>>0<xn>>>0?1:0)|0,go=an,xn=nn,an=zi,nn=tn,zi=Fi,tn=Ti,Ti=Pi+fi|0,Fi=Vr+_s+(Ti>>>0<Pi>>>0?1:0)|0}fe=z.low=fe+Ti,z.high=me+Fi+(fe>>>0<Ti>>>0?1:0),Z=D.low=Z+tn,D.high=_e+zi+(Z>>>0<tn>>>0?1:0),ee=U.low=ee+nn,U.high=J+an+(ee>>>0<nn>>>0?1:0),re=k.low=re+xn,k.high=Y+go+(re>>>0<xn>>>0?1:0),Se=H.low=Se+bi,H.high=ve+ci+(Se>>>0<bi>>>0?1:0),be=G.low=be+Ni,G.high=ze+ki+(be>>>0<Ni>>>0?1:0),Ge=$.low=Ge+Hi,$.high=Re+On+(Ge>>>0<Hi>>>0?1:0),mn=se.low=mn+qs,se.high=We+vo+(mn>>>0<qs>>>0?1:0)},_doFinalize:function(){var O=this._data,W=O.words,z=8*this._nDataBytes,D=8*O.sigBytes;return W[D>>>5]|=128<<24-D%32,W[(D+128>>>10<<5)+30]=Math.floor(z/4294967296),W[(D+128>>>10<<5)+31]=z,O.sigBytes=4*W.length,this._process(),this._hash.toX32()},clone:function(){var O=u.clone.call(this);return O._hash=this._hash.clone(),O},blockSize:32}),d.SHA512=u._createHelper(E),d.HmacSHA512=u._createHmacHelper(E)}(),function(){var a=s,T=a.x64,d=T.Word,u=T.WordArray,T=a.algo,_=T.SHA512,T=T.SHA384=_.extend({_doReset:function(){this._hash=new u.init([new d.init(3418070365,3238371032),new d.init(1654270250,914150663),new d.init(2438529370,812702999),new d.init(355462360,4144912697),new d.init(1731405415,4290775857),new d.init(2394180231,1750603025),new d.init(3675008525,1694076839),new d.init(1203062813,3204075428)])},_doFinalize:function(){var E=_._doFinalize.call(this);return E.sigBytes-=16,E}});a.SHA384=_._createHelper(T),a.HmacSHA384=_._createHmacHelper(T)}(),function(){var a=s,O=a.lib,d=O.WordArray,u=O.Hasher,O=a.algo,_=d.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),T=d.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),E=d.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),L=d.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),I=d.create([0,1518500249,1859775393,2400959708,2840853838]),V=d.create([1352829926,1548603684,1836072691,2053994217,0]),O=O.RIPEMD160=u.extend({_doReset:function(){this._hash=d.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(W,z){for(var D=0;16>D;D++){var U=z+D,k=W[U];W[U]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360}var U=this._hash.words,k=I.words,H=V.words,G=_.words,$=T.words,se=E.words,me=L.words,fe,_e,Z,J,ee,Y,re,ve,Se,ze;Y=fe=U[0],re=_e=U[1],ve=Z=U[2],Se=J=U[3],ze=ee=U[4];for(var be,D=0;80>D;D+=1)be=fe+W[z+G[D]]|0,be=16>D?be+((_e^Z^J)+k[0]):32>D?be+((_e&Z|~_e&J)+k[1]):48>D?be+(((_e|~Z)^J)+k[2]):64>D?be+((_e&J|Z&~J)+k[3]):be+((_e^(Z|~J))+k[4]),be|=0,be=be<<se[D]|be>>>32-se[D],be=be+ee|0,fe=ee,ee=J,J=Z<<10|Z>>>22,Z=_e,_e=be,be=Y+W[z+$[D]]|0,be=16>D?be+((re^(ve|~Se))+H[0]):32>D?be+((re&Se|ve&~Se)+H[1]):48>D?be+(((re|~ve)^Se)+H[2]):64>D?be+((re&ve|~re&Se)+H[3]):be+((re^ve^Se)+H[4]),be|=0,be=be<<me[D]|be>>>32-me[D],be=be+ze|0,Y=ze,ze=Se,Se=ve<<10|ve>>>22,ve=re,re=be;be=U[1]+Z+Se|0,U[1]=U[2]+J+ze|0,U[2]=U[3]+ee+Y|0,U[3]=U[4]+fe+re|0,U[4]=U[0]+_e+ve|0,U[0]=be},_doFinalize:function(){var W=this._data,z=W.words,D=8*this._nDataBytes,U=8*W.sigBytes;for(z[U>>>5]|=128<<24-U%32,z[(U+64>>>9<<4)+14]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,W.sigBytes=4*(z.length+1),this._process(),W=this._hash,z=W.words,D=0;5>D;D++)U=z[D],z[D]=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360;return W},clone:function(){var W=u.clone.call(this);return W._hash=this._hash.clone(),W}});a.RIPEMD160=u._createHelper(O),a.HmacRIPEMD160=u._createHmacHelper(O)}(),function(){var a=s,d=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(u,_){u=this._hasher=new u.init,typeof _=="string"&&(_=d.parse(_));var T=u.blockSize,E=4*T;_.sigBytes>E&&(_=u.finalize(_)),_.clamp();for(var L=this._oKey=_.clone(),I=this._iKey=_.clone(),V=L.words,O=I.words,W=0;W<T;W++)V[W]^=1549556828,O[W]^=909522486;L.sigBytes=I.sigBytes=E,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var _=this._hasher;return u=_.finalize(u),_.reset(),_.finalize(this._oKey.clone().concat(u))}})}(),function(){var a=s,_=a.lib,d=_.Base,u=_.WordArray,_=a.algo,T=_.HMAC,E=_.PBKDF2=d.extend({cfg:d.extend({keySize:4,hasher:_.SHA1,iterations:1}),init:function(L){this.cfg=this.cfg.extend(L)},compute:function(L,I){for(var k=this.cfg,V=T.create(k.hasher,L),O=u.create(),W=u.create([1]),z=O.words,D=W.words,U=k.keySize,k=k.iterations;z.length<U;){var H=V.update(I).finalize(W);V.reset();for(var G=H.words,$=G.length,se=H,me=1;me<k;me++){se=V.finalize(se),V.reset();for(var fe=se.words,_e=0;_e<$;_e++)G[_e]^=fe[_e]}O.concat(H),D[0]++}return O.sigBytes=4*U,O}});a.PBKDF2=function(L,I,V){return E.create(V).compute(L,I)}}();var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="=";function h(a){var d,u,_="";for(d=0;d+3<=a.length;d+=3)u=parseInt(a.substring(d,d+3),16),_+=o.charAt(u>>6)+o.charAt(u&63);for(d+1==a.length?(u=parseInt(a.substring(d,d+1),16),_+=o.charAt(u<<2)):d+2==a.length&&(u=parseInt(a.substring(d,d+2),16),_+=o.charAt(u>>2)+o.charAt((u&3)<<4));(_.length&3)>0;)_+=c;return _}function l(a){var d="",u,_=0,T,E;for(u=0;u<a.length&&a.charAt(u)!=c;++u)E=o.indexOf(a.charAt(u)),!(E<0)&&(_==0?(d+=M(E>>2),T=E&3,_=1):_==1?(d+=M(T<<2|E>>4),T=E&15,_=2):_==2?(d+=M(T),d+=M(E>>2),T=E&3,_=3):(d+=M(T<<2|E>>4),d+=M(E&15),_=0));return _==1&&(d+=M(T<<2)),d}function p(a){var d=l(a),u,_=new Array;for(u=0;2*u<d.length;++u)_[u]=parseInt(d.substring(2*u,2*u+2),16);return _}var g;function f(a,d,u){a!=null&&(typeof a=="number"?this.fromNumber(a,d,u):d==null&&typeof a!="string"?this.fromString(a,256):this.fromString(a,d))}function y(){return new f(null)}function x(a,d,u,_,T,E){for(;--E>=0;){var L=d*this[a++]+u[_]+T;T=Math.floor(L/67108864),u[_++]=L&67108863}return T}function S(a,d,u,_,T,E){for(var L=d&32767,I=d>>15;--E>=0;){var V=this[a]&32767,O=this[a++]>>15,W=I*V+O*L;V=L*V+((W&32767)<<15)+u[_]+(T&1073741823),T=(V>>>30)+(W>>>15)+I*O+(T>>>30),u[_++]=V&1073741823}return T}function v(a,d,u,_,T,E){for(var L=d&16383,I=d>>14;--E>=0;){var V=this[a]&16383,O=this[a++]>>14,W=I*V+O*L;V=L*V+((W&16383)<<14)+u[_]+T,T=(V>>28)+(W>>14)+I*O,u[_++]=V&268435455}return T}e.appName=="Microsoft Internet Explorer"?(f.prototype.am=S,g=30):e.appName!="Netscape"?(f.prototype.am=x,g=26):(f.prototype.am=v,g=28),f.prototype.DB=g,f.prototype.DM=(1<<g)-1,f.prototype.DV=1<<g;var m=52;f.prototype.FV=Math.pow(2,m),f.prototype.F1=m-g,f.prototype.F2=2*g-m;var w="0123456789abcdefghijklmnopqrstuvwxyz",b=new Array,C,A;for(C=48,A=0;A<=9;++A)b[C++]=A;for(C=97,A=10;A<36;++A)b[C++]=A;for(C=65,A=10;A<36;++A)b[C++]=A;function M(a){return w.charAt(a)}function F(a,d){var u=b[a.charCodeAt(d)];return u??-1}function N(a){for(var d=this.t-1;d>=0;--d)a[d]=this[d];a.t=this.t,a.s=this.s}function P(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a<-1?this[0]=a+this.DV:this.t=0}function j(a){var d=y();return d.fromInt(a),d}function K(a,d){var u;if(d==16)u=4;else if(d==8)u=3;else if(d==256)u=8;else if(d==2)u=1;else if(d==32)u=5;else if(d==4)u=2;else{this.fromRadix(a,d);return}this.t=0,this.s=0;for(var _=a.length,T=!1,E=0;--_>=0;){var L=u==8?a[_]&255:F(a,_);if(L<0){a.charAt(_)=="-"&&(T=!0);continue}T=!1,E==0?this[this.t++]=L:E+u>this.DB?(this[this.t-1]|=(L&(1<<this.DB-E)-1)<<E,this[this.t++]=L>>this.DB-E):this[this.t-1]|=L<<E,E+=u,E>=this.DB&&(E-=this.DB)}u==8&&(a[0]&128)!=0&&(this.s=-1,E>0&&(this[this.t-1]|=(1<<this.DB-E)-1<<E)),this.clamp(),T&&f.ZERO.subTo(this,this)}function X(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function ie(a){if(this.s<0)return"-"+this.negate().toString(a);var d;if(a==16)d=4;else if(a==8)d=3;else if(a==2)d=1;else if(a==32)d=5;else if(a==4)d=2;else return this.toRadix(a);var u=(1<<d)-1,_,T=!1,E="",L=this.t,I=this.DB-L*this.DB%d;if(L-- >0)for(I<this.DB&&(_=this[L]>>I)>0&&(T=!0,E=M(_));L>=0;)I<d?(_=(this[L]&(1<<I)-1)<<d-I,_|=this[--L]>>(I+=this.DB-d)):(_=this[L]>>(I-=d)&u,I<=0&&(I+=this.DB,--L)),_>0&&(T=!0),T&&(E+=M(_));return T?E:"0"}function q(){var a=y();return f.ZERO.subTo(this,a),a}function ae(){return this.s<0?this.negate():this}function pe(a){var d=this.s-a.s;if(d!=0)return d;var u=this.t;if(d=u-a.t,d!=0)return this.s<0?-d:d;for(;--u>=0;)if((d=this[u]-a[u])!=0)return d;return 0}function ue(a){var d=1,u;return(u=a>>>16)!=0&&(a=u,d+=16),(u=a>>8)!=0&&(a=u,d+=8),(u=a>>4)!=0&&(a=u,d+=4),(u=a>>2)!=0&&(a=u,d+=2),(u=a>>1)!=0&&(a=u,d+=1),d}function xe(){return this.t<=0?0:this.DB*(this.t-1)+ue(this[this.t-1]^this.s&this.DM)}function Ee(a,d){var u;for(u=this.t-1;u>=0;--u)d[u+a]=this[u];for(u=a-1;u>=0;--u)d[u]=0;d.t=this.t+a,d.s=this.s}function ye(a,d){for(var u=a;u<this.t;++u)d[u-a]=this[u];d.t=Math.max(this.t-a,0),d.s=this.s}function ge(a,d){var u=a%this.DB,_=this.DB-u,T=(1<<_)-1,E=Math.floor(a/this.DB),L=this.s<<u&this.DM,I;for(I=this.t-1;I>=0;--I)d[I+E+1]=this[I]>>_|L,L=(this[I]&T)<<u;for(I=E-1;I>=0;--I)d[I]=0;d[E]=L,d.t=this.t+E+1,d.s=this.s,d.clamp()}function Te(a,d){d.s=this.s;var u=Math.floor(a/this.DB);if(u>=this.t){d.t=0;return}var _=a%this.DB,T=this.DB-_,E=(1<<_)-1;d[0]=this[u]>>_;for(var L=u+1;L<this.t;++L)d[L-u-1]|=(this[L]&E)<<T,d[L-u]=this[L]>>_;_>0&&(d[this.t-u-1]|=(this.s&E)<<T),d.t=this.t-u,d.clamp()}function rt(a,d){for(var u=0,_=0,T=Math.min(a.t,this.t);u<T;)_+=this[u]-a[u],d[u++]=_&this.DM,_>>=this.DB;if(a.t<this.t){for(_-=a.s;u<this.t;)_+=this[u],d[u++]=_&this.DM,_>>=this.DB;_+=this.s}else{for(_+=this.s;u<a.t;)_-=a[u],d[u++]=_&this.DM,_>>=this.DB;_-=a.s}d.s=_<0?-1:0,_<-1?d[u++]=this.DV+_:_>0&&(d[u++]=_),d.t=u,d.clamp()}function et(a,d){var u=this.abs(),_=a.abs(),T=u.t;for(d.t=T+_.t;--T>=0;)d[T]=0;for(T=0;T<_.t;++T)d[T+u.t]=u.am(0,_[T],d,T,0,u.t);d.s=0,d.clamp(),this.s!=a.s&&f.ZERO.subTo(d,d)}function tt(a){for(var d=this.abs(),u=a.t=2*d.t;--u>=0;)a[u]=0;for(u=0;u<d.t-1;++u){var _=d.am(u,d[u],a,2*u,0,1);(a[u+d.t]+=d.am(u+1,2*d[u],a,2*u+1,_,d.t-u-1))>=d.DV&&(a[u+d.t]-=d.DV,a[u+d.t+1]=1)}a.t>0&&(a[a.t-1]+=d.am(u,d[u],a,2*u,0,1)),a.s=0,a.clamp()}function gt(a,d,u){var _=a.abs();if(!(_.t<=0)){var T=this.abs();if(T.t<_.t){d!=null&&d.fromInt(0),u!=null&&this.copyTo(u);return}u==null&&(u=y());var E=y(),L=this.s,I=a.s,V=this.DB-ue(_[_.t-1]);V>0?(_.lShiftTo(V,E),T.lShiftTo(V,u)):(_.copyTo(E),T.copyTo(u));var O=E.t,W=E[O-1];if(W!=0){var z=W*(1<<this.F1)+(O>1?E[O-2]>>this.F2:0),D=this.FV/z,U=(1<<this.F1)/z,k=1<<this.F2,H=u.t,G=H-O,$=d??y();for(E.dlShiftTo(G,$),u.compareTo($)>=0&&(u[u.t++]=1,u.subTo($,u)),f.ONE.dlShiftTo(O,$),$.subTo(E,E);E.t<O;)E[E.t++]=0;for(;--G>=0;){var se=u[--H]==W?this.DM:Math.floor(u[H]*D+(u[H-1]+k)*U);if((u[H]+=E.am(0,se,u,G,0,O))<se)for(E.dlShiftTo(G,$),u.subTo($,u);u[H]<--se;)u.subTo($,u)}d!=null&&(u.drShiftTo(O,d),L!=I&&f.ZERO.subTo(d,d)),u.t=O,u.clamp(),V>0&&u.rShiftTo(V,u),L<0&&f.ZERO.subTo(u,u)}}}function Lt(a){var d=y();return this.abs().divRemTo(a,null,d),this.s<0&&d.compareTo(f.ZERO)>0&&a.subTo(d,d),d}function St(a){this.m=a}function Kt(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function Ei(a){return a}function Ut(a){a.divRemTo(this.m,null,a)}function Pe(a,d,u){a.multiplyTo(d,u),this.reduce(u)}function _i(a,d){a.squareTo(d),this.reduce(d)}St.prototype.convert=Kt,St.prototype.revert=Ei,St.prototype.reduce=Ut,St.prototype.mulTo=Pe,St.prototype.sqrTo=_i;function Mt(){if(this.t<1)return 0;var a=this[0];if((a&1)==0)return 0;var d=a&3;return d=d*(2-(a&15)*d)&15,d=d*(2-(a&255)*d)&255,d=d*(2-((a&65535)*d&65535))&65535,d=d*(2-a*d%this.DV)%this.DV,d>0?this.DV-d:-d}function xt(a){this.m=a,this.mp=a.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function Bt(a){var d=y();return a.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),a.s<0&&d.compareTo(f.ZERO)>0&&this.m.subTo(d,d),d}function li(a){var d=y();return a.copyTo(d),this.reduce(d),d}function Ot(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var d=0;d<this.m.t;++d){var u=a[d]&32767,_=u*this.mpl+((u*this.mph+(a[d]>>15)*this.mpl&this.um)<<15)&a.DM;for(u=d+this.m.t,a[u]+=this.m.am(0,_,a,d,0,this.m.t);a[u]>=a.DV;)a[u]-=a.DV,a[++u]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function Ht(a,d){a.squareTo(d),this.reduce(d)}function ei(a,d,u){a.multiplyTo(d,u),this.reduce(u)}xt.prototype.convert=Bt,xt.prototype.revert=li,xt.prototype.reduce=Ot,xt.prototype.mulTo=ei,xt.prototype.sqrTo=Ht;function Ci(){return(this.t>0?this[0]&1:this.s)==0}function yi(a,d){if(a>4294967295||a<1)return f.ONE;var u=y(),_=y(),T=d.convert(this),E=ue(a)-1;for(T.copyTo(u);--E>=0;)if(d.sqrTo(u,_),(a&1<<E)>0)d.mulTo(_,T,u);else{var L=u;u=_,_=L}return d.revert(u)}function ce(a,d){var u;return a<256||d.isEven()?u=new St(d):u=new xt(d),this.exp(a,u)}f.prototype.copyTo=N,f.prototype.fromInt=P,f.prototype.fromString=K,f.prototype.clamp=X,f.prototype.dlShiftTo=Ee,f.prototype.drShiftTo=ye,f.prototype.lShiftTo=ge,f.prototype.rShiftTo=Te,f.prototype.subTo=rt,f.prototype.multiplyTo=et,f.prototype.squareTo=tt,f.prototype.divRemTo=gt,f.prototype.invDigit=Mt,f.prototype.isEven=Ci,f.prototype.exp=yi,f.prototype.toString=ie,f.prototype.negate=q,f.prototype.abs=ae,f.prototype.compareTo=pe,f.prototype.bitLength=xe,f.prototype.mod=Lt,f.prototype.modPowInt=ce,f.ZERO=j(0),f.ONE=j(1);function te(){var a=y();return this.copyTo(a),a}function De(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function He(){return this.t==0?this.s:this[0]<<24>>24}function Oe(){return this.t==0?this.s:this[0]<<16>>16}function Fe(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function it(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function $e(a){if(a==null&&(a=10),this.signum()==0||a<2||a>36)return"0";var d=this.chunkSize(a),u=Math.pow(a,d),_=j(u),T=y(),E=y(),L="";for(this.divRemTo(_,T,E);T.signum()>0;)L=(u+E.intValue()).toString(a).substr(1)+L,T.divRemTo(_,T,E);return E.intValue().toString(a)+L}function st(a,d){this.fromInt(0),d==null&&(d=10);for(var u=this.chunkSize(d),_=Math.pow(d,u),T=!1,E=0,L=0,I=0;I<a.length;++I){var V=F(a,I);if(V<0){a.charAt(I)=="-"&&this.signum()==0&&(T=!0);continue}L=d*L+V,++E>=u&&(this.dMultiply(_),this.dAddOffset(L,0),E=0,L=0)}E>0&&(this.dMultiply(Math.pow(d,E)),this.dAddOffset(L,0)),T&&f.ZERO.subTo(this,this)}function de(a,d,u){if(typeof d=="number")if(a<2)this.fromInt(1);else for(this.fromNumber(a,u),this.testBit(a-1)||this.bitwiseTo(f.ONE.shiftLeft(a-1),nt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(d);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(f.ONE.shiftLeft(a-1),this);else{var _=new Array,T=a&7;_.length=(a>>3)+1,d.nextBytes(_),T>0?_[0]&=(1<<T)-1:_[0]=0,this.fromString(_,256)}}function ke(){var a=this.t,d=new Array;d[0]=this.s;var u=this.DB-a*this.DB%8,_,T=0;if(a-- >0)for(u<this.DB&&(_=this[a]>>u)!=(this.s&this.DM)>>u&&(d[T++]=_|this.s<<this.DB-u);a>=0;)u<8?(_=(this[a]&(1<<u)-1)<<8-u,_|=this[--a]>>(u+=this.DB-8)):(_=this[a]>>(u-=8)&255,u<=0&&(u+=this.DB,--a)),(_&128)!=0&&(_|=-256),T==0&&(this.s&128)!=(_&128)&&++T,(T>0||_!=this.s)&&(d[T++]=_);return d}function Ve(a){return this.compareTo(a)==0}function Ct(a){return this.compareTo(a)<0?this:a}function Tt(a){return this.compareTo(a)>0?this:a}function At(a,d,u){var _,T,E=Math.min(a.t,this.t);for(_=0;_<E;++_)u[_]=d(this[_],a[_]);if(a.t<this.t){for(T=a.s&this.DM,_=E;_<this.t;++_)u[_]=d(this[_],T);u.t=this.t}else{for(T=this.s&this.DM,_=E;_<a.t;++_)u[_]=d(T,a[_]);u.t=a.t}u.s=d(this.s,a.s),u.clamp()}function wt(a,d){return a&d}function he(a){var d=y();return this.bitwiseTo(a,wt,d),d}function nt(a,d){return a|d}function Je(a){var d=y();return this.bitwiseTo(a,nt,d),d}function ct(a,d){return a^d}function ot(a){var d=y();return this.bitwiseTo(a,ct,d),d}function Ke(a,d){return a&~d}function lt(a){var d=y();return this.bitwiseTo(a,Ke,d),d}function It(){for(var a=y(),d=0;d<this.t;++d)a[d]=this.DM&~this[d];return a.t=this.t,a.s=~this.s,a}function Ii(a){var d=y();return a<0?this.rShiftTo(-a,d):this.lShiftTo(a,d),d}function hi(a){var d=y();return a<0?this.lShiftTo(-a,d):this.rShiftTo(a,d),d}function pn(a){if(a==0)return-1;var d=0;return(a&65535)==0&&(a>>=16,d+=16),(a&255)==0&&(a>>=8,d+=8),(a&15)==0&&(a>>=4,d+=4),(a&3)==0&&(a>>=2,d+=2),(a&1)==0&&++d,d}function Ui(){for(var a=0;a<this.t;++a)if(this[a]!=0)return a*this.DB+pn(this[a]);return this.s<0?this.t*this.DB:-1}function gr(a){for(var d=0;a!=0;)a&=a-1,++d;return d}function gs(){for(var a=0,d=this.s&this.DM,u=0;u<this.t;++u)a+=gr(this[u]^d);return a}function Kn(a){var d=Math.floor(a/this.DB);return d>=this.t?this.s!=0:(this[d]&1<<a%this.DB)!=0}function Or(a,d){var u=f.ONE.shiftLeft(a);return this.bitwiseTo(u,d,u),u}function Ln(a){return this.changeBit(a,nt)}function Xn(a){return this.changeBit(a,Ke)}function Ur(a){return this.changeBit(a,ct)}function Jr(a,d){for(var u=0,_=0,T=Math.min(a.t,this.t);u<T;)_+=this[u]+a[u],d[u++]=_&this.DM,_>>=this.DB;if(a.t<this.t){for(_+=a.s;u<this.t;)_+=this[u],d[u++]=_&this.DM,_>>=this.DB;_+=this.s}else{for(_+=this.s;u<a.t;)_+=a[u],d[u++]=_&this.DM,_>>=this.DB;_+=a.s}d.s=_<0?-1:0,_>0?d[u++]=_:_<-1&&(d[u++]=this.DV+_),d.t=u,d.clamp()}function Gs(a){var d=y();return this.addTo(a,d),d}function or(a){var d=y();return this.subTo(a,d),d}function oe(a){var d=y();return this.multiplyTo(a,d),d}function Me(){var a=y();return this.squareTo(a),a}function Ue(a){var d=y();return this.divRemTo(a,d,null),d}function Ae(a){var d=y();return this.divRemTo(a,null,d),d}function Be(a){var d=y(),u=y();return this.divRemTo(a,d,u),new Array(d,u)}function vt(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ft(a,d){if(a!=0){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=a;this[d]>=this.DV;)this[d]-=this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}}function Et(){}function kt(a){return a}function Xt(a,d,u){a.multiplyTo(d,u)}function Le(a,d){a.squareTo(d)}Et.prototype.convert=kt,Et.prototype.revert=kt,Et.prototype.mulTo=Xt,Et.prototype.sqrTo=Le;function Xe(a){return this.exp(a,new Et)}function at(a,d,u){var _=Math.min(this.t+a.t,d);for(u.s=0,u.t=_;_>0;)u[--_]=0;var T;for(T=u.t-this.t;_<T;++_)u[_+this.t]=this.am(0,a[_],u,_,0,this.t);for(T=Math.min(a.t,d);_<T;++_)this.am(0,a[_],u,_,0,d-_);u.clamp()}function Nt(a,d,u){--d;var _=u.t=this.t+a.t-d;for(u.s=0;--_>=0;)u[_]=0;for(_=Math.max(d-this.t,0);_<a.t;++_)u[this.t+_-d]=this.am(d-_,a[_],u,0,0,this.t+_-d);u.clamp(),u.drShiftTo(1,u)}function _t(a){this.r2=y(),this.q3=y(),f.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function ni(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var d=y();return a.copyTo(d),this.reduce(d),d}function ut(a){return a}function bt(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Wt(a,d){a.squareTo(d),this.reduce(d)}function $t(a,d,u){a.multiplyTo(d,u),this.reduce(u)}_t.prototype.convert=ni,_t.prototype.revert=ut,_t.prototype.reduce=bt,_t.prototype.mulTo=$t,_t.prototype.sqrTo=Wt;function Xi(a,d){var u=a.bitLength(),_,T=j(1),E;if(u<=0)return T;u<18?_=1:u<48?_=3:u<144?_=4:u<768?_=5:_=6,u<8?E=new St(d):d.isEven()?E=new _t(d):E=new xt(d);var L=new Array,I=3,V=_-1,O=(1<<_)-1;if(L[1]=E.convert(this),_>1){var W=y();for(E.sqrTo(L[1],W);I<=O;)L[I]=y(),E.mulTo(W,L[I-2],L[I]),I+=2}var z=a.t-1,D,U=!0,k=y(),H;for(u=ue(a[z])-1;z>=0;){for(u>=V?D=a[z]>>u-V&O:(D=(a[z]&(1<<u+1)-1)<<V-u,z>0&&(D|=a[z-1]>>this.DB+u-V)),I=_;(D&1)==0;)D>>=1,--I;if((u-=I)<0&&(u+=this.DB,--z),U)L[D].copyTo(T),U=!1;else{for(;I>1;)E.sqrTo(T,k),E.sqrTo(k,T),I-=2;I>0?E.sqrTo(T,k):(H=T,T=k,k=H),E.mulTo(k,L[D],T)}for(;z>=0&&(a[z]&1<<u)==0;)E.sqrTo(T,k),H=T,T=k,k=H,--u<0&&(u=this.DB-1,--z)}return E.revert(T)}function $n(a){var d=this.s<0?this.negate():this.clone(),u=a.s<0?a.negate():a.clone();if(d.compareTo(u)<0){var _=d;d=u,u=_}var T=d.getLowestSetBit(),E=u.getLowestSetBit();if(E<0)return d;for(T<E&&(E=T),E>0&&(d.rShiftTo(E,d),u.rShiftTo(E,u));d.signum()>0;)(T=d.getLowestSetBit())>0&&d.rShiftTo(T,d),(T=u.getLowestSetBit())>0&&u.rShiftTo(T,u),d.compareTo(u)>=0?(d.subTo(u,d),d.rShiftTo(1,d)):(u.subTo(d,u),u.rShiftTo(1,u));return E>0&&u.lShiftTo(E,u),u}function Zn(a){if(a<=0)return 0;var d=this.DV%a,u=this.s<0?a-1:0;if(this.t>0)if(d==0)u=this[0]%a;else for(var _=this.t-1;_>=0;--_)u=(d*u+this[_])%a;return u}function Br(a){var d=a.isEven();if(this.isEven()&&d||a.signum()==0)return f.ZERO;for(var u=a.clone(),_=this.clone(),T=j(1),E=j(0),L=j(0),I=j(1);u.signum()!=0;){for(;u.isEven();)u.rShiftTo(1,u),d?((!T.isEven()||!E.isEven())&&(T.addTo(this,T),E.subTo(a,E)),T.rShiftTo(1,T)):E.isEven()||E.subTo(a,E),E.rShiftTo(1,E);for(;_.isEven();)_.rShiftTo(1,_),d?((!L.isEven()||!I.isEven())&&(L.addTo(this,L),I.subTo(a,I)),L.rShiftTo(1,L)):I.isEven()||I.subTo(a,I),I.rShiftTo(1,I);u.compareTo(_)>=0?(u.subTo(_,u),d&&T.subTo(L,T),E.subTo(I,E)):(_.subTo(u,_),d&&L.subTo(T,L),I.subTo(E,I))}if(_.compareTo(f.ONE)!=0)return f.ZERO;if(I.compareTo(a)>=0)return I.subtract(a);if(I.signum()<0)I.addTo(a,I);else return I;return I.signum()<0?I.add(a):I}var di=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Yn=(1<<26)/di[di.length-1];function Qr(a){var d,u=this.abs();if(u.t==1&&u[0]<=di[di.length-1]){for(d=0;d<di.length;++d)if(u[0]==di[d])return!0;return!1}if(u.isEven())return!1;for(d=1;d<di.length;){for(var _=di[d],T=d+1;T<di.length&&_<Yn;)_*=di[T++];for(_=u.modInt(_);d<T;)if(_%di[d++]==0)return!1}return u.millerRabin(a)}function sn(a){var d=this.subtract(f.ONE),u=d.getLowestSetBit();if(u<=0)return!1;var _=d.shiftRight(u);a=a+1>>1,a>di.length&&(a=di.length);for(var T=y(),E=0;E<a;++E){T.fromInt(di[Math.floor(Math.random()*di.length)]);var L=T.modPow(_,this);if(L.compareTo(f.ONE)!=0&&L.compareTo(d)!=0){for(var I=1;I++<u&&L.compareTo(d)!=0;)if(L=L.modPowInt(2,this),L.compareTo(f.ONE)==0)return!1;if(L.compareTo(d)!=0)return!1}}return!0}f.prototype.chunkSize=Fe,f.prototype.toRadix=$e,f.prototype.fromRadix=st,f.prototype.fromNumber=de,f.prototype.bitwiseTo=At,f.prototype.changeBit=Or,f.prototype.addTo=Jr,f.prototype.dMultiply=vt,f.prototype.dAddOffset=Ft,f.prototype.multiplyLowerTo=at,f.prototype.multiplyUpperTo=Nt,f.prototype.modInt=Zn,f.prototype.millerRabin=sn,f.prototype.clone=te,f.prototype.intValue=De,f.prototype.byteValue=He,f.prototype.shortValue=Oe,f.prototype.signum=it,f.prototype.toByteArray=ke,f.prototype.equals=Ve,f.prototype.min=Ct,f.prototype.max=Tt,f.prototype.and=he,f.prototype.or=Je,f.prototype.xor=ot,f.prototype.andNot=lt,f.prototype.not=It,f.prototype.shiftLeft=Ii,f.prototype.shiftRight=hi,f.prototype.getLowestSetBit=Ui,f.prototype.bitCount=gs,f.prototype.testBit=Kn,f.prototype.setBit=Ln,f.prototype.clearBit=Xn,f.prototype.flipBit=Ur,f.prototype.add=Gs,f.prototype.subtract=or,f.prototype.multiply=oe,f.prototype.divide=Ue,f.prototype.remainder=Ae,f.prototype.divideAndRemainder=Be,f.prototype.modPow=Xi,f.prototype.modInverse=Br,f.prototype.pow=Xe,f.prototype.gcd=$n,f.prototype.isProbablePrime=Qr,f.prototype.square=Me;function Jn(){this.i=0,this.j=0,this.S=new Array}function ho(a){var d,u,_;for(d=0;d<256;++d)this.S[d]=d;for(u=0,d=0;d<256;++d)u=u+this.S[d]+a[d%a.length]&255,_=this.S[d],this.S[d]=this.S[u],this.S[u]=_;this.i=0,this.j=0}function cc(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}Jn.prototype.init=ho,Jn.prototype.next=cc;function Nv(){return new Jn}var Yl=256,lc,Qn,en;function Ov(a){Qn[en++]^=a&255,Qn[en++]^=a>>8&255,Qn[en++]^=a>>16&255,Qn[en++]^=a>>24&255,en>=Yl&&(en-=Yl)}function Jl(){Ov(new Date().getTime())}if(Qn==null){if(Qn=new Array,en=0,i!==void 0&&(i.crypto!==void 0||i.msCrypto!==void 0)){if(Ql=i.crypto||i.msCrypto,Ql.getRandomValues)for(ed=new Uint8Array(32),Ql.getRandomValues(ed),vr=0;vr<32;++vr)Qn[en++]=ed[vr];else if(e.appName=="Netscape"&&e.appVersion<"5")for(td=i.crypto.random(32),vr=0;vr<td.length;++vr)Qn[en++]=td.charCodeAt(vr)&255}for(;en<Yl;)vr=Math.floor(65536*Math.random()),Qn[en++]=vr>>>8,Qn[en++]=vr&255;en=0,Jl()}var vr,Ql,ed,td;function Uv(){if(lc==null){for(Jl(),lc=Nv(),lc.init(Qn),en=0;en<Qn.length;++en)Qn[en]=0;en=0}return lc.next()}function Bv(a){var d;for(d=0;d<a.length;++d)a[d]=Uv()}function ba(){}ba.prototype.nextBytes=Bv;function Fn(a,d){return new f(a,d)}function Gt(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Hv(a,d){if(this.isPublic=!0,this.isPrivate=!1,typeof a!="string")this.n=a,this.e=d;else if(a!=null&&d!=null&&a.length>0&&d.length>0)this.n=Fn(a,16),this.e=parseInt(d,16);else throw"Invalid RSA public key"}function jv(a){return a.modPowInt(this.e,this.n)}Gt.prototype.doPublic=jv,Gt.prototype.setPublic=Hv,Gt.prototype.type="RSA";function Vv(a,d,u){if(this.isPrivate=!0,typeof a!="string")this.n=a,this.e=d,this.d=u;else if(a!=null&&d!=null&&a.length>0&&d.length>0)this.n=Fn(a,16),this.e=parseInt(d,16),this.d=Fn(u,16);else throw"Invalid RSA private key"}function zv(a,d,u,_,T,E,L,I){if(this.isPrivate=!0,this.isPublic=!1,a==null)throw"RSASetPrivateEx N == null";if(d==null)throw"RSASetPrivateEx E == null";if(a.length==0)throw"RSASetPrivateEx N.length == 0";if(d.length==0)throw"RSASetPrivateEx E.length == 0";if(a!=null&&d!=null&&a.length>0&&d.length>0)this.n=Fn(a,16),this.e=parseInt(d,16),this.d=Fn(u,16),this.p=Fn(_,16),this.q=Fn(T,16),this.dmp1=Fn(E,16),this.dmq1=Fn(L,16),this.coeff=Fn(I,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function Gv(a,d){var u=new ba,_=a>>1;this.e=parseInt(d,16);for(var T=new f(d,16),E=a/2-100,L=f.ONE.shiftLeft(E);;){for(;this.p=new f(a-_,1,u),!(this.p.subtract(f.ONE).gcd(T).compareTo(f.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new f(_,1,u),!(this.q.subtract(f.ONE).gcd(T).compareTo(f.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var I=this.p;this.p=this.q,this.q=I}var V=this.q.subtract(this.p).abs();if(!(V.bitLength()<E||V.compareTo(L)<=0)){var O=this.p.subtract(f.ONE),W=this.q.subtract(f.ONE),z=O.multiply(W);if(z.gcd(T).compareTo(f.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==a)){this.d=T.modInverse(z),this.dmp1=this.d.mod(O),this.dmq1=this.d.mod(W),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function qv(a){if(this.p==null||this.q==null)return a.modPow(this.d,this.n);for(var d=a.mod(this.p).modPow(this.dmp1,this.p),u=a.mod(this.q).modPow(this.dmq1,this.q);d.compareTo(u)<0;)d=d.add(this.p);return d.subtract(u).multiply(this.coeff).mod(this.p).multiply(this.q).add(u)}Gt.prototype.doPrivate=qv,Gt.prototype.setPrivate=Vv,Gt.prototype.setPrivateEx=zv,Gt.prototype.generate=Gv;function $i(a,d){this.x=d,this.q=a}function Wv(a){return a==this?!0:this.q.equals(a.q)&&this.x.equals(a.x)}function Kv(){return this.x}function Xv(){return new $i(this.q,this.x.negate().mod(this.q))}function $v(a){return new $i(this.q,this.x.add(a.toBigInteger()).mod(this.q))}function Zv(a){return new $i(this.q,this.x.subtract(a.toBigInteger()).mod(this.q))}function Yv(a){return new $i(this.q,this.x.multiply(a.toBigInteger()).mod(this.q))}function Jv(){return new $i(this.q,this.x.square().mod(this.q))}function Qv(a){return new $i(this.q,this.x.multiply(a.toBigInteger().modInverse(this.q)).mod(this.q))}$i.prototype.equals=Wv,$i.prototype.toBigInteger=Kv,$i.prototype.negate=Xv,$i.prototype.add=$v,$i.prototype.subtract=Zv,$i.prototype.multiply=Yv,$i.prototype.square=Jv,$i.prototype.divide=Qv,$i.prototype.sqrt=function(){return new $i(this.q,this.x.sqrt().mod(this.q))};function pi(a,d,u,_){this.curve=a,this.x=d,this.y=u,_==null?this.z=f.ONE:this.z=_,this.zinv=null}function e_(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function t_(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function i_(a){if(a==this)return!0;if(this.isInfinity())return a.isInfinity();if(a.isInfinity())return this.isInfinity();var d,u;return d=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),d.equals(f.ZERO)?(u=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q),u.equals(f.ZERO)):!1}function n_(){return this.x==null&&this.y==null?!0:this.z.equals(f.ZERO)&&!this.y.toBigInteger().equals(f.ZERO)}function r_(){return new pi(this.curve,this.x,this.y.negate(),this.z)}function s_(a){if(this.isInfinity())return a;if(a.isInfinity())return this;var d=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),u=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q);if(f.ZERO.equals(u))return f.ZERO.equals(d)?this.twice():this.curve.getInfinity();var _=new f("3"),T=this.x.toBigInteger(),E=this.y.toBigInteger();a.x.toBigInteger(),a.y.toBigInteger();var L=u.square(),I=L.multiply(u),V=T.multiply(L),O=d.square().multiply(this.z),W=O.subtract(V.shiftLeft(1)).multiply(a.z).subtract(I).multiply(u).mod(this.curve.q),z=V.multiply(_).multiply(d).subtract(E.multiply(I)).subtract(O.multiply(d)).multiply(a.z).add(d.multiply(I)).mod(this.curve.q),D=I.multiply(this.z).multiply(a.z).mod(this.curve.q);return new pi(this.curve,this.curve.fromBigInteger(W),this.curve.fromBigInteger(z),D)}function a_(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var a=new f("3"),d=this.x.toBigInteger(),u=this.y.toBigInteger(),_=u.multiply(this.z),T=_.multiply(u).mod(this.curve.q),E=this.curve.a.toBigInteger(),L=d.square().multiply(a);f.ZERO.equals(E)||(L=L.add(this.z.square().multiply(E))),L=L.mod(this.curve.q);var I=L.square().subtract(d.shiftLeft(3).multiply(T)).shiftLeft(1).multiply(_).mod(this.curve.q),V=L.multiply(a).multiply(d).subtract(T.shiftLeft(1)).shiftLeft(2).multiply(T).subtract(L.square().multiply(L)).mod(this.curve.q),O=_.square().multiply(_).shiftLeft(3).mod(this.curve.q);return new pi(this.curve,this.curve.fromBigInteger(I),this.curve.fromBigInteger(V),O)}function o_(a){if(this.isInfinity())return this;if(a.signum()==0)return this.curve.getInfinity();var d=a,u=d.multiply(new f("3")),_=this.negate(),T=this,E=this.curve.q.subtract(a),L=E.multiply(new f("3")),I=new pi(this.curve,this.x,this.y),V=I.negate(),O;for(O=u.bitLength()-2;O>0;--O){T=T.twice();var W=u.testBit(O),z=d.testBit(O);W!=z&&(T=T.add(W?this:_))}for(O=L.bitLength()-2;O>0;--O){I=I.twice();var D=L.testBit(O),U=E.testBit(O);D!=U&&(I=I.add(D?I:V))}return T}function c_(a,d,u){var _;a.bitLength()>u.bitLength()?_=a.bitLength()-1:_=u.bitLength()-1;for(var T=this.curve.getInfinity(),E=this.add(d);_>=0;)T=T.twice(),a.testBit(_)?u.testBit(_)?T=T.add(E):T=T.add(this):u.testBit(_)&&(T=T.add(d)),--_;return T}pi.prototype.getX=e_,pi.prototype.getY=t_,pi.prototype.equals=i_,pi.prototype.isInfinity=n_,pi.prototype.negate=r_,pi.prototype.add=s_,pi.prototype.twice=a_,pi.prototype.multiply=o_,pi.prototype.multiplyTwo=c_;function es(a,d,u){this.q=a,this.a=this.fromBigInteger(d),this.b=this.fromBigInteger(u),this.infinity=new pi(this,null,null)}function l_(){return this.q}function d_(){return this.a}function u_(){return this.b}function h_(a){return a==this?!0:this.q.equals(a.q)&&this.a.equals(a.a)&&this.b.equals(a.b)}function p_(){return this.infinity}function f_(a){return new $i(this.q,a)}function m_(a){switch(parseInt(a.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var d=a.substr(0,2);a.substr(2);var u=this.fromBigInteger(new f(V,16)),_=this.getA(),T=this.getB(),E=u.square().add(_).multiply(u).add(T),L=E.sqrt();return d=="03"&&(L=L.negate()),new pi(this,u,L);case 4:case 6:case 7:var I=(a.length-2)/2,V=a.substr(2,I),O=a.substr(I+2,I);return new pi(this,this.fromBigInteger(new f(V,16)),this.fromBigInteger(new f(O,16)));default:return null}}es.prototype.getQ=l_,es.prototype.getA=d_,es.prototype.getB=u_,es.prototype.equals=h_,es.prototype.getInfinity=p_,es.prototype.fromBigInteger=f_,es.prototype.decodePointHex=m_,$i.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},pi.prototype.getEncoded=function(a){var d=function(E,L){var I=E.toByteArrayUnsigned();if(L<I.length)I=I.slice(I.length-L);else for(;L>I.length;)I.unshift(0);return I},u=this.getX().toBigInteger(),_=this.getY().toBigInteger(),T=d(u,32);return a?_.isEven()?T.unshift(2):T.unshift(3):(T.unshift(4),T=T.concat(d(_,32))),T},pi.decodeFrom=function(a,d){d[0];var u=d.length-1,_=d.slice(1,1+u/2),T=d.slice(1+u/2,1+u);_.unshift(0),T.unshift(0);var E=new f(_),L=new f(T);return new pi(a,a.fromBigInteger(E),a.fromBigInteger(L))},pi.decodeFromHex=function(a,d){d.substr(0,2);var u=d.length-2,_=d.substr(2,u/2),T=d.substr(2+u/2,u/2),E=new f(_,16),L=new f(T,16);return new pi(a,a.fromBigInteger(E),a.fromBigInteger(L))},pi.prototype.add2D=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;if(this.x.equals(a.x))return this.y.equals(a.y)?this.twice():this.curve.getInfinity();var d=a.x.subtract(this.x),u=a.y.subtract(this.y),_=u.divide(d),T=_.square().subtract(this.x).subtract(a.x),E=_.multiply(this.x.subtract(T)).subtract(this.y);return new pi(this.curve,T,E)},pi.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var a=this.curve.fromBigInteger(f.valueOf(2)),d=this.curve.fromBigInteger(f.valueOf(3)),u=this.x.square().multiply(d).add(this.curve.a).divide(this.y.multiply(a)),_=u.square().subtract(this.x.multiply(a)),T=u.multiply(this.x.subtract(_)).subtract(this.y);return new pi(this.curve,_,T)},pi.prototype.multiply2D=function(a){if(this.isInfinity())return this;if(a.signum()==0)return this.curve.getInfinity();var d=a,u=d.multiply(new f("3")),_=this.negate(),T=this,E;for(E=u.bitLength()-2;E>0;--E){T=T.twice();var L=u.testBit(E),I=d.testBit(E);L!=I&&(T=T.add2D(L?this:_))}return T},pi.prototype.isOnCurve=function(){var a=this.getX().toBigInteger(),d=this.getY().toBigInteger(),u=this.curve.getA().toBigInteger(),_=this.curve.getB().toBigInteger(),T=this.curve.getQ(),E=d.multiply(d).mod(T),L=a.multiply(a).multiply(a).add(u.multiply(a)).add(_).mod(T);return E.equals(L)},pi.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},pi.prototype.validate=function(){var a=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var d=this.getX().toBigInteger(),u=this.getY().toBigInteger();if(d.compareTo(f.ONE)<0||d.compareTo(a.subtract(f.ONE))>0)throw new Error("x coordinate out of bounds");if(u.compareTo(f.ONE)<0||u.compareTo(a.subtract(f.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(a).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var ah=function(){var a="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",d='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',u='(?:"'+d+'*")',_=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+a+"|"+u+")","g"),T=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),E={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function L(W,z,D){return z?E[z]:String.fromCharCode(parseInt(D,16))}var I=new String(""),V="\\",O=Object.hasOwnProperty;return function(W,z){var D=W.match(_),U,k=D[0],H=!1;k==="{"?U={}:k==="["?U=[]:(U=[],H=!0);for(var G,$=[U],se=1-H,me=D.length;se<me;++se){k=D[se];var fe;switch(k.charCodeAt(0)){default:fe=$[0],fe[G||fe.length]=+k,G=void 0;break;case 34:if(k=k.substring(1,k.length-1),k.indexOf(V)!==-1&&(k=k.replace(T,L)),fe=$[0],!G)if(fe instanceof Array)G=fe.length;else{G=k||I;break}fe[G]=k,G=void 0;break;case 91:fe=$[0],$.unshift(fe[G||fe.length]=[]),G=void 0;break;case 93:$.shift();break;case 102:fe=$[0],fe[G||fe.length]=!1,G=void 0;break;case 110:fe=$[0],fe[G||fe.length]=null,G=void 0;break;case 116:fe=$[0],fe[G||fe.length]=!0,G=void 0;break;case 123:fe=$[0],$.unshift(fe[G||fe.length]={}),G=void 0;break;case 125:$.shift();break}}if(H){if($.length!==1)throw new Error;U=U[0]}else if($.length)throw new Error;if(z){var _e=function(Z,J){var ee=Z[J];if(ee&&typeof ee=="object"){var Y=null;for(var re in ee)if(O.call(ee,re)&&ee!==Z){var ve=_e(ee,re);ve!==void 0?ee[re]=ve:(Y||(Y=[]),Y.push(re))}if(Y)for(var Se=Y.length;--Se>=0;)delete ee[Y[Se]]}return z.call(Z,J,ee)};U=_e({"":U},"")}return U}}();(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),R.asn1.ASN1Util=new function(){this.integerToByteHex=function(a){var d=a.toString(16);return d.length%2==1&&(d="0"+d),d},this.bigIntToMinTwosComplementsHex=function(a){return mo(a)},this.getPEMStringFromHex=function(a,d){return fn(a,d)},this.newObject=function(a){var d=R,u=d.asn1,_=u.ASN1Object,T=u.DERBoolean,E=u.DERInteger,L=u.DERBitString,I=u.DEROctetString,V=u.DERNull,O=u.DERObjectIdentifier,W=u.DEREnumerated,z=u.DERUTF8String,D=u.DERNumericString,U=u.DERPrintableString,k=u.DERTeletexString,H=u.DERIA5String,G=u.DERUTCTime,$=u.DERGeneralizedTime,se=u.DERVisibleString,me=u.DERBMPString,fe=u.DERSequence,_e=u.DERSet,Z=u.DERTaggedObject,J=u.ASN1Util.newObject;if(a instanceof u.ASN1Object)return a;var ee=Object.keys(a);if(ee.length!=1)throw new Error("key of param shall be only one.");var Y=ee[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+Y+":")==-1)throw new Error("undefined key: "+Y);if(Y=="bool")return new T(a[Y]);if(Y=="int")return new E(a[Y]);if(Y=="bitstr")return new L(a[Y]);if(Y=="octstr")return new I(a[Y]);if(Y=="null")return new V(a[Y]);if(Y=="oid")return new O(a[Y]);if(Y=="enum")return new W(a[Y]);if(Y=="utf8str")return new z(a[Y]);if(Y=="numstr")return new D(a[Y]);if(Y=="prnstr")return new U(a[Y]);if(Y=="telstr")return new k(a[Y]);if(Y=="ia5str")return new H(a[Y]);if(Y=="utctime")return new G(a[Y]);if(Y=="gentime")return new $(a[Y]);if(Y=="visstr")return new se(a[Y]);if(Y=="bmpstr")return new me(a[Y]);if(Y=="asn1")return new _(a[Y]);if(Y=="seq"){for(var re=a[Y],ve=[],Se=0;Se<re.length;Se++){var ze=J(re[Se]);ve.push(ze)}return new fe({array:ve})}if(Y=="set"){for(var re=a[Y],ve=[],Se=0;Se<re.length;Se++){var ze=J(re[Se]);ve.push(ze)}return new _e({array:ve})}if(Y=="tag"){var be=a[Y];if(Object.prototype.toString.call(be)==="[object Array]"&&be.length==3){var Re=J(be[2]);return new Z({tag:be[0],explicit:be[1],obj:Re})}else return new Z(be)}},this.jsonToASN1HEX=function(a){var d=this.newObject(a);return d.tohex()}},R.asn1.ASN1Util.oidHexToInt=function(a){for(var T="",d=parseInt(a.substr(0,2),16),u=Math.floor(d/40),_=d%40,T=u+"."+_,E="",L=2;L<a.length;L+=2){var I=parseInt(a.substr(L,2),16),V=("00000000"+I.toString(2)).slice(-8);if(E=E+V.substr(1,7),V.substr(0,1)=="0"){var O=new f(E,2);T=T+"."+O.toString(10),E=""}}return T},R.asn1.ASN1Util.oidIntToHex=function(a){var d=function(I){var V=I.toString(16);return V.length==1&&(V="0"+V),V},u=function(I){var V="",O=new f(I,10),W=O.toString(2),z=7-W.length%7;z==7&&(z=0);for(var D="",U=0;U<z;U++)D+="0";W=D+W;for(var U=0;U<W.length-1;U+=7){var k=W.substr(U,7);U!=W.length-7&&(k="1"+k),V+=d(parseInt(k,2))}return V};if(!a.match(/^[0-9.]+$/))throw"malformed oid string: "+a;var _="",T=a.split("."),E=parseInt(T[0])*40+parseInt(T[1]);_+=d(E),T.splice(0,2);for(var L=0;L<T.length;L++)_+=u(T[L]);return _},R.asn1.ASN1Object=function(a){var d="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+d.length+",v="+this.hV);var u=this.hV.length/2,_=u.toString(16);if(_.length%2==1&&(_="0"+_),u<128)return _;var T=_.length/2;if(T>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+u.toString(16));var E=128+T;return E.toString(16)+_},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(u){this.params=u},a!=null&&a.tlv!=null&&(this.hTLV=a.tlv,this.isModified=!1)},R.asn1.DERAbstractString=function(a){R.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(d){this.hTLV=null,this.isModified=!0,this.s=d,this.hV=uc(this.s).toLowerCase()},this.setStringHex=function(d){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=d},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a=="string"?this.setString(a):typeof a.str<"u"?this.setString(a.str):typeof a.hex<"u"&&this.setStringHex(a.hex))},je(R.asn1.DERAbstractString,R.asn1.ASN1Object),R.asn1.DERAbstractTime=function(a){R.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(d){var u=d.getTime()+d.getTimezoneOffset()*6e4,_=new Date(u);return _},this.formatDate=function(d,u,_){var T=this.zeroPadding,E=this.localDateToUTC(d),L=String(E.getFullYear());u=="utc"&&(L=L.substr(2,2));var I=T(String(E.getMonth()+1),2),V=T(String(E.getDate()),2),O=T(String(E.getHours()),2),W=T(String(E.getMinutes()),2),z=T(String(E.getSeconds()),2),D=L+I+V+O+W+z;if(_===!0){var U=E.getMilliseconds();if(U!=0){var k=T(String(U),3);k=k.replace(/[0]+$/,""),D=D+"."+k}}return D+"Z"},this.zeroPadding=function(d,u){return d.length>=u?d:new Array(u-d.length+1).join("0")+d},this.setByParam=function(d){this.hV=null,this.hTLV=null,this.params=d},this.getString=function(){},this.setString=function(d){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=d},this.setByDate=function(d){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=d},this.setByDateValue=function(d,u,_,T,E,L){var I=new Date(Date.UTC(d,u-1,_,T,E,L,0));this.setByDate(I)},this.getFreshValueHex=function(){return this.hV}},je(R.asn1.DERAbstractTime,R.asn1.ASN1Object),R.asn1.DERAbstractStructured=function(a){R.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(d){this.hTLV=null,this.isModified=!0,this.asn1Array=d},this.appendASN1Object=function(d){this.hTLV=null,this.isModified=!0,this.asn1Array.push(d)},this.asn1Array=new Array,typeof a<"u"&&typeof a.array<"u"&&(this.asn1Array=a.array)},je(R.asn1.DERAbstractStructured,R.asn1.ASN1Object),R.asn1.DERBoolean=function(a){R.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",a==!1?this.hTLV="010100":this.hTLV="0101ff"},je(R.asn1.DERBoolean,R.asn1.ASN1Object),R.asn1.DERInteger=function(a){R.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var d=mo;this.setByBigInteger=function(u){this.isModified=!0,this.params={bigint:u}},this.setByInteger=function(u){this.isModified=!0,this.params=u},this.setValueHex=function(u){this.isModified=!0,this.params={hex:u}},this.getFreshValueHex=function(){var u=this.params,_=null;if(u==null)throw new Error("value not set");if(typeof u=="object"&&u.hex!=null)return this.hV=u.hex,this.hV;if(typeof u=="number")_=new f(String(u),10);else if(u.int!=null)_=new f(String(u.int),10);else if(u.bigint!=null)_=u.bigint;else throw new Error("wrong parameter");return this.hV=d(_),this.hV},a!=null&&(this.params=a)},je(R.asn1.DERInteger,R.asn1.ASN1Object),R.asn1.DERBitString=function(a){if(a!==void 0&&typeof a.obj<"u"){var d=R.asn1.ASN1Util.newObject(a.obj);a.hex="00"+d.tohex()}R.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(u){this.hTLV=null,this.isModified=!0,this.hV=u},this.setUnusedBitsAndHexValue=function(u,_){if(u<0||7<u)throw"unused bits shall be from 0 to 7: u = "+u;var T="0"+u;this.hTLV=null,this.isModified=!0,this.hV=T+_},this.setByBinaryString=function(u){u=u.replace(/0+$/,"");var _=8-u.length%8;_==8&&(_=0),u+="0000000".substr(0,_);for(var T="",E=0;E<u.length-1;E+=8){var L=u.substr(E,8),I=parseInt(L,2).toString(16);I.length==1&&(I="0"+I),T+=I}this.hTLV=null,this.isModified=!0,this.hV="0"+_+T},this.setByBooleanArray=function(u){for(var _="",T=0;T<u.length;T++)u[T]==!0?_+="1":_+="0";this.setByBinaryString(_)},this.newFalseArray=function(u){for(var _=new Array(u),T=0;T<u;T++)_[T]=!1;return _},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a=="string"&&a.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(a):typeof a.hex<"u"?this.setHexValueIncludingUnusedBits(a.hex):typeof a.bin<"u"?this.setByBinaryString(a.bin):typeof a.array<"u"&&this.setByBooleanArray(a.array))},je(R.asn1.DERBitString,R.asn1.ASN1Object),R.asn1.DEROctetString=function(a){if(a!==void 0&&typeof a.obj<"u"){var d=R.asn1.ASN1Util.newObject(a.obj);a.hex=d.tohex()}R.asn1.DEROctetString.superclass.constructor.call(this,a),this.hT="04"},je(R.asn1.DEROctetString,R.asn1.DERAbstractString),R.asn1.DERNull=function(){R.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},je(R.asn1.DERNull,R.asn1.ASN1Object),R.asn1.DERObjectIdentifier=function(a){R.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(d){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=d},this.setValueOidString=function(d){var u=mh(d);if(u==null)throw new Error("malformed oid string: "+d);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=u},this.setValueName=function(d){var u=R.asn1.x509.OID.name2oid(d);if(u!=="")this.setValueOidString(u);else throw new Error("DERObjectIdentifier oidName undefined: "+d)},this.setValueNameOrOid=function(d){d.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(d):this.setValueName(d)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(d){typeof d=="string"?this.setValueNameOrOid(d):d.oid!==void 0?this.setValueNameOrOid(d.oid):d.name!==void 0?this.setValueNameOrOid(d.name):d.hex!==void 0&&this.setValueHex(d.hex)},a!==void 0&&this.setByParam(a)},je(R.asn1.DERObjectIdentifier,R.asn1.ASN1Object),R.asn1.DEREnumerated=function(a){R.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(d){this.hTLV=null,this.isModified=!0,this.hV=mo(d)},this.setByInteger=function(d){var u=new f(String(d),10);this.setByBigInteger(u)},this.setValueHex=function(d){this.hV=d},this.getFreshValueHex=function(){return this.hV},typeof a<"u"&&(typeof a.int<"u"?this.setByInteger(a.int):typeof a=="number"?this.setByInteger(a):typeof a.hex<"u"&&this.setValueHex(a.hex))},je(R.asn1.DEREnumerated,R.asn1.ASN1Object),R.asn1.DERUTF8String=function(a){R.asn1.DERUTF8String.superclass.constructor.call(this,a),this.hT="0c"},je(R.asn1.DERUTF8String,R.asn1.DERAbstractString),R.asn1.DERNumericString=function(a){R.asn1.DERNumericString.superclass.constructor.call(this,a),this.hT="12"},je(R.asn1.DERNumericString,R.asn1.DERAbstractString),R.asn1.DERPrintableString=function(a){R.asn1.DERPrintableString.superclass.constructor.call(this,a),this.hT="13"},je(R.asn1.DERPrintableString,R.asn1.DERAbstractString),R.asn1.DERTeletexString=function(a){R.asn1.DERTeletexString.superclass.constructor.call(this,a),this.hT="14"},je(R.asn1.DERTeletexString,R.asn1.DERAbstractString),R.asn1.DERIA5String=function(a){R.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="16"},je(R.asn1.DERIA5String,R.asn1.DERAbstractString),R.asn1.DERVisibleString=function(a){R.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="1a"},je(R.asn1.DERVisibleString,R.asn1.DERAbstractString),R.asn1.DERBMPString=function(a){R.asn1.DERBMPString.superclass.constructor.call(this,a),this.hT="1e"},je(R.asn1.DERBMPString,R.asn1.DERAbstractString),R.asn1.DERUTCTime=function(a){R.asn1.DERUTCTime.superclass.constructor.call(this,a),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var d=this.params;if(this.params==null&&(d={date:new Date}),typeof d=="string")if(d.match(/^[0-9]{12}Z$/)||d.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=kn(d);else throw new Error("malformed string for UTCTime: "+d);else if(d.str!=null)this.hV=kn(d.str);else if(d.date==null&&d.millis==!0){var u=new Date;this.hV=kn(this.formatDate(u,"utc",!0))}else if(d.date!=null&&d.date instanceof Date){var _=d.millis===!0;this.hV=kn(this.formatDate(d.date,"utc",_))}else d instanceof Date&&(this.hV=kn(this.formatDate(d,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},a!=null&&this.setByParam(a)},je(R.asn1.DERUTCTime,R.asn1.DERAbstractTime),R.asn1.DERGeneralizedTime=function(a){R.asn1.DERGeneralizedTime.superclass.constructor.call(this,a),this.hT="18",this.params=a,this.getFreshValueHex=function(){var d=this.params;if(this.params==null&&(d={date:new Date}),typeof d=="string")if(d.match(/^[0-9]{14}Z$/)||d.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=kn(d);else throw new Error("malformed string for GeneralizedTime: "+d);else if(d.str!=null)this.hV=kn(d.str);else if(d.date==null&&d.millis==!0){var u=new Date;this.hV=kn(this.formatDate(u,"gen",!0))}else if(d.date!=null&&d.date instanceof Date){var _=d.millis===!0;this.hV=kn(this.formatDate(d.date,"gen",_))}else d instanceof Date&&(this.hV=kn(this.formatDate(d,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},a!=null&&this.setByParam(a)},je(R.asn1.DERGeneralizedTime,R.asn1.DERAbstractTime),R.asn1.DERSequence=function(a){R.asn1.DERSequence.superclass.constructor.call(this,a),this.hT="30",this.getFreshValueHex=function(){for(var d="",u=0;u<this.asn1Array.length;u++){var _=this.asn1Array[u];d+=_.tohex()}return this.hV=d,this.hV}},je(R.asn1.DERSequence,R.asn1.DERAbstractStructured),R.asn1.DERSet=function(a){R.asn1.DERSet.superclass.constructor.call(this,a),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var d=new Array,u=0;u<this.asn1Array.length;u++){var _=this.asn1Array[u];d.push(_.tohex())}return this.sortFlag==!0&&d.sort(),this.hV=d.join(""),this.hV},typeof a<"u"&&typeof a.sortflag<"u"&&a.sortflag==!1&&(this.sortFlag=!1)},je(R.asn1.DERSet,R.asn1.DERAbstractStructured),R.asn1.DERTaggedObject=function(a){R.asn1.DERTaggedObject.superclass.constructor.call(this);var d=R.asn1,u=Ze,_=u.getV;u.isASN1HEX;var T=d.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(E,L,I){this.params={tag:L,explicit:E,obj:I}},this.getFreshValueHex=function(){var E=this.params;if(E.explicit==null&&(E.explicit=!0),E.tage!=null&&(E.tag=E.tage,E.explicit=!0),E.tagi!=null&&(E.tag=E.tagi,E.explicit=!1),E.str!=null)this.hV=uc(E.str);else if(E.hex!=null)this.hV=E.hex;else if(E.obj!=null){var L;E.obj instanceof d.ASN1Object?L=E.obj.tohex():typeof E.obj=="object"&&(L=T(E.obj).tohex()),E.explicit?this.hV=L:this.hV=_(L,0)}else throw new Error("str, hex nor obj not specified");return E.tag==null&&(E.tag="a0"),this.hT=E.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(E){this.params=E},a!==void 0&&this.setByParam(a)},je(R.asn1.DERTaggedObject,R.asn1.ASN1Object);var Ze=new function(){};Ze.getLblen=function(a,d){if(a.substr(d+2,1)!="8")return 1;var u=parseInt(a.substr(d+3,1));return u==0?-1:0<u&&u<10?u+1:-2},Ze.getL=function(a,d){var u=Ze.getLblen(a,d);return u<1?"":a.substr(d+2,u*2)},Ze.getVblen=function(a,d){var u,_;return u=Ze.getL(a,d),u==""?-1:(u.substr(0,1)==="8"?_=new f(u.substr(2),16):_=new f(u,16),_.intValue())},Ze.getVidx=function(a,d){var u=Ze.getLblen(a,d);return u<0?u:d+(u+1)*2},Ze.getV=function(a,d){var u=Ze.getVidx(a,d),_=Ze.getVblen(a,d);return a.substr(u,_*2)},Ze.getTLV=function(a,d){return a.substr(d,2)+Ze.getL(a,d)+Ze.getV(a,d)},Ze.getTLVblen=function(a,d){return 2+Ze.getLblen(a,d)*2+Ze.getVblen(a,d)*2},Ze.getNextSiblingIdx=function(a,d){var u=Ze.getVidx(a,d),_=Ze.getVblen(a,d);return u+_*2},Ze.getChildIdx=function(a,d){var u=Ze,_=[],T,E,L;T=u.getVidx(a,d),E=u.getVblen(a,d)*2,a.substr(d,2)=="03"&&(T+=2,E-=2),L=0;for(var I=T;L<=E;){var V=u.getTLVblen(a,I);if(L+=V,L<=E&&_.push(I),I+=V,L>=E)break}return _},Ze.getNthChildIdx=function(a,d,u){var _=Ze.getChildIdx(a,d);return _[u]},Ze.getIdxbyList=function(a,d,u,_){var T=Ze,E,L;return u.length==0?_!==void 0&&a.substr(d,2)!==_?-1:d:(E=u.shift(),L=T.getChildIdx(a,d),E>=L.length?-1:T.getIdxbyList(a,L[E],u,_))},Ze.getIdxbyListEx=function(a,d,u,_){var T=Ze,E,L;if(u.length==0)return _!==void 0&&a.substr(d,2)!==_?-1:d;E=u.shift(),L=T.getChildIdx(a,d);for(var I=0,V=0;V<L.length;V++){var O=a.substr(L[V],2);if(typeof E=="number"&&!T.isContextTag(O)&&I==E||typeof E=="string"&&T.isContextTag(O,E))return T.getIdxbyListEx(a,L[V],u,_);T.isContextTag(O)||I++}return-1},Ze.getTLVbyList=function(a,d,u,_){var T=Ze,E=T.getIdxbyList(a,d,u,_);return E==-1||E>=a.length?null:T.getTLV(a,E)},Ze.getTLVbyListEx=function(a,d,u,_){var T=Ze,E=T.getIdxbyListEx(a,d,u,_);return E==-1?null:T.getTLV(a,E)},Ze.getVbyList=function(a,d,u,_,T){var E=Ze,L,I;return L=E.getIdxbyList(a,d,u,_),L==-1||L>=a.length?null:(I=E.getV(a,L),T===!0&&(I=I.substr(2)),I)},Ze.getVbyListEx=function(a,d,u,_,T){var E=Ze,L,I;return L=E.getIdxbyListEx(a,d,u,_),L==-1?null:(I=E.getV(a,L),a.substr(L,2)=="03"&&T!==!1&&(I=I.substr(2)),I)},Ze.getInt=function(a,d,u){u==null&&(u=-1);try{var _=a.substr(d,2);if(_!="02"&&_!="03")return u;var T=Ze.getV(a,d);return _=="02"?parseInt(T,16):vh(T)}catch{return u}},Ze.getOID=function(a,d,u){u==null&&(u=null);try{if(a.substr(d,2)!="06")return u;var _=Ze.getV(a,d);return vc(_)}catch{return u}},Ze.getOIDName=function(a,d,u){u==null&&(u=null);try{var _=Ze.getOID(a,d,u);if(_==u)return u;var T=R.asn1.x509.OID.oid2name(_);return T==""?_:T}catch{return u}},Ze.getString=function(a,d,u){u==null&&(u=null);try{var _=Ze.getV(a,d);return Nn(_)}catch{return u}},Ze.hextooidstr=function(a){var d=function(z,D){return z.length>=D?z:new Array(D-z.length+1).join("0")+z},u=[],_=a.substr(0,2),T=parseInt(_,16);u[0]=new String(Math.floor(T/40)),u[1]=new String(T%40);for(var E=a.substr(2),L=[],I=0;I<E.length/2;I++)L.push(parseInt(E.substr(I*2,2),16));for(var V=[],O="",I=0;I<L.length;I++)L[I]&128?O=O+d((L[I]&127).toString(2),7):(O=O+d((L[I]&127).toString(2),7),V.push(new String(parseInt(O,2))),O="");var W=u.join(".");return V.length>0&&(W=W+"."+V.join(".")),W},Ze.dump=function(a,d,u,_){var T=Ze,E=T.getV,L=T.dump,I=T.getChildIdx,V=a;a instanceof R.asn1.ASN1Object&&(V=a.tohex());var O=function(J,ee){if(J.length<=ee*2)return J;var Y=J.substr(0,ee)+"..(total "+J.length/2+"bytes).."+J.substr(J.length-ee,ee);return Y};d===void 0&&(d={ommit_long_octet:32}),u===void 0&&(u=0),_===void 0&&(_="");var W=d.ommit_long_octet,_e=V.substr(u,2);if(_e=="01"){var z=E(V,u);return z=="00"?_+`BOOLEAN FALSE
`:_+`BOOLEAN TRUE
`}if(_e=="02"){var z=E(V,u);return _+"INTEGER "+O(z,W)+`
`}if(_e=="03"){var z=E(V,u);if(T.isASN1HEX(z.substr(2))){var D=_+`BITSTRING, encapsulates
`;return D=D+L(z.substr(2),d,0,_+"  "),D}else return _+"BITSTRING "+O(z,W)+`
`}if(_e=="04"){var z=E(V,u);if(T.isASN1HEX(z)){var D=_+`OCTETSTRING, encapsulates
`;return D=D+L(z,d,0,_+"  "),D}else return _+"OCTETSTRING "+O(z,W)+`
`}if(_e=="05")return _+`NULL
`;if(_e=="06"){var U=E(V,u),k=R.asn1.ASN1Util.oidHexToInt(U),H=R.asn1.x509.OID.oid2name(k),G=k.replace(/\./g," ");return H!=""?_+"ObjectIdentifier "+H+" ("+G+`)
`:_+"ObjectIdentifier ("+G+`)
`}if(_e=="0a")return _+"ENUMERATED "+parseInt(E(V,u))+`
`;if(_e=="0c")return _+"UTF8String '"+gi(E(V,u))+`'
`;if(_e=="13")return _+"PrintableString '"+gi(E(V,u))+`'
`;if(_e=="14")return _+"TeletexString '"+gi(E(V,u))+`'
`;if(_e=="16")return _+"IA5String '"+gi(E(V,u))+`'
`;if(_e=="17")return _+"UTCTime "+gi(E(V,u))+`
`;if(_e=="18")return _+"GeneralizedTime "+gi(E(V,u))+`
`;if(_e=="1a")return _+"VisualString '"+gi(E(V,u))+`'
`;if(_e=="1e")return _+"BMPString '"+od(E(V,u))+`'
`;if(_e=="30"){if(V.substr(u,4)=="3000")return _+`SEQUENCE {}
`;var D=_+`SEQUENCE
`,$=I(V,u),se=d;if(($.length==2||$.length==3)&&V.substr($[0],2)=="06"&&V.substr($[$.length-1],2)=="04"){var H=T.oidname(E(V,$[0])),me=JSON.parse(JSON.stringify(d));me.x509ExtName=H,se=me}for(var fe=0;fe<$.length;fe++)D=D+L(V,se,$[fe],_+"  ");return D}if(_e=="31"){for(var D=_+`SET
`,$=I(V,u),fe=0;fe<$.length;fe++)D=D+L(V,d,$[fe],_+"  ");return D}var _e=parseInt(_e,16);if((_e&128)!=0){var Z=_e&31;if((_e&32)!=0){for(var D=_+"["+Z+`]
`,$=I(V,u),fe=0;fe<$.length;fe++)D=D+L(V,d,$[fe],_+"  ");return D}else{var z=E(V,u);if(Ze.isASN1HEX(z)){var D=_+"["+Z+`]
`;return D=D+L(z,d,0,_+"  "),D}else(z.substr(0,8)=="68747470"||d.x509ExtName==="subjectAltName"&&Z==2)&&(z=gi(z));var D=_+"["+Z+"] "+z+`
`;return D}}return _+"UNKNOWN("+_e+") "+E(V,u)+`
`},Ze.parse=function(a){var d=Ze,u=d.parse,_=d.isASN1HEX,T=d.getV,E=d.getTLV,L=d.getChildIdx,I=R.asn1,V=I.ASN1Util.oidHexToInt,O=I.x509.OID.oid2name,W=gi,z=od,D=S_,U={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},k=function(Y){for(var re=[],ve=L(Y,0),Se=0;Se<ve.length;Se++){var ze=ve[Se],be=E(Y,ze),Re=u(be);re.push(Re)}return re},H=a.substr(0,2),G={},$=T(a,0);if(H=="01")return a=="0101ff"?{bool:!0}:{bool:!1};if(H=="02")return{int:{hex:$}};if(H=="03")try{if($.substr(0,2)!="00")throw"not encap";var se=$.substr(2);if(!_(se))throw"not encap";return{bitstr:{obj:u(se)}}}catch{var me=null;return $.length<=10&&(me=bh($)),me==null?{bitstr:{hex:$}}:{bitstr:{bin:me}}}else if(H=="04")try{if(!_($))throw"not encap";return{octstr:{obj:u($)}}}catch{return{octstr:{hex:$}}}else{if(H=="05")return{null:""};if(H=="06"){var fe=V($),_e=O(fe);return _e==""?{oid:fe}:{oid:_e}}else{if(H=="0a")return $.length>4?{enum:{hex:$}}:{enum:parseInt($,16)};if(H=="30"||H=="31")return G[U[H]]=k(a),G;if(H=="14"){var Z=D($);return G[U[H]]={str:Z},G}else if(H=="1e"){var Z=z($);return G[U[H]]={str:Z},G}else if(":0c:12:13:16:17:18:1a:".indexOf(H)!=-1){var Z=W($);return G[U[H]]={str:Z},G}else if(H.match(/^8[0-9]$/)){var Z=W($);return Z==null|Z==""?{tag:{tag:H,explicit:!1,hex:$}}:Z.match(/[\x00-\x1F\x7F-\x9F]/)!=null||Z.match(/[\u0000-\u001F\u0080–\u009F]/)!=null?{tag:{tag:H,explicit:!1,hex:$}}:{tag:{tag:H,explicit:!1,str:Z}}}else if(H.match(/^a[0-9]$/))try{if(!_($))throw new Error("not encap");return{tag:{tag:H,explicit:!0,obj:u($)}}}catch{return{tag:{tag:H,explicit:!0,hex:$}}}else{var J=new R.asn1.ASN1Object;J.hV=$;var ee=J.getLengthHexFromValue();return{asn1:{tlv:H+ee+$}}}}}},Ze.isContextTag=function(a,d){a=a.toLowerCase();var u,_;try{u=parseInt(a,16)}catch{return-1}if(d===void 0)return(u&192)==128;try{var T=d.match(/^\[[0-9]+\]$/);return T==null||(_=parseInt(d.substr(1,d.length-1),10),_>31)?!1:(u&192)==128&&(u&31)==_}catch{return!1}},Ze.isASN1HEX=function(a){var d=Ze;if(a.length%2==1)return!1;var u=d.getVblen(a,0),_=a.substr(0,2),T=d.getL(a,0),E=a.length-_.length-T.length;return E==u*2},Ze.checkStrictDER=function(a,d,u,_,T){var E=Ze;if(u===void 0){if(typeof a!="string")throw new Error("not hex string");if(a=a.toLowerCase(),!R.lang.String.isHex(a))throw new Error("not hex string");u=a.length,_=a.length/2,_<128?T=1:T=Math.ceil(_.toString(16))+1}var L=E.getL(a,d);if(L.length>T*2)throw new Error("L of TLV too long: idx="+d);var I=E.getVblen(a,d);if(I>_)throw new Error("value of L too long than hex: idx="+d);var V=E.getTLV(a,d),O=V.length-2-E.getL(a,d).length;if(O!==I*2)throw new Error("V string length and L's value not the same:"+O+"/"+I*2);if(d===0&&a.length!=V.length)throw new Error("total length and TLV length unmatch:"+a.length+"!="+V.length);var W=a.substr(d,2);if(W==="02"){var z=E.getVidx(a,d);if(a.substr(z,2)=="00"&&a.charCodeAt(z+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(W,16)&32){for(var D=E.getVblen(a,d),U=0,k=E.getChildIdx(a,d),H=0;H<k.length;H++){var G=E.getTLV(a,k[H]);U+=G.length,E.checkStrictDER(a,k[H],u,_,T)}if(D*2!=U)throw new Error("sum of children's TLV length and L unmatch: "+D*2+"!="+U)}},Ze.oidname=function(a){var d=R.asn1;R.lang.String.isHex(a)&&(a=d.ASN1Util.oidHexToInt(a));var u=d.x509.OID.oid2name(a);return u===""&&(u=a),u},(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),(typeof R.asn1.x509>"u"||!R.asn1.x509)&&(R.asn1.x509={}),R.asn1.x509.Certificate=function(a){R.asn1.x509.Certificate.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERBitString,T=u.DERSequence,E=u.x509,L=E.TBSCertificate,I=E.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(V){this.params=V},this.sign=function(){var V=this.params,O=V.sigalg;V.sigalg.name!=null&&(O=V.sigalg.name);var W=V.tbsobj.tohex(),z=new R.crypto.Signature({alg:O});z.init(V.cakey),z.updateHex(W),V.sighex=z.sign()},this.getPEM=function(){return fn(this.tohex(),"CERTIFICATE")},this.tohex=function(){var V=this.params;if((V.tbsobj==null||V.tbsobj==null)&&(V.tbsobj=new L(V)),V.sighex==null&&V.cakey!=null&&this.sign(),V.sighex==null)throw new Error("sighex or cakey parameter not defined");var O=[];O.push(V.tbsobj),O.push(new I({name:V.sigalg})),O.push(new _({hex:"00"+V.sighex}));var W=new T({array:O});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&(this.params=a)},je(R.asn1.x509.Certificate,R.asn1.ASN1Object),R.asn1.x509.TBSCertificate=function(a){R.asn1.x509.TBSCertificate.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.x509,T=u.DERTaggedObject,E=u.DERInteger,L=u.DERSequence,I=_.AlgorithmIdentifier,V=_.Time,O=_.X500Name,W=_.Extensions,z=_.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(D){this.params=D},this.tohex=function(){var D=[],U=this.params;if(U.version!=null||U.version!=1){var k=2;U.version!=null&&(k=U.version-1);var H=new T({obj:new E({int:k})});D.push(H)}D.push(new E(U.serial)),D.push(new I({name:U.sigalg})),D.push(new O(U.issuer)),D.push(new L({array:[new V(U.notbefore),new V(U.notafter)]})),D.push(new O(U.subject)),D.push(new z(ai.getKey(U.sbjpubkey))),U.ext!==void 0&&U.ext.length>0&&D.push(new T({tag:"a3",obj:new W(U.ext)}));var G=new R.asn1.DERSequence({array:D});return G.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.TBSCertificate,R.asn1.ASN1Object),R.asn1.x509.Extensions=function(a){R.asn1.x509.Extensions.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERSequence,T=u.x509;this.aParam=[],this.setByParam=function(E){this.aParam=E},this.tohex=function(){for(var E=[],L=0;L<this.aParam.length;L++){var I=this.aParam[L],V=I.extname,O=null;if(I.extn!=null)O=new T.PrivateExtension(I);else if(V=="subjectKeyIdentifier")O=new T.SubjectKeyIdentifier(I);else if(V=="keyUsage")O=new T.KeyUsage(I);else if(V=="subjectAltName")O=new T.SubjectAltName(I);else if(V=="issuerAltName")O=new T.IssuerAltName(I);else if(V=="basicConstraints")O=new T.BasicConstraints(I);else if(V=="nameConstraints")O=new T.NameConstraints(I);else if(V=="cRLDistributionPoints")O=new T.CRLDistributionPoints(I);else if(V=="certificatePolicies")O=new T.CertificatePolicies(I);else if(V=="policyMappings")O=new T.PolicyMappings(I);else if(V=="policyConstraints")O=new T.PolicyConstraints(I);else if(V=="inhibitAnyPolicy")O=new T.InhibitAnyPolicy(I);else if(V=="authorityKeyIdentifier")O=new T.AuthorityKeyIdentifier(I);else if(V=="extKeyUsage")O=new T.ExtKeyUsage(I);else if(V=="authorityInfoAccess")O=new T.AuthorityInfoAccess(I);else if(V=="cRLNumber")O=new T.CRLNumber(I);else if(V=="cRLReason")O=new T.CRLReason(I);else if(V=="ocspNonce")O=new T.OCSPNonce(I);else if(V=="ocspNoCheck")O=new T.OCSPNoCheck(I);else if(V=="adobeTimeStamp")O=new T.AdobeTimeStamp(I);else if(V=="subjectDirectoryAttributes")O=new T.SubjectDirectoryAttributes(I);else throw new Error("extension not supported:"+JSON.stringify(I));O!=null&&E.push(O)}var W=new _({array:E});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.x509.Extensions,R.asn1.ASN1Object),R.asn1.x509.Extension=function(a){R.asn1.x509.Extension.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERObjectIdentifier,T=u.DEROctetString;u.DERBitString;var E=u.DERBoolean,L=u.DERSequence;this.tohex=function(){var I=new _({oid:this.oid}),V=new T({hex:this.getExtnValueHex()}),O=new Array;O.push(I),this.critical&&O.push(new E),O.push(V);var W=new L({array:O});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,a!==void 0&&a.critical!==void 0&&(this.critical=a.critical)},je(R.asn1.x509.Extension,R.asn1.ASN1Object),R.asn1.x509.KeyUsage=function(a){R.asn1.x509.KeyUsage.superclass.constructor.call(this,a);var d=Error,u={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var _=this.getBinValue();return this.asn1ExtnValue=new R.asn1.DERBitString({bin:_}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var _=this.params;if(typeof _!="object"||typeof _.names!="object"&&typeof _.bin!="string")throw new d("parameter not yet set");if(_.names!=null)return bc(_.names,u);if(_.bin!=null)return _.bin;throw new d("parameter not set properly")},this.oid="2.5.29.15",a!==void 0&&(this.params=a)},je(R.asn1.x509.KeyUsage,R.asn1.x509.Extension),R.asn1.x509.BasicConstraints=function(a){R.asn1.x509.BasicConstraints.superclass.constructor.call(this,a);var d=R.asn1,u=d.DERBoolean,_=d.DERInteger,T=d.DERSequence;this.getExtnValueHex=function(){var E=new Array;this.cA&&E.push(new u),this.pathLen>-1&&E.push(new _({int:this.pathLen}));var L=new T({array:E});return this.asn1ExtnValue=L,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,a!==void 0&&(a.cA!==void 0&&(this.cA=a.cA),a.pathLen!==void 0&&(this.pathLen=a.pathLen))},je(R.asn1.x509.BasicConstraints,R.asn1.x509.Extension),R.asn1.x509.CRLDistributionPoints=function(a){R.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(T){for(var E=[],L=0;L<T.length;L++)if(T[L]instanceof R.asn1.ASN1Object)E.push(T[L]);else{var I=new _.DistributionPoint(T[L]);E.push(I)}this.asn1ExtnValue=new u.DERSequence({array:E})},this.setByOneURI=function(T){var E=new _.DistributionPoint({fulluri:T});this.setByDPArray([E])},this.oid="2.5.29.31",a!==void 0&&(a.array!==void 0?this.setByDPArray(a.array):a.uri!==void 0&&this.setByOneURI(a.uri))},je(R.asn1.x509.CRLDistributionPoints,R.asn1.x509.Extension),R.asn1.x509.DistributionPoint=function(a){R.asn1.x509.DistributionPoint.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.x509.DistributionPointName;this.tohex=function(){var T=new u.DERSequence;if(this.asn1DP!=null){var E=new u.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});T.appendASN1Object(E)}return this.hTLV=T.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.dpobj!==void 0?this.asn1DP=a.dpobj:a.dpname!==void 0?this.asn1DP=new _(a.dpname):a.fulluri!==void 0&&(this.asn1DP=new _({full:[{uri:a.fulluri}]})))},je(R.asn1.x509.DistributionPoint,R.asn1.ASN1Object),R.asn1.x509.DistributionPointName=function(a){R.asn1.x509.DistributionPointName.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new _({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0)if(u.x509.GeneralNames.prototype.isPrototypeOf(a))this.type="full",this.tag="a0",this.asn1V=a;else if(a.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new u.x509.GeneralNames(a.full);else throw new Error("This class supports GeneralNames only as argument")},je(R.asn1.x509.DistributionPointName,R.asn1.ASN1Object),R.asn1.x509.CertificatePolicies=function(a){R.asn1.x509.CertificatePolicies.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.x509,T=u.DERSequence,E=_.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var L=[],I=0;I<this.params.array.length;I++)L.push(new E(this.params.array[I]));var V=new T({array:L});return this.asn1ExtnValue=V,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",a!==void 0&&(this.params=a)},je(R.asn1.x509.CertificatePolicies,R.asn1.x509.Extension),R.asn1.x509.PolicyInformation=function(a){R.asn1.x509.PolicyInformation.superclass.constructor.call(this,a);var d=R.asn1,u=d.DERSequence,_=d.DERObjectIdentifier,T=d.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var E=[new _(this.params.policyoid)];if(this.params.array!==void 0){for(var L=[],I=0;I<this.params.array.length;I++)L.push(new T(this.params.array[I]));L.length>0&&E.push(new u({array:L}))}var V=new u({array:E});return V.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},je(R.asn1.x509.PolicyInformation,R.asn1.ASN1Object),R.asn1.x509.PolicyQualifierInfo=function(a){R.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,a);var d=R.asn1,u=d.DERSequence,_=d.DERIA5String,T=d.DERObjectIdentifier,E=d.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var L=new u({array:[new T({oid:"1.3.6.1.5.5.7.2.1"}),new _({str:this.params.cps})]});return L.tohex()}if(this.params.unotice!=null){var L=new u({array:[new T({oid:"1.3.6.1.5.5.7.2.2"}),new E(this.params.unotice)]});return L.tohex()}},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},je(R.asn1.x509.PolicyQualifierInfo,R.asn1.ASN1Object),R.asn1.x509.UserNotice=function(a){R.asn1.x509.UserNotice.superclass.constructor.call(this,a);var d=R.asn1.DERSequence;R.asn1.DERInteger;var u=R.asn1.x509.DisplayText,_=R.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var T=[];this.params.noticeref!==void 0&&T.push(new _(this.params.noticeref)),this.params.exptext!==void 0&&T.push(new u(this.params.exptext));var E=new d({array:T});return E.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},je(R.asn1.x509.UserNotice,R.asn1.ASN1Object),R.asn1.x509.NoticeReference=function(a){R.asn1.x509.NoticeReference.superclass.constructor.call(this,a);var d=R.asn1.DERSequence,u=R.asn1.DERInteger,_=R.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var T=[];if(this.params.org!==void 0&&T.push(new _(this.params.org)),this.params.noticenum!==void 0){for(var E=[],L=this.params.noticenum,I=0;I<L.length;I++)E.push(new u(L[I]));T.push(new d({array:E}))}if(T.length==0)throw new Error("parameter is empty");var V=new d({array:T});return V.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(this.params=a)},je(R.asn1.x509.NoticeReference,R.asn1.ASN1Object),R.asn1.x509.DisplayText=function(a){R.asn1.x509.DisplayText.superclass.constructor.call(this,a),this.hT="0c",a!==void 0&&(a.type==="ia5"?this.hT="16":a.type==="vis"?this.hT="1a":a.type==="bmp"&&(this.hT="1e"))},je(R.asn1.x509.DisplayText,R.asn1.DERAbstractString),R.asn1.x509.PolicyMappings=function(a){R.asn1.x509.PolicyMappings.superclass.constructor.call(this,a);var d=R,u=d.asn1;u.x509;var _=u.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var T=this.params,E=[],L=0;L<T.array.length;L++){var I=T.array[L];E.push({seq:[{oid:I[0]},{oid:I[1]}]})}return this.asn1ExtnValue=_({seq:E}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",a!==void 0&&(this.params=a)},je(R.asn1.x509.PolicyMappings,R.asn1.x509.Extension),R.asn1.x509.PolicyConstraints=function(a){R.asn1.x509.PolicyConstraints.superclass.constructor.call(this,a);var d=R,u=d.asn1;u.x509;var _=u.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var T=this.params,E=[];return T.reqexp!=null&&E.push({tag:{tagi:"80",obj:{int:T.reqexp}}}),T.inhibit!=null&&E.push({tag:{tagi:"81",obj:{int:T.inhibit}}}),this.asn1ExtnValue=_({seq:E}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",a!==void 0&&(this.params=a)},je(R.asn1.x509.PolicyConstraints,R.asn1.x509.Extension),R.asn1.x509.InhibitAnyPolicy=function(a){R.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,a);var d=R,u=d.asn1;u.x509;var _=u.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=_({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",a!==void 0&&(this.params=a)},je(R.asn1.x509.InhibitAnyPolicy,R.asn1.x509.Extension),R.asn1.x509.NameConstraints=function(a){R.asn1.x509.NameConstraints.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.x509,T=u.ASN1Util.newObject,E=_.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var L=this.params,I=[];if(L.permit!=null&&L.permit.length!=null){for(var V=[],O=0;O<L.permit.length;O++)V.push(new E(L.permit[O]));I.push({tag:{tagi:"a0",obj:{seq:V}}})}if(L.exclude!=null&&L.exclude.length!=null){for(var W=[],O=0;O<L.exclude.length;O++)W.push(new E(L.exclude[O]));I.push({tag:{tagi:"a1",obj:{seq:W}}})}return this.asn1ExtnValue=T({seq:I}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",a!==void 0&&(this.params=a)},je(R.asn1.x509.NameConstraints,R.asn1.x509.Extension),R.asn1.x509.GeneralSubtree=function(a){R.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var d=R.asn1,u=d.x509,_=u.GeneralName,T=d.ASN1Util.newObject;this.params=null,this.setByParam=function(E){this.params=E},this.tohex=function(){var E=this.params,L=[new _(E)];E.min!=null&&L.push({tag:{tagi:"80",obj:{int:E.min}}}),E.max!=null&&L.push({tag:{tagi:"81",obj:{int:E.max}}});var I=T({seq:L});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.GeneralSubtree,R.asn1.ASN1Object),R.asn1.x509.ExtKeyUsage=function(a){R.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,a);var d=R,u=d.asn1;this.setPurposeArray=function(_){this.asn1ExtnValue=new u.DERSequence;for(var T=0;T<_.length;T++){var E=new u.DERObjectIdentifier(_[T]);this.asn1ExtnValue.appendASN1Object(E)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",a!==void 0&&a.array!==void 0&&this.setPurposeArray(a.array)},je(R.asn1.x509.ExtKeyUsage,R.asn1.x509.Extension),R.asn1.x509.AuthorityKeyIdentifier=function(a){R.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.DERTaggedObject,T=u.x509.GeneralNames;d.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var E=new Array;this.asn1KID&&E.push(new _({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&E.push(new _({explicit:!1,tag:"a1",obj:new T([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&E.push(new _({explicit:!1,tag:"82",obj:this.asn1CertSN}));var L=new u.DERSequence({array:E});return this.asn1ExtnValue=L,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(E){if(E.str!==void 0||E.hex!==void 0)this.asn1KID=new R.asn1.DEROctetString(E);else if(typeof E=="object"&&R.crypto.Util.isKey(E)||typeof E=="string"&&E.indexOf("BEGIN ")!=-1){var L=E;typeof E=="string"&&(L=ai.getKey(E));var I=ai.getKeyID(L);this.asn1KID=new R.asn1.DEROctetString({hex:I})}},this.setCertIssuerByParam=function(E){E.str!==void 0||E.ldapstr!==void 0||E.hex!==void 0||E.certsubject!==void 0||E.certissuer!==void 0?this.asn1CertIssuer=new R.asn1.x509.X500Name(E):typeof E=="string"&&E.indexOf("BEGIN ")!=-1&&E.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new R.asn1.x509.X500Name({certissuer:E}))},this.setCertSNByParam=function(E){if(E.str!==void 0||E.bigint!==void 0||E.hex!==void 0)this.asn1CertSN=new R.asn1.DERInteger(E);else if(typeof E=="string"&&E.indexOf("BEGIN ")!=-1&&E.indexOf("CERTIFICATE")){var L=new jt;L.readCertPEM(E);var I=L.getSerialNumberHex();this.asn1CertSN=new R.asn1.DERInteger({hex:I})}},this.oid="2.5.29.35",a!==void 0&&(a.kid!==void 0&&this.setKIDByParam(a.kid),a.issuer!==void 0&&this.setCertIssuerByParam(a.issuer),a.sn!==void 0&&this.setCertSNByParam(a.sn),a.issuersn!==void 0&&typeof a.issuersn=="string"&&a.issuersn.indexOf("BEGIN ")!=-1&&a.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(a.issuersn),this.setCertIssuerByParam(a.issuersn)))},je(R.asn1.x509.AuthorityKeyIdentifier,R.asn1.x509.Extension),R.asn1.x509.SubjectKeyIdentifier=function(a){R.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(T){if(T.str!==void 0||T.hex!==void 0)this.asn1KID=new _(T);else if(typeof T=="object"&&R.crypto.Util.isKey(T)||typeof T=="string"&&T.indexOf("BEGIN")!=-1){var E=T;typeof T=="string"&&(E=ai.getKey(T));var L=ai.getKeyID(E);this.asn1KID=new R.asn1.DEROctetString({hex:L})}},this.oid="2.5.29.14",a!==void 0&&a.kid!==void 0&&this.setKIDByParam(a.kid)},je(R.asn1.x509.SubjectKeyIdentifier,R.asn1.x509.Extension),R.asn1.x509.AuthorityInfoAccess=function(a){R.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,a),this.setAccessDescriptionArray=function(d){for(var u=new Array,_=R,T=_.asn1,E=T.DERSequence,L=T.DERObjectIdentifier,I=T.x509.GeneralName,V=0;V<d.length;V++){var O,W=d[V];if(W.ocsp!==void 0)O=new E({array:[new L({oid:"1.3.6.1.5.5.7.48.1"}),new I({uri:W.ocsp})]});else if(W.caissuer!==void 0)O=new E({array:[new L({oid:"1.3.6.1.5.5.7.48.2"}),new I({uri:W.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(W));u.push(O)}this.asn1ExtnValue=new E({array:u})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",a!==void 0&&a.array!==void 0&&this.setAccessDescriptionArray(a.array)},je(R.asn1.x509.AuthorityInfoAccess,R.asn1.x509.Extension),R.asn1.x509.SubjectAltName=function(a){R.asn1.x509.SubjectAltName.superclass.constructor.call(this,a),this.setNameArray=function(d){this.asn1ExtnValue=new R.asn1.x509.GeneralNames(d)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",a!==void 0&&a.array!==void 0&&this.setNameArray(a.array)},je(R.asn1.x509.SubjectAltName,R.asn1.x509.Extension),R.asn1.x509.IssuerAltName=function(a){R.asn1.x509.IssuerAltName.superclass.constructor.call(this,a),this.setNameArray=function(d){this.asn1ExtnValue=new R.asn1.x509.GeneralNames(d)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",a!==void 0&&a.array!==void 0&&this.setNameArray(a.array)},je(R.asn1.x509.IssuerAltName,R.asn1.x509.Extension),R.asn1.x509.SubjectDirectoryAttributes=function(a){R.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,a);var d=R.asn1,u=d.DERSequence,_=d.ASN1Util.newObject,T=d.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var E=[],L=0;L<this.params.array.length;L++){var I=this.params.array[L];if(I.attr!=null&&I.array!=null){var V={seq:[{oid:I.attr},{set:I.array}]};E.push(_(V));continue}var O={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(I.attr=="dateOfBirth")O.seq[0].oid=T(I.attr),O.seq[1].set[0]={gentime:I.str};else if(I.attr=="placeOfBirth")O.seq[0].oid=T(I.attr),O.seq[1].set[0]={utf8str:I.str};else if(I.attr=="gender")O.seq[0].oid=T(I.attr),O.seq[1].set[0]={prnstr:I.str};else if(I.attr=="countryOfCitizenship")O.seq[0].oid=T(I.attr),O.seq[1].set[0]={prnstr:I.str};else if(I.attr=="countryOfResidence")O.seq[0].oid=T(I.attr),O.seq[1].set[0]={prnstr:I.str};else throw new Error("unsupported attribute: "+I.attr);E.push(new _(O))}var W=new u({array:E});return this.asn1ExtnValue=W,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",a!==void 0&&(this.params=a)},je(R.asn1.x509.SubjectDirectoryAttributes,R.asn1.x509.Extension),R.asn1.x509.PrivateExtension=function(a){R.asn1.x509.PrivateExtension.superclass.constructor.call(this,a);var d=R,u=d.lang.String.isHex,_=d.asn1,T=_.x509.OID.name2oid,E=_.ASN1Util.newObject;this.params=null,this.setByParam=function(L){this.oid=T(L.extname),this.params=L},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var L=this.params.extn;if(typeof L=="string"&&u(L))return L;if(typeof L=="object")try{return E(L).tohex()}catch{}throw new Error("unsupported extn value")},a!=null&&this.setByParam(a)},je(R.asn1.x509.PrivateExtension,R.asn1.x509.Extension),R.asn1.x509.CRL=function(a){R.asn1.x509.CRL.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERSequence,T=u.DERBitString,E=u.x509,L=E.AlgorithmIdentifier,I=E.TBSCertList;this.params=void 0,this.setByParam=function(V){this.params=V},this.sign=function(){var V=new I(this.params).tohex(),O=new R.crypto.Signature({alg:this.params.sigalg});O.init(this.params.cakey),O.updateHex(V);var W=O.sign();this.params.sighex=W},this.getPEM=function(){return fn(this.tohex(),"X509 CRL")},this.tohex=function(){var V=this.params;if(V.tbsobj==null&&(V.tbsobj=new I(V)),V.sighex==null&&V.cakey!=null&&this.sign(),V.sighex==null)throw new Error("sighex or cakey parameter not defined");var O=[];O.push(V.tbsobj),O.push(new L({name:V.sigalg})),O.push(new T({hex:"00"+V.sighex}));var W=new _({array:O});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&(this.params=a)},je(R.asn1.x509.CRL,R.asn1.ASN1Object),R.asn1.x509.TBSCertList=function(a){R.asn1.x509.TBSCertList.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERInteger,T=u.DERSequence,E=u.DERTaggedObject;u.DERObjectIdentifier;var L=u.x509,I=L.AlgorithmIdentifier,V=L.Time,O=L.Extensions,W=L.X500Name;this.params=null,this.setByParam=function(z){this.params=z},this.getRevCertSequence=function(){for(var z=[],D=this.params.revcert,U=0;U<D.length;U++){var k=[new _(D[U].sn),new V(D[U].date)];D[U].ext!=null&&k.push(new O(D[U].ext)),z.push(new T({array:k}))}return new T({array:z})},this.tohex=function(){var z=[],D=this.params;if(D.version!=null){var U=D.version-1,k=new _({int:U});z.push(k)}if(z.push(new I({name:D.sigalg})),z.push(new W(D.issuer)),z.push(new V(D.thisupdate)),D.nextupdate!=null&&z.push(new V(D.nextupdate)),D.revcert!=null&&z.push(this.getRevCertSequence()),D.ext!=null){var H=new O(D.ext);z.push(new E({tag:"a0",explicit:!0,obj:H}))}var G=new T({array:z});return G.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.TBSCertList,R.asn1.ASN1Object),R.asn1.x509.CRLEntry=function(a){R.asn1.x509.CRLEntry.superclass.constructor.call(this);var d=R,u=d.asn1;this.setCertSerial=function(_){this.sn=new u.DERInteger(_)},this.setRevocationDate=function(_){this.time=new u.x509.Time(_)},this.tohex=function(){var _=new u.DERSequence({array:[this.sn,this.time]});return this.TLV=_.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.time!==void 0&&this.setRevocationDate(a.time),a.sn!==void 0&&this.setCertSerial(a.sn))},je(R.asn1.x509.CRLEntry,R.asn1.ASN1Object),R.asn1.x509.CRLNumber=function(a){R.asn1.x509.CRLNumber.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new R.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",a!=null&&(this.params=a)},je(R.asn1.x509.CRLNumber,R.asn1.x509.Extension),R.asn1.x509.CRLReason=function(a){R.asn1.x509.CRLReason.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new R.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",a!=null&&(this.params=a)},je(R.asn1.x509.CRLReason,R.asn1.x509.Extension),R.asn1.x509.OCSPNonce=function(a){R.asn1.x509.OCSPNonce.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new R.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",a!=null&&(this.params=a)},je(R.asn1.x509.OCSPNonce,R.asn1.x509.Extension),R.asn1.x509.OCSPNoCheck=function(a){R.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,a),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new R.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",a!=null&&(this.params=a)},je(R.asn1.x509.OCSPNoCheck,R.asn1.x509.Extension),R.asn1.x509.AdobeTimeStamp=function(a){R.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,a);var d=R,u=d.asn1,_=u.DERInteger,T=u.DERBoolean,E=u.DERSequence,L=u.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var I=this.params,V=[new _(1)];return V.push(new L({uri:I.uri})),I.reqauth!=null&&V.push(new T(I.reqauth)),this.asn1ExtnValue=new E({array:V}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",a!==void 0&&this.setByParam(a)},je(R.asn1.x509.AdobeTimeStamp,R.asn1.x509.Extension),R.asn1.x509.X500Name=function(a){R.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var d=R,u=d.asn1,_=u.x509,T=_.RDN;this.setByString=function(E,L){L!==void 0&&(this.sRule=L);var I=E.split("/");I.shift();for(var V=[],O=0;O<I.length;O++)if(I[O].match(/^[^=]+=.+$/))V.push(I[O]);else{var W=V.length-1;V[W]=V[W]+"/"+I[O]}for(var O=0;O<V.length;O++)this.asn1Array.push(new T({str:V[O],rule:this.sRule}))},this.setByLdapString=function(E,L){L!==void 0&&(this.sRule=L);var I=_.X500Name.ldapToCompat(E);this.setByString(I,L)},this.setByObject=function(E,L){L!==void 0&&(this.sRule=L);for(var I in E)if(E.hasOwnProperty(I)){var V=new T({str:I+"="+E[I],rule:this.sRule});this.asn1Array?this.asn1Array.push(V):this.asn1Array=[V]}},this.setByParam=function(E){if(E.rule!==void 0&&(this.sRule=E.rule),E.array!==void 0)this.paramArray=E.array;else if(E.str!==void 0)this.setByString(E.str);else if(E.ldapstr!==void 0)this.setByLdapString(E.ldapstr);else if(E.hex!==void 0)this.hTLV=E.hex;else if(E.certissuer!==void 0){var L=new jt;L.readCertPEM(E.certissuer),this.hTLV=L.getIssuerHex()}else if(E.certsubject!==void 0){var L=new jt;L.readCertPEM(E.certsubject),this.hTLV=L.getSubjectHex()}else typeof E=="object"&&E.certsubject===void 0&&E.certissuer===void 0&&this.setByObject(E)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var E=0;E<this.paramArray.length;E++){var L={array:this.paramArray[E]};this.sRule!="utf8"&&(L.rule=this.sRule);var I=new T(L);this.asn1Array.push(I)}var V=new u.DERSequence({array:this.asn1Array});return this.hTLV=V.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.X500Name,R.asn1.ASN1Object),R.asn1.x509.X500Name.compatToLDAP=function(a){if(a.substr(0,1)!=="/")throw"malformed input";a=a.substr(1);var d=a.split("/");return d.reverse(),d=d.map(function(u){return u.replace(/,/,"\\,")}),d.join(",")},R.asn1.x509.X500Name.onelineToLDAP=function(a){return R.asn1.x509.X500Name.compatToLDAP(a)},R.asn1.x509.X500Name.ldapToCompat=function(a){for(var d=a.split(","),u=!1,_=[],T=0;d.length>0;T++){var E=d.shift();if(u===!0){var L=_.pop(),I=(L+","+E).replace(/\\,/g,",");_.push(I),u=!1}else _.push(E);E.substr(-1,1)==="\\"&&(u=!0)}return _=_.map(function(V){return V.replace("/","\\/")}),_.reverse(),"/"+_.join("/")},R.asn1.x509.X500Name.ldapToOneline=function(a){return R.asn1.x509.X500Name.ldapToCompat(a)},R.asn1.x509.RDN=function(a){R.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var d=R.asn1.x509.AttributeTypeAndValue;this.setByParam=function(u){u.rule!==void 0&&(this.sRule=u.rule),u.str!==void 0&&this.addByMultiValuedString(u.str),u.array!==void 0&&(this.paramArray=u.array)},this.addByString=function(u){this.asn1Array.push(new R.asn1.x509.AttributeTypeAndValue({str:u,rule:this.sRule}))},this.addByMultiValuedString=function(u){for(var _=R.asn1.x509.RDN.parseString(u),T=0;T<_.length;T++)this.addByString(_[T])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var u=0;u<this.paramArray.length;u++){var _=this.paramArray[u];_.rule!==void 0&&this.sRule!="utf8"&&(_.rule=this.sRule);var T=new d(_);this.asn1Array.push(T)}var E=new R.asn1.DERSet({array:this.asn1Array});return this.TLV=E.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.RDN,R.asn1.ASN1Object),R.asn1.x509.RDN.parseString=function(a){for(var d=a.split(/\+/),u=!1,_=[],T=0;d.length>0;T++){var E=d.shift();if(u===!0){var L=_.pop(),I=(L+"+"+E).replace(/\\\+/g,"+");_.push(I),u=!1}else _.push(E);E.substr(-1,1)==="\\"&&(u=!0)}for(var V=!1,O=[],T=0;_.length>0;T++){var E=_.shift();if(V===!0){var W=O.pop();if(E.match(/"$/)){var I=(W+"+"+E).replace(/^([^=]+)="(.*)"$/,"$1=$2");O.push(I),V=!1}else O.push(W+"+"+E)}else O.push(E);E.match(/^[^=]+="/)&&(V=!0)}return O},R.asn1.x509.AttributeTypeAndValue=function(a){R.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var d=R,u=d.asn1,_=u.DERSequence,T=u.DERUTF8String,E=u.DERPrintableString,L=u.DERTeletexString,I=u.DERIA5String,V=u.DERVisibleString,O=u.DERBMPString,W=d.lang.String.isMail,z=d.lang.String.isPrintable;this.setByParam=function(D){if(D.rule!==void 0&&(this.sRule=D.rule),D.ds!==void 0&&(this.dsType=D.ds),D.value===void 0&&D.str!==void 0){var U=D.str,k=U.match(/^([^=]+)=(.+)$/);if(k)this.sType=k[1],this.sValue=k[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=D.type,this.sValue=D.value},this.setByString=function(D,U){U!==void 0&&(this.sRule=U);var k=D.match(/^([^=]+)=(.+)$/);if(k)this.setByAttrTypeAndValueStr(k[1],k[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var D=this.sType,U=this.sValue,k=this.sRule;return k==="prn"?D=="CN"&&W(U)?"ia5":z(U)?"prn":"utf8":k==="utf8"?D=="CN"&&W(U)?"ia5":D=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(D,U,k){k!==void 0&&(this.sRule=k),this.sType=D,this.sValue=U},this.getValueObj=function(D,U){if(D=="utf8")return new T({str:U});if(D=="prn")return new E({str:U});if(D=="tel")return new L({str:U});if(D=="ia5")return new I({str:U});if(D=="vis")return new V({str:U});if(D=="bmp")return new O({str:U});throw new Error("unsupported directory string type: type="+D+" value="+U)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var D=R.asn1.x509.OID.atype2obj(this.sType),U=this.getValueObj(this.dsType,this.sValue),k=new _({array:[D,U]});return this.TLV=k.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.AttributeTypeAndValue,R.asn1.ASN1Object),R.asn1.x509.SubjectPublicKeyInfo=function(a){R.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERInteger,T=u.DERBitString,E=u.DERObjectIdentifier,L=u.DERSequence,I=u.ASN1Util.newObject,V=u.x509,O=V.AlgorithmIdentifier,W=d.crypto;W.ECDSA,W.DSA,this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var z=new L({array:[this.asn1AlgId,this.asn1SubjPKey]});return z},this.tohex=function(){var z=this.getASN1Object();return this.hTLV=z.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(z){try{if(z instanceof Gt){var D=I({seq:[{int:{bigint:z.n}},{int:{int:z.e}}]}),U=D.tohex();this.asn1AlgId=new O({name:"rsaEncryption"}),this.asn1SubjPKey=new T({hex:"00"+U})}}catch{}try{if(z instanceof R.crypto.ECDSA){var k=new E({name:z.curveName});this.asn1AlgId=new O({name:"ecPublicKey",asn1params:k}),this.asn1SubjPKey=new T({hex:"00"+z.pubKeyHex})}}catch{}try{if(z instanceof R.crypto.DSA){var k=new I({seq:[{int:{bigint:z.p}},{int:{bigint:z.q}},{int:{bigint:z.g}}]});this.asn1AlgId=new O({name:"dsa",asn1params:k});var H=new _({bigint:z.y});this.asn1SubjPKey=new T({hex:"00"+H.tohex()})}}catch{}},a!==void 0&&this.setPubKey(a)},je(R.asn1.x509.SubjectPublicKeyInfo,R.asn1.ASN1Object),R.asn1.x509.Time=function(a){R.asn1.x509.Time.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERUTCTime,T=u.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(E){this.timeParams=E},this.setByParam=function(E){this.params=E},this.getType=function(E){return E.match(/^[0-9]{12}Z$/)?"utc":E.match(/^[0-9]{14}Z$/)?"gen":E.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":E.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var E=this.params,L=null;if(typeof E=="string"&&(E={str:E}),E!=null&&E.str&&(E.type==null||E.type==null)&&(E.type=this.getType(E.str)),E!=null&&E.str?(E.type=="utc"&&(L=new _(E.str)),E.type=="gen"&&(L=new T(E.str))):this.type=="gen"?L=new T:L=new _,L==null)throw new Error("wrong setting for Time");return this.TLV=L.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},R.asn1.x509.Time_bak=function(a){R.asn1.x509.Time_bak.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERUTCTime,T=u.DERGeneralizedTime;this.setTimeParams=function(E){this.timeParams=E},this.tohex=function(){var E=null;return this.timeParams!=null?this.type=="utc"?E=new _(this.timeParams):E=new T(this.timeParams):this.type=="utc"?E=new _:E=new T,this.TLV=E.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",a!==void 0&&(a.type!==void 0?this.type=a.type:a.str!==void 0&&(a.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),a.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=a)},je(R.asn1.x509.Time,R.asn1.ASN1Object),R.asn1.x509.AlgorithmIdentifier=function(a){R.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var d=R,u=d.asn1,_=u.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var E=null;for(var L in _)L===this.nameAlg&&(E=_[L]);if(E!==null)return this.hTLV=E,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=u.x509.OID.name2obj(this.nameAlg));var I=[this.asn1Alg];this.asn1Params!==null&&I.push(this.asn1Params);var V=new u.DERSequence({array:I});return this.hTLV=V.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&(a.name!==void 0&&(this.nameAlg=a.name),a.asn1params!==void 0&&(this.asn1Params=a.asn1params),a.paramempty!==void 0&&(this.paramEmpty=a.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var T=this.nameAlg.toLowerCase();T.substr(-7,7)!=="withdsa"&&T.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new u.DERNull)}},je(R.asn1.x509.AlgorithmIdentifier,R.asn1.ASN1Object),R.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},R.asn1.x509.GeneralName=function(a){R.asn1.x509.GeneralName.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.x509,T=_.X500Name,E=_.OtherName,L=u.DERIA5String;u.DERPrintableString;var I=u.DEROctetString,V=u.DERTaggedObject,O=u.ASN1Object,W=Error;this.params=null,this.setByParam=function(z){this.params=z},this.tohex=function(){var z=this.params,D,k,U,k=!1;if(z.other!==void 0)D="a0",U=new E(z.other);else if(z.rfc822!==void 0)D="81",U=new L({str:z.rfc822});else if(z.dns!==void 0)D="82",U=new L({str:z.dns});else if(z.dn!==void 0)D="a4",k=!0,typeof z.dn=="string"?U=new T({str:z.dn}):z.dn instanceof R.asn1.x509.X500Name?U=z.dn:U=new T(z.dn);else if(z.ldapdn!==void 0)D="a4",k=!0,U=new T({ldapstr:z.ldapdn});else if(z.certissuer!==void 0||z.certsubj!==void 0){D="a4",k=!0;var H,G,$=null;if(z.certsubj!==void 0?(H=!1,G=z.certsubj):(H=!0,G=z.certissuer),G.match(/^[0-9A-Fa-f]+$/),G.indexOf("-----BEGIN ")!=-1&&($=Bi(G)),$==null)throw new Error("certsubj/certissuer not cert");var se=new jt;se.hex=$;var me;H?me=se.getIssuerHex():me=se.getSubjectHex(),U=new O,U.hTLV=me}else if(z.uri!==void 0)D="86",U=new L({str:z.uri});else if(z.ip!==void 0){D="87";var fe,_e=z.ip;try{if(_e.match(/^[0-9a-f]+$/)){var Z=_e.length;if(Z==8||Z==16||Z==32||Z==64)fe=_e;else throw"err"}else fe=ad(_e)}catch(ee){throw new W("malformed IP address: "+z.ip+":"+ee.message)}U=new I({hex:fe})}else throw new W("improper params");var J=new V({tag:D,explicit:k,obj:U});return J.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.GeneralName,R.asn1.ASN1Object),R.asn1.x509.GeneralNames=function(a){R.asn1.x509.GeneralNames.superclass.constructor.call(this);var d=R,u=d.asn1;this.setByParamArray=function(_){for(var T=0;T<_.length;T++){var E=new u.x509.GeneralName(_[T]);this.asn1Array.push(E)}},this.tohex=function(){var _=new u.DERSequence({array:this.asn1Array});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof a<"u"&&this.setByParamArray(a)},je(R.asn1.x509.GeneralNames,R.asn1.ASN1Object),R.asn1.x509.OtherName=function(a){R.asn1.x509.OtherName.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DERObjectIdentifier,T=u.DERSequence,E=u.ASN1Util.newObject;this.params=null,this.setByParam=function(L){this.params=L},this.tohex=function(){var L=this.params;if(L.oid==null||L.value==null)throw new Error("oid or value not specified");var I=new _({oid:L.oid}),V=E({tag:{tag:"a0",explicit:!0,obj:L.value}}),O=new T({array:[I,V]});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.x509.OtherName,R.asn1.ASN1Object),R.asn1.x509.OID=new function(){var a=R.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(d){if(typeof this.objCache[d]<"u")return this.objCache[d];if(typeof this.name2oidList[d]>"u")throw"Name of ObjectIdentifier not defined: "+d;var u=this.name2oidList[d],_=new a({oid:u});return this.objCache[d]=_,_},this.atype2obj=function(d){if(this.objCache[d]!==void 0)return this.objCache[d];var u;if(d.match(/^\d+\.\d+\.[0-9.]+$/))u=d;else if(this.atype2oidList[d]!==void 0)u=this.atype2oidList[d];else if(this.name2oidList[d]!==void 0)u=this.name2oidList[d];else throw new Error("AttributeType name undefined: "+d);var _=new a({oid:u});return this.objCache[d]=_,_},this.registerOIDs=function(d){if(this.checkOIDs(d))for(var u in d)this.name2oidList[u]=d[u]},this.checkOIDs=function(d){try{var u=Object.keys(d);return u.length==0?!1:(u.map(function(_,T,E){var L=this[_];if(!L.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},d),!0)}catch{return!1}}},R.asn1.x509.OID.oid2name=function(a){var d=R.asn1.x509.OID.name2oidList;for(var u in d)if(d[u]==a)return u;return""},R.asn1.x509.OID.oid2atype=function(a){var d=R.asn1.x509.OID.atype2oidList;for(var u in d)if(d[u]==a)return u;return a},R.asn1.x509.OID.name2oid=function(a){if(a.match(/^[0-9.]+$/))return a;var d=R.asn1.x509.OID.name2oidList;return d[a]===void 0?"":d[a]},R.asn1.x509.X509Util={},R.asn1.x509.X509Util.newCertPEM=function(a){var d=R.asn1.x509;d.TBSCertificate;var u=d.Certificate,_=new u(a);return _.getPEM()},(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),(typeof R.asn1.cms>"u"||!R.asn1.cms)&&(R.asn1.cms={}),R.asn1.cms.Attribute=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.DERSet,L=_.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(I){this.params=I},this.getValueArray=function(){throw new d("not yet implemented abstract")},this.tohex=function(){var I=new L({oid:this.typeOid}),V=new E({array:this.getValueArray()}),O=new T({array:[I,V]});return O.tohex()},this.getEncodedHex=function(){return this.tohex()}},je(R.asn1.cms.Attribute,R.asn1.ASN1Object),R.asn1.cms.ContentType=function(a){var d=R,u=d.asn1;u.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var _=new u.DERObjectIdentifier(this.params.type);return[_]},a!=null&&this.setByParam(a)},je(R.asn1.cms.ContentType,R.asn1.cms.Attribute),R.asn1.cms.MessageDigest=function(a){var d=R,u=d.asn1,_=u.DEROctetString,T=u.cms;T.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var E=new _(this.params);return[E]},a!=null&&this.setByParam(a)},je(R.asn1.cms.MessageDigest,R.asn1.cms.Attribute),R.asn1.cms.SigningTime=function(a){var d=R,u=d.asn1;u.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var _=new u.x509.Time(this.params);return[_]},a!=null&&this.setByParam(a)},je(R.asn1.cms.SigningTime,R.asn1.cms.Attribute),R.asn1.cms.SigningCertificate=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.cms,L=E.ESSCertID;u.crypto,E.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new d("parameter 'array' not specified");for(var I=this.params.array,V=[],O=0;O<I.length;O++){var W=I[O];a.hasis==!1&&typeof W=="string"&&(W.indexOf("-----BEGIN")!=-1||Ze.isASN1HEX(W))&&(W={cert:W}),W.hasis!=!1&&a.hasis==!1&&(W.hasis=!1),V.push(new L(W))}var z=new T({array:V}),D=new T({array:[z]});return[D]},a!=null&&this.setByParam(a)},je(R.asn1.cms.SigningCertificate,R.asn1.cms.Attribute),R.asn1.cms.ESSCertID=function(a){R.asn1.cms.ESSCertID.superclass.constructor.call(this);var d=Error,u=R,_=u.asn1,T=_.DEROctetString,E=_.DERSequence,L=_.cms.IssuerSerial;this.params=null,this.getCertHash=function(I,V){if(I.hash!=null)return I.hash;if(typeof I=="string"&&I.indexOf("-----BEGIN")==-1&&!Ze.isASN1HEX(I))return I;var O;if(typeof I=="string")O=I;else if(I.cert!=null)O=I.cert;else throw new d("hash nor cert unspecified");var W;O.indexOf("-----BEGIN")!=-1?W=Bi(O):W=O,typeof I=="string"&&(I.indexOf("-----BEGIN")!=-1?W=Bi(I):Ze.isASN1HEX(I)&&(W=I));var z;if(I.alg!=null)z=I.alg;else if(V!=null)z=V;else throw new d("hash alg unspecified");return u.crypto.Util.hashHex(W,z)},this.tohex=function(){var I=this.params,V=this.getCertHash(I,"sha1"),O=[];O.push(new T({hex:V})),(typeof I=="string"&&I.indexOf("-----BEGIN")!=-1||I.cert!=null&&I.hasis!=!1||I.issuer!=null&&I.serial!=null)&&O.push(new L(I));var W=new E({array:O});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.ESSCertID,R.asn1.ASN1Object),R.asn1.cms.SigningCertificateV2=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence;_.x509;var E=_.cms,L=E.ESSCertIDv2;u.crypto,E.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new d("parameter 'array' not specified");for(var I=this.params.array,V=[],O=0;O<I.length;O++){var W=I[O];(a.alg!=null||a.hasis==!1)&&typeof W=="string"&&(W.indexOf("-----BEGIN")!=-1||Ze.isASN1HEX(W))&&(W={cert:W}),W.alg==null&&a.alg!=null&&(W.alg=a.alg),W.hasis!=!1&&a.hasis==!1&&(W.hasis=!1),V.push(new L(W))}var z=new T({array:V}),D=new T({array:[z]});return[D]},a!=null&&this.setByParam(a)},je(R.asn1.cms.SigningCertificateV2,R.asn1.cms.Attribute),R.asn1.cms.ESSCertIDv2=function(a){R.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.DEROctetString,T=u.DERSequence,E=u.cms.IssuerSerial,L=u.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var I=this.params,V=this.getCertHash(I,"sha256"),O=[];I.alg!=null&&I.alg!="sha256"&&O.push(new L({name:I.alg})),O.push(new _({hex:V})),(typeof I=="string"&&I.indexOf("-----BEGIN")!=-1||I.cert!=null&&I.hasis!=!1||I.issuer!=null&&I.serial!=null)&&O.push(new E(I));var W=new T({array:O});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.ESSCertIDv2,R.asn1.cms.ESSCertID),R.asn1.cms.IssuerSerial=function(a){var d=Error,u=R,_=u.asn1,T=_.DERInteger,E=_.DERSequence,L=_.cms,I=_.x509,V=I.GeneralNames,O=jt;L.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(W){this.params=W},this.tohex=function(){var W=this.params,z,D;if(typeof W=="string"&&W.indexOf("-----BEGIN")!=-1||W.cert!=null){var U;W.cert!=null?U=W.cert:U=W;var k=new O;k.readCertPEM(U),z=k.getIssuer(),D={hex:k.getSerialNumberHex()}}else if(W.issuer!=null&&W.serial)z=W.issuer,D=W.serial;else throw new d("cert or issuer and serial parameter not specified");var H=new V([{dn:z}]),G=new T(D),$=new E({array:[H,G]});return $.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.IssuerSerial,R.asn1.ASN1Object),R.asn1.cms.SignerIdentifier=function(a){var d=R,u=d.asn1;u.DERInteger,u.DERSequence;var _=u.cms,T=_.IssuerAndSerialNumber,E=_.SubjectKeyIdentifier,L=u.x509;L.X500Name,_.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params;if(I.type=="isssn"){var V=new T(I);return V.tohex()}else if(I.type=="skid"){var O=new E(I);return O.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.SignerIdentifier,R.asn1.ASN1Object),R.asn1.cms.IssuerAndSerialNumber=function(a){var d=R,u=d.asn1,_=u.DERInteger,T=u.DERSequence,E=u.cms,L=u.x509,I=L.X500Name,V=jt,O=Error;E.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var W=this.params,z,D;if(typeof W=="string"&&W.indexOf("-----BEGIN")!=-1||W.cert!=null){var U;W.cert!=null?U=W.cert:U=W;var k=new V;k.readCertPEM(U),z=k.getIssuer(),D={hex:k.getSerialNumberHex()}}else if(W.issuer!=null&&W.serial)z=W.issuer,D=W.serial;else throw new O("cert or issuer and serial parameter not specified");var H=new I(z),G=new _(D),$=new T({array:[H,G]});return $.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(W){this.params=W},a!=null&&this.setByParam(a)},je(R.asn1.cms.IssuerAndSerialNumber,R.asn1.ASN1Object),R.asn1.cms.SubjectKeyIdentifier=function(a){var d=R,u=d.asn1;u.DERInteger,u.DERSequence;var _=u.ASN1Util.newObject,T=u.cms;T.IssuerAndSerialName,T.SubjectKeyIdentifier;var E=u.x509;E.X500Name;var L=jt,I=Error;T.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var V=this.params;if(V.cert==null&&V.skid==null)throw new I("property cert nor skid undefined");var O;if(V.cert!=null){var W=new L(V.cert),z=W.getExtSubjectKeyIdentifier();O=z.kid.hex}else V.skid!=null&&(O=V.skid);var D=_({tag:{tage:"a0",obj:{octstr:{hex:O}}}});return D.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.SubjectKeyIdentifier,R.asn1.ASN1Object),R.asn1.cms.AttributeList=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSet,E=_.cms;E.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(L){this.params=L},this.tohex=function(){var L=this.params;if(this.hTLV!=null)return this.hTLV;var I=!0;L.sortflag!=null&&(I=L.sortflag);for(var V=L.array,O=[],W=0;W<V.length;W++){var z=V[W],D=z.attr;if(D=="contentType")O.push(new E.ContentType(z));else if(D=="messageDigest")O.push(new E.MessageDigest(z));else if(D=="signingTime")O.push(new E.SigningTime(z));else if(D=="signingCertificate")O.push(new E.SigningCertificate(z));else if(D=="signingCertificateV2")O.push(new E.SigningCertificateV2(z));else if(D=="signaturePolicyIdentifier")O.push(new R.asn1.cades.SignaturePolicyIdentifier(z));else if(D=="signatureTimeStamp"||D=="timeStampToken")O.push(new R.asn1.cades.SignatureTimeStamp(z));else throw new d("unknown attr: "+D)}var U=new T({array:O,sortflag:I});return this.hTLV=U.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.AttributeList,R.asn1.ASN1Object),R.asn1.cms.SignerInfo=function(a){var d=Error,u=R,_=u.asn1,T=_.DERInteger,E=_.DEROctetString,L=_.DERSequence,I=_.DERTaggedObject,V=_.cms,O=V.SignerIdentifier,W=V.AttributeList;V.ContentType,V.EncapsulatedContentInfo,V.MessageDigest,V.SignedData;var z=_.x509,D=z.AlgorithmIdentifier,U=u.crypto,k=ai;V.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var H=this.params,G=H.sigalg,$=new W(H.sattrs).tohex(),se=k.getKey(H.signkey),me=new U.Signature({alg:G});me.init(se),me.updateHex($);var fe=me.sign();H.sighex=fe},this.tohex=function(){var H=this.params,G=[];if(G.push(new T({int:H.version})),G.push(new O(H.id)),G.push(new D({name:H.hashalg})),H.sattrs!=null){var $=new W(H.sattrs);try{G.push(new I({tag:"a0",explicit:!1,obj:$}))}catch(me){throw new d("si sattr error: "+me)}}if(H.sigalgfield!=null?G.push(new D({name:H.sigalgfield})):G.push(new D({name:H.sigalg})),H.sighex==null&&H.signkey!=null&&this.sign(),G.push(new E({hex:H.sighex})),H.uattrs!=null){var $=new W(H.uattrs);try{G.push(new I({tag:"a1",explicit:!1,obj:$}))}catch(fe){throw new d("si uattr error: "+fe)}}var se=new L({array:G});return se.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.SignerInfo,R.asn1.ASN1Object),R.asn1.cms.EncapsulatedContentInfo=function(a){var d=R,u=d.asn1,_=u.DERTaggedObject,T=u.DERSequence,E=u.DERObjectIdentifier,L=u.DEROctetString,I=u.cms;I.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var V=this.params,O=[];if(O.push(new E(V.type)),V.content!=null&&(V.content.hex!=null||V.content.str!=null)&&V.isDetached!=!0){var W=new L(V.content),z=new _({tag:"a0",explicit:!0,obj:W});O.push(z)}var D=new T({array:O});return D.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(V){this.params=V},a!=null&&this.setByParam(a)},je(R.asn1.cms.EncapsulatedContentInfo,R.asn1.ASN1Object),R.asn1.cms.ContentInfo=function(a){var d=R,u=d.asn1,_=u.DERTaggedObject,T=u.DERSequence,E=u.DERObjectIdentifier,L=u.x509;L.OID.name2obj,R.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params,V=[];V.push(new E(I.type));var O=new _({tag:"a0",explicit:!0,obj:I.obj});V.push(O);var W=new T({array:V});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(I){this.params=I},a!=null&&this.setByParam(a)},je(R.asn1.cms.ContentInfo,R.asn1.ASN1Object),R.asn1.cms.SignedData=function(a){var d=R,u=d.asn1;u.ASN1Object;var _=u.DERInteger,T=u.DERSet,E=u.DERSequence;u.DERTaggedObject;var L=u.cms,I=L.EncapsulatedContentInfo,V=L.SignerInfo,O=L.ContentInfo,W=L.CertificateSet,z=L.RevocationInfoChoices,D=u.x509,U=D.AlgorithmIdentifier;R.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var k=this.params;this._setDigestAlgs(k),this._setContentTypeByEContent(k),this._setMessageDigestByEContent(k),this._setSignerInfoVersion(k),this._setSignedDataVersion(k)},this._setDigestAlgs=function(k){for(var H={},G=k.sinfos,$=0;$<G.length;$++){var se=G[$];H[se.hashalg]=1}k.hashalgs=Object.keys(H).sort()},this._setContentTypeByEContent=function(k){for(var H=k.econtent.type,G=k.sinfos,$=0;$<G.length;$++){var se=G[$],me=this._getAttrParamByName(se,"contentType");me.type=H}},this._setMessageDigestByEContent=function(k){var H=k.econtent;k.econtent.type;var G=H.content.hex;G==null&&H.type=="data"&&H.content.str!=null&&(G=Hr(H.content.str));for(var $=k.sinfos,se=0;se<$.length;se++){var me=$[se],fe=me.hashalg,_e=this._getAttrParamByName(me,"messageDigest"),Z=R.crypto.Util.hashHex(G,fe);_e.hex=Z}},this._getAttrParamByName=function(k,H){for(var G=k.sattrs.array,$=0;$<G.length;$++)if(G[$].attr==H)return G[$]},this._setSignerInfoVersion=function(k){for(var H=k.sinfos,G=0;G<H.length;G++){var $=H[G],se=1;$.id.type=="skid"&&(se=3),$.version=se}},this._setSignedDataVersion=function(k){var H=this._getSignedDataVersion(k);k.version=H},this._getSignedDataVersion=function(k){if(k.revinfos!=null)for(var H=k.revinfos,G=0;G<H.length;G++){var $=H[G];if($.ocsp!=null)return 5}for(var se=k.sinfos,G=0;G<se.length;G++){var me=k.sinfos[G];if(me.version==3)return 3}return k.econtent.type!="data"?3:1},this.tohex=function(){var k=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),k.fixed!=!0&&this.checkAndFixParam();var H=[];H.push(new _({int:k.version}));for(var G=[],$=0;$<k.hashalgs.length;$++){var se=k.hashalgs[$];G.push(new U({name:se}))}H.push(new T({array:G})),H.push(new I(k.econtent)),k.certs!=null&&H.push(new W(k.certs)),k.revinfos!=null&&H.push(new z(k.revinfos));for(var me=[],$=0;$<k.sinfos.length;$++){var fe=k.sinfos[$];me.push(new V(fe))}H.push(new T({array:me}));var _e=new E({array:H});return _e.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var k=new O({type:"signed-data",obj:this});return k},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.SignedData,R.asn1.ASN1Object),R.asn1.cms.CertificateSet=function(a){R.asn1.cms.CertificateSet.superclass.constructor.call(this);var d=Error,u=R.asn1,_=u.DERTaggedObject,T=u.DERSet,E=u.ASN1Object;this.params=null,this.tohex=function(){var L=this.params,I=[],V;if(L instanceof Array)V=L;else if(L.array!=null)V=L.array;else throw new d("cert array not specified");for(var O=0;O<V.length;O++){var W=V[O],z=Bi(W),D=new E;D.hTLV=z,I.push(D)}var U={array:I};L.sortflag==!1&&(U.sortflag=!1);var k=new T(U),H=new _({tag:"a0",explicit:!1,obj:k});return H.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.CertificateSet,R.asn1.ASN1Object),R.asn1.cms.RevocationInfoChoices=function(a){R.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params;if(!d instanceof Array)throw new Error("params is not array");for(var u=[],_=0;_<d.length;_++)u.push(new R.asn1.cms.RevocationInfoChoice(d[_]));var T=R.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:u}}});return T.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.RevocationInfoChoices,R.asn1.ASN1Object),R.asn1.cms.RevocationInfoChoice=function(a){R.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params;if(d.crl!=null&&typeof d.crl=="string"){var u=d.crl;return d.crl.indexOf("-----BEGIN")!=-1&&(u=Bi(d.crl)),u}else if(d.ocsp!=null){var _=R.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new R.asn1.cms.OtherRevocationFormat(d)}});return _.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.RevocationInfoChoice,R.asn1.ASN1Object),R.asn1.cms.OtherRevocationFormat=function(a){R.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var d=Error,u=R,_=u.asn1,T=_.ASN1Util.newObject,E=u.lang.String.isHex;this.params=null,this.tohex=function(){var L=this.params;if(L.ocsp==null)throw new d("property ocsp not specified");if(!E(L.ocsp)||!Ze.isASN1HEX(L.ocsp))throw new d("ocsp value not ASN.1 hex string");var I=T({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:L.ocsp}}]});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cms.OtherRevocationFormat,R.asn1.ASN1Object),R.asn1.cms.CMSUtil=new function(){},R.asn1.cms.CMSUtil.newSignedData=function(a){return new R.asn1.cms.SignedData(a)},R.asn1.cms.CMSUtil.verifySignedData=function(a){var d=R,u=d.asn1,_=u.cms;_.SignerInfo,_.SignedData,_.SigningTime,_.SigningCertificate,_.SigningCertificateV2;var T=u.cades;T.SignaturePolicyIdentifier;var E=d.lang.String.isHex,L=Ze,I=L.getVbyList,V=L.getTLVbyList,O=L.getIdxbyList,W=L.getChildIdx,z=L.getTLV,D=L.oidname,U=d.crypto.Util.hashHex;a.cms===void 0&&E(a.cms);var k=a.cms,H=function(ee,Y){for(var re,ve=3;ve<6;ve++)if(re=O(ee,0,[1,0,ve]),re!==void 0){var Se=ee.substr(re,2);Se==="a0"&&(Y.certsIdx=re),Se==="a1"&&(Y.revinfosIdx=re),Se==="31"&&(Y.signerinfosIdx=re)}},G=function(ee,Y){var re=Y.signerinfosIdx;if(re!==void 0){var ve=W(ee,re);Y.signerInfoIdxList=ve;for(var Se=0;Se<ve.length;Se++){var ze=ve[Se],be={idx:ze};$(ee,be),Y.signerInfos.push(be)}}},$=function(ee,Y){var re=Y.idx;Y.signerid_issuer1=V(ee,re,[1,0],"30"),Y.signerid_serial1=I(ee,re,[1,1],"02"),Y.hashalg=D(I(ee,re,[2,0],"06"));var ve=O(ee,re,[3],"a0");Y.idxSignedAttrs=ve,se(ee,Y,ve);var Se=W(ee,re),ze=Se.length;if(ze<6)throw"malformed SignerInfo";Y.sigalg=D(I(ee,re,[ze-2,0],"06")),Y.sigval=I(ee,re,[ze-1],"04")},se=function(ee,Y,re){var ve=W(ee,re);Y.signedAttrIdxList=ve;for(var Se=0;Se<ve.length;Se++){var ze=ve[Se],be=I(ee,ze,[0],"06"),Re;be==="2a864886f70d010905"?(Re=gi(I(ee,ze,[1,0])),Y.saSigningTime=Re):be==="2a864886f70d010904"&&(Re=I(ee,ze,[1,0],"04"),Y.saMessageDigest=Re)}},me=function(ee,Y){if(I(ee,0,[0],"06")!=="2a864886f70d010702")return Y;Y.cmsType="signedData",Y.econtent=I(ee,0,[1,0,2,1,0]),H(ee,Y),Y.signerInfos=[],G(ee,Y)},fe=function(ee,Y){for(var re=Y.parse.signerInfos,ve=re.length,Se=!0,ze=0;ze<ve;ze++){var be=re[ze];Z(ee,Y,be),be.isValid||(Se=!1)}Y.isValid=Se},_e=function(ee,Y,re,ve){var Se=Y.parse.certsIdx,ze;if(Y.certs===void 0){ze=[],Y.certkeys=[];for(var be=W(ee,Se),Re=0;Re<be.length;Re++){var Ge=z(ee,be[Re]),We=new jt;We.readCertHex(Ge),ze[Re]=We,Y.certkeys[Re]=We.getPublicKey()}Y.certs=ze}else ze=Y.certs;Y.cccc=ze.length,Y.cccci=be.length;for(var Re=0;Re<ze.length;Re++){var mn=We.getIssuerHex(),Fi=We.getSerialNumberHex();re.signerid_issuer1===mn&&re.signerid_serial1===Fi&&(re.certkey_idx=Re)}},Z=function(ee,Y,re,ve){re.verifyDetail={};var Se=re.verifyDetail,ze=Y.parse.econtent,be=re.hashalg,Re=re.saMessageDigest;Se.validMessageDigest=!1,U(ze,be)===Re&&(Se.validMessageDigest=!0),_e(ee,Y,re),Se.validSignatureValue=!1;var Ge=re.sigalg,We="31"+z(ee,re.idxSignedAttrs).substr(2);re.signedattrshex=We;var mn=Y.certs[re.certkey_idx].getPublicKey(),Fi=new R.crypto.Signature({alg:Ge});Fi.init(mn),Fi.updateHex(We);var Ti=Fi.verify(re.sigval);Se.validSignatureValue_isValid=Ti,Ti===!0&&(Se.validSignatureValue=!0),re.isValid=!1,Se.validMessageDigest&&Se.validSignatureValue&&(re.isValid=!0)},J={isValid:!1,parse:{}};return me(k,J.parse),fe(k,J),J},R.asn1.cms.CMSParser=function(){var a=Error,d=jt,u=new d,_=Ze,T=_.getV,E=_.getTLV;_.getIdxbyList;var L=_.getTLVbyList,I=_.getTLVbyListEx,V=_.getVbyList,O=_.getVbyListEx,W=_.getChildIdx;this.getCMSSignedData=function(z){var D=L(z,0,[1,0]),U=this.getSignedData(D);return U},this.getSignedData=function(z){var D=W(z,0),U={},k=T(z,D[0]),H=parseInt(k,16);U.version=H;var G=E(z,D[1]);U.hashalgs=this.getHashAlgArray(G);var $=E(z,D[2]);U.econtent=this.getEContent($);var se=I(z,0,["[0]"]);se!=null&&(U.certs=this.getCertificateSet(se)),I(z,0,["[1]"]);var me=I(z,0,[3]);return U.sinfos=this.getSignerInfos(me),U},this.getHashAlgArray=function(z){for(var D=W(z,0),U=new d,k=[],H=0;H<D.length;H++){var G=E(z,D[H]),$=U.getAlgorithmIdentifierName(G);k.push($)}return k},this.getEContent=function(z){var D={},U=V(z,0,[0]),k=V(z,0,[1,0]);return D.type=R.asn1.x509.OID.oid2name(Ze.hextooidstr(U)),D.content={hex:k},D},this.getSignerInfos=function(z){for(var D=[],U=W(z,0),k=0;k<U.length;k++){var H=E(z,U[k]),G=this.getSignerInfo(H);D.push(G)}return D},this.getSignerInfo=function(z){var D={},U=W(z,0),k=_.getInt(z,U[0],-1);k!=-1&&(D.version=k);var H=E(z,U[1]),G=this.getIssuerAndSerialNumber(H);D.id=G;var $=E(z,U[2]),se=u.getAlgorithmIdentifierName($);D.hashalg=se;var me=I(z,0,["[0]"]);if(me!=null){var fe=this.getAttributeList(me);D.sattrs=fe}var _e=I(z,0,[3]),Z=u.getAlgorithmIdentifierName(_e);D.sigalg=Z;var J=O(z,0,[4]);D.sighex=J;var ee=I(z,0,["[1]"]);if(ee!=null){var Y=this.getAttributeList(ee);D.uattrs=Y}return D},this.getSignerIdentifier=function(z){if(z.substr(0,2)=="30")return this.getIssuerAndSerialNumber(z);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(z){var D={type:"isssn"},U=W(z,0),k=E(z,U[0]);D.issuer=u.getX500Name(k);var H=T(z,U[1]);return D.serial={hex:H},D},this.getAttributeList=function(z){for(var D=[],U=W(z,0),k=0;k<U.length;k++){var H=E(z,U[k]),G=this.getAttribute(H);D.push(G)}return{array:D}},this.getAttribute=function(z){var D={},U=W(z,0),k=_.getOID(z,U[0]),H=R.asn1.x509.OID.oid2name(k);D.attr=H;var G=E(z,U[1]),$=W(G,0);if($.length==1)D.valhex=E(G,$[0]);else{for(var se=[],me=0;me<$.length;me++)se.push(E(G,$[me]));D.valhex=se}return H=="contentType"?this.setContentType(D):H=="messageDigest"?this.setMessageDigest(D):H=="signingTime"?this.setSigningTime(D):H=="signingCertificate"?this.setSigningCertificate(D):H=="signingCertificateV2"?this.setSigningCertificateV2(D):H=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(D),D},this.setContentType=function(z){var D=_.getOIDName(z.valhex,0,null);D!=null&&(z.type=D,delete z.valhex)},this.setSigningTime=function(z){var D=T(z.valhex,0),U=gi(D);z.str=U,delete z.valhex},this.setMessageDigest=function(z){var D=T(z.valhex,0);z.hex=D,delete z.valhex},this.setSigningCertificate=function(z){var D=W(z.valhex,0);if(D.length>0){for(var U=E(z.valhex,D[0]),k=W(U,0),H=[],G=0;G<k.length;G++){var $=E(U,k[G]),se=this.getESSCertID($);H.push(se)}z.array=H}if(D.length>1){var me=E(z.valhex,D[1]);z.polhex=me}delete z.valhex},this.setSignaturePolicyIdentifier=function(z){var D=W(z.valhex,0);if(D.length>0){var U=_.getOID(z.valhex,D[0]);z.oid=U}if(D.length>1){var k=new d,H=W(z.valhex,D[1]),G=E(z.valhex,H[0]),$=k.getAlgorithmIdentifierName(G);z.alg=$;var se=T(z.valhex,H[1]);z.hash=se}delete z.valhex},this.setSigningCertificateV2=function(z){var D=W(z.valhex,0);if(D.length>0){for(var U=E(z.valhex,D[0]),k=W(U,0),H=[],G=0;G<k.length;G++){var $=E(U,k[G]),se=this.getESSCertIDv2($);H.push(se)}z.array=H}if(D.length>1){var me=E(z.valhex,D[1]);z.polhex=me}delete z.valhex},this.getESSCertID=function(z){var D={},U=W(z,0);if(U.length>0){var k=T(z,U[0]);D.hash=k}if(U.length>1){var H=E(z,U[1]),G=this.getIssuerSerial(H);G.serial!=null&&(D.serial=G.serial),G.issuer!=null&&(D.issuer=G.issuer)}return D},this.getESSCertIDv2=function(z){var D={},U=W(z,0);if(U.length<1||3<U.length)throw new a("wrong number of elements");var k=0;if(z.substr(U[0],2)=="30"){var H=E(z,U[0]);D.alg=u.getAlgorithmIdentifierName(H),k++}else D.alg="sha256";var G=T(z,U[k]);if(D.hash=G,U.length>k+1){var $=E(z,U[k+1]),se=this.getIssuerSerial($);D.issuer=se.issuer,D.serial=se.serial}return D},this.getIssuerSerial=function(z){var D={},U=W(z,0),k=E(z,U[0]),H=u.getGeneralNames(k),G=H[0].dn;D.issuer=G;var $=T(z,U[1]);return D.serial={hex:$},D},this.getCertificateSet=function(z){for(var D=W(z,0),U=[],k=0;k<D.length;k++){var H=E(z,D[k]);if(H.substr(0,2)=="30"){var G=fn(H,"CERTIFICATE");U.push(G)}}return{array:U,sortflag:!1}}},(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),(typeof R.asn1.tsp>"u"||!R.asn1.tsp)&&(R.asn1.tsp={}),R.asn1.tsp.TimeStampToken=function(a){var d=R,u=d.asn1,_=u.tsp;_.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var T=new _.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=T.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.TimeStampToken,R.asn1.cms.SignedData),R.asn1.tsp.TSTInfo=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.DERInteger,E=u.DERBoolean,L=u.DERGeneralizedTime,I=u.DERObjectIdentifier,V=u.DERTaggedObject,O=u.tsp,W=O.MessageImprint,z=O.Accuracy;u.x509.X500Name;var D=u.x509.GeneralName;if(O.TSTInfo.superclass.constructor.call(this),this.dVersion=new T({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var U=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(U.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(U.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(U.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");U.push(this.dGenTime),this.dAccuracy!=null&&U.push(this.dAccuracy),this.dOrdering!=null&&U.push(this.dOrdering),this.dNonce!=null&&U.push(this.dNonce),this.dTsa!=null&&U.push(this.dTsa);var k=new _({array:U});return this.hTLV=k.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0){if(typeof a.policy=="string"){if(!a.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new I({oid:a.policy})}a.messageImprint!==void 0&&(this.dMessageImprint=new W(a.messageImprint)),a.serial!==void 0&&(this.dSerial=new T(a.serial)),a.genTime!==void 0&&(this.dGenTime=new L(a.genTime)),a.accuracy!==void 0&&(this.dAccuracy=new z(a.accuracy)),a.ordering!==void 0&&a.ordering==!0&&(this.dOrdering=new E),a.nonce!==void 0&&(this.dNonce=new T(a.nonce)),a.tsa!==void 0&&(this.dTsa=new V({tag:"a0",explicit:!0,obj:new D({dn:a.tsa})}))}},je(R.asn1.tsp.TSTInfo,R.asn1.ASN1Object),R.asn1.tsp.Accuracy=function(a){var d=R,u=d.asn1,_=u.ASN1Util.newObject;u.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var T=this.params,E=[];return T.seconds!=null&&typeof T.seconds=="number"&&E.push({int:T.seconds}),T.millis!=null&&typeof T.millis=="number"&&E.push({tag:{tagi:"80",obj:{int:T.millis}}}),T.micros!=null&&typeof T.micros=="number"&&E.push({tag:{tagi:"81",obj:{int:T.micros}}}),_({seq:E}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.Accuracy,R.asn1.ASN1Object),R.asn1.tsp.MessageImprint=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.DEROctetString,E=u.x509,L=E.AlgorithmIdentifier;u.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params,V=new L({name:I.alg}),O=new T({hex:I.hash}),W=new _({array:[V,O]});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.tsp.MessageImprint,R.asn1.ASN1Object),R.asn1.tsp.TimeStampReq=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.DERInteger,E=u.DERBoolean;u.ASN1Object;var L=u.DERObjectIdentifier,I=u.tsp,V=I.MessageImprint;I.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var O=this.params,W=[];W.push(new T({int:1})),O.messageImprint instanceof R.asn1.ASN1Object?W.push(O.messageImprint):W.push(new V(O.messageImprint)),O.policy!=null&&W.push(new L(O.policy)),O.nonce!=null&&W.push(new T(O.nonce)),O.certreq==!0&&W.push(new E);var z=new _({array:W});return z.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.TimeStampReq,R.asn1.ASN1Object),R.asn1.tsp.TimeStampResp=function(a){var d=R,u=d.asn1,_=u.DERSequence;u.ASN1Object;var T=u.tsp,E=T.PKIStatusInfo;T.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var L=this.params,I=[];if(L.econtent!=null||L.tst!=null)if(L.statusinfo!=null?I.push(new E(L.statusinfo)):I.push(new E("granted")),L.econtent!=null)I.push(new T.TimeStampToken(L).getContentInfo());else if(L.tst instanceof u.ASN1Object)I.push(L.tst);else throw new Error("improper member tst value");else if(L.statusinfo!=null)I.push(new E(L.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var V=new _({array:I});return V.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.TimeStampResp,R.asn1.ASN1Object),R.asn1.tsp.PKIStatusInfo=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.tsp,L=E.PKIStatus,I=E.PKIFreeText,V=E.PKIFailureInfo;E.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var O=this.params,W=[];if(typeof O=="string")W.push(new L(O));else{if(O.status==null)throw new d("property 'status' unspecified");W.push(new L(O.status)),O.statusstr!=null&&W.push(new I(O.statusstr)),O.failinfo!=null&&W.push(new V(O.failinfo))}var z=new T({array:W});return z.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.PKIStatusInfo,R.asn1.ASN1Object),R.asn1.tsp.PKIStatus=function(a){var d=Error,u=R,_=u.asn1,T=_.DERInteger,E=_.tsp;E.PKIStatus.superclass.constructor.call(this);var L={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var I=this.params,V;if(typeof I=="string")try{V=L[I]}catch{throw new d("undefined name: "+I)}else if(typeof I=="number")V=I;else throw new d("unsupported params");return new T({int:V}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.PKIStatus,R.asn1.ASN1Object),R.asn1.tsp.PKIFreeText=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.DERUTF8String,L=_.tsp;L.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params;if(!I instanceof Array)throw new d("wrong params: not array");for(var V=[],O=0;O<I.length;O++)V.push(new E({str:I[O]}));var W=new T({array:V});return W.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.PKIFreeText,R.asn1.ASN1Object),R.asn1.tsp.PKIFailureInfo=function(a){var d=Error,u=R,_=u.asn1,T=_.DERBitString,E=_.tsp,L=E.PKIFailureInfo,I={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};L.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var V=this.params,O=0;if(typeof V=="number"&&0<=V&&V<=25){O|=1<<V;for(var W=O.toString(2),z="",D=W.length-1;D>=0;D--)z+=W[D];return z}else{if(typeof V=="string"&&I[V]!=null)return bc([V],I);if(typeof V=="object"&&V.length!=null)return bc(V,I);throw new d("wrong params")}},this.tohex=function(){this.params;var V=this.getBinValue();return new T({bin:V}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.tsp.PKIFailureInfo,R.asn1.ASN1Object),R.asn1.tsp.AbstractTSAAdapter=function(a){this.getTSTHex=function(d,u){throw"not implemented yet"}},R.asn1.tsp.SimpleTSAAdapter=function(a){var d=R,u=d.asn1,_=u.tsp,T=d.crypto.Util.hashHex;_.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(E,L){var I=T(E,L);this.params.econtent.content.messageImprint={alg:L,hash:I},this.params.econtent.content.serial={int:this.serial++};var V=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:V};var O=new _.TimeStampToken(this.params);return O.getContentInfoEncodedHex()},a!==void 0&&(this.params=a)},je(R.asn1.tsp.SimpleTSAAdapter,R.asn1.tsp.AbstractTSAAdapter),R.asn1.tsp.FixedTSAAdapter=function(a){var d=R,u=d.asn1,_=u.tsp,T=d.crypto.Util.hashHex;_.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(E,L){var I=T(E,L);this.params.econtent.content.messageImprint={alg:L,hash:I};var V=new _.TimeStampToken(this.params);return V.getContentInfoEncodedHex()},a!==void 0&&(this.params=a)},je(R.asn1.tsp.FixedTSAAdapter,R.asn1.tsp.AbstractTSAAdapter),R.asn1.tsp.TSPUtil=new function(){},R.asn1.tsp.TSPUtil.newTimeStampToken=function(a){return new R.asn1.tsp.TimeStampToken(a)},R.asn1.tsp.TSPUtil.parseTimeStampReq=function(a){var d=new R.asn1.tsp.TSPParser;return d.getTimeStampReq(a)},R.asn1.tsp.TSPUtil.parseMessageImprint=function(a){var d=new R.asn1.tsp.TSPParser;return d.getMessageImprint(a)},R.asn1.tsp.TSPParser=function(){var a=jt,d=new a,u=Ze,_=u.getV,T=u.getTLV,E=u.getIdxbyList;u.getTLVbyListEx;var L=u.getChildIdx,I=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],V={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(O){var W=L(O,0);if(W.length==1)return this.getPKIStatusInfo(T(O,W[0]));if(W.length>1){var z=this.getPKIStatusInfo(T(O,W[0])),D=T(O,W[1]),U=this.getToken(D);return U.statusinfo=z,U}},this.getToken=function(O){var W=new R.asn1.cms.CMSParser,z=W.getCMSSignedData(O);return this.setTSTInfo(z),z},this.setTSTInfo=function(O){var W=O.econtent;if(W.type=="tstinfo"){var z=W.content.hex,D=this.getTSTInfo(z);W.content=D}},this.getTSTInfo=function(O){var W={},z=L(O,0),D=_(O,z[1]);W.policy=vc(D);var U=T(O,z[2]);W.messageImprint=this.getMessageImprint(U);var k=_(O,z[3]);W.serial={hex:k};var H=_(O,z[4]);W.genTime={str:gi(H)};var G=0;if(z.length>5&&O.substr(z[5],2)=="30"){var $=T(O,z[5]);W.accuracy=this.getAccuracy($),G++}if(z.length>5+G&&O.substr(z[5+G],2)=="01"){var se=_(O,z[5+G]);se=="ff"&&(W.ordering=!0),G++}if(z.length>5+G&&O.substr(z[5+G],2)=="02"){var me=_(O,z[5+G]);W.nonce={hex:me},G++}if(z.length>5+G&&O.substr(z[5+G],2)=="a0"){var fe=T(O,z[5+G]);fe="30"+fe.substr(2),pGeneralNames=d.getGeneralNames(fe);var _e=pGeneralNames[0].dn;W.tsa=_e,G++}if(z.length>5+G&&O.substr(z[5+G],2)=="a1"){var Z=T(O,z[5+G]);Z="30"+Z.substr(2);var J=d.getExtParamArray(Z);W.ext=J,G++}return W},this.getAccuracy=function(O){for(var W={},z=L(O,0),D=0;D<z.length;D++){var U=O.substr(z[D],2),k=_(O,z[D]),H=parseInt(k,16);U=="02"?W.seconds=H:U=="80"?W.millis=H:U=="81"&&(W.micros=H)}return W},this.getMessageImprint=function(O){if(O.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var W={};L(O,0);var z=E(O,0,[0,0]),D=_(O,z),U=u.hextooidstr(D),k=R.asn1.x509.OID.oid2name(U);if(k=="")throw new Error("hashAlg name undefined: "+U);var H=k,G=E(O,0,[1]);return W.alg=H,W.hash=_(O,G),W},this.getPKIStatusInfo=function(O){var W={},z=L(O,0),D=0;try{var U=_(O,z[0]),k=parseInt(U,16);W.status=I[k]}catch{}if(z.length>1&&O.substr(z[1],2)=="30"){var H=T(O,z[1]);W.statusstr=this.getPKIFreeText(H),D++}if(z.length>D&&O.substr(z[1+D],2)=="03"){var G=T(O,z[1+D]);W.failinfo=this.getPKIFailureInfo(G)}return W},this.getPKIFreeText=function(O){for(var W=[],z=L(O,0),D=0;D<z.length;D++)W.push(u.getString(O,z[D]));return W},this.getPKIFailureInfo=function(O){var W=u.getInt(O,0);return V[W]!=null?V[W]:W},this.getTimeStampReq=function(O){var W={};W.certreq=!1;var z=L(O,0);if(z.length<2)throw new Error("TimeStampReq must have at least 2 items");var D=T(O,z[1]);W.messageImprint=R.asn1.tsp.TSPUtil.parseMessageImprint(D);for(var U=2;U<z.length;U++){var k=z[U],H=O.substr(k,2);if(H=="06"){var G=_(O,k);W.policy=u.hextooidstr(G)}H=="02"&&(W.nonce=_(O,k)),H=="01"&&(W.certreq=!0)}return W}},(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),(typeof R.asn1.cades>"u"||!R.asn1.cades)&&(R.asn1.cades={}),R.asn1.cades.SignaturePolicyIdentifier=function(a){var d=R,u=d.asn1,_=u.cades,T=_.SignaturePolicyId;_.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new T(this.params)]},this.setByParam=function(E){this.params=E},a!=null&&this.setByParam(a)},je(R.asn1.cades.SignaturePolicyIdentifier,R.asn1.cms.Attribute),R.asn1.cades.SignaturePolicyId=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.DERObjectIdentifier,E=u.x509;E.AlgorithmIdentifier;var L=u.cades,I=L.SignaturePolicyId,V=L.OtherHashAlgAndValue;I.superclass.constructor.call(this),this.params=null,this.tohex=function(){var O=this.params,W=[];W.push(new T(O.oid)),W.push(new V(O));var z=new _({array:W});return z.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(O){this.params=O},a!=null&&this.setByParam(a)},je(R.asn1.cades.SignaturePolicyId,R.asn1.ASN1Object),R.asn1.cades.OtherHashAlgAndValue=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.DEROctetString,L=_.x509,I=L.AlgorithmIdentifier,V=_.cades,O=V.OtherHashAlgAndValue;O.superclass.constructor.call(this),this.params=null,this.tohex=function(){var W=this.params;if(W.alg==null)throw new d("property 'alg' not specified");if(W.hash==null&&W.cert==null)throw new d("property 'hash' nor 'cert' not specified");var z=null;if(W.hash!=null)z=W.hash;else if(W.cert!=null){if(typeof W.cert!="string")throw new d("cert not string");var D=W.cert;W.cert.indexOf("-----BEGIN")!=-1&&(D=Bi(W.cert)),z=R.crypto.Util.hashHex(D,W.alg)}var U=[];U.push(new I({name:W.alg})),U.push(new E({hex:z}));var k=new T({array:U});return k.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cades.OtherHashAlgAndValue,R.asn1.ASN1Object),R.asn1.cades.OtherHashValue=function(a){R.asn1.cades.OtherHashValue.superclass.constructor.call(this);var d=Error,u=R;u.lang.String.isHex;var _=u.asn1,T=_.DEROctetString;u.crypto.Util.hashHex,this.params=null,this.tohex=function(){var E=this.params;if(E.hash==null&&E.cert==null)throw new d("hash or cert not specified");var L=null;if(E.hash!=null)L=E.hash;else if(E.cert!=null){if(typeof E.cert!="string")throw new d("cert not string");var I=E.cert;E.cert.indexOf("-----BEGIN")!=-1&&(I=Bi(E.cert)),L=R.crypto.Util.hashHex(I,"sha1")}return new T({hex:L}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cades.OtherHashValue,R.asn1.ASN1Object),R.asn1.cades.SignatureTimeStamp=function(a){var d=Error,u=R,_=u.lang.String.isHex,T=u.asn1,E=T.ASN1Object;T.x509;var L=T.cades;L.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var I=this.params;if(I.tst!=null)if(_(I.tst)){var V=new E;return V.hTLV=I.tst,[V]}else{if(I.tst instanceof E)return[I.tst];throw new d("params.tst has wrong value")}else if(I.res!=null){var O=I.res;if(O instanceof E&&(O=O.tohex()),typeof O!="string"||!_(O))throw new d("params.res has wrong value");Ze.getTLVbyList(O,0,[1]);var V=new E;return V.hTLV=I.tst,[V]}},a!=null&&this.setByParam(a)},je(R.asn1.cades.SignatureTimeStamp,R.asn1.cms.Attribute),R.asn1.cades.CompleteCertificateRefs=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.cades,L=E.OtherCertID,I=u.lang.String.isHex;E.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var V=this.params,O=[],W=0;W<V.array.length;W++){var z=V.array[W];if(typeof z=="string")if(z.indexOf("-----BEGIN")!=-1)z={cert:z};else if(I(z))z={hash:z};else throw new d("unsupported value: "+z);V.alg!=null&&z.alg==null&&(z.alg=V.alg),V.hasis!=null&&z.hasis==null&&(z.hasis=V.hasis);var D=new L(z);O.push(D)}var U=new T({array:O});return[U]},a!=null&&this.setByParam(a)},je(R.asn1.cades.CompleteCertificateRefs,R.asn1.cms.Attribute),R.asn1.cades.OtherCertID=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.cms,E=T.IssuerSerial,L=u.cades,I=L.OtherHashValue,V=L.OtherHashAlgAndValue;L.OtherCertID.superclass.constructor.call(this),this.params=a,this.tohex=function(){var O=this.params;typeof O=="string"&&(O.indexOf("-----BEGIN")!=-1?O={cert:O}:_isHex(O)&&(O={hash:O}));var W=[],z=null;if(O.alg!=null?z=new V(O):z=new I(O),W.push(z),O.cert!=null&&O.hasis==!0||O.issuer!=null&&O.serial!=null){var D=new E(O);W.push(D)}var U=new _({array:W});return U.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cades.OtherCertID,R.asn1.ASN1Object),R.asn1.cades.OtherHash=function(a){var d=R,u=d.asn1;u.cms;var _=u.cades,T=_.OtherHashAlgAndValue,E=_.OtherHashValue;d.crypto.Util.hashHex;var L=d.lang.String.isHex;_.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var I=this.params;typeof I=="string"&&(I.indexOf("-----BEGIN")!=-1?I={cert:I}:L(I)&&(I={hash:I}));var V=null;return I.alg!=null?V=new T(I):V=new E(I),V.tohex()},this.getEncodedHex=function(){return this.tohex()},a!=null&&this.setByParam(a)},je(R.asn1.cades.OtherHash,R.asn1.ASN1Object),R.asn1.cades.CAdESUtil=new function(){},R.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(a){var d=new R.asn1.cms.CMSParser,u=d.getCMSSignedData(a);return u},R.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(a,d,u){var _=Ze,T=_.getChildIdx,E=_.getTLV,L=_.getV,I=R,V=I.asn1,O=V.ASN1Object,W=V.cms,z=W.AttributeList,D=W.SignerInfo,U={},k=T(a,d);if(k.length!=6)throw"not supported items for SignerInfo (!=6)";var H=k.shift();U.version=E(a,H);var G=k.shift();U.si=E(a,G);var $=k.shift();U.digalg=E(a,$);var se=k.shift();U.sattrs=E(a,se);var me=k.shift();U.sigalg=E(a,me);var fe=k.shift();U.sig=E(a,fe),U.sigval=L(a,fe);var _e=null;return U.obj=new D,_e=new O,_e.hTLV=U.version,U.obj.dCMSVersion=_e,_e=new O,_e.hTLV=U.si,U.obj.dSignerIdentifier=_e,_e=new O,_e.hTLV=U.digalg,U.obj.dDigestAlgorithm=_e,_e=new O,_e.hTLV=U.sattrs,U.obj.dSignedAttrs=_e,_e=new O,_e.hTLV=U.sigalg,U.obj.dSigAlg=_e,_e=new O,_e.hTLV=U.sig,U.obj.dSig=_e,U.obj.dUnsignedAttrs=new z,U},(typeof R.asn1.csr>"u"||!R.asn1.csr)&&(R.asn1.csr={}),R.asn1.csr.CertificationRequest=function(a){var d=R,u=d.asn1,_=u.DERBitString,T=u.DERSequence,E=u.csr;u.x509;var L=E.CertificationRequestInfo;E.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(I){this.params=I},this.sign=function(){var I=new L(this.params).tohex(),V=new R.crypto.Signature({alg:this.params.sigalg});V.init(this.params.sbjprvkey),V.updateHex(I);var O=V.sign();this.params.sighex=O},this.getPEM=function(){return fn(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var I=this.params,V=new R.asn1.csr.CertificationRequestInfo(this.params),O=new R.asn1.x509.AlgorithmIdentifier({name:I.sigalg});if(I.sighex==null&&I.sbjprvkey!=null&&this.sign(),I.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var W=new _({hex:"00"+I.sighex}),z=new T({array:[V,O,W]});return z.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.csr.CertificationRequest,R.asn1.ASN1Object),R.asn1.csr.CertificationRequestInfo=function(a){var d=R,u=d.asn1;u.DERBitString;var _=u.DERSequence,T=u.DERInteger,E=u.DERUTF8String,L=u.DERTaggedObject,I=u.ASN1Util.newObject,V=u.csr,O=u.x509,W=O.X500Name,z=O.Extensions,D=O.SubjectPublicKeyInfo;V.AttributeList,V.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(k){k!=null&&(this.params=k)},this.tohex=function(){var k=this.params,H=[];if(H.push(new T({int:0})),H.push(new W(k.subject)),H.push(new D(ai.getKey(k.sbjpubkey))),k.attrs!=null){var G=U(k.attrs),$=I({tag:{tage:"a0",obj:G}});H.push($)}else if(k.extreq!=null){var se=new z(k.extreq),$=I({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[se]}]}}});H.push($)}else H.push(new L({tag:"a0",explicit:!1,obj:new E({str:""})}));var me=new _({array:H});return me.tohex()},this.getEncodedHex=function(){return this.tohex()};function U(k){for(var H=Error,G=R.asn1.x509.Extensions,$=[],se=0;se<k.length;se++){var me=k[se],fe=me.attr;if(fe=="extensionRequest"){var _e=new G(me.ext),Z={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[_e]}]};$.push(Z)}else if(fe=="unstructuredName"){var Z={seq:[{oid:"1.2.840.113549.1.9.2"},{set:me.names}]};$.push(Z)}else if(fe=="challengePassword"){var Z={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:me.password}]}]};$.push(Z)}else throw new H("unknown CSR attribute")}return{set:$}}a!=null&&this.setByParam(a)},je(R.asn1.csr.CertificationRequestInfo,R.asn1.ASN1Object),R.asn1.csr.AttributeList=function(a){},je(R.asn1.csr.AttributeList,R.asn1.ASN1Object),R.asn1.csr.CSRUtil=new function(){},R.asn1.csr.CSRUtil.newCSRPEM=function(a){var d=R.asn1.csr,u=new d.CertificationRequest(a),_=u.getPEM();return _},R.asn1.csr.CSRUtil.getParam=function(a,d){var u=Ze,_=u.getV,T=u.getIdxbyList,E=u.getTLVbyList,L=u.getTLVbyListEx,I=u.getVbyListEx,V=function(se){var me=T(se,0,[0,3,0,0],"06");return _(se,me)!="2a864886f70d01090e"?null:E(se,0,[0,3,0,1,0],"30")},O={};if(a.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var W=Bi(a,"CERTIFICATE REQUEST");d&&(O.tbs=E(W,0,[0]));try{var z=L(W,0,[0,1]);if(z=="3000")O.subject={};else{var H=new jt;O.subject=H.getX500Name(z)}}catch{}var D=L(W,0,[0,2]),U=ai.getKey(D,null,"pkcs8pub");O.sbjpubkey=ai.getPEM(U,"PKCS8PUB");var k=V(W),H=new jt;k!=null&&(O.extreq=H.getExtParamArray(k));try{var G=L(W,0,[1],"30"),H=new jt;O.sigalg=H.getAlgorithmIdentifierName(G)}catch{}try{var $=I(W,0,[2]);O.sighex=$}catch{}return O},R.asn1.csr.CSRUtil.verifySignature=function(a){try{var d=null;if(typeof a=="string"&&a.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?d=R.asn1.csr.CSRUtil.getParam(a,!0):typeof a=="object"&&a.sbjpubkey!=null&&a.sigalg!=null&&a.sighex!=null&&a.tbs!=null&&(d=a),d==null)return!1;var u=new R.crypto.Signature({alg:d.sigalg});return u.init(d.sbjpubkey),u.updateHex(d.tbs),u.verify(d.sighex)}catch(_){return alert(_),!1}},(typeof R>"u"||!R)&&(R={}),(typeof R.asn1>"u"||!R.asn1)&&(R.asn1={}),(typeof R.asn1.ocsp>"u"||!R.asn1.ocsp)&&(R.asn1.ocsp={}),R.asn1.ocsp.DEFAULT_HASH="sha1",R.asn1.ocsp.OCSPResponse=function(a){R.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),R.asn1.DEREnumerated;var d=R.asn1.ASN1Util.newObject,u=R.asn1.ocsp.ResponseBytes,_=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var T=this.params.resstatus;return typeof T=="number"?T:typeof T!="string"?-1:_.indexOf(T)},this.setByParam=function(T){this.params=T},this.tohex=function(){var T=this.params,E=this._getStatusCode();if(E==-1)throw new Error("responseStatus not supported: "+T.resstatus);if(E!=0)return d({seq:[{enum:{int:E}}]}).tohex();var L=new u(T);return d({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:L}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.OCSPResponse,R.asn1.ASN1Object),R.asn1.ocsp.ResponseBytes=function(a){R.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var d=R.asn1,u=d.DERSequence,_=d.DERObjectIdentifier,T=d.DEROctetString,E=d.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(L){this.params=L},this.tohex=function(){var L=this.params;if(L.restype!="ocspBasic")throw new Error("not supported responseType: "+L.restype);var I=new E(L),V=[];V.push(new _({name:"ocspBasic"})),V.push(new T({hex:I.tohex()}));var O=new u({array:V});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.ResponseBytes,R.asn1.ASN1Object),R.asn1.ocsp.BasicOCSPResponse=function(a){R.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var d=Error,u=R.asn1,_=u.ASN1Object,T=u.DERSequence;u.DERGeneralizedTime;var E=u.DERTaggedObject,L=u.DERBitString;u.x509.Extensions;var I=u.x509.AlgorithmIdentifier,V=u.ocsp;V.ResponderID,_SingleResponseList=V.SingleResponseList,_ResponseData=V.ResponseData,this.params=null,this.setByParam=function(O){this.params=O},this.sign=function(){var O=this.params,W=O.tbsresp.tohex(),z=new R.crypto.Signature({alg:O.sigalg});z.init(O.reskey),z.updateHex(W),O.sighex=z.sign()},this.tohex=function(){var O=this.params;O.tbsresp==null&&(O.tbsresp=new _ResponseData(O)),O.sighex==null&&O.reskey!=null&&this.sign();var W=[];if(W.push(O.tbsresp),W.push(new I({name:O.sigalg})),W.push(new L({hex:"00"+O.sighex})),O.certs!=null&&O.certs.length!=null){for(var z=[],D=0;D<O.certs.length;D++){var U=O.certs[D],k=null;if(Ze.isASN1HEX(U))k=U;else if(U.match(/-----BEGIN/))k=Bi(U);else throw new d("certs["+D+"] not hex or PEM");z.push(new _({tlv:k}))}var H=new T({array:z});W.push(new E({tag:"a0",explicit:!0,obj:H}))}var G=new T({array:W});return G.tohex()},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.BasicOCSPResponse,R.asn1.ASN1Object),R.asn1.ocsp.ResponseData=function(a){R.asn1.ocsp.ResponseData.superclass.constructor.call(this);var d=R.asn1,u=d.DERSequence,_=d.DERGeneralizedTime,T=d.DERTaggedObject,E=d.x509.Extensions,L=d.ocsp,I=L.ResponderID;_SingleResponseList=L.SingleResponseList,this.params=null,this.tohex=function(){var V=this.params;V.respid!=null,V.prodat!=null,V.array!=null;var O=[];if(O.push(new I(V.respid)),O.push(new _(V.prodat)),O.push(new _SingleResponseList(V.array)),V.ext!=null){var W=new E(V.ext);O.push(new T({tag:"a1",explicit:!0,obj:W}))}var z=new u({array:O});return z.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(V){this.params=V},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.ResponseData,R.asn1.ASN1Object),R.asn1.ocsp.ResponderID=function(a){R.asn1.ocsp.ResponderID.superclass.constructor.call(this);var d=R,u=d.asn1,_=u.ASN1Util.newObject,T=u.x509.X500Name,E=d.lang.String.isHex,L=Error;this.params=null,this.tohex=function(){var I=this.params;if(I.key!=null){var V=null;if(typeof I.key=="string"){if(E(I.key)&&(V=I.key),I.key.match(/-----BEGIN CERTIFICATE/)){var O=new jt(I.key),W=O.getExtSubjectKeyIdentifier();W!=null&&(V=W.kid.hex)}}else if(I.key instanceof jt){var W=I.key.getExtSubjectKeyIdentifier();W!=null&&(V=W.kid.hex)}if(V==null)throw new L("wrong key member value");var z=_({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:V}}}});return z.tohex()}else if(I.name!=null){var D=null;if(typeof I.name=="string"&&I.name.match(/-----BEGIN CERTIFICATE/)){var O=new jt(I.name);D=O.getSubject()}else I.name instanceof jt?D=I.name.getSubject():typeof I.name=="object"&&(I.name.array!=null||I.name.str!=null)&&(D=I.name);if(D==null)throw new L("wrong name member value");var z=_({tag:{tag:"a1",explicit:!0,obj:new T(D)}});return z.tohex()}throw new L("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(I){this.params=I},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.ResponderID,R.asn1.ASN1Object),R.asn1.ocsp.SingleResponseList=function(a){R.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var d=R.asn1,u=d.DERSequence,_=d.ocsp.SingleResponse;this.params=null,this.tohex=function(){var T=this.params;if(typeof T!="object"||T.length==null)throw new Error("params not specified properly");for(var E=[],L=0;L<T.length;L++)E.push(new _(T[L]));var I=new u({array:E});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(T){this.params=T},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.SingleResponseList,R.asn1.ASN1Object),R.asn1.ocsp.SingleResponse=function(a){var d=Error,u=R,_=u.asn1,T=_.DERSequence,E=_.DERGeneralizedTime,L=_.DERTaggedObject,I=_.ocsp,V=I.CertID,O=I.CertStatus,W=_.x509,z=W.Extensions;I.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var D=this.params,U=[];if(D.certid==null)throw new d("certid unspecified");if(D.status==null)throw new d("status unspecified");if(D.thisupdate==null)throw new d("thisupdate unspecified");if(U.push(new V(D.certid)),U.push(new O(D.status)),U.push(new E(D.thisupdate)),D.nextupdate!=null){var k=new E(D.nextupdate);U.push(new L({tag:"a0",explicit:!0,obj:k}))}if(D.ext!=null){var H=new z(D.ext);U.push(new L({tag:"a1",explicit:!0,obj:H}))}var G=new T({array:U});return G.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(D){this.params=D},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.SingleResponse,R.asn1.ASN1Object),R.asn1.ocsp.CertID=function(a){var d=R,u=d.asn1,_=u.DEROctetString,T=u.DERInteger,E=u.DERSequence,L=u.x509,I=L.AlgorithmIdentifier,V=u.ocsp;V.DEFAULT_HASH;var O=d.crypto,W=O.Util.hashHex,z=jt,D=Ze,U=D.getVbyList;V.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(k,H,G,$){$==null&&($=this.DEFAULT_HASH),this.params={alg:$,issname:k,isskey:H,sbjsn:G}},this.setByCert=function(k,H,G){G==null&&(G=this.DEFAULT_HASH),this.params={alg:G,issuerCert:k,subjectCert:H}},this.getParamByCerts=function(k,H,G){G==null&&(G=this.DEFAULT_HASH);var $=new z(k),se=new z(H),me=W($.getSubjectHex(),G),fe=$.getPublicKeyHex(),_e=W(U(fe,0,[1],"03",!0),G),Z=se.getSerialNumberHex(),J={alg:G,issname:me,isskey:_e,sbjsn:Z};return J},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var k=this.params,H,G,$,se;if(k.alg==null?se=this.DEFAULT_HASH:se=k.alg,k.issuerCert!=null&&k.subjectCert!=null){var me=this.getParamByCerts(k.issuerCert,k.subjectCert,se);H=me.issname,G=me.isskey,$=me.sbjsn}else if(k.issname!=null&&k.isskey!=null&&k.sbjsn!=null)H=k.issname,G=k.isskey,$=k.sbjsn;else throw new Error("required param members not defined");var fe=new I({name:se}),_e=new _({hex:H}),Z=new _({hex:G}),J=new T({hex:$}),ee=new E({array:[fe,_e,Z,J]});return this.hTLV=ee.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.CertID,R.asn1.ASN1Object),R.asn1.ocsp.CertStatus=function(a){R.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var d=this.params;if(d.status=="good")return"8000";if(d.status=="unknown")return"8200";if(d.status=="revoked"){var u=[{gentime:{str:d.time}}];d.reason!=null&&u.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:d.reason}}}});var _={tag:"a1",explicit:!1,obj:{seq:u}};return R.asn1.ASN1Util.newObject({tag:_}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(d){this.params=d},a!==void 0&&this.setByParam(a)},je(R.asn1.ocsp.CertStatus,R.asn1.ASN1Object),R.asn1.ocsp.Request=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.ocsp;if(T.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var L=[];if(this.dReqCert===null)throw"reqCert not set";L.push(this.dReqCert);var I=new _({array:L});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof a<"u"){var E=new T.CertID(a);this.dReqCert=E}},je(R.asn1.ocsp.Request,R.asn1.ASN1Object),R.asn1.ocsp.TBSRequest=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.ocsp;T.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(E){for(var L=[],I=0;I<E.length;I++){var V=new T.Request(E[0]);L.push(V)}this.dRequestList=L},this.tohex=function(){var E=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var L=new _({array:this.dRequestList});if(E.push(L),this.dRequestExt!==null)throw"requestExtensions not supported";var I=new _({array:E});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&a.reqList!==void 0&&this.setRequestListByParam(a.reqList)},je(R.asn1.ocsp.TBSRequest,R.asn1.ASN1Object),R.asn1.ocsp.OCSPRequest=function(a){var d=R,u=d.asn1,_=u.DERSequence,T=u.ocsp;if(T.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var L=[];if(this.dTbsRequest!==null)L.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var I=new _({array:L});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},a!==void 0&&a.reqList!==void 0){var E=new T.TBSRequest(a);this.dTbsRequest=E}},je(R.asn1.ocsp.OCSPRequest,R.asn1.ASN1Object),R.asn1.ocsp.OCSPUtil={},R.asn1.ocsp.OCSPUtil.getRequestHex=function(a,d,u){var _=R,T=_.asn1,E=T.ocsp;u===void 0&&(u=E.DEFAULT_HASH);var L={alg:u,issuerCert:a,subjectCert:d},I=new E.OCSPRequest({reqList:[L]});return I.tohex()},R.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(a){var d=Ze,u=d.getVbyList,_=d.getVbyListEx,T=d.getIdxbyList;d.getIdxbyListEx;var E=d.getV,L={};try{var I=_(a,0,[0],"0a");L.responseStatus=parseInt(I,16)}catch{}if(L.responseStatus!==0)return L;try{var V=T(a,0,[1,0,1,0,0,2,0,1]);a.substr(V,2)==="80"?L.certStatus="good":a.substr(V,2)==="a1"?(L.certStatus="revoked",L.revocationTime=gi(u(a,V,[0]))):a.substr(V,2)==="82"&&(L.certStatus="unknown")}catch{}try{var O=T(a,0,[1,0,1,0,0,2,0,2]);L.thisUpdate=gi(E(a,O))}catch{}try{var W=T(a,0,[1,0,1,0,0,2,0,3]);a.substr(W,2)==="a0"&&(L.nextUpdate=gi(u(a,W,[0])))}catch{}return L},R.asn1.ocsp.OCSPParser=function(){var a=Error,d=jt,u=new d,_=Ze,T=_.getV,E=_.getTLV,L=_.getIdxbyList,I=_.getVbyList,V=_.getTLVbyList,O=_.getVbyListEx,W=_.getTLVbyListEx,z=_.getChildIdx;this.getOCSPRequest=function(D){var U=z(D,0);if(U.length!=1&&U.length!=2)throw new a("wrong number elements: "+U.length);var k=this.getTBSRequest(E(D,U[0]));return k},this.getTBSRequest=function(D){var U={},k=W(D,0,[0],"30");U.array=this.getRequestList(k);var H=W(D,0,["[2]",0],"30");return H!=null&&(U.ext=u.getExtParamArray(H)),U},this.getRequestList=function(D){for(var U=[],k=z(D,0),H=0;H<k.length;H++){var D=E(D,k[H]);U.push(this.getRequest(D))}return U},this.getRequest=function(D){var U=z(D,0);if(U.length!=1&&U.length!=2)throw new a("wrong number elements: "+U.length);var k=this.getCertID(E(D,U[0]));if(U.length==2){var H=L(D,0,[1,0]);k.ext=u.getExtParamArray(E(D,H))}return k},this.getCertID=function(D){var U=z(D,0);if(U.length!=4)throw new a("wrong number elements: "+U.length);var k=new d,H={};return H.alg=k.getAlgorithmIdentifierName(E(D,U[0])),H.issname=T(D,U[1]),H.isskey=T(D,U[2]),H.sbjsn=T(D,U[3]),H},this.getOCSPResponse=function(D){var U=z(D,0),k,H=T(D,U[0]),G=parseInt(H);if(U.length==1)return{resstatus:G};var $=V(D,0,[1,0]);return k=this.getResponseBytes($),k.resstatus=G,k},this.getResponseBytes=function(D){var U=z(D,0),k,H=V(D,0,[1,0]);k=this.getBasicOCSPResponse(H);var G=T(D,U[0]);return k.restype=R.asn1.x509.OID.oid2name(vc(G)),k},this.getBasicOCSPResponse=function(D){var U=z(D,0),k;k=this.getResponseData(E(D,U[0]));var H=new jt;k.alg=H.getAlgorithmIdentifierName(E(D,U[1]));var G=T(D,U[2]);k.sighex=G.substr(2);var $=O(D,0,["[0]"]);if($!=null){for(var se=z($,0),me=[],fe=0;fe<se.length;fe++){var _e=E($,se[fe]);me.push(_e)}k.certs=me}return k},this.getResponseData=function(D){var U=z(D,0),k=U.length,H={},G=0;D.substr(U[0],2)=="a0"&&G++,H.respid=this.getResponderID(E(D,U[G++]));var $=T(D,U[G++]);if(H.prodat=gi($),H.array=this.getSingleResponseList(E(D,U[G++])),D.substr(U[k-1],2)=="a1"){var se=V(D,U[k-1],[0]),me=new jt;H.ext=me.getExtParamArray(se)}return H},this.getResponderID=function(D){var U={};if(D.substr(0,2)=="a2"){var k=I(D,0,[0]);U.key=k}if(D.substr(0,2)=="a1"){var H=V(D,0,[0]),G=new jt;U.name=G.getX500Name(H)}return U},this.getSingleResponseList=function(D){for(var U=z(D,0),k=[],H=0;H<U.length;H++){var G=this.getSingleResponse(E(D,U[H]));k.push(G)}return k},this.getSingleResponse=function(D){var U=z(D,0),k={},H=this.getCertID(E(D,U[0]));k.certid=H;var G=this.getCertStatus(E(D,U[1]));if(k.status=G,D.substr(U[2],2)=="18"){var $=T(D,U[2]);k.thisupdate=gi($)}for(var se=3;se<U.length;se++){if(D.substr(U[se],2)=="a0"){var me=I(D,U[se],[0],"18");k.nextupdate=gi(me)}if(D.substr(U[se],2)=="a1"){var fe=new jt,_e=V(D,0,[se,0]);k.ext=fe.getExtParamArray(_e)}}return k},this.getCertStatus=function(D){var U={};if(D=="8000")return{status:"good"};if(D=="8200")return{status:"unknown"};if(D.substr(0,2)=="a1"){U.status="revoked";var k=I(D,0,[0]),H=gi(k);U.time=H}return U}};var R;(typeof R>"u"||!R)&&(R={}),(typeof R.lang>"u"||!R.lang)&&(R.lang={}),R.lang.String=function(){};function oh(a){for(var d=new Array,u=0;u<a.length;u++)d[u]=a.charCodeAt(u);return d}function ch(a){for(var d="",u=0;u<a.length;u++)d=d+String.fromCharCode(a[u]);return d}function dc(a){for(var d="",u=0;u<a.length;u++){var _=a[u].toString(16);_.length==1&&(_="0"+_),d=d+_}return d}function kn(a){return dc(oh(a))}function g_(a){return h(kn(a))}function v_(a){return ya(h(kn(a)))}function __(a){return ch(p(po(a)))}function ya(a){return a=a.replace(/\=/g,""),a=a.replace(/\+/g,"-"),a=a.replace(/\//g,"_"),a}function po(a){return a.length%4==2?a=a+"==":a.length%4==3&&(a=a+"="),a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/"),a}function Zi(a){return a.length%2==1&&(a="0"+a),ya(h(a))}function Ri(a){return l(po(a))}var fo,_r;typeof Buffer=="function"?(fo=function(a){return ya(Buffer.from(a,"utf8").toString("base64"))},_r=function(a){return Buffer.from(po(a),"base64").toString("utf8")}):(fo=function(a){return Zi(pc(gc(a)))},_r=function(a){return decodeURIComponent(fc(Ri(a)))});function b_(a){return h(pc(gc(a)))}function y_(a){return decodeURIComponent(fc(l(a)))}function uc(a){return pc(gc(a)).toLowerCase()}function gi(a){try{return decodeURIComponent(fc(a))}catch{return null}}function S_(a){return gi(w_(a))}function w_(a){for(var d=a.match(/.{1,2}/g),u=[],_=0;_<d.length;_++){var T=parseInt(d[_],16);161<=T&&T<=191?(u.push("c2"),u.push(d[_])):192<=T&&T<=255?(u.push("c3"),u.push((T-64).toString(16))):u.push(d[_])}return u.join("")}function Nn(a){for(var d="",u=0;u<a.length-1;u+=2)d+=String.fromCharCode(parseInt(a.substr(u,2),16));return d}function Hr(a){for(var d="",u=0;u<a.length;u++)d+=("0"+a.charCodeAt(u).toString(16)).slice(-2);return d}function id(a){return h(a)}function x_(a){return hc(id(a),64)}function hc(a,d){return a=a.replace(new RegExp("(.{"+d+"})","g"),`$1\r
`),a=a.replace(/\s+$/,""),a}function lh(a){var d=a.replace(/[^0-9A-Za-z\/+=]*/g,""),u=l(d);return u}function E_(a,d){return"-----BEGIN "+d+`-----\r
`+hc(a,64)+`\r
-----END `+d+`-----\r
`}function fn(a,d){return"-----BEGIN "+d+`-----\r
`+hc(id(a),64)+`\r
-----END `+d+`-----\r
`}function Bi(a,d){if(a.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return d!==void 0?(a=a.replace(new RegExp("^[^]*-----BEGIN "+d+"-----"),""),a=a.replace(new RegExp("-----END "+d+"-----[^]*$"),"")):(a=a.replace(/^[^]*-----BEGIN [^-]+-----/,""),a=a.replace(/-----END [^-]+-----[^]*$/,"")),lh(a)}function C_(a){return a.indexOf("-----BEGIN ")==-1||a.indexOf("-----END ")==-1?null:(a=a.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),a=a.replace(/-----END [\s\S]+$/m,""),a=a.replace(/\s+/g,""),a.match(/^[0-9a-zA-Z+/=]+$/)?a:null)}function T_(a){if(a.length%2!=0)throw"input is not even length";if(a.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var d=new ArrayBuffer(a.length/2),u=new DataView(d),_=0;_<a.length/2;_++)u.setUint8(_,parseInt(a.substr(_*2,2),16));return d}function R_(a){for(var d="",u=new DataView(a),_=0;_<a.byteLength;_++)d+=("00"+u.getUint8(_).toString(16)).slice(-2);return d}function nd(a){var d,u,_,T,E,L,I,V,O,W;if(a=uh(a),W=a.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),W)return d=parseInt(W[1]),u=parseInt(W[2])-1,_=parseInt(W[3]),T=parseInt(W[4]),E=parseInt(W[5]),L=parseInt(W[6]),I=0,V=W[7],V!==""&&(O=(V.substr(1)+"00").substr(0,3),I=parseInt(O)),Date.UTC(d,u,_,T,E,L,I);throw new Error("unsupported zulu format: "+a)}function P_(a){var d=new Date(a),u=("0000"+d.getUTCFullYear()).slice(-4),_=("00"+(d.getUTCMonth()+1)).slice(-2),T=("00"+d.getUTCDate()).slice(-2),E=("00"+d.getUTCHours()).slice(-2),L=("00"+d.getUTCMinutes()).slice(-2),I=("00"+d.getUTCSeconds()).slice(-2),V=("000"+d.getUTCMilliseconds()).slice(-3);return V=V.replace(/0+$/,""),V=V!=""?"."+V:V,u+_+T+E+L+I+V+"Z"}function dh(a){return Math.round(nd(a)/1e3)}function M_(a){return new Date(nd(a))}function A_(a,d,u){var _,T=a.getUTCFullYear();if(d){if(T<1950||2049<T)throw"not proper year for UTCTime: "+T;_=(""+T).slice(-2)}else _=("000"+T).slice(-4);if(_+=("0"+(a.getUTCMonth()+1)).slice(-2),_+=("0"+a.getUTCDate()).slice(-2),_+=("0"+a.getUTCHours()).slice(-2),_+=("0"+a.getUTCMinutes()).slice(-2),_+=("0"+a.getUTCSeconds()).slice(-2),u){var E=a.getUTCMilliseconds();E!==0&&(E=("00"+E).slice(-3),E=E.replace(/0+$/g,""),_+="."+E)}return _+="Z",_}function uh(a){return a.match(/^[0-9]{12}Z$/)||a.match(/^[0-9]{12}[.][0-9]*Z$/)?a.match(/^[0-4]/)?"20"+a:"19"+a:a}function pc(a){return a.replace(/%/g,"")}function fc(a){return a.replace(/(..)/g,"%$1")}function rd(a){var d="malformed IPv6 address";if(!a.match(/^[0-9A-Fa-f:]+$/))throw d;a=a.toLowerCase();var u=a.split(":").length-1;if(u<2)throw d;var _=":".repeat(7-u+2);a=a.replace("::",_);var T=a.split(":");if(T.length!=8)throw d;for(var E=0;E<8;E++)T[E]=("0000"+T[E]).slice(-4);return T.join("")}function sd(a){if(!a.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+a);a=a.toLowerCase();var d=a.match(/.{1,4}/g);d=d.map(function(T){return T.replace(/^0+/,"")}),d=d.map(function(T){return T==""?"0":T}),a=":"+d.join(":")+":";var u=a.match(/:(0:){2,}/g);if(u==null)return a.slice(1,-1);var _=u.sort().slice(-1)[0];return a=a.replace(_.substr(0,_.length-1),":"),a.substr(0,2)!="::"&&(a=a.substr(1)),a.substr(-2,2)!="::"&&(a=a.substr(0,a.length-1)),a}function mc(a){var d=new Error("malformed hex value");if(!a.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw d;if(a.length==8){var u;try{return u=parseInt(a.substr(0,2),16)+"."+parseInt(a.substr(2,2),16)+"."+parseInt(a.substr(4,2),16)+"."+parseInt(a.substr(6,2),16),u}catch{throw d}}else if(a.length==16)try{return mc(a.substr(0,8))+"/"+hh(a.substr(8))}catch{throw d}else{if(a.length==32)return sd(a);if(a.length==64){try{return sd(a.substr(0,32))+"/"+hh(a.substr(32))}catch{throw d}return}else return a}}function hh(a){var d=new Error("malformed mask"),u;try{u=new f(a,16).toString(2)}catch{throw d}if(!u.match(/^1*0*$/))throw d;return u.replace(/0+$/,"").length}function ad(a){var d=new Error("malformed IP address");if(a=a.toLowerCase(a),!a.match(/^[0-9a-f.:/]+$/))throw d;if(a.match(/^[0-9.]+$/)){var u=a.split(".");if(u.length!==4)throw d;var _="";try{for(var T=0;T<4;T++){var E=parseInt(u[T]);_+=("0"+E.toString(16)).slice(-2)}return _}catch{throw d}}else if(a.match(/^[0-9.]+\/[0-9]+$/)){var L=a.split("/");return ad(L[0])+ph(parseInt(L[1]),32)}else{if(a.match(/^[0-9a-f:]+$/)&&a.indexOf(":")!==-1)return rd(a);if(a.match(/^[0-9a-f:]+\/[0-9]+$/)&&a.indexOf(":")!==-1){var L=a.split("/");return rd(L[0])+ph(parseInt(L[1]),128)}else throw d}}function ph(a,d){if(d==32&&a==0)return"00000000";if(d==128&&a==0)return"00000000000000000000000000000000";var u=Array(a+1).join("1")+Array(d-a+1).join("0");return new f(u,2).toString(16)}function od(a){function d(T){var E=parseInt(T.substr(0,2),16),L=parseInt(T.substr(2),16);if(E==0&L<128)return String.fromCharCode(L);if(E<8){var I=192|(E&7)<<3|(L&192)>>6,V=128|L&63;return gi(I.toString(16)+V.toString(16))}var I=224|(E&240)>>4,V=128|(E&15)<<2|(L&192)>>6,O=128|L&63;return gi(I.toString(16)+V.toString(16)+O.toString(16))}var u=a.match(/.{4}/g),_=u.map(d);return _.join("")}function gc(a){for(var d=encodeURIComponent(a),u="",_=0;_<d.length;_++)d[_]=="%"?(u=u+d.substr(_,3),_=_+2):u=u+"%"+kn(d[_]);return u}function D_(a){return a=a.replace(/\r\n/mg,`
`),a}function I_(a){return a=a.replace(/\r\n/mg,`
`),a=a.replace(/\n/mg,`\r
`),a}R.lang.String.isInteger=function(a){return a.match(/^[0-9]+$/)?!0:!!a.match(/^-[0-9]+$/)},R.lang.String.isHex=function(a){return fh(a)};function fh(a){return!!(a.length%2==0&&(a.match(/^[0-9a-f]+$/)||a.match(/^[0-9A-F]+$/)))}R.lang.String.isBase64=function(a){return a=a.replace(/\s+/g,""),!!(a.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&a.length%4==0)},R.lang.String.isBase64URL=function(a){return a.match(/[+/=]/)?!1:(a=po(a),R.lang.String.isBase64(a))};function cd(a){return!!a.match(/^[0-9A-Za-z-_.]+$/)}R.lang.String.isIntegerArray=function(a){return a=a.replace(/\s+/g,""),!!a.match(/^\[[0-9,]+\]$/)},R.lang.String.isPrintable=function(a){return a.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},R.lang.String.isIA5=function(a){return a.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},R.lang.String.isMail=function(a){return a.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function ld(a){return a.length%2==1?"0"+a:a.substr(0,1)>"7"?"00"+a:a}function L_(a){a=a.replace(/^\s*\[\s*/,""),a=a.replace(/\s*\]\s*$/,""),a=a.replace(/\s*/g,"");try{var d=a.split(/,/).map(function(u,_,T){var E=parseInt(u);if(E<0||255<E)throw"integer not in range 0-255";var L=("00"+E.toString(16)).slice(-2);return L}).join("");return d}catch(u){throw"malformed integer array string: "+u}}var F_=function(a,d){var u=a.length;a.length>d.length&&(u=d.length);for(var _=0;_<u;_++)if(a.charCodeAt(_)!=d.charCodeAt(_))return _;return a.length!=d.length?u:-1};function mh(a){var d=function(I){var V=I.toString(16);return V.length==1&&(V="0"+V),V},u=function(I){var V="",O=parseInt(I,10),W=O.toString(2),z=7-W.length%7;z==7&&(z=0);for(var D="",U=0;U<z;U++)D+="0";W=D+W;for(var U=0;U<W.length-1;U+=7){var k=W.substr(U,7);U!=W.length-7&&(k="1"+k),V+=d(parseInt(k,2))}return V};try{if(!a.match(/^[0-9.]+$/))return null;var _="",T=a.split("."),E=parseInt(T[0],10)*40+parseInt(T[1],10);_+=d(E),T.splice(0,2);for(var L=0;L<T.length;L++)_+=u(T[L]);return _}catch{return null}}function vc(a){if(!fh(a))return null;try{var d=[],u=a.substr(0,2),_=parseInt(u,16);d[0]=new String(Math.floor(_/40)),d[1]=new String(_%40);for(var T=a.substr(2),E=[],L=0;L<T.length/2;L++)E.push(parseInt(T.substr(L*2,2),16));for(var I=[],V="",L=0;L<E.length;L++)E[L]&128?V=V+_c((E[L]&127).toString(2),7):(V=V+_c((E[L]&127).toString(2),7),I.push(new String(parseInt(V,2))),V="");var O=d.join(".");return I.length>0&&(O=O+"."+I.join(".")),O}catch{return null}}function gh(a){var d=new f(String(a),10);return mo(d)}function mo(a){var d=a.toString(16);if(d.substr(0,1)!="-")return d.length%2==1?d="0"+d:d.match(/^[0-7]/)||(d="00"+d),d;var u=d.substr(1),_=u.length;_%2==1?_+=1:d.match(/^[0-7]/)||(_+=2);for(var T="",E=0;E<_;E++)T+="f";var L=new f(T,16),I=L.xor(a).add(f.ONE);return d=I.toString(16).replace(/^-/,""),d}var _c=function(a,d,u){return u==null&&(u="0"),a.length>=d?a:new Array(d-a.length+1).join(u)+a};function vh(a){if(a.length%2!=0||(a=a.toLowerCase(),a.match(/^[0-9a-f]+$/)==null))return-1;try{var d=a.substr(0,2);if(d=="00")return parseInt(a.substr(2),16);var u=parseInt(d,16);if(u>7)return-1;var _=a.substr(2),T=parseInt(_,16).toString(2);T=="0"&&(T="00000000"),T=T.slice(0,0-u);var E=parseInt(T,2);return E==NaN?-1:E}catch{return-1}}function _h(a){if(typeof a!="number"||a<0)return null;var d=Number(a).toString(2),u=8-d.length%8;u==8&&(u=0),d=d+_c("",u,"0");var _=parseInt(d,2).toString(16);_.length%2==1&&(_="0"+_);var T="0"+u;return T+_}function bh(a){if(typeof a!="string"||a.length%2!=0||!a.match(/^[0-9a-f]+$/))return null;try{var d=parseInt(a.substr(0,2),16);if(d<0||7<d)return null;for(var u=a.substr(2),_="",T=0;T<u.length;T+=2){var E=u.substr(T,2),L=parseInt(E,16).toString(2);L=("0000000"+L).slice(-8),_+=L}return _.substr(0,_.length-d)}catch{return null}}function k_(a){if(typeof a!="string"||a.match(/^[01]+$/)==null)return null;try{var d=parseInt(a,2);return _h(d)}catch{return null}}function bc(a,d){for(var u=0,_=0;_<a.length;_++)u|=1<<d[a[_]];for(var T=u.toString(2),E="",_=T.length-1;_>=0;_--)E+=T[_];return E}function Si(a,_,u){if(typeof a=="object"){for(var _=String(_).split("."),T=0;T<_.length&&a;T++){var E=_[T];E.match(/^[0-9]+$/)&&(E=parseInt(E)),a=a[E]}return a||a===!1?a:u}}function je(a,d){var u=function(){};u.prototype=d.prototype,a.prototype=new u,a.prototype.constructor=a,a.superclass=d.prototype,d.prototype.constructor==Object.prototype.constructor&&(d.prototype.constructor=d)}(typeof R>"u"||!R)&&(R={}),(typeof R.crypto>"u"||!R.crypto)&&(R.crypto={}),R.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:s.algo.MD5,sha1:s.algo.SHA1,sha224:s.algo.SHA224,sha256:s.algo.SHA256,sha384:s.algo.SHA384,sha512:s.algo.SHA512,ripemd160:s.algo.RIPEMD160},this.getDigestInfoHex=function(a,d){if(typeof this.DIGESTINFOHEAD[d]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+d;return this.DIGESTINFOHEAD[d]+a},this.getPaddedDigestInfoHex=function(a,d,u){var _=this.getDigestInfoHex(a,d),T=u/4;if(_.length+22>T)throw"key is too short for SigAlg: keylen="+u+","+d;for(var E="0001",L="00"+_,I="",V=T-E.length-L.length,O=0;O<V;O+=2)I+="ff";var W=E+I+L;return W},this.hashString=function(a,d){var u=new R.crypto.MessageDigest({alg:d});return u.digestString(a)},this.hashHex=function(a,d){var u=new R.crypto.MessageDigest({alg:d});return u.digestHex(a)},this.sha1=function(a){return this.hashString(a,"sha1")},this.sha256=function(a){return this.hashString(a,"sha256")},this.sha256Hex=function(a){return this.hashHex(a,"sha256")},this.sha512=function(a){return this.hashString(a,"sha512")},this.sha512Hex=function(a){return this.hashHex(a,"sha512")},this.isKey=function(a){return a instanceof Gt||a instanceof R.crypto.DSA||a instanceof R.crypto.ECDSA}},R.crypto.Util.md5=function(a){var d=new R.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return d.digestString(a)},R.crypto.Util.ripemd160=function(a){var d=new R.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return d.digestString(a)},R.crypto.Util.SECURERANDOMGEN=new ba,R.crypto.Util.getRandomHexOfNbytes=function(a){var d=new Array(a);return R.crypto.Util.SECURERANDOMGEN.nextBytes(d),dc(d)},R.crypto.Util.getRandomBigIntegerOfNbytes=function(a){return new f(R.crypto.Util.getRandomHexOfNbytes(a),16)},R.crypto.Util.getRandomHexOfNbits=function(a){var d=a%8,u=(a-d)/8,_=new Array(u+1);return R.crypto.Util.SECURERANDOMGEN.nextBytes(_),_[0]=(255<<d&255^255)&_[0],dc(_)},R.crypto.Util.getRandomBigIntegerOfNbits=function(a){return new f(R.crypto.Util.getRandomHexOfNbits(a),16)},R.crypto.Util.getRandomBigIntegerZeroToMax=function(a){for(var d=a.bitLength();;){var u=R.crypto.Util.getRandomBigIntegerOfNbits(d);if(a.compareTo(u)!=-1)return u}},R.crypto.Util.getRandomBigIntegerMinToMax=function(a,d){var u=a.compareTo(d);if(u==1)throw"biMin is greater than biMax";if(u==0)return a;var _=d.subtract(a),T=R.crypto.Util.getRandomBigIntegerZeroToMax(_);return T.add(a)},R.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(d,u){if(d=R.crypto.MessageDigest.getCanonicalAlgName(d),d!==null&&u===void 0&&(u=R.crypto.Util.DEFAULTPROVIDER[d]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(d)!=-1&&u=="cryptojs"){try{this.md=R.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[d].create()}catch(_){throw"setAlgAndProvider hash alg set fail alg="+d+"/"+_}this.updateString=function(_){this.md.update(_)},this.updateHex=function(_){var T=s.enc.Hex.parse(_);this.md.update(T)},this.digest=function(){var _=this.md.finalize();return _.toString(s.enc.Hex)},this.digestString=function(_){return this.updateString(_),this.digest()},this.digestHex=function(_){return this.updateHex(_),this.digest()}}if(":sha256:".indexOf(d)!=-1&&u=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(_){throw"setAlgAndProvider hash alg set fail alg="+d+"/"+_}this.updateString=function(_){this.md.update(_)},this.updateHex=function(_){var T=sjcl.codec.hex.toBits(_);this.md.update(T)},this.digest=function(){var _=this.md.finalize();return sjcl.codec.hex.fromBits(_)},this.digestString=function(_){return this.updateString(_),this.digest()},this.digestHex=function(_){return this.updateHex(_),this.digest()}}},this.updateString=function(d){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(d){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(d){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(d){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},a!==void 0&&a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0&&(this.provName=R.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},R.crypto.MessageDigest.getCanonicalAlgName=function(a){return typeof a=="string"&&(a=a.toLowerCase(),a=a.replace(/-/,"")),a},R.crypto.MessageDigest.getHashLength=function(a){var d=R.crypto.MessageDigest,u=d.getCanonicalAlgName(a);if(d.HASHLENGTH[u]===void 0)throw"not supported algorithm: "+a;return d.HASHLENGTH[u]},R.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},R.crypto.Mac=function(a){this.setAlgAndProvider=function(d,u){if(d=d.toLowerCase(),d==null&&(d="hmacsha1"),d=d.toLowerCase(),d.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+d;u===void 0&&(u=R.crypto.Util.DEFAULTPROVIDER[d]),this.algProv=d+"/"+u;var _=d.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(_)!=-1&&u=="cryptojs"){try{var T=R.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[_];this.mac=s.algo.HMAC.create(T,this.pass)}catch(E){throw"setAlgAndProvider hash alg set fail hashAlg="+_+"/"+E}this.updateString=function(E){this.mac.update(E)},this.updateHex=function(E){var L=s.enc.Hex.parse(E);this.mac.update(L)},this.doFinal=function(){var E=this.mac.finalize();return E.toString(s.enc.Hex)},this.doFinalString=function(E){return this.updateString(E),this.doFinal()},this.doFinalHex=function(E){return this.updateHex(E),this.doFinal()}}},this.updateString=function(d){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(d){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(d){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(d){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(d){if(typeof d=="string"){var u=d;(d.length%2==1||!d.match(/^[0-9A-Fa-f]+$/))&&(u=Hr(d)),this.pass=s.enc.Hex.parse(u);return}if(typeof d!="object")throw"KJUR.crypto.Mac unsupported password type: "+d;var u=null;if(d.hex!==void 0){if(d.hex.length%2!=0||!d.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+d.hex;u=d.hex}if(d.utf8!==void 0&&(u=uc(d.utf8)),d.rstr!==void 0&&(u=Hr(d.rstr)),d.b64!==void 0&&(u=l(d.b64)),d.b64u!==void 0&&(u=Ri(d.b64u)),u==null)throw"KJUR.crypto.Mac unsupported password type: "+d;this.pass=s.enc.Hex.parse(u)},a!==void 0&&(a.pass!==void 0&&this.setPassword(a.pass),a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0&&(this.provName=R.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},R.crypto.Signature=function(a){var d=null;if(this._setAlgNames=function(){var u=this.algName.match(/^(.+)with(.+)$/);u&&(this.mdAlgName=u[1].toLowerCase(),this.pubkeyAlgName=u[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(u,_){for(var T="",E=_/4-u.length,L=0;L<E;L++)T=T+"0";return T+u},this.setAlgAndProvider=function(u,_){if(this._setAlgNames(),_!="cryptojs/jsrsa")throw new Error("provider not supported: "+_);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new R.crypto.MessageDigest({alg:this.mdAlgName})}catch(T){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+T)}this.init=function(T,E){var L=null;try{E===void 0?L=ai.getKey(T):L=ai.getKey(T,E)}catch(I){throw"init failed:"+I}if(L.isPrivate===!0)this.prvKey=L,this.state="SIGN";else if(L.isPublic===!0)this.pubKey=L,this.state="VERIFY";else throw"init failed.:"+L},this.updateString=function(T){this.md.updateString(T)},this.updateHex=function(T){this.md.updateHex(T)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&R.crypto.ECDSA!==void 0&&(this.prvKey=new R.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Gt&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Gt&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof R.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof R.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(T){return this.updateString(T),this.sign()},this.signHex=function(T){return this.updateHex(T),this.sign()},this.verify=function(T){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&R.crypto.ECDSA!==void 0&&(this.pubKey=new R.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Gt&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,T,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Gt&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,T);if(R.crypto.ECDSA!==void 0&&this.pubKey instanceof R.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,T);if(R.crypto.DSA!==void 0&&this.pubKey instanceof R.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,T);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(u,_){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(u){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(u){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(u){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(u){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(u){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=a,a!==void 0&&(a.alg!==void 0&&(this.algName=a.alg,a.prov===void 0?this.provName=R.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),a.psssaltlen!==void 0&&(this.pssSaltLen=a.psssaltlen),a.prvkeypem!==void 0)){if(a.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var d=ai.getKey(a.prvkeypem);this.init(d)}catch(u){throw"fatal error to load pem private key: "+u}}},R.crypto.Cipher=function(a){},R.crypto.Cipher.encrypt=function(a,d,u,_){if(Si(_,"enclag")!=null&&(u=_.encalg),typeof u=="string"&&u.substr(-4)=="-CBC"){var T=d,E=a;Si(_,"key")!=null&&(T=_.key),Si(_,"enc")!=null&&(hEnc=_.enc);var L=s.enc.Hex.parse(T),I=s.enc.Hex.parse(E),V=s.enc.Hex.parse(_.iv),O;if(u=="des-EDE3-CBC")O=s.TripleDES.encrypt(I,L,{iv:V});else if(u=="aes128-CBC"||u=="aes256-CBC")O=s.AES.encrypt(I,L,{iv:V});else throw new Error("unsupported algorithm: "+u);return O+""}else throw new Error("Cipher.encrypt: unsupported key or algorithm")},R.crypto.Cipher.decrypt=function(a,d,u,_){if(Si(_,"enclag")!=null&&(u=_.encalg),typeof u=="string"&&u.substr(-4)=="-CBC"){var T=d,E=a;Si(_,"key")!=null&&(T=_.key),Si(_,"enc")!=null&&(E=_.enc);var L=s.enc.Hex.parse(T),I=s.enc.Hex.parse(E),V=s.enc.Hex.parse(_.iv),O;if(u=="des-EDE3-CBC")O=s.TripleDES.decrypt({ciphertext:I},L,{iv:V});else if(u=="aes128-CBC"||u=="aes256-CBC")O=s.AES.decrypt({ciphertext:I},L,{iv:V});else throw new Error("unsupported algorithm: "+u);return s.enc.Hex.stringify(O)}else throw new Error("Cipher.decrypt: unsupported key or algorithm")},R.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof R>"u"||!R)&&(R={}),(typeof R.crypto>"u"||!R.crypto)&&(R.crypto={}),R.crypto.ECDSA=function(a){var d="secp256r1",u=Error,_=f,T=pi,E=R.crypto.ECDSA,L=R.crypto.ECParameterDB,I=E.getName,V=Ze,O=V.getVbyListEx,W=V.isASN1HEX,z=new ba;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(D){return new _(D.bitLength(),z).mod(D.subtract(_.ONE)).add(_.ONE)},this.setNamedCurve=function(D){this.ecparams=L.getByName(D),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=D},this.setPrivateKeyHex=function(D){this.isPrivate=!0,this.prvKeyHex=D},this.setPublicKeyHex=function(D){this.isPublic=!0,this.pubKeyHex=D},this.getPublicKeyXYHex=function(){var D=this.pubKeyHex;if(D.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var U=this.ecparams.keycharlen;if(D.length!==2+U*2)throw"malformed public key hex length";var k={};return k.x=D.substr(2,U),k.y=D.substr(2+U),k},this.getShortNISTPCurveName=function(){var D=this.curveName;return D==="secp256r1"||D==="NIST P-256"||D==="P-256"||D==="prime256v1"?"P-256":D==="secp384r1"||D==="NIST P-384"||D==="P-384"?"P-384":D==="secp521r1"||D==="NIST P-521"||D==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var D=this.ecparams.n,U=this.getBigRandom(D),k=this.ecparams.keycharlen,H=("0000000000"+U.toString(16)).slice(-k);this.setPrivateKeyHex(H);var G=this.generatePublicKeyHex();return{ecprvhex:H,ecpubhex:G}},this.generatePublicKeyHex=function(){var D=new _(this.prvKeyHex,16),U=this.ecparams.G.multiply(D),k=U.getX().toBigInteger(),H=U.getY().toBigInteger(),G=this.ecparams.keycharlen,$=("0000000000"+k.toString(16)).slice(-G),se=("0000000000"+H.toString(16)).slice(-G),me="04"+$+se;return this.setPublicKeyHex(me),me},this.signWithMessageHash=function(D){return this.signHex(D,this.prvKeyHex)},this.signHex=function(D,U){var k=new _(U,16),H=this.ecparams.n,G=new _(D.substring(0,this.ecparams.keycharlen),16);do var $=this.getBigRandom(H),se=this.ecparams.G,me=se.multiply($),fe=me.getX().toBigInteger().mod(H);while(fe.compareTo(_.ZERO)<=0);var _e=$.modInverse(H).multiply(G.add(k.multiply(fe))).mod(H);return E.biRSSigToASN1Sig(fe,_e)},this.sign=function(D,U){var k=U,H=this.ecparams.n,G=_.fromByteArrayUnsigned(D);do var $=this.getBigRandom(H),se=this.ecparams.G,me=se.multiply($),fe=me.getX().toBigInteger().mod(H);while(fe.compareTo(f.ZERO)<=0);var _e=$.modInverse(H).multiply(G.add(k.multiply(fe))).mod(H);return this.serializeSig(fe,_e)},this.verifyWithMessageHash=function(D,U){return this.verifyHex(D,U,this.pubKeyHex)},this.verifyHex=function(D,U,k){try{var H,G,$=E.parseSigHex(U);H=$.r,G=$.s;var se=T.decodeFromHex(this.ecparams.curve,k),me=new _(D.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(me,H,G,se)}catch{return!1}},this.verify=function(D,U,k){var H,G;if(Bitcoin.Util.isArray(U)){var $=this.parseSig(U);H=$.r,G=$.s}else if(typeof U=="object"&&U.r&&U.s)H=U.r,G=U.s;else throw"Invalid value for signature";var se;if(k instanceof pi)se=k;else if(Bitcoin.Util.isArray(k))se=T.decodeFrom(this.ecparams.curve,k);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var me=_.fromByteArrayUnsigned(D);return this.verifyRaw(me,H,G,se)},this.verifyRaw=function(D,U,k,H){var G=this.ecparams.n,$=this.ecparams.G;if(U.compareTo(_.ONE)<0||U.compareTo(G)>=0||k.compareTo(_.ONE)<0||k.compareTo(G)>=0)return!1;var se=k.modInverse(G),me=D.multiply(se).mod(G),fe=U.multiply(se).mod(G),_e=$.multiply(me).add(H.multiply(fe)),Z=_e.getX().toBigInteger().mod(G);return Z.equals(U)},this.serializeSig=function(D,U){var k=D.toByteArraySigned(),H=U.toByteArraySigned(),G=[];return G.push(2),G.push(k.length),G=G.concat(k),G.push(2),G.push(H.length),G=G.concat(H),G.unshift(G.length),G.unshift(48),G},this.parseSig=function(D){var U;if(D[0]!=48)throw new Error("Signature not a valid DERSequence");if(U=2,D[U]!=2)throw new Error("First element in signature must be a DERInteger");var k=D.slice(U+2,U+2+D[U+1]);if(U+=2+D[U+1],D[U]!=2)throw new Error("Second element in signature must be a DERInteger");var H=D.slice(U+2,U+2+D[U+1]);U+=2+D[U+1];var G=_.fromByteArrayUnsigned(k),$=_.fromByteArrayUnsigned(H);return{r:G,s:$}},this.parseSigCompact=function(D){if(D.length!==65)throw"Signature has the wrong length";var U=D[0]-27;if(U<0||U>7)throw"Invalid signature type";var k=this.ecparams.n,H=_.fromByteArrayUnsigned(D.slice(1,33)).mod(k),G=_.fromByteArrayUnsigned(D.slice(33,65)).mod(k);return{r:H,s:G,i:U}},this.readPKCS5PrvKeyHex=function(D){if(W(D)===!1)throw new Error("not ASN.1 hex string");var U,k,H;try{U=O(D,0,["[0]",0],"06"),k=O(D,0,[1],"04");try{H=O(D,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=I(U),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(H),this.setPrivateKeyHex(k),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(D){if(W(D)===!1)throw new u("not ASN.1 hex string");var U,k,H,G;try{U=O(D,0,[1,0],"06"),k=O(D,0,[1,1],"06"),H=O(D,0,[2,0,1],"04");try{G=O(D,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new u("malformed PKCS#8 plain ECC private key")}if(this.curveName=I(k),this.curveName===void 0)throw new u("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(G),this.setPrivateKeyHex(H),this.isPublic=!1},this.readPKCS8PubKeyHex=function(D){if(W(D)===!1)throw new u("not ASN.1 hex string");var U,k,H;try{U=O(D,0,[0,0],"06"),k=O(D,0,[0,1],"06"),H=O(D,0,[1],"03")}catch{throw new u("malformed PKCS#8 ECC public key")}if(this.curveName=I(k),this.curveName===null)throw new u("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(H)},this.readCertPubKeyHex=function(D,U){if(W(D)===!1)throw new u("not ASN.1 hex string");var k,H;try{k=O(D,0,[0,5,0,1],"06"),H=O(D,0,[0,5,1],"03")}catch{throw new u("malformed X.509 certificate ECC public key")}if(this.curveName=I(k),this.curveName===null)throw new u("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(H)},a!==void 0&&a.curve!==void 0&&(this.curveName=a.curve),this.curveName===void 0&&(this.curveName=d),this.setNamedCurve(this.curveName),a!==void 0&&(a.prv!==void 0&&this.setPrivateKeyHex(a.prv),a.pub!==void 0&&this.setPublicKeyHex(a.pub))},R.crypto.ECDSA.parseSigHex=function(a){var d=R.crypto.ECDSA.parseSigHexInHexRS(a),u=new f(d.r,16),_=new f(d.s,16);return{r:u,s:_}},R.crypto.ECDSA.parseSigHexInHexRS=function(a){var d=Ze,u=d.getChildIdx,_=d.getV;if(d.checkStrictDER(a,0),a.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var T=u(a,0);if(T.length!=2)throw new Error("signature shall have two elements");var E=T[0],L=T[1];if(a.substr(E,2)!="02")throw new Error("1st item not ASN.1 integer");if(a.substr(L,2)!="02")throw new Error("2nd item not ASN.1 integer");var I=_(a,E),V=_(a,L);return{r:I,s:V}},R.crypto.ECDSA.asn1SigToConcatSig=function(a){var d=R.crypto.ECDSA.parseSigHexInHexRS(a),u=d.r,_=d.s;if(u.length>=130&&u.length<=134){if(u.length%2!=0)throw Error("unknown ECDSA sig r length error");if(_.length%2!=0)throw Error("unknown ECDSA sig s length error");u.substr(0,2)=="00"&&(u=u.substr(2)),_.substr(0,2)=="00"&&(_=_.substr(2));var T=Math.max(u.length,_.length);return u=("000000"+u).slice(-T),_=("000000"+_).slice(-T),u+_}if(u.substr(0,2)=="00"&&u.length%32==2&&(u=u.substr(2)),_.substr(0,2)=="00"&&_.length%32==2&&(_=_.substr(2)),u.length%32==30&&(u="00"+u),_.length%32==30&&(_="00"+_),u.length%32!=0)throw Error("unknown ECDSA sig r length error");if(_.length%32!=0)throw Error("unknown ECDSA sig s length error");return u+_},R.crypto.ECDSA.concatSigToASN1Sig=function(a){if(a.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var d=a.substr(0,a.length/2),u=a.substr(a.length/2);return R.crypto.ECDSA.hexRSSigToASN1Sig(d,u)},R.crypto.ECDSA.hexRSSigToASN1Sig=function(a,d){var u=new f(a,16),_=new f(d,16);return R.crypto.ECDSA.biRSSigToASN1Sig(u,_)},R.crypto.ECDSA.biRSSigToASN1Sig=function(a,d){var u=R.asn1,_=new u.DERInteger({bigint:a}),T=new u.DERInteger({bigint:d}),E=new u.DERSequence({array:[_,T]});return E.tohex()},R.crypto.ECDSA.getName=function(a){return a==="2b8104001f"?"secp192k1":a==="2a8648ce3d030107"?"secp256r1":a==="2b8104000a"?"secp256k1":a==="2b81040021"?"secp224r1":a==="2b81040022"?"secp384r1":a==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(a)!==-1?"secp256r1":"|secp256k1|".indexOf(a)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(a)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(a)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(a)!==-1?"secp521r1":null},(typeof R>"u"||!R)&&(R={}),(typeof R.crypto>"u"||!R.crypto)&&(R.crypto={}),R.crypto.ECParameterDB=new function(){var a={},d={};function u(_){return new f(_,16)}this.getByName=function(_){var T=_;if(typeof d[T]<"u"&&(T=d[_]),typeof a[T]<"u")return a[T];throw"unregistered EC curve name: "+T},this.regist=function(_,T,E,L,I,V,O,W,z,D,U,k){a[_]={};var H=u(E),G=u(L),$=u(I),se=u(V),me=u(O),fe=new es(H,G,$),_e=fe.decodePointHex("04"+W+z);a[_].name=_,a[_].keylen=T,a[_].keycharlen=Math.ceil(T/8)*2,a[_].curve=fe,a[_].G=_e,a[_].n=se,a[_].h=me,a[_].oid=U,a[_].info=k;for(var Z=0;Z<D.length;Z++)d[D[Z]]=_}},R.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),R.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),R.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),R.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),R.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),R.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),R.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),R.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),R.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),R.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof R>"u"||!R)&&(R={}),(typeof R.crypto>"u"||!R.crypto)&&(R.crypto={}),R.crypto.DSA=function(){var a=Ze;a.getVbyList;var d=a.getVbyListEx,u=a.isASN1HEX,_=f;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(T,E,L,I,V){this.isPrivate=!0,this.p=T,this.q=E,this.g=L,this.y=I,this.x=V},this.setPrivateHex=function(T,E,L,I,V){var O,W,z,D,U;O=new f(T,16),W=new f(E,16),z=new f(L,16),typeof I=="string"&&I.length>1?D=new f(I,16):D=null,U=new f(V,16),this.setPrivate(O,W,z,D,U)},this.setPublic=function(T,E,L,I){this.isPublic=!0,this.p=T,this.q=E,this.g=L,this.y=I,this.x=null},this.setPublicHex=function(T,E,L,I){var V,O,W,z;V=new f(T,16),O=new f(E,16),W=new f(L,16),z=new f(I,16),this.setPublic(V,O,W,z)},this.signWithMessageHash=function(T){var E=this.p,L=this.q,I=this.g;this.y;var V=this.x,O=R.crypto.Util.getRandomBigIntegerMinToMax(f.ONE.add(f.ONE),L.subtract(f.ONE)),W=T.substr(0,L.bitLength()/4),z=new f(W,16),D=I.modPow(O,E).mod(L),U=O.modInverse(L).multiply(z.add(V.multiply(D))).mod(L),k=R.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:D}},{int:{bigint:U}}]});return k},this.verifyWithMessageHash=function(T,E){var L=this.p,I=this.q,V=this.g,O=this.y,W=this.parseASN1Signature(E),z=W[0],D=W[1],U=T.substr(0,I.bitLength()/4),k=new f(U,16);if(f.ZERO.compareTo(z)>0||z.compareTo(I)>0||f.ZERO.compareTo(D)>=0||D.compareTo(I)>0)throw"invalid DSA signature";var H=D.modInverse(I),G=k.multiply(H).mod(I),$=z.multiply(H).mod(I),se=V.modPow(G,L).multiply(O.modPow($,L)).mod(L).mod(I);return se.compareTo(z)==0},this.parseASN1Signature=function(T){try{var E=new _(d(T,0,[0],"02"),16),L=new _(d(T,0,[1],"02"),16);return[E,L]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(T){var E,L,I,V,O;if(u(T)===!1)throw new Error("not ASN.1 hex string");try{E=d(T,0,[1],"02"),L=d(T,0,[2],"02"),I=d(T,0,[3],"02"),V=d(T,0,[4],"02"),O=d(T,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(E,L,I,V,O)},this.readPKCS8PrvKeyHex=function(T){var E,L,I,V;if(u(T)===!1)throw new Error("not ASN.1 hex string");try{E=d(T,0,[1,1,0],"02"),L=d(T,0,[1,1,1],"02"),I=d(T,0,[1,1,2],"02"),V=d(T,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(E,L,I,null,V)},this.readPKCS8PubKeyHex=function(T){var E,L,I,V;if(u(T)===!1)throw new Error("not ASN.1 hex string");try{E=d(T,0,[0,1,0],"02"),L=d(T,0,[0,1,1],"02"),I=d(T,0,[0,1,2],"02"),V=d(T,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(E,L,I,V)},this.readCertPubKeyHex=function(T,E){var L,I,V,O;if(u(T)===!1)throw new Error("not ASN.1 hex string");try{L=d(T,0,[0,5,0,1,0],"02"),I=d(T,0,[0,5,0,1,1],"02"),V=d(T,0,[0,5,0,1,2],"02"),O=d(T,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(L,I,V,O)}};var ai=function(){var a=function(k,H,G){return _(s.AES,k,H,G)},d=function(k,H,G){return _(s.TripleDES,k,H,G)},u=function(k,H,G){return _(s.DES,k,H,G)},_=function(k,H,G,$){var se=s.enc.Hex.parse(H),me=s.enc.Hex.parse(G),fe=s.enc.Hex.parse($),_e={};_e.key=me,_e.iv=fe,_e.ciphertext=se;var Z=k.decrypt(_e,me,{iv:fe});return s.enc.Hex.stringify(Z)},T=function(k,H,G){return I(s.AES,k,H,G)},E=function(k,H,G){return I(s.TripleDES,k,H,G)},L=function(k,H,G){return I(s.DES,k,H,G)},I=function(k,H,G,$){var se=s.enc.Hex.parse(H),me=s.enc.Hex.parse(G),fe=s.enc.Hex.parse($),_e=k.encrypt(se,me,{iv:fe}),Z=s.enc.Hex.parse(_e.toString()),J=s.enc.Base64.stringify(Z);return J},V={"AES-256-CBC":{proc:a,eproc:T,keylen:32,ivlen:16},"AES-192-CBC":{proc:a,eproc:T,keylen:24,ivlen:16},"AES-128-CBC":{proc:a,eproc:T,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:d,eproc:E,keylen:24,ivlen:8},"DES-CBC":{proc:u,eproc:L,keylen:8,ivlen:8}},O=function(k){var H=s.lib.WordArray.random(k),G=s.enc.Hex.stringify(H);return G},W=function(k){var H={},G=k.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));G&&(H.cipher=G[1],H.ivsalt=G[2]);var $=k.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));$&&(H.type=$[1]);var se=-1,me=0;k.indexOf(`\r
\r
`)!=-1&&(se=k.indexOf(`\r
\r
`),me=2),k.indexOf(`

`)!=-1&&(se=k.indexOf(`

`),me=1);var fe=k.indexOf("-----END");if(se!=-1&&fe!=-1){var _e=k.substring(se+me*2,fe-me);_e=_e.replace(/\s+/g,""),H.data=_e}return H},z=function(k,H,G){for(var $=G.substring(0,16),se=s.enc.Hex.parse($),me=s.enc.Utf8.parse(H),fe=V[k].keylen+V[k].ivlen,_e="",Z=null;;){var J=s.algo.MD5.create();if(Z!=null&&J.update(Z),J.update(me),J.update(se),Z=J.finalize(),_e=_e+s.enc.Hex.stringify(Z),_e.length>=fe*2)break}var ee={};return ee.keyhex=_e.substr(0,V[k].keylen*2),ee.ivhex=_e.substr(V[k].keylen*2,V[k].ivlen*2),ee},D=function(k,H,G,$){var se=s.enc.Base64.parse(k),me=s.enc.Hex.stringify(se),fe=V[H].proc,_e=fe(me,G,$);return _e},U=function(k,H,G,$){var se=V[H].eproc,me=se(k,G,$);return me};return{version:"1.0.0",parsePKCS5PEM:function(k){return W(k)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(k,H,G){return z(k,H,G)},decryptKeyB64:function(k,H,G,$){return D(k,H,G,$)},getDecryptedKeyHex:function(k,H){var G=W(k),$=G.cipher,se=G.ivsalt,me=G.data,fe=z($,H,se),_e=fe.keyhex,Z=D(me,$,_e,se);return Z},getEncryptedPKCS5PEMFromPrvKeyHex:function(k,H,G,$,se){var Y="";if((typeof $>"u"||$==null)&&($="AES-256-CBC"),typeof V[$]>"u")throw new Error("KEYUTIL unsupported algorithm: "+$);if(typeof se>"u"||se==null){var me=V[$].ivlen,fe=O(me);se=fe.toUpperCase()}var _e=z($,G,se),Z=_e.keyhex,J=U(H,$,Z,se),ee=J.replace(/(.{64})/g,`$1\r
`),Y="-----BEGIN "+k+` PRIVATE KEY-----\r
`;return Y+=`Proc-Type: 4,ENCRYPTED\r
`,Y+="DEK-Info: "+$+","+se+`\r
`,Y+=`\r
`,Y+=ee,Y+=`\r
-----END `+k+` PRIVATE KEY-----\r
`,Y},getEncryptedPKCS8PEM:function(k,H,G){var $=this.getEncryptedPKCS8Hex(k,H,G);return fn($,"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(k,H,G){var $;G==null||G==null?$={}:$=JSON.parse(JSON.stringify(G)),$.plain=k,this.initPBES2Param($),this.encryptPBES2Param($,H);var se=this.generatePBES2ASN1Param($);return R.asn1.ASN1Util.newObject(se).tohex()},initPBES2Param:function(k){if(Si(k,"encalg")==null&&(k.encalg="aes256-CBC"),Si(k,"iter")==null&&(k.iter=2048),Si(k,"prf")==null&&(k.prf="hmacWithSHA256"),Si(k,"salt")==null&&(k.salt=s.enc.Hex.stringify(s.lib.WordArray.random(8))),Si(k,"enciv")==null){var H;k.encalg=="des-EDE3-CBC"&&(H=8),k.encalg=="aes128-CBC"&&(H=16),k.encalg=="aes256-CBC"&&(H=16),k.enciv=s.enc.Hex.stringify(s.lib.WordArray.random(H))}},encryptPBES2Param:function(k,H){var G=ai.getDKFromPBES2Param(k,H);try{var $=R.crypto.Cipher.encrypt(k.plain,G,k.encalg,{iv:k.enciv})}catch{throw new Error("encrypt error: "+k.plain+" "+G+" "+k.encalg+" "+k.enciv)}k.enc=$},generatePBES2ASN1Param:function(k){var H={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:k.salt}},{int:{hex:gh(k.iter)}}]}]},{seq:[{oid:k.encalg},{octstr:{hex:k.enciv}}]}]}]},{octstr:{hex:k.enc}}]};return k.prf!="hmacWithSHA1"&&H.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:k.prf},{null:""}]}),H},parseHexOfEncryptedPKCS8:function(k){var H=Ze,G=H.getChildIdx,$=H.getV,se={},me=G(k,0);if(me.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+me.length);se.ciphertext=$(k,me[1]);var fe=G(k,me[0]);if(fe.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+fe.length);if($(k,fe[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var _e=G(k,fe[1]);if(fe.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+_e.length);var Z=G(k,_e[1]);if(Z.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+Z.length);if($(k,Z[0])!="2a864886f70d0307")throw"this only supports TripleDES";se.encryptionSchemeAlg="TripleDES",se.encryptionSchemeIV=$(k,Z[1]);var J=G(k,_e[0]);if(J.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+J.length);if($(k,J[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var ee=G(k,J[1]);if(ee.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+ee.length);se.pbkdf2Salt=$(k,ee[0]);var Y=$(k,ee[1]);try{se.pbkdf2Iter=parseInt(Y,16)}catch{throw new Error("malformed format pbkdf2Iter: "+Y)}return se},getPBKDF2KeyHexFromParam:function(k,H){var G=s.enc.Hex.parse(k.pbkdf2Salt),$=k.pbkdf2Iter,se=s.PBKDF2(H,G,{keySize:192/32,iterations:$}),me=s.enc.Hex.stringify(se);return me},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(k,H){var G=Bi(k,"ENCRYPTED PRIVATE KEY"),$=this.parseHexOfEncryptedPKCS8(G),se=ai.getPBKDF2KeyHexFromParam($,H),me={};me.ciphertext=s.enc.Hex.parse($.ciphertext);var fe=s.enc.Hex.parse(se),_e=s.enc.Hex.parse($.encryptionSchemeIV),Z=s.TripleDES.decrypt(me,fe,{iv:_e}),J=s.enc.Hex.stringify(Z);return J},parsePBES2:function(k){var H=Ze.parse(k);if(Si(H,"seq.0.seq.0.oid")!="pkcs5PBES2"||Si(H,"seq.0.seq.1.seq.0.seq.0.oid")!="pkcs5PBKDF2")throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var G=Si(H,"seq.0.seq.1.seq.0.seq.1.seq");if(G==null)throw new Error("PBKDF2 parameter not found");var $=Si(G,"0.octstr.hex"),se=Si(G,"1.int.hex"),me=Si(G,"2.seq.0.oid","hmacWithSHA1"),fe=-1;try{fe=parseInt(se,16)}catch{throw new Error("iter not proper value")}var _e=Si(H,"seq.0.seq.1.seq.1.seq.0.oid"),Z=Si(H,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),J=Si(H,"seq.1.octstr.hex");if(_e==null||Z==null||J==null)throw new Error("encalg, enciv or enc is undefined");var ee={salt:$,iter:fe,prf:me,encalg:_e,enciv:Z,enc:J};return ee},getDKFromPBES2Param:function(k,H){var G={hmacWithSHA1:s.algo.SHA1,hmacWithSHA224:s.algo.SHA224,hmacWithSHA256:s.algo.SHA256,hmacWithSHA384:s.algo.SHA384,hmacWithSHA512:s.algo.SHA512},$={"des-EDE3-CBC":192/32,"aes128-CBC":128/32,"aes256-CBC":256/32},se=G[k.prf];if(se==null)throw new Error("unsupported prf");var me=$[k.encalg];if(me==null)throw new Error("unsupported encalg");var fe=s.enc.Hex.parse(k.salt),_e=k.iter;try{var Z=s.PBKDF2(H,fe,{keySize:me,iterations:_e,hasher:se});return s.enc.Hex.stringify(Z)}catch(J){throw new Error("PBKDF2 error: "+J+" "+JSON.stringify(k)+" "+H)}},getPlainHexFromEncryptedPKCS8PEM:function(k,H){if(k.indexOf("BEGIN ENCRYPTED PRIVATE KEY")==-1)throw new Error("not Encrypted PKCS#8 PEM string");var G=Bi(k),$;try{$=ai.parsePBES2(G)}catch(me){throw new Error("malformed PBES2 format: "+me.message)}var se=ai.getDKFromPBES2Param($,H);return R.crypto.Cipher.decrypt($.enc,se,$.encalg,{iv:$.enciv})},getKeyFromEncryptedPKCS8PEM:function(k,H){var G=this.getPlainHexFromEncryptedPKCS8PEM(k,H),$=this.getKeyFromPlainPrivatePKCS8Hex(G);return $},parsePlainPrivatePKCS8Hex:function(k){var H=Ze,G=H.getChildIdx,$=H.getV,se={};if(se.algparam=null,k.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var me=G(k,0);if(me.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(k.substr(me[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var fe=G(k,me[1]);if(fe.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(k.substr(fe[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(se.algoid=$(k,fe[0]),k.substr(fe[1],2)=="06"&&(se.algparam=$(k,fe[1])),k.substr(me[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return se.keyidx=H.getVidx(k,me[2]),se},getKeyFromPlainPrivatePKCS8PEM:function(k){var H=Bi(k,"PRIVATE KEY"),G=this.getKeyFromPlainPrivatePKCS8Hex(H);return G},getKeyFromPlainPrivatePKCS8Hex:function(k){var H=this.parsePlainPrivatePKCS8Hex(k),G;if(H.algoid=="2a864886f70d010101")G=new Gt;else if(H.algoid=="2a8648ce380401")G=new R.crypto.DSA;else if(H.algoid=="2a8648ce3d0201")G=new R.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return G.readPKCS8PrvKeyHex(k),G},_getKeyFromPublicPKCS8Hex:function(k){var H,G=Ze.getVbyList(k,0,[0,0],"06");if(G==="2a864886f70d010101")H=new Gt;else if(G==="2a8648ce380401")H=new R.crypto.DSA;else if(G==="2a8648ce3d0201")H=new R.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return H.readPKCS8PubKeyHex(k),H},parsePublicRawRSAKeyHex:function(k){var H=Ze,G=H.getChildIdx,$=H.getV,se={};if(k.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var me=G(k,0);if(me.length!=2)throw new Error("malformed RSA key(code:002)");if(k.substr(me[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(se.n=$(k,me[0]),k.substr(me[1],2)!="02")throw new Error("malformed RSA key(code:004)");return se.e=$(k,me[1]),se},parsePublicPKCS8Hex:function(k){var H=Ze,G=H.getChildIdx,$=H.getV,se={};se.algparam=null;var me=G(k,0);if(me.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+me.length);var fe=me[0];if(k.substr(fe,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var _e=G(k,fe);if(_e.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(k.substr(_e[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(se.algoid=$(k,_e[0]),k.substr(_e[1],2)=="06"?se.algparam=$(k,_e[1]):k.substr(_e[1],2)=="30"&&(se.algparam={},se.algparam.p=H.getVbyList(k,_e[1],[0],"02"),se.algparam.q=H.getVbyList(k,_e[1],[1],"02"),se.algparam.g=H.getVbyList(k,_e[1],[2],"02")),k.substr(me[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return se.key=$(k,me[1]).substr(2),se}}}();ai.getKey=function(a,d,u){var _=Ze,T=_.getChildIdx;_.getV;var E=_.getVbyList,L=R.crypto,I=L.ECDSA,V=L.DSA,O=Gt,W=Bi,z=ai;if(typeof O<"u"&&a instanceof O||typeof I<"u"&&a instanceof I||typeof V<"u"&&a instanceof V)return a;if(a.curve!==void 0&&a.xy!==void 0&&a.d===void 0)return new I({pub:a.xy,curve:a.curve});if(a.curve!==void 0&&a.d!==void 0)return new I({prv:a.d,curve:a.curve});if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d===void 0){var D=new O;return D.setPublic(a.n,a.e),D}if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p!==void 0&&a.q!==void 0&&a.dp!==void 0&&a.dq!==void 0&&a.co!==void 0&&a.qi===void 0){var D=new O;return D.setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),D}if(a.kty===void 0&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p===void 0){var D=new O;return D.setPrivate(a.n,a.e,a.d),D}if(a.p!==void 0&&a.q!==void 0&&a.g!==void 0&&a.y!==void 0&&a.x===void 0){var D=new V;return D.setPublic(a.p,a.q,a.g,a.y),D}if(a.p!==void 0&&a.q!==void 0&&a.g!==void 0&&a.y!==void 0&&a.x!==void 0){var D=new V;return D.setPrivate(a.p,a.q,a.g,a.y,a.x),D}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d===void 0){var D=new O;return D.setPublic(Ri(a.n),Ri(a.e)),D}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0&&a.p!==void 0&&a.q!==void 0&&a.dp!==void 0&&a.dq!==void 0&&a.qi!==void 0){var D=new O;return D.setPrivateEx(Ri(a.n),Ri(a.e),Ri(a.d),Ri(a.p),Ri(a.q),Ri(a.dp),Ri(a.dq),Ri(a.qi)),D}if(a.kty==="RSA"&&a.n!==void 0&&a.e!==void 0&&a.d!==void 0){var D=new O;return D.setPrivate(Ri(a.n),Ri(a.e),Ri(a.d)),D}if(a.kty==="EC"&&a.crv!==void 0&&a.x!==void 0&&a.y!==void 0&&a.d===void 0){var U=new I({curve:a.crv}),k=U.ecparams.keycharlen,H=("0000000000"+Ri(a.x)).slice(-k),G=("0000000000"+Ri(a.y)).slice(-k),$="04"+H+G;return U.setPublicKeyHex($),U}if(a.kty==="EC"&&a.crv!==void 0&&a.x!==void 0&&a.y!==void 0&&a.d!==void 0){var U=new I({curve:a.crv}),k=U.ecparams.keycharlen,H=("0000000000"+Ri(a.x)).slice(-k),G=("0000000000"+Ri(a.y)).slice(-k),$="04"+H+G,se=("0000000000"+Ri(a.d)).slice(-k);return U.setPublicKeyHex($),U.setPrivateKeyHex(se),U}if(u==="pkcs5prv"){var me=a,_=Ze,fe,D;if(fe=T(me,0),fe.length===9)D=new O,D.readPKCS5PrvKeyHex(me);else if(fe.length===6)D=new V,D.readPKCS5PrvKeyHex(me);else if(fe.length>2&&me.substr(fe[1],2)==="04")D=new I,D.readPKCS5PrvKeyHex(me);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return D}if(u==="pkcs8prv"){var D=z.getKeyFromPlainPrivatePKCS8Hex(a);return D}if(u==="pkcs8pub")return z._getKeyFromPublicPKCS8Hex(a);if(u==="x509pub")return jt.getPublicKeyFromCertHex(a);if(a.indexOf("-END CERTIFICATE-",0)!=-1||a.indexOf("-END X509 CERTIFICATE-",0)!=-1||a.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return jt.getPublicKeyFromCertPEM(a);if(a.indexOf("-END PUBLIC KEY-")!=-1){var _e=Bi(a,"PUBLIC KEY");return z._getKeyFromPublicPKCS8Hex(_e)}if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var Z=W(a,"RSA PRIVATE KEY");return z.getKey(Z,null,"pkcs5prv")}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var J=W(a,"DSA PRIVATE KEY"),ee=E(J,0,[1],"02"),Y=E(J,0,[2],"02"),re=E(J,0,[3],"02"),ve=E(J,0,[4],"02"),Se=E(J,0,[5],"02"),D=new V;return D.setPrivate(new f(ee,16),new f(Y,16),new f(re,16),new f(ve,16),new f(Se,16)),D}if(a.indexOf("-END EC PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var Z=W(a,"EC PRIVATE KEY");return z.getKey(Z,null,"pkcs5prv")}if(a.indexOf("-END PRIVATE KEY-")!=-1)return z.getKeyFromPlainPrivatePKCS8PEM(a);if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var ze=z.getDecryptedKeyHex(a,d),be=new Gt;return be.readPKCS5PrvKeyHex(ze),be}if(a.indexOf("-END EC PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var J=z.getDecryptedKeyHex(a,d),D=E(J,0,[1],"04"),Re=E(J,0,[2,0],"06"),Ge=E(J,0,[3,0],"03").substr(2),We="";if(R.crypto.OID.oidhex2name[Re]!==void 0)We=R.crypto.OID.oidhex2name[Re];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Re);var U=new I({curve:We});return U.setPublicKeyHex(Ge),U.setPrivateKeyHex(D),U.isPublic=!1,U}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var J=z.getDecryptedKeyHex(a,d),ee=E(J,0,[1],"02"),Y=E(J,0,[2],"02"),re=E(J,0,[3],"02"),ve=E(J,0,[4],"02"),Se=E(J,0,[5],"02"),D=new V;return D.setPrivate(new f(ee,16),new f(Y,16),new f(re,16),new f(ve,16),new f(Se,16)),D}if(a.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return z.getKeyFromEncryptedPKCS8PEM(a,d);throw new Error("not supported argument")},ai.generateKeypair=function(a,d){if(a=="RSA"){var u=d,_=new Gt;_.generate(u,"10001"),_.isPrivate=!0,_.isPublic=!0;var T=new Gt,E=_.n.toString(16),L=_.e.toString(16);T.setPublic(E,L),T.isPrivate=!1,T.isPublic=!0;var I={};return I.prvKeyObj=_,I.pubKeyObj=T,I}else if(a=="EC"){var V=d,O=new R.crypto.ECDSA({curve:V}),W=O.generateKeyPairHex(),_=new R.crypto.ECDSA({curve:V});_.setPublicKeyHex(W.ecpubhex),_.setPrivateKeyHex(W.ecprvhex),_.isPrivate=!0,_.isPublic=!1;var T=new R.crypto.ECDSA({curve:V});T.setPublicKeyHex(W.ecpubhex),T.isPrivate=!1,T.isPublic=!0;var I={};return I.prvKeyObj=_,I.pubKeyObj=T,I}else throw new Error("unknown algorithm: "+a)},ai.getPEM=function(a,d,u,_,T,E){var L=R,I=L.asn1,V=I.DERObjectIdentifier,O=I.DERInteger,W=I.ASN1Util.newObject,z=I.x509,D=z.SubjectPublicKeyInfo,U=L.crypto,k=U.DSA,H=U.ECDSA,G=Gt;function $(Re){var Ge=W({seq:[{int:0},{int:{bigint:Re.n}},{int:Re.e},{int:{bigint:Re.d}},{int:{bigint:Re.p}},{int:{bigint:Re.q}},{int:{bigint:Re.dmp1}},{int:{bigint:Re.dmq1}},{int:{bigint:Re.coeff}}]});return Ge}function se(Re){var Ge=W({seq:[{int:1},{octstr:{hex:Re.prvKeyHex}},{tag:["a0",!0,{oid:{name:Re.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+Re.pubKeyHex}}]}]});return Ge}function me(Re){var Ge=W({seq:[{int:0},{int:{bigint:Re.p}},{int:{bigint:Re.q}},{int:{bigint:Re.g}},{int:{bigint:Re.y}},{int:{bigint:Re.x}}]});return Ge}if((G!==void 0&&a instanceof G||k!==void 0&&a instanceof k||H!==void 0&&a instanceof H)&&a.isPublic==!0&&(d===void 0||d=="PKCS8PUB")){var fe=new D(a),_e=fe.tohex();return fn(_e,"PUBLIC KEY")}if(d=="PKCS1PRV"&&G!==void 0&&a instanceof G&&(u===void 0||u==null)&&a.isPrivate==!0){var fe=$(a),_e=fe.tohex();return fn(_e,"RSA PRIVATE KEY")}if(d=="PKCS1PRV"&&H!==void 0&&a instanceof H&&(u===void 0||u==null)&&a.isPrivate==!0){var Z=new V({name:a.curveName}),J=Z.tohex(),ee=se(a),Y=ee.tohex(),re="";return re+=fn(J,"EC PARAMETERS"),re+=fn(Y,"EC PRIVATE KEY"),re}if(d=="PKCS1PRV"&&k!==void 0&&a instanceof k&&(u===void 0||u==null)&&a.isPrivate==!0){var fe=me(a),_e=fe.tohex();return fn(_e,"DSA PRIVATE KEY")}if(d=="PKCS5PRV"&&G!==void 0&&a instanceof G&&u!==void 0&&u!=null&&a.isPrivate==!0){var fe=$(a),_e=fe.tohex();return _===void 0&&(_="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",_e,u,_,E)}if(d=="PKCS5PRV"&&H!==void 0&&a instanceof H&&u!==void 0&&u!=null&&a.isPrivate==!0){var fe=se(a),_e=fe.tohex();return _===void 0&&(_="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",_e,u,_,E)}if(d=="PKCS5PRV"&&k!==void 0&&a instanceof k&&u!==void 0&&u!=null&&a.isPrivate==!0){var fe=me(a),_e=fe.tohex();return _===void 0&&(_="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",_e,u,_,E)}var ve=function(Re,Ge){if(typeof Ge=="string")return ai.getEncryptedPKCS8PEM(Re,Ge);if(typeof Ge=="object"&&Si(Ge,"passcode")!=null){var We=JSON.parse(JSON.stringify(Ge)),mn=We.passcode;return delete We.passcode,ai.getEncryptedPKCS8PEM(Re,mn,We)}};if(d=="PKCS8PRV"&&G!=null&&a instanceof G&&a.isPrivate==!0){var Se=$(a),ze=Se.tohex(),fe=W({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:ze}}]}),_e=fe.tohex();return u===void 0||u==null?fn(_e,"PRIVATE KEY"):ve(_e,u)}if(d=="PKCS8PRV"&&H!==void 0&&a instanceof H&&a.isPrivate==!0){var be={seq:[{int:1},{octstr:{hex:a.prvKeyHex}}]};typeof a.pubKeyHex=="string"&&be.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]});var Se=new W(be),ze=Se.tohex(),fe=W({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:a.curveName}}]},{octstr:{hex:ze}}]}),_e=fe.tohex();return u===void 0||u==null?fn(_e,"PRIVATE KEY"):ve(_e,u)}if(d=="PKCS8PRV"&&k!==void 0&&a instanceof k&&a.isPrivate==!0){var Se=new O({bigint:a.x}),ze=Se.tohex(),fe=W({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}}]}]},{octstr:{hex:ze}}]}),_e=fe.tohex();return u===void 0||u==null?fn(_e,"PRIVATE KEY"):ve(_e,u)}throw new Error("unsupported object nor format")},ai.getKeyFromCSRPEM=function(a){var d=Bi(a,"CERTIFICATE REQUEST"),u=ai.getKeyFromCSRHex(d);return u},ai.getKeyFromCSRHex=function(a){var d=ai.parseCSRHex(a),u=ai.getKey(d.p8pubkeyhex,null,"pkcs8pub");return u},ai.parseCSRHex=function(a){var d=Ze,u=d.getChildIdx,_=d.getTLV,T={},E=a;if(E.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var L=u(E,0);if(L.length<1)throw new Error("malformed CSR(code:002)");if(E.substr(L[0],2)!="30")throw new Error("malformed CSR(code:003)");var I=u(E,L[0]);if(I.length<3)throw new Error("malformed CSR(code:004)");return T.p8pubkeyhex=_(E,I[2]),T},ai.getKeyID=function(a){var d=ai,u=Ze;typeof a=="string"&&a.indexOf("BEGIN ")!=-1&&(a=d.getKey(a));var _=Bi(d.getPEM(a)),T=u.getIdxbyList(_,0,[1]),E=u.getV(_,T).substring(2);return R.crypto.Util.hashHex(E,"sha1")},ai.getJWK=function(a,d,u,_,T){var E,L={},I,V=R.crypto.Util.hashHex;if(typeof a=="string")E=ai.getKey(a),a.indexOf("CERTIFICATE")!=-1&&(I=Bi(a));else if(typeof a=="object")a instanceof jt?(E=a.getPublicKey(),I=a.hex):E=a;else throw new Error("unsupported keyinfo type");if(E instanceof Gt&&E.isPrivate)L.kty="RSA",L.n=Zi(E.n.toString(16)),L.e=Zi(E.e.toString(16)),L.d=Zi(E.d.toString(16)),L.p=Zi(E.p.toString(16)),L.q=Zi(E.q.toString(16)),L.dp=Zi(E.dmp1.toString(16)),L.dq=Zi(E.dmq1.toString(16)),L.qi=Zi(E.coeff.toString(16));else if(E instanceof Gt&&E.isPublic)L.kty="RSA",L.n=Zi(E.n.toString(16)),L.e=Zi(E.e.toString(16));else if(E instanceof R.crypto.ECDSA&&E.isPrivate){var O=E.getShortNISTPCurveName();if(O!=="P-256"&&O!=="P-384"&&O!=="P-521")throw new Error("unsupported curve name for JWT: "+O);var W=E.getPublicKeyXYHex();L.kty="EC",L.crv=O,L.x=Zi(W.x),L.y=Zi(W.y),L.d=Zi(E.prvKeyHex)}else if(E instanceof R.crypto.ECDSA&&E.isPublic){var O=E.getShortNISTPCurveName();if(O!=="P-256"&&O!=="P-384"&&O!=="P-521")throw new Error("unsupported curve name for JWT: "+O);var W=E.getPublicKeyXYHex();L.kty="EC",L.crv=O,L.x=Zi(W.x),L.y=Zi(W.y)}if(L.kty==null)throw new Error("unsupported keyinfo");return!E.isPrivate&&d!=!0&&(L.kid=R.jws.JWS.getJWKthumbprint(L)),I!=null&&u!=!0&&(L.x5c=[h(I)]),I!=null&&_!=!0&&(L.x5t=ya(h(V(I,"sha1")))),I!=null&&T!=!0&&(L["x5t#S256"]=ya(h(V(I,"sha256")))),L},ai.getJWKFromKey=function(a){return ai.getJWK(a,!0,!0,!0,!0)},Gt.getPosArrayOfChildrenFromHex=function(a){return Ze.getChildIdx(a,0)},Gt.getHexValueArrayOfChildrenFromHex=function(a){var d=Ze,u=d.getV,D=Gt.getPosArrayOfChildrenFromHex(a),_=u(a,D[0]),T=u(a,D[1]),E=u(a,D[2]),L=u(a,D[3]),I=u(a,D[4]),V=u(a,D[5]),O=u(a,D[6]),W=u(a,D[7]),z=u(a,D[8]),D=new Array;return D.push(_,T,E,L,I,V,O,W,z),D},Gt.prototype.readPrivateKeyFromPEMString=function(a){var d=Bi(a),u=Gt.getHexValueArrayOfChildrenFromHex(d);this.setPrivateEx(u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},Gt.prototype.readPKCS5PrvKeyHex=function(a){var d=Gt.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},Gt.prototype.readPKCS8PrvKeyHex=function(a){var d,u,_,T,E,L,I,V,O=Ze,W=O.getVbyListEx;if(O.isASN1HEX(a)===!1)throw new Error("not ASN.1 hex string");try{d=W(a,0,[2,0,1],"02"),u=W(a,0,[2,0,2],"02"),_=W(a,0,[2,0,3],"02"),T=W(a,0,[2,0,4],"02"),E=W(a,0,[2,0,5],"02"),L=W(a,0,[2,0,6],"02"),I=W(a,0,[2,0,7],"02"),V=W(a,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(d,u,_,T,E,L,I,V)},Gt.prototype.readPKCS5PubKeyHex=function(a){var d=Ze,u=d.getV;if(d.isASN1HEX(a)===!1)throw new Error("keyHex is not ASN.1 hex string");var _=d.getChildIdx(a,0);if(_.length!==2||a.substr(_[0],2)!=="02"||a.substr(_[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var T=u(a,_[0]),E=u(a,_[1]);this.setPublic(T,E)},Gt.prototype.readPKCS8PubKeyHex=function(a){var d=Ze;if(d.isASN1HEX(a)===!1)throw new Error("not ASN.1 hex string");if(d.getTLVbyListEx(a,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var u=d.getTLVbyListEx(a,0,[1,0]);this.readPKCS5PubKeyHex(u)},Gt.prototype.readCertPubKeyHex=function(a,d){var u,_;u=new jt,u.readCertHex(a),_=u.getPublicKeyHex(),this.readPKCS8PubKeyHex(_)};function yh(a,d){for(var u="",_=d/4-a.length,T=0;T<_;T++)u=u+"0";return u+a}Gt.prototype.sign=function(a,d){var u=function(T){return R.crypto.Util.hashString(T,d)},_=u(a);return this.signWithMessageHash(_,d)},Gt.prototype.signWithMessageHash=function(a,d){var u=R.crypto.Util.getPaddedDigestInfoHex(a,d,this.n.bitLength()),_=Fn(u,16),T=this.doPrivate(_),E=T.toString(16);return yh(E,this.n.bitLength())};function Sh(a,d,u){for(var _="",T=0;_.length<d;)_+=Nn(u(Hr(a+String.fromCharCode.apply(String,[(T&4278190080)>>24,(T&16711680)>>16,(T&65280)>>8,T&255])))),T+=1;return _}Gt.prototype.signPSS=function(a,d,u){var _=function(E){return R.crypto.Util.hashHex(E,d)},T=_(Hr(a));return u===void 0&&(u=-1),this.signWithMessageHashPSS(T,d,u)},Gt.prototype.signWithMessageHashPSS=function(a,d,u){var _=Nn(a),T=_.length,E=this.n.bitLength()-1,L=Math.ceil(E/8),I,V=function(G){return R.crypto.Util.hashHex(G,d)};if(u===-1||u===void 0)u=T;else if(u===-2)u=L-T-2;else if(u<-2)throw new Error("invalid salt length");if(L<T+u+2)throw new Error("data too long");var O="";u>0&&(O=new Array(u),new ba().nextBytes(O),O=String.fromCharCode.apply(String,O));var W=Nn(V(Hr("\0\0\0\0\0\0\0\0"+_+O))),z=[];for(I=0;I<L-u-T-2;I+=1)z[I]=0;var D=String.fromCharCode.apply(String,z)+""+O,U=Sh(W,D.length,V),k=[];for(I=0;I<D.length;I+=1)k[I]=D.charCodeAt(I)^U.charCodeAt(I);var H=65280>>8*L-E&255;for(k[0]&=~H,I=0;I<T;I++)k.push(W.charCodeAt(I));return k.push(188),yh(this.doPrivate(new f(k)).toString(16),this.n.bitLength())};function wh(a){for(var d in R.crypto.Util.DIGESTINFOHEAD){var u=R.crypto.Util.DIGESTINFOHEAD[d],_=u.length;if(a.substring(0,_)==u){var T=[d,a.substring(_)];return T}}return[]}Gt.prototype.verify=function(a,d){if(d=d.toLowerCase(),d.match(/^[0-9a-f]+$/)==null)return!1;var u=Fn(d,16),_=this.n.bitLength();if(u.bitLength()>_)return!1;var T=this.doPublic(u),E=T.toString(16);if(E.length+3!=_/4)return!1;var L=E.replace(/^1f+00/,""),I=wh(L);if(I.length==0)return!1;var V=I[0],O=I[1],W=function(D){return R.crypto.Util.hashString(D,V)},z=W(a);return O==z},Gt.prototype.verifyWithMessageHash=function(a,d){if(d.length!=Math.ceil(this.n.bitLength()/4))return!1;var u=Fn(d,16);if(u.bitLength()>this.n.bitLength())return 0;var _=this.doPublic(u),T=_.toString(16).replace(/^1f+00/,""),E=wh(T);if(E.length==0)return!1;E[0];var L=E[1];return L==a},Gt.prototype.verifyPSS=function(a,d,u,_){var T=function(L){return R.crypto.Util.hashHex(L,u)},E=T(Hr(a));return _===void 0&&(_=-1),this.verifyWithMessageHashPSS(E,d,u,_)},Gt.prototype.verifyWithMessageHashPSS=function(a,d,u,_){if(d.length!=Math.ceil(this.n.bitLength()/4))return!1;var T=new f(d,16),E=function(se){return R.crypto.Util.hashHex(se,u)},L=Nn(a),I=L.length,V=this.n.bitLength()-1,O=Math.ceil(V/8),W;if(_===-1||_===void 0)_=I;else if(_===-2)_=O-I-2;else if(_<-2)throw new Error("invalid salt length");if(O<I+_+2)throw new Error("data too long");var z=this.doPublic(T).toByteArray();for(W=0;W<z.length;W+=1)z[W]&=255;for(;z.length<O;)z.unshift(0);if(z[O-1]!==188)throw new Error("encoded message does not end in 0xbc");z=String.fromCharCode.apply(String,z);var D=z.substr(0,O-I-1),U=z.substr(D.length,I),k=65280>>8*O-V&255;if((D.charCodeAt(0)&k)!==0)throw new Error("bits beyond keysize not zero");var H=Sh(U,D.length,E),G=[];for(W=0;W<D.length;W+=1)G[W]=D.charCodeAt(W)^H.charCodeAt(W);G[0]&=~k;var $=O-I-_-2;for(W=0;W<$;W+=1)if(G[W]!==0)throw new Error("leftmost octets not zero");if(G[$]!==1)throw new Error("0x01 marker not found");return U===Nn(E(Hr("\0\0\0\0\0\0\0\0"+L+String.fromCharCode.apply(String,G.slice(-_)))))},Gt.SALT_LEN_HLEN=-1,Gt.SALT_LEN_MAX=-2,Gt.SALT_LEN_RECOVER=-2;function jt(a){var d=Ze,u=d.getChildIdx,_=d.getV;d.dump;var T=d.parse,E=d.getTLV,L=d.getVbyList,I=d.getVbyListEx,V=d.getTLVbyList,O=d.getTLVbyListEx,W=d.getIdxbyList,z=d.getIdxbyListEx,D=d.getVidx,U=d.getInt,k=d.oidname,H=d.hextooidstr,G=Bi,$,se=Error;try{$=R.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var Z=V(this.hex,0,[0,0]);if(Z.substr(0,2)=="a0"){var J=V(Z,0,[0]),ee=U(J,0);if(ee<0||2<ee)throw new Error("malformed version field");return this.version=ee+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return I(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var Z=O(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(Z)},this.getAlgorithmIdentifierName=function(Z){for(var J in $)if(Z===$[J])return J;return k(I(Z,0,[0],"06"))},this.getIssuer=function(Z,J){return this.getX500Name(this.getIssuerHex(),Z,J)},this.getIssuerHex=function(){return V(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var Z=this.getIssuer();return Z.str},this.getSubject=function(Z,J){return this.getX500Name(this.getSubjectHex(),Z,J)},this.getSubjectHex=function(){return V(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var Z=this.getSubject();return Z.str},this.getNotBefore=function(){var Z=L(this.hex,0,[0,4+this.foffset,0]);return Z=Z.replace(/(..)/g,"%$1"),Z=decodeURIComponent(Z),Z},this.getNotAfter=function(){var Z=L(this.hex,0,[0,4+this.foffset,1]);return Z=Z.replace(/(..)/g,"%$1"),Z=decodeURIComponent(Z),Z},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return V(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var Z=this.getSPKI();return Z==null?null:L(Z,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return W(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var Z=this.getPublicKeyIdx();return W(this.hex,Z,[1,0],"30")},this.getPublicKey=function(){return ai.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var Z=V(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(Z)},this.getSignatureValueHex=function(){return L(this.hex,0,[2],"03",!0)},this.verifySignature=function(Z){var J=this.getSignatureAlgorithmField(),ee=this.getSignatureValueHex(),Y=V(this.hex,0,[0],"30"),re=new R.crypto.Signature({alg:J});return re.init(Z),re.updateHex(Y),re.verify(ee)},this.parseExt=function(Z){var J,ee,Y;if(Z===void 0){if(Y=this.hex,this.version!==3)return-1;J=W(Y,0,[0,7,0],"30"),ee=u(Y,J)}else{Y=Bi(Z);var re=W(Y,0,[0,3,0,0],"06");if(_(Y,re)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}J=W(Y,0,[0,3,0,1,0],"30"),ee=u(Y,J),this.hex=Y}this.aExtInfo=new Array;for(var ve=0;ve<ee.length;ve++){var Se={};Se.critical=!1;var ze=u(Y,ee[ve]),be=0;ze.length===3&&(Se.critical=!0,be=1),Se.oid=d.hextooidstr(L(Y,ee[ve],[0],"06"));var Re=W(Y,ee[ve],[1+be]);Se.vidx=D(Y,Re),this.aExtInfo.push(Se)}},this.getExtInfo=function(Z){var J=this.aExtInfo,ee=Z;if(Z.match(/^[0-9.]+$/)||(ee=R.asn1.x509.OID.name2oid(Z)),ee!==""){for(var Y=0;Y<J.length;Y++)if(J[Y].oid===ee)return J[Y]}},this.getCriticalExtV=function(Z,J,ee){if(J!=null)return[J,ee];var Y=this.getExtInfo(Z);return Y==null?[null,null]:[E(this.hex,Y.vidx),Y.critical]},this.getExtBasicConstraints=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("basicConstraints");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"basicConstraints"};if(J&&(Y.critical=!0),Z==="3000")return Y;if(Z==="30030101ff")return Y.cA=!0,Y;if(Z.substr(0,12)==="30060101ff02"){var re=_(Z,10),ve=parseInt(re,16);return Y.cA=!0,Y.pathLen=ve,Y}throw new Error("hExtV parse error: "+Z)},this.getExtNameConstraints=function(Z,J){var ee=this.getCriticalExtV("nameConstraints",Z,J);if(Z=ee[0],J=ee[1],Z!=null){var Y={extname:"nameConstraints"};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++){for(var Se=[],ze=u(Z,re[ve]),be=0;be<ze.length;be++){var Re=E(Z,ze[be]),Ge=this.getGeneralSubtree(Re);Se.push(Ge)}var We=Z.substr(re[ve],2);We=="a0"?Y.permit=Se:We=="a1"&&(Y.exclude=Se)}return Y}},this.getGeneralSubtree=function(Z){var J=u(Z,0),ee=J.length;if(ee<1||2<ee)throw new Error("wrong num elements");for(var Y=this.getGeneralName(E(Z,J[0])),re=1;re<ee;re++){var ve=Z.substr(J[re],2),Se=_(Z,J[re]),ze=parseInt(Se,16);ve=="80"&&(Y.min=ze),ve=="81"&&(Y.max=ze)}return Y},this.getExtKeyUsage=function(Z,J){var ee=this.getCriticalExtV("keyUsage",Z,J);if(Z=ee[0],J=ee[1],Z!=null){var Y={extname:"keyUsage"};return J&&(Y.critical=!0),Y.names=this.getExtKeyUsageString(Z).split(","),Y}},this.getExtKeyUsageBin=function(Z){if(Z===void 0){var J=this.getExtInfo("keyUsage");if(J===void 0)return"";Z=E(this.hex,J.vidx)}if(Z.length!=8&&Z.length!=10)throw new Error("malformed key usage value: "+Z);var ee="000000000000000"+parseInt(Z.substr(6),16).toString(2);return Z.length==8&&(ee=ee.slice(-8)),Z.length==10&&(ee=ee.slice(-16)),ee=ee.replace(/0+$/,""),ee==""&&(ee="0"),ee},this.getExtKeyUsageString=function(Z){for(var J=this.getExtKeyUsageBin(Z),ee=new Array,Y=0;Y<J.length;Y++)J.substr(Y,1)=="1"&&ee.push(jt.KEYUSAGE_NAME[Y]);return ee.join(",")},this.getExtSubjectKeyIdentifier=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("subjectKeyIdentifier");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"subjectKeyIdentifier"};J&&(Y.critical=!0);var re=_(Z,0);return Y.kid={hex:re},Y},this.getExtAuthorityKeyIdentifier=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("authorityKeyIdentifier");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"authorityKeyIdentifier"};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++){var Se=Z.substr(re[ve],2);if(Se==="80"&&(Y.kid={hex:_(Z,re[ve])}),Se==="a1"){var ze=E(Z,re[ve]),be=this.getGeneralNames(ze);Y.issuer=be[0].dn}Se==="82"&&(Y.sn={hex:_(Z,re[ve])})}return Y},this.getExtExtKeyUsage=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("extKeyUsage");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"extKeyUsage",array:[]};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++)Y.array.push(k(_(Z,re[ve])));return Y},this.getExtExtKeyUsageName=function(){var Z=this.getExtInfo("extKeyUsage");if(Z===void 0)return Z;var J=new Array,ee=E(this.hex,Z.vidx);if(ee==="")return J;for(var Y=u(ee,0),re=0;re<Y.length;re++)J.push(k(_(ee,Y[re])));return J},this.getExtSubjectAltName=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("subjectAltName");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"subjectAltName",array:[]};return J&&(Y.critical=!0),Y.array=this.getGeneralNames(Z),Y},this.getExtIssuerAltName=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("issuerAltName");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"issuerAltName",array:[]};return J&&(Y.critical=!0),Y.array=this.getGeneralNames(Z),Y},this.getGeneralNames=function(Z){for(var J=u(Z,0),ee=[],Y=0;Y<J.length;Y++){var re=this.getGeneralName(E(Z,J[Y]));re!==void 0&&ee.push(re)}return ee},this.getGeneralName=function(Z){var J=Z.substr(0,2),ee=_(Z,0),Y=Nn(ee);if(J=="81")return{rfc822:Y};if(J=="82")return{dns:Y};if(J=="86")return{uri:Y};if(J=="87")return{ip:mc(ee)};if(J=="a4")return{dn:this.getX500Name(ee)};if(J=="a0")return{other:this.getOtherName(Z)}},this.getExtSubjectAltName2=function(){var Z,J,ee,Y=this.getExtInfo("subjectAltName");if(Y===void 0)return Y;for(var re=new Array,ve=E(this.hex,Y.vidx),Se=u(ve,0),ze=0;ze<Se.length;ze++)ee=ve.substr(Se[ze],2),Z=_(ve,Se[ze]),ee==="81"&&(J=gi(Z),re.push(["MAIL",J])),ee==="82"&&(J=gi(Z),re.push(["DNS",J])),ee==="84"&&(J=jt.hex2dn(Z,0),re.push(["DN",J])),ee==="86"&&(J=gi(Z),re.push(["URI",J])),ee==="87"&&(J=mc(Z),re.push(["IP",J]));return re},this.getExtCRLDistributionPoints=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("cRLDistributionPoints");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"cRLDistributionPoints",array:[]};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++){var Se=E(Z,re[ve]);Y.array.push(this.getDistributionPoint(Se))}return Y},this.getDistributionPoint=function(Z){for(var J={},ee=u(Z,0),Y=0;Y<ee.length;Y++){var re=Z.substr(ee[Y],2),ve=E(Z,ee[Y]);re=="a0"&&(J.dpname=this.getDistributionPointName(ve))}return J},this.getDistributionPointName=function(Z){for(var J={},ee=u(Z,0),Y=0;Y<ee.length;Y++){var re=Z.substr(ee[Y],2),ve=E(Z,ee[Y]);re=="a0"&&(J.full=this.getGeneralNames(ve))}return J},this.getExtCRLDistributionPointsURI=function(){var Z=this.getExtCRLDistributionPoints();if(Z==null)return Z;for(var J=Z.array,ee=[],Y=0;Y<J.length;Y++)try{J[Y].dpname.full[0].uri!=null&&ee.push(J[Y].dpname.full[0].uri)}catch{}return ee},this.getExtAIAInfo=function(){var Z=this.getExtInfo("authorityInfoAccess");if(Z===void 0)return Z;for(var J={ocsp:[],caissuer:[]},ee=u(this.hex,Z.vidx),Y=0;Y<ee.length;Y++){var re=L(this.hex,ee[Y],[0],"06"),ve=L(this.hex,ee[Y],[1],"86");re==="2b06010505073001"&&J.ocsp.push(gi(ve)),re==="2b06010505073002"&&J.caissuer.push(gi(ve))}return J},this.getExtAuthorityInfoAccess=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("authorityInfoAccess");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"authorityInfoAccess",array:[]};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++){var Se=I(Z,re[ve],[0],"06"),ze=L(Z,re[ve],[1],"86"),be=gi(ze);if(Se=="2b06010505073001")Y.array.push({ocsp:be});else if(Se=="2b06010505073002")Y.array.push({caissuer:be});else throw new Error("unknown method: "+Se)}return Y},this.getExtCertificatePolicies=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("certificatePolicies");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"certificatePolicies",array:[]};J&&(Y.critical=!0);for(var re=u(Z,0),ve=0;ve<re.length;ve++){var Se=E(Z,re[ve]),ze=this.getPolicyInformation(Se);Y.array.push(ze)}return Y},this.getPolicyInformation=function(Z){var J={},ee=L(Z,0,[0],"06");J.policyoid=k(ee);var Y=z(Z,0,[1],"30");if(Y!=-1){J.array=[];for(var re=u(Z,Y),ve=0;ve<re.length;ve++){var Se=E(Z,re[ve]),ze=this.getPolicyQualifierInfo(Se);J.array.push(ze)}}return J},this.getOtherName=function(Z){var J={},ee=u(Z,0),Y=L(Z,ee[0],[],"06"),re=L(Z,ee[1],[]);return J.oid=k(Y),J.value=T(re),J},this.getPolicyQualifierInfo=function(Z){var J={},ee=L(Z,0,[0],"06");if(ee==="2b06010505070201"){var Y=I(Z,0,[1],"16");J.cps=Nn(Y)}else if(ee==="2b06010505070202"){var re=V(Z,0,[1],"30");J.unotice=this.getUserNotice(re)}return J},this.getUserNotice=function(Z){var J=null;try{J=d.parse(Z);var ee=this._asn1ToUnotice(J);return ee}catch{return}},this._asn1ToUnotice=function(Z){try{for(var J={},ee=Si(Z,"seq"),Y=0;Y<ee.length;Y++){var re=this._asn1ToNoticeRef(ee[Y]);re!=null&&(J.noticeref=re);var ve=this.asn1ToDisplayText(ee[Y]);ve!=null&&(J.exptext=ve)}return Object.keys(J).length>0?J:void 0}catch{return}},this._asn1ToNoticeRef=function(Z){try{for(var J={},ee=Si(Z,"seq"),Y=0;Y<ee.length;Y++){var re=this._asn1ToNoticeNum(ee[Y]);re!=null&&(J.noticenum=re);var ve=this.asn1ToDisplayText(ee[Y]);ve!=null&&(J.org=ve)}return Object.keys(J).length>0?J:void 0}catch{return}},this._asn1ToNoticeNum=function(Z){try{for(var J=Si(Z,"seq"),ee=[],Y=0;Y<J.length;Y++){var re=J[Y];ee.push(parseInt(Si(re,"int.hex"),16))}return ee}catch{return}},this.getDisplayText=function(Z){var J={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},ee={};return ee.type=J[Z.substr(0,2)],ee.str=Nn(_(Z,0)),ee},this.asn1ToDisplayText=function(Z){if(Z.utf8str!=null)return{type:"utf8",str:Z.utf8str.str};if(Z.ia5str!=null)return{type:"ia5",str:Z.ia5str.str};if(Z.visstr!=null)return{type:"vis",str:Z.visstr.str};if(Z.bmpstr!=null)return{type:"bmp",str:Z.bmpstr.str};if(Z.prnstr!=null)return{type:"prn",str:Z.prnstr.str}},this.getExtPolicyMappings=function(Z,J){var ee=this.getCriticalExtV("policyMappings",Z,J);if(Z=ee[0],J=ee[1],Z!=null){var Y={extname:"policyMappings"};J&&(Y.critical=!0);try{for(var re=T(Z),ve=re.seq,Se=[],ze=0;ze<ve.length;ze++){var be=ve[ze].seq;Se.push([be[0].oid,be[1].oid])}Y.array=Se}catch{throw new se("malformed policyMappings")}return Y}},this.getExtPolicyConstraints=function(Z,J){var ee=this.getCriticalExtV("policyConstraints",Z,J);if(Z=ee[0],J=ee[1],Z!=null){var Y={extname:"policyConstraints"};J&&(Y.critical=!0);var re=T(Z);try{for(var ve=re.seq,Se=0;Se<ve.length;Se++){var ze=ve[Se].tag;ze.explicit==!1&&(ze.tag=="80"&&(Y.reqexp=parseInt(ze.hex,16)),ze.tag=="81"&&(Y.inhibit=parseInt(ze.hex,16)))}}catch{return new se("malformed policyConstraints value")}return Y}},this.getExtInhibitAnyPolicy=function(Z,J){var ee=this.getCriticalExtV("inhibitAnyPolicy",Z,J);if(Z=ee[0],J=ee[1],Z!=null){var Y={extname:"inhibitAnyPolicy"};J&&(Y.critical=!0);var re=U(Z,0);return re==-1?new se("wrong value"):(Y.skip=re,Y)}},this.getExtCRLNumber=function(Z,J){var ee={extname:"cRLNumber"};if(J&&(ee.critical=!0),Z.substr(0,2)=="02")return ee.num={hex:_(Z,0)},ee;throw new se("hExtV parse error: "+Z)},this.getExtCRLReason=function(Z,J){var ee={extname:"cRLReason"};if(J&&(ee.critical=!0),Z.substr(0,2)=="0a")return ee.code=parseInt(_(Z,0),16),ee;throw new Error("hExtV parse error: "+Z)},this.getExtOcspNonce=function(Z,J){var ee={extname:"ocspNonce"};J&&(ee.critical=!0);var Y=_(Z,0);return ee.hex=Y,ee},this.getExtOcspNoCheck=function(Z,J){var ee={extname:"ocspNoCheck"};return J&&(ee.critical=!0),ee},this.getExtAdobeTimeStamp=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("adobeTimeStamp");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"adobeTimeStamp"};J&&(Y.critical=!0);var re=u(Z,0);if(re.length>1){var ve=E(Z,re[1]),Se=this.getGeneralName(ve);Se.uri!=null&&(Y.uri=Se.uri)}if(re.length>2){var ze=E(Z,re[2]);ze=="0101ff"&&(Y.reqauth=!0),ze=="010100"&&(Y.reqauth=!1)}return Y},this.getExtSubjectDirectoryAttributes=function(Z,J){if(Z===void 0&&J===void 0){var ee=this.getExtInfo("subjectDirectoryAttributes");if(ee===void 0)return;Z=E(this.hex,ee.vidx),J=ee.critical}var Y={extname:"subjectDirectoryAttributes"};J&&(Y.critical=!0);try{for(var re=T(Z),ve=[],Se=0;Se<re.seq.length;Se++){var ze=re.seq[Se],be=Si(ze,"seq.0.oid"),Re=Si(ze,"seq.1.set");if(be==null||Re==null)throw"error";ve.push({attr:be,array:Re})}return Y.array=ve,Y}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var me=function(Z){var J={};try{var ee=Z.seq[0].oid,Y=R.asn1.x509.OID.name2oid(ee);J.type=R.asn1.x509.OID.oid2atype(Y);var re=Z.seq[1];if(re.utf8str!=null)J.ds="utf8",J.value=re.utf8str.str;else if(re.numstr!=null)J.ds="num",J.value=re.numstr.str;else if(re.telstr!=null)J.ds="tel",J.value=re.telstr.str;else if(re.prnstr!=null)J.ds="prn",J.value=re.prnstr.str;else if(re.ia5str!=null)J.ds="ia5",J.value=re.ia5str.str;else if(re.visstr!=null)J.ds="vis",J.value=re.visstr.str;else if(re.bmpstr!=null)J.ds="bmp",J.value=re.bmpstr.str;else throw"error";return J}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},fe=function(Z){try{return Z.set.map(function(J){return me(J)})}catch(J){throw new Error("improper ASN.1 parsed RDN: "+J)}},_e=function(Z){try{return Z.seq.map(function(J){return fe(J)})}catch(J){throw new Error("improper ASN.1 parsed X500Name: "+J)}};this.getX500NameRule=function(Z){for(var J=null,ee=[],Y=0;Y<Z.length;Y++)for(var re=Z[Y],ve=0;ve<re.length;ve++)ee.push(re[ve]);for(var Y=0;Y<ee.length;Y++){var Se=ee[Y],ze=Se.ds,be=Se.value,Re=Se.type;if(ze!="prn"&&ze!="utf8"&&ze!="ia5")return"mixed";if(ze=="ia5"){if(Re!="CN")return"mixed";if(R.lang.String.isMail(be))continue;return"mixed"}if(Re=="C"){if(ze=="prn")continue;return"mixed"}if(J==null)J=ze;else if(J!==ze)return"mixed"}return J??"prn"},this.getAttrTypeAndValue=function(Z){var J=T(Z);return me(J)},this.getRDN=function(Z){var J=T(Z);return fe(J)},this.getX500NameArray=function(Z){var J=T(Z);return _e(J)},this.getX500Name=function(Z,J,ee){var Y=this.getX500NameArray(Z),re=this.dnarraytostr(Y),ve={str:re};return ve.array=Y,ee==!0&&(ve.hex=Z),J==!0&&(ve.canon=this.c14nRDNArray(Y)),ve},this.readCertPEM=function(Z){this.readCertHex(G(Z))},this.readCertHex=function(Z){this.hex=Z,this.getVersion();try{W(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(Z){var J={};return Z==null&&(Z={}),J.version=this.getVersion(),J.serial={hex:this.getSerialNumberHex()},J.sigalg=this.getSignatureAlgorithmField(),J.issuer=this.getIssuer(Z.dncanon,Z.dnhex),J.notbefore=this.getNotBefore(),J.notafter=this.getNotAfter(),J.subject=this.getSubject(Z.dncanon,Z.dnhex),J.sbjpubkey=fn(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&(J.ext=this.getExtParamArray()),J.sighex=this.getSignatureValueHex(),Z.tbshex==!0&&(J.tbshex=V(this.hex,0,[0])),Z.nodnarray==!0&&(delete J.issuer.array,delete J.subject.array),J},this.getExtParamArray=function(Z){if(Z==null){var J=z(this.hex,0,[0,"[3]"]);J!=-1&&(Z=O(this.hex,0,[0,"[3]",0],"30"))}for(var ee=[],Y=u(Z,0),re=0;re<Y.length;re++){var ve=E(Z,Y[re]),Se=this.getExtParam(ve);Se!=null&&ee.push(Se)}return ee},this.getExtParam=function(Z){var J=u(Z,0),ee=J.length;if(ee!=2&&ee!=3)throw new Error("wrong number elements in Extension: "+ee+" "+Z);var Y=H(L(Z,0,[0],"06")),re=!1;ee==3&&V(Z,0,[1])=="0101ff"&&(re=!0);var ve=V(Z,0,[ee-1,0]),Se=void 0;if(Y=="2.5.29.14"?Se=this.getExtSubjectKeyIdentifier(ve,re):Y=="2.5.29.15"?Se=this.getExtKeyUsage(ve,re):Y=="2.5.29.17"?Se=this.getExtSubjectAltName(ve,re):Y=="2.5.29.18"?Se=this.getExtIssuerAltName(ve,re):Y=="2.5.29.19"?Se=this.getExtBasicConstraints(ve,re):Y=="2.5.29.30"?Se=this.getExtNameConstraints(ve,re):Y=="2.5.29.31"?Se=this.getExtCRLDistributionPoints(ve,re):Y=="2.5.29.32"?Se=this.getExtCertificatePolicies(ve,re):Y=="2.5.29.33"?Se=this.getExtPolicyMappings(ve,re):Y=="2.5.29.35"?Se=this.getExtAuthorityKeyIdentifier(ve,re):Y=="2.5.29.36"?Se=this.getExtPolicyConstraints(ve,re):Y=="2.5.29.37"?Se=this.getExtExtKeyUsage(ve,re):Y=="2.5.29.54"?Se=this.getExtInhibitAnyPolicy(ve,re):Y=="1.3.6.1.5.5.7.1.1"?Se=this.getExtAuthorityInfoAccess(ve,re):Y=="2.5.29.20"?Se=this.getExtCRLNumber(ve,re):Y=="2.5.29.21"?Se=this.getExtCRLReason(ve,re):Y=="2.5.29.9"?Se=this.getExtSubjectDirectoryAttributes(ve,re):Y=="1.3.6.1.5.5.7.48.1.2"?Se=this.getExtOcspNonce(ve,re):Y=="1.3.6.1.5.5.7.48.1.5"?Se=this.getExtOcspNoCheck(ve,re):Y=="1.2.840.113583.1.1.9.1"?Se=this.getExtAdobeTimeStamp(ve,re):jt.EXT_PARSER[Y]!=null&&(Se=jt.EXT_PARSER[Y](Y,re,ve)),Se!=null)return Se;var ze={extname:Y,extn:ve};try{ze.extn=T(ve)}catch{}return re&&(ze.critical=!0),ze},this.findExt=function(Z,J){for(var ee=0;ee<Z.length;ee++)if(Z[ee].extname==J)return Z[ee];return null},this.updateExtCDPFullURI=function(Z,J){var ee=this.findExt(Z,"cRLDistributionPoints");if(ee!=null&&ee.array!=null){for(var Y=ee.array,re=0;re<Y.length;re++)if(Y[re].dpname!=null&&Y[re].dpname.full!=null)for(var ve=Y[re].dpname.full,Se=0;Se<ve.length;Se++){var ze=ve[re];ze.uri!=null&&(ze.uri=J)}}},this.updateExtAIAOCSP=function(Z,J){var ee=this.findExt(Z,"authorityInfoAccess");if(ee!=null&&ee.array!=null)for(var Y=ee.array,re=0;re<Y.length;re++)Y[re].ocsp!=null&&(Y[re].ocsp=J)},this.updateExtAIACAIssuer=function(Z,J){var ee=this.findExt(Z,"authorityInfoAccess");if(ee!=null&&ee.array!=null)for(var Y=ee.array,re=0;re<Y.length;re++)Y[re].caissuer!=null&&(Y[re].caissuer=J)},this.dnarraytostr=function(Z){function J(Y){return Y.map(function(re){return ee(re).replace(/\+/,"\\+")}).join("+")}function ee(Y){return Y.type+"="+Y.value}return"/"+Z.map(function(Y){return J(Y).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(Z){var J;if(Z.str!=null&&Z.array==null){var ee=new R.asn1.x509.X500Name({str:Z.str}),Y=ee.tohex();J=this.getX500NameArray(Y)}else J=Z.array;Z.canon==null&&(Z.canon=this.c14nRDNArray(J))},this.c14nRDNArray=function(Z){for(var J=[],ee=0;ee<Z.length;ee++){for(var Y=Z[ee],re=[],ve=0;ve<Y.length;ve++){var Se=Y[ve],ze=Se.value;ze=ze.replace(/^\s*/,""),ze=ze.replace(/\s*$/,""),ze=ze.replace(/\s+/g," "),ze=ze.toLowerCase(),re.push(Se.type.toLowerCase()+"="+ze)}J.push(re.join("+"))}return"/"+J.join("/")},this.getInfo=function(){var Z=function(xn){for(var ci="",bi="    ",ki=`
`,Ni=xn.array,On=0;On<Ni.length;On++){var Hi=Ni[On];if(Hi.dn!=null&&(ci+=bi+"dn: "+Hi.dn.str+ki),Hi.ip!=null&&(ci+=bi+"ip: "+Hi.ip+ki),Hi.rfc822!=null&&(ci+=bi+"rfc822: "+Hi.rfc822+ki),Hi.dns!=null&&(ci+=bi+"dns: "+Hi.dns+ki),Hi.uri!=null&&(ci+=bi+"uri: "+Hi.uri+ki),Hi.other!=null){var vo=Hi.other.oid,qs=JSON.stringify(Hi.other.value).replace(/\"/g,"");ci+=bi+"other: "+vo+"="+qs+ki}}return ci=ci.replace(/\n$/,""),ci},J=function(xn){for(var ci="",bi=xn.array,ki=0;ki<bi.length;ki++){var Ni=bi[ki];if(ci+="    policy oid: "+Ni.policyoid+`
`,Ni.array!==void 0)for(var On=0;On<Ni.array.length;On++){var Hi=Ni.array[On];Hi.cps!==void 0&&(ci+="    cps: "+Hi.cps+`
`)}}return ci},ee=function(xn){for(var ci="",bi=xn.array,ki=0;ki<bi.length;ki++){var Ni=bi[ki];try{Ni.dpname.full[0].uri!==void 0&&(ci+="    "+Ni.dpname.full[0].uri+`
`)}catch{}try{Ni.dname.full[0].dn.hex!==void 0&&(ci+="    "+jt.hex2dn(Ni.dpname.full[0].dn.hex)+`
`)}catch{}}return ci},Y=function(xn){for(var ci="",bi=xn.array,ki=0;ki<bi.length;ki++){var Ni=bi[ki];Ni.caissuer!==void 0&&(ci+="    caissuer: "+Ni.caissuer+`
`),Ni.ocsp!==void 0&&(ci+="    ocsp: "+Ni.ocsp+`
`)}return ci},re,ve,Se;if(re=`Basic Fields
`,re+="  serial number: "+this.getSerialNumberHex()+`
`,re+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,re+="  issuer: "+this.getIssuerString()+`
`,re+="  notBefore: "+this.getNotBefore()+`
`,re+="  notAfter: "+this.getNotAfter()+`
`,re+="  subject: "+this.getSubjectString()+`
`,re+=`  subject public key info: 
`,ve=this.getPublicKey(),re+="    key algorithm: "+ve.type+`
`,ve.type==="RSA"&&(re+="    n="+ld(ve.n.toString(16)).substr(0,16)+`...
`,re+="    e="+ld(ve.e.toString(16))+`
`),Se=this.aExtInfo,Se!=null){re+=`X509v3 Extensions:
`;for(var ze=0;ze<Se.length;ze++){var be=Se[ze],Re=R.asn1.x509.OID.oid2name(be.oid);Re===""&&(Re=be.oid);var Ge="";if(be.critical===!0&&(Ge="CRITICAL"),re+="  "+Re+" "+Ge+`:
`,Re==="basicConstraints"){var We=this.getExtBasicConstraints();We.cA===void 0?re+=`    {}
`:(re+="    cA=true",We.pathLen!==void 0&&(re+=", pathLen="+We.pathLen),re+=`
`)}else if(Re=="policyMappings"){var mn=this.getExtPolicyMappings().array,Fi=mn.map(function(xn){var ci=xn;return ci[0]+":"+ci[1]}).join(", ");re+="    "+Fi+`
`}else if(Re=="policyConstraints"){var Ti=this.getExtPolicyConstraints();re+="    ",Ti.reqexp!=null&&(re+=" reqexp="+Ti.reqexp),Ti.inhibit!=null&&(re+=" inhibit="+Ti.inhibit),re+=`
`}else if(Re=="inhibitAnyPolicy"){var Ti=this.getExtInhibitAnyPolicy();re+="    skip="+Ti.skip+`
`}else if(Re=="keyUsage")re+="    "+this.getExtKeyUsageString()+`
`;else if(Re=="subjectKeyIdentifier")re+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(Re=="authorityKeyIdentifier"){var zi=this.getExtAuthorityKeyIdentifier();zi.kid!==void 0&&(re+="    kid="+zi.kid.hex+`
`)}else if(Re=="extKeyUsage"){var tn=this.getExtExtKeyUsage().array;re+="    "+tn.join(", ")+`
`}else if(Re=="subjectAltName"){var an=Z(this.getExtSubjectAltName());re+=an+`
`}else if(Re=="cRLDistributionPoints"){var nn=this.getExtCRLDistributionPoints();re+=ee(nn)}else if(Re=="authorityInfoAccess"){var go=this.getExtAuthorityInfoAccess();re+=Y(go)}else Re=="certificatePolicies"&&(re+=J(this.getExtCertificatePolicies()))}}return re+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,re+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,re},typeof a=="string"&&(a.indexOf("-----BEGIN")!=-1?this.readCertPEM(a):R.lang.String.isHex(a)&&this.readCertHex(a))}jt.EXT_PARSER={},jt.registExtParser=function(a,d){jt.EXT_PARSER[a]=d},jt.hex2dn=function(a,d){d===void 0&&(d=0);var u=new jt;Ze.getTLV(a,d);var _=u.getX500Name(a);return _.str},jt.hex2rdn=function(a,d){if(d===void 0&&(d=0),a.substr(d,2)!=="31")throw new Error("malformed RDN");for(var u=new Array,_=Ze.getChildIdx(a,d),T=0;T<_.length;T++)u.push(jt.hex2attrTypeValue(a,_[T]));return u=u.map(function(E){return E.replace("+","\\+")}),u.join("+")},jt.hex2attrTypeValue=function(a,d){var u=Ze,_=u.getV;if(d===void 0&&(d=0),a.substr(d,2)!=="30")throw new Error("malformed attribute type and value");var T=u.getChildIdx(a,d);T.length!==2||a.substr(T[0],2);var E=_(a,T[0]),L=R.asn1.ASN1Util.oidHexToInt(E),I=R.asn1.x509.OID.oid2atype(L),V=_(a,T[1]),O=Nn(V);return I+"="+O},jt.getPublicKeyFromCertHex=function(a){var d=new jt;return d.readCertHex(a),d.getPublicKey()},jt.getPublicKeyFromCertPEM=function(a){var d=new jt;return d.readCertPEM(a),d.getPublicKey()},jt.getPublicKeyInfoPropOfCertPEM=function(a){var d=Ze,u=d.getVbyList,_={},T,E;return _.algparam=null,T=new jt,T.readCertPEM(a),E=T.getPublicKeyHex(),_.keyhex=u(E,0,[1],"03").substr(2),_.algoid=u(E,0,[0,0],"06"),_.algoid==="2a8648ce3d0201"&&(_.algparam=u(E,0,[0,1],"06")),_},jt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var N_=function(a){var d=R,u=d.lang.String.isHex,_=Ze,T=_.getV,E=_.getTLV,L=_.getVbyList,I=_.getTLVbyList,V=_.getTLVbyListEx,O=_.getIdxbyList,W=_.getIdxbyListEx,z=_.getChildIdx,D=new jt;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var U=O(this.hex,0,[0,0]),k=this.hex.substr(U,2);if(k=="02")this.posSigAlg=1;else if(k=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+k);var H=O(this.hex,0,[0,this.posSigAlg+3]),G=this.hex.substr(H,2);if(G=="17"||G=="18"){var $,se;$=O(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,$!=-1&&(se=this.hex.substr($,2),se=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(G=="30")this.posRevCert=this.posSigAlg+3;else if(G=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+G)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(L(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var U=I(this.hex,0,[0,this.posSigAlg],"30");return D.getAlgorithmIdentifierName(U)},this.getIssuer=function(){return D.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return I(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var U=L(this.hex,0,[0,this.posSigAlg+2]);return result=Nn(U)},this.getNextUpdate=function(){var U=O(this.hex,0,[0,this.posSigAlg+3]),k=this.hex.substr(U,2);return k!="17"&&k!="18"?null:Nn(T(this.hex,U))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var U=[],k=O(this.hex,0,[0,this.posRevCert]),H=z(this.hex,k),G=0;G<H.length;G++){var $=E(this.hex,H[G]);U.push(this.getRevCert($))}return U},this.getRevCert=function(U){var k={},H=z(U,0);return k.sn={hex:L(U,0,[0],"02")},k.date=Nn(L(U,0,[1])),H.length==3&&(k.ext=D.getExtParamArray(I(U,0,[2]))),k},this.findRevCert=function(U){var k=new jt(U),H=k.getSerialNumberHex();return this.findRevCertBySN(H)},this.findRevCertBySN=function(U){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var k=this.parsed.revcert,H=0;H<k.length;H++)if(U==k[H].sn.hex)return k[H];return null},this.getSignatureValueHex=function(){return L(this.hex,0,[2],"03",!0)},this.verifySignature=function(U){var k=this.getSignatureAlgorithmField(),H=this.getSignatureValueHex(),G=I(this.hex,0,[0],"30"),$=new R.crypto.Signature({alg:k});return $.init(U),$.updateHex(G),$.verify(H)},this.getParam=function(U){var k={},H=this.getVersion();H!=null&&(k.version=H),k.sigalg=this.getSignatureAlgorithmField(),k.issuer=this.getIssuer(),k.thisupdate=this.getThisUpdate();var G=this.getNextUpdate();G!=null&&(k.nextupdate=G);var $=this.getRevCertArray();$!=null&&(k.revcert=$);var se=W(this.hex,0,[0,"[0]"]);if(se!=-1){var me=V(this.hex,0,[0,"[0]",0]);k.ext=D.getExtParamArray(me)}return k.sighex=this.getSignatureValueHex(),this.parsed=k,typeof U=="object"&&(U.tbshex==!0&&(k.tbshex=I(this.hex,0,[0])),U.nodnarray==!0&&delete k.issuer.array),k},typeof a=="string"&&(u(a)?this.hex=a:a.match(/-----BEGIN X509 CRL/)&&(this.hex=Bi(a)),this._setPos())};(typeof R>"u"||!R)&&(R={}),(typeof R.jws>"u"||!R.jws)&&(R.jws={}),R.jws.JWS=function(){var a=R,d=a.jws.JWS,u=d.isSafeJSONString;this.parseJWS=function(_,T){if(!(this.parsedJWS!==void 0&&(T||this.parsedJWS.sigvalH!==void 0))){var E=_.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(E==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var L=E[1],I=E[2],V=E[3],O=L+"."+I;if(this.parsedJWS={},this.parsedJWS.headB64U=L,this.parsedJWS.payloadB64U=I,this.parsedJWS.sigvalB64U=V,this.parsedJWS.si=O,!T){var W=Ri(V),z=Fn(W,16);this.parsedJWS.sigvalH=W,this.parsedJWS.sigvalBI=z}var D=_r(L),U=_r(I);if(this.parsedJWS.headS=D,this.parsedJWS.payloadS=U,!u(D,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+D}}},R.jws.JWS.sign=function(a,d,u,_,T){var E=R,L=E.jws,I=L.JWS,V=I.readSafeJSONString,O=I.isSafeJSONString,W=E.crypto;W.ECDSA;var z=W.Mac,D=W.Signature,U=JSON,k,H,G;if(typeof d!="string"&&typeof d!="object")throw"spHeader must be JSON string or object: "+d;if(typeof d=="object"&&(H=d,k=U.stringify(H)),typeof d=="string"){if(k=d,!O(k))throw"JWS Head is not safe JSON string: "+k;H=V(k)}if(G=u,typeof u=="object"&&(G=U.stringify(u)),(a==""||a==null)&&H.alg!==void 0&&(a=H.alg),a!=""&&a!=null&&H.alg===void 0&&(H.alg=a,k=U.stringify(H)),a!==H.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+H.alg;var $=null;if(I.jwsalg2sigalg[a]===void 0)throw"unsupported alg name: "+a;$=I.jwsalg2sigalg[a];var se=fo(k),me=fo(G),fe=se+"."+me,_e="";if($.substr(0,4)=="Hmac"){if(_===void 0)throw"mac key shall be specified for HS* alg";var Z=new z({alg:$,prov:"cryptojs",pass:_});Z.updateString(fe),_e=Z.doFinal()}else if($.indexOf("withECDSA")!=-1){var J=new D({alg:$});J.init(_,T),J.updateString(fe);var ee=J.sign();_e=R.crypto.ECDSA.asn1SigToConcatSig(ee)}else if($!="none"){var J=new D({alg:$});J.init(_,T),J.updateString(fe),_e=J.sign()}var Y=Zi(_e);return fe+"."+Y},R.jws.JWS.verify=function(a,d,u){var _=R,T=_.jws,E=T.JWS,L=E.readSafeJSONString,I=_.crypto,V=I.ECDSA,O=I.Mac,W=I.Signature,z;if(typeof Gt!==void 0&&(z=Gt),!cd(a))return!1;var D=a.split(".");if(D.length!==3)return!1;var U=D[0],k=D[1],H=U+"."+k,G=Ri(D[2]),$=L(_r(D[0])),se=null,me=null;if($.alg===void 0)throw"algorithm not specified in header";if(se=$.alg,me=se.substr(0,2),u!=null&&Object.prototype.toString.call(u)==="[object Array]"&&u.length>0){var fe=":"+u.join(":")+":";if(fe.indexOf(":"+se+":")==-1)throw"algorithm '"+se+"' not accepted in the list"}if(se!="none"&&d===null)throw"key shall be specified to verify.";if(typeof d=="string"&&d.indexOf("-----BEGIN ")!=-1&&(d=ai.getKey(d)),(me=="RS"||me=="PS")&&!(d instanceof z))throw"key shall be a RSAKey obj for RS* and PS* algs";if(me=="ES"&&!(d instanceof V))throw"key shall be a ECDSA obj for ES* algs";var _e=null;if(E.jwsalg2sigalg[$.alg]===void 0)throw"unsupported alg name: "+se;if(_e=E.jwsalg2sigalg[se],_e=="none")throw"not supported";if(_e.substr(0,4)=="Hmac"){var Z=null;if(d===void 0)throw"hexadecimal key shall be specified for HMAC";var J=new O({alg:_e,pass:d});return J.updateString(H),Z=J.doFinal(),G==Z}else if(_e.indexOf("withECDSA")!=-1){var ee=null;try{ee=V.concatSigToASN1Sig(G)}catch{return!1}var Y=new W({alg:_e});return Y.init(d),Y.updateString(H),Y.verify(ee)}else{var Y=new W({alg:_e});return Y.init(d),Y.updateString(H),Y.verify(G)}},R.jws.JWS.parse=function(a){var d=a.split("."),u={},_,T,E;if(d.length!=2&&d.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return _=d[0],T=d[1],d.length==3&&(E=d[2]),u.headerObj=R.jws.JWS.readSafeJSONString(_r(_)),u.payloadObj=R.jws.JWS.readSafeJSONString(_r(T)),u.headerPP=JSON.stringify(u.headerObj,null,"  "),u.payloadObj==null?u.payloadPP=_r(T):u.payloadPP=JSON.stringify(u.payloadObj,null,"  "),E!==void 0&&(u.sigHex=Ri(E)),u},R.jws.JWS.verifyJWT=function(a,d,u){var _=R,T=_.jws,E=T.JWS,L=E.readSafeJSONString,I=E.inArray,V=E.includedArray;if(!cd(a))return!1;var O=a.split(".");if(O.length!=3)return!1;var W=O[0],z=O[1];Ri(O[2]);var D=L(_r(W)),U=L(_r(z));if(D.alg===void 0)return!1;if(u.alg===void 0)throw"acceptField.alg shall be specified";if(!I(D.alg,u.alg)||U.iss!==void 0&&typeof u.iss=="object"&&!I(U.iss,u.iss)||U.sub!==void 0&&typeof u.sub=="object"&&!I(U.sub,u.sub))return!1;if(U.aud!==void 0&&typeof u.aud=="object"){if(typeof U.aud=="string"){if(!I(U.aud,u.aud))return!1}else if(typeof U.aud=="object"&&!V(U.aud,u.aud))return!1}var k=T.IntDate.getNow();return u.verifyAt!==void 0&&typeof u.verifyAt=="number"&&(k=u.verifyAt),(u.gracePeriod===void 0||typeof u.gracePeriod!="number")&&(u.gracePeriod=0),!(U.exp!==void 0&&typeof U.exp=="number"&&U.exp+u.gracePeriod<k||U.nbf!==void 0&&typeof U.nbf=="number"&&k<U.nbf-u.gracePeriod||U.iat!==void 0&&typeof U.iat=="number"&&k<U.iat-u.gracePeriod||U.jti!==void 0&&u.jti!==void 0&&U.jti!==u.jti||!E.verify(a,d,u.alg))},R.jws.JWS.includedArray=function(a,d){var u=R.jws.JWS.inArray;if(a===null||typeof a!="object"||typeof a.length!="number")return!1;for(var _=0;_<a.length;_++)if(!u(a[_],d))return!1;return!0},R.jws.JWS.inArray=function(a,d){if(d===null||typeof d!="object"||typeof d.length!="number")return!1;for(var u=0;u<d.length;u++)if(d[u]==a)return!0;return!1},R.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},R.jws.JWS.isSafeJSONString=function(a,d,u){var _=null;try{return _=ah(a),typeof _!="object"||_.constructor===Array?0:(d&&(d[u]=_),1)}catch{return 0}},R.jws.JWS.readSafeJSONString=function(a){var d=null;try{return d=ah(a),typeof d!="object"||d.constructor===Array?null:d}catch{return null}},R.jws.JWS.getEncodedSignatureValueFromJWS=function(a){var d=a.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(d==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return d[1]},R.jws.JWS.getJWKthumbprint=function(a){if(a.kty!=="RSA"&&a.kty!=="EC"&&a.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var d="{";if(a.kty==="RSA"){if(typeof a.n!="string"||typeof a.e!="string")throw"wrong n and e value for RSA key";d+='"e":"'+a.e+'",',d+='"kty":"'+a.kty+'",',d+='"n":"'+a.n+'"}'}else if(a.kty==="EC"){if(typeof a.crv!="string"||typeof a.x!="string"||typeof a.y!="string")throw"wrong crv, x and y value for EC key";d+='"crv":"'+a.crv+'",',d+='"kty":"'+a.kty+'",',d+='"x":"'+a.x+'",',d+='"y":"'+a.y+'"}'}else if(a.kty==="oct"){if(typeof a.k!="string")throw"wrong k value for oct(symmetric) key";d+='"kty":"'+a.kty+'",',d+='"k":"'+a.k+'"}'}var u=Hr(d),_=R.crypto.Util.hashHex(u,"sha256"),T=Zi(_);return T},R.jws.IntDate={},R.jws.IntDate.get=function(a){var d=R.jws.IntDate,u=d.getNow,_=d.getZulu;if(a=="now")return u();if(a=="now + 1hour")return u()+60*60;if(a=="now + 1day")return u()+60*60*24;if(a=="now + 1month")return u()+60*60*24*30;if(a=="now + 1year")return u()+60*60*24*365;if(a.match(/Z$/))return _(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a},R.jws.IntDate.getZulu=function(a){return dh(a)},R.jws.IntDate.getNow=function(){var a=~~(new Date/1e3);return a},R.jws.IntDate.intDate2UTCString=function(a){var d=new Date(a*1e3);return d.toUTCString()},R.jws.IntDate.intDate2Zulu=function(a){var d=new Date(a*1e3),u=("0000"+d.getUTCFullYear()).slice(-4),_=("00"+(d.getUTCMonth()+1)).slice(-2),T=("00"+d.getUTCDate()).slice(-2),E=("00"+d.getUTCHours()).slice(-2),L=("00"+d.getUTCMinutes()).slice(-2),I=("00"+d.getUTCSeconds()).slice(-2);return u+_+T+E+L+I+"Z"},(typeof R>"u"||!R)&&(R={}),(typeof R.jws>"u"||!R.jws)&&(R.jws={}),R.jws.JWSJS=function(){var a=R,d=a.jws,u=d.JWS,_=u.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(T){this.init();var E=T.split(".");if(E.length!=3)throw"malformed input JWS";this.aHeader.push(E[0]),this.sPayload=E[1],this.aSignature.push(E[2])},this.addSignature=function(T,E,L,I){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var V=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var O=R.jws.JWS.sign(T,E,this.sPayload,L,I),W=O.split("."),z=W[0],D=W[2];this.aHeader.push(W[0]),this.aSignature.push(W[2])}catch(U){throw this.aHeader.length>V&&this.aHeader.pop(),this.aSignature.length>V&&this.aSignature.pop(),"addSignature failed: "+U}},this.verifyAll=function(T){if(this.aHeader.length!==T.length||this.aSignature.length!==T.length)return!1;for(var E=0;E<T.length;E++){var L=T[E];if(L.length!==2)return!1;var I=this.verifyNth(E,L[0],L[1]);if(I===!1)return!1}return!0},this.verifyNth=function(T,E,L){if(this.aHeader.length<=T||this.aSignature.length<=T)return!1;var I=this.aHeader[T],V=this.aSignature[T],O=I+"."+this.sPayload+"."+V,W=!1;try{W=u.verify(O,E,L)}catch{return!1}return W},this.readJWSJS=function(T){if(typeof T=="string"){var E=_(T);if(E==null)throw"argument is not safe JSON object string";this.aHeader=E.headers,this.sPayload=E.payload,this.aSignature=E.signatures}else try{if(T.headers.length>0)this.aHeader=T.headers;else throw"malformed header";if(typeof T.payload=="string")this.sPayload=T.payload;else throw"malformed signatures";if(T.signatures.length>0)this.aSignature=T.signatures;else throw"malformed signatures"}catch(L){throw"malformed JWS-JS JSON object: "+L}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}},t.SecureRandom=ba,t.rng_seed_time=Jl,t.BigInteger=f,t.RSAKey=Gt,t.ECDSA=R.crypto.ECDSA,t.DSA=R.crypto.DSA,t.Signature=R.crypto.Signature,t.MessageDigest=R.crypto.MessageDigest,t.Mac=R.crypto.Mac,t.KEYUTIL=ai,t.ASN1HEX=Ze,t.X509=jt,t.X509CRL=N_,t.CryptoJS=s,t.b64tohex=l,t.b64toBA=p,t.ECFieldElementFp=$i,t.ECPointFp=pi,t.ECCurveFp=es,t.stoBA=oh,t.BAtos=ch,t.BAtohex=dc,t.stohex=kn,t.stob64=g_,t.stob64u=v_,t.b64utos=__,t.b64tob64u=ya,t.b64utob64=po,t.hex2b64=h,t.hextob64u=Zi,t.b64utohex=Ri,t.utf8tob64u=fo,t.b64utoutf8=_r,t.utf8tob64=b_,t.b64toutf8=y_,t.utf8tohex=uc,t.hextoutf8=gi,t.hextorstr=Nn,t.rstrtohex=Hr,t.hextob64=id,t.hextob64nl=x_,t.b64nltohex=lh,t.hextopem=fn,t.pemtohex=Bi,t.hextoArrayBuffer=T_,t.ArrayBuffertohex=R_,t.zulutomsec=nd,t.msectozulu=P_,t.zulutosec=dh,t.zulutodate=M_,t.datetozulu=A_,t.uricmptohex=pc,t.hextouricmp=fc,t.ipv6tohex=rd,t.hextoipv6=sd,t.hextoip=mc,t.iptohex=ad,t.ucs2hextoutf8=od,t.encodeURIComponentAll=gc,t.newline_toUnix=D_,t.newline_toDos=I_,t.hextoposhex=ld,t.intarystrtohex=L_,t.strdiffidx=F_,t.oidtohex=mh,t.hextooid=vc,t.strpad=_c,t.bitstrtoint=vh,t.inttobitstr=_h,t.bitstrtobinstr=bh,t.binstrtobitstr=k_,t.isBase64URLDot=cd,t.namearraytobinstr=bc,t.extendClass=je,t.foldnl=hc,t.b64topem=E_,t.pemtob64=C_,t.timeogen=uh,t.aryval=Si,t.inttohex=gh,t.twoscompl=mo,t.KJUR=R,t.crypto=R.crypto,t.asn1=R.asn1,t.jws=R.jws,t.lang=R.lang,t.VERSION=n,t.VERSION_FULL=r}}),Nu=Ce({"../../node_modules/isomorphic-ws/browser.js"(t,e){Q();var i=null;typeof WebSocket<"u"?i=WebSocket:typeof MozWebSocket<"u"?i=MozWebSocket:typeof global<"u"?i=global.WebSocket||global.MozWebSocket:typeof window<"u"?i=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(i=self.WebSocket||self.MozWebSocket),e.exports=i}}),qf=Ce({"../../node_modules/deepmerge/dist/cjs.js"(t,e){Q();var i=function(C){return n(C)&&!r(C)};function n(b){return!!b&&typeof b=="object"}function r(b){var C=Object.prototype.toString.call(b);return C==="[object RegExp]"||C==="[object Date]"||c(b)}var s=typeof Symbol=="function"&&Symbol.for,o=s?Symbol.for("react.element"):60103;function c(b){return b.$$typeof===o}function h(b){return Array.isArray(b)?[]:{}}function l(b,C){return C.clone!==!1&&C.isMergeableObject(b)?m(h(b),b,C):b}function p(b,C,A){return b.concat(C).map(function(M){return l(M,A)})}function g(b,C){if(!C.customMerge)return m;var A=C.customMerge(b);return typeof A=="function"?A:m}function f(b){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(b).filter(function(C){return Object.propertyIsEnumerable.call(b,C)}):[]}function y(b){return Object.keys(b).concat(f(b))}function x(b,C){try{return C in b}catch{return!1}}function S(b,C){return x(b,C)&&!(Object.hasOwnProperty.call(b,C)&&Object.propertyIsEnumerable.call(b,C))}function v(b,C,A){var M={};return A.isMergeableObject(b)&&y(b).forEach(function(F){M[F]=l(b[F],A)}),y(C).forEach(function(F){S(b,F)||(x(b,F)&&A.isMergeableObject(C[F])?M[F]=g(F,A)(b[F],C[F],A):M[F]=l(C[F],A))}),M}function m(b,C,A){A=A||{},A.arrayMerge=A.arrayMerge||p,A.isMergeableObject=A.isMergeableObject||i,A.cloneUnlessOtherwiseSpecified=l;var M=Array.isArray(C),F=Array.isArray(b),N=M===F;return N?M?A.arrayMerge(b,C,A):v(b,C,A):l(C,A)}m.all=function(C,A){if(!Array.isArray(C))throw new Error("first argument should be an array");return C.reduce(function(M,F){return m(M,F,A)},{})};var w=m;e.exports=w}}),e0=Ce({"../../node_modules/lodash/_listCacheClear.js"(t,e){Q();function i(){this.__data__=[],this.size=0}e.exports=i}}),Wf=Ce({"../../node_modules/lodash/eq.js"(t,e){Q();function i(n,r){return n===r||n!==n&&r!==r}e.exports=i}}),Cl=Ce({"../../node_modules/lodash/_assocIndexOf.js"(t,e){Q();var i=Wf();function n(r,s){for(var o=r.length;o--;)if(i(r[o][0],s))return o;return-1}e.exports=n}}),t0=Ce({"../../node_modules/lodash/_listCacheDelete.js"(t,e){Q();var i=Cl(),n=Array.prototype,r=n.splice;function s(o){var c=this.__data__,h=i(c,o);if(h<0)return!1;var l=c.length-1;return h==l?c.pop():r.call(c,h,1),--this.size,!0}e.exports=s}}),i0=Ce({"../../node_modules/lodash/_listCacheGet.js"(t,e){Q();var i=Cl();function n(r){var s=this.__data__,o=i(s,r);return o<0?void 0:s[o][1]}e.exports=n}}),n0=Ce({"../../node_modules/lodash/_listCacheHas.js"(t,e){Q();var i=Cl();function n(r){return i(this.__data__,r)>-1}e.exports=n}}),r0=Ce({"../../node_modules/lodash/_listCacheSet.js"(t,e){Q();var i=Cl();function n(r,s){var o=this.__data__,c=i(o,r);return c<0?(++this.size,o.push([r,s])):o[c][1]=s,this}e.exports=n}}),Tl=Ce({"../../node_modules/lodash/_ListCache.js"(t,e){Q();var i=e0(),n=t0(),r=i0(),s=n0(),o=r0();function c(h){var l=-1,p=h==null?0:h.length;for(this.clear();++l<p;){var g=h[l];this.set(g[0],g[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=r,c.prototype.has=s,c.prototype.set=o,e.exports=c}}),s0=Ce({"../../node_modules/lodash/_stackClear.js"(t,e){Q();var i=Tl();function n(){this.__data__=new i,this.size=0}e.exports=n}}),a0=Ce({"../../node_modules/lodash/_stackDelete.js"(t,e){Q();function i(n){var r=this.__data__,s=r.delete(n);return this.size=r.size,s}e.exports=i}}),o0=Ce({"../../node_modules/lodash/_stackGet.js"(t,e){Q();function i(n){return this.__data__.get(n)}e.exports=i}}),c0=Ce({"../../node_modules/lodash/_stackHas.js"(t,e){Q();function i(n){return this.__data__.has(n)}e.exports=i}}),Kf=Ce({"../../node_modules/lodash/_freeGlobal.js"(t,e){Q();var i=typeof global=="object"&&global&&global.Object===Object&&global;e.exports=i}}),ms=Ce({"../../node_modules/lodash/_root.js"(t,e){Q();var i=Kf(),n=typeof self=="object"&&self&&self.Object===Object&&self,r=i||n||Function("return this")();e.exports=r}}),Ou=Ce({"../../node_modules/lodash/_Symbol.js"(t,e){Q();var i=ms(),n=i.Symbol;e.exports=n}}),l0=Ce({"../../node_modules/lodash/_getRawTag.js"(t,e){Q();var i=Ou(),n=Object.prototype,r=n.hasOwnProperty,s=n.toString,o=i?i.toStringTag:void 0;function c(h){var l=r.call(h,o),p=h[o];try{h[o]=void 0;var g=!0}catch{}var f=s.call(h);return g&&(l?h[o]=p:delete h[o]),f}e.exports=c}}),d0=Ce({"../../node_modules/lodash/_objectToString.js"(t,e){Q();var i=Object.prototype,n=i.toString;function r(s){return n.call(s)}e.exports=r}}),Rl=Ce({"../../node_modules/lodash/_baseGetTag.js"(t,e){Q();var i=Ou(),n=l0(),r=d0(),s="[object Null]",o="[object Undefined]",c=i?i.toStringTag:void 0;function h(l){return l==null?l===void 0?o:s:c&&c in Object(l)?n(l):r(l)}e.exports=h}}),Xf=Ce({"../../node_modules/lodash/isObject.js"(t,e){Q();function i(n){var r=typeof n;return n!=null&&(r=="object"||r=="function")}e.exports=i}}),$f=Ce({"../../node_modules/lodash/isFunction.js"(t,e){Q();var i=Rl(),n=Xf(),r="[object AsyncFunction]",s="[object Function]",o="[object GeneratorFunction]",c="[object Proxy]";function h(l){if(!n(l))return!1;var p=i(l);return p==s||p==o||p==r||p==c}e.exports=h}}),u0=Ce({"../../node_modules/lodash/_coreJsData.js"(t,e){Q();var i=ms(),n=i["__core-js_shared__"];e.exports=n}}),h0=Ce({"../../node_modules/lodash/_isMasked.js"(t,e){Q();var i=u0(),n=function(){var s=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}();function r(s){return!!n&&n in s}e.exports=r}}),Zf=Ce({"../../node_modules/lodash/_toSource.js"(t,e){Q();var i=Function.prototype,n=i.toString;function r(s){if(s!=null){try{return n.call(s)}catch{}try{return s+""}catch{}}return""}e.exports=r}}),p0=Ce({"../../node_modules/lodash/_baseIsNative.js"(t,e){Q();var i=$f(),n=h0(),r=Xf(),s=Zf(),o=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,h=Function.prototype,l=Object.prototype,p=h.toString,g=l.hasOwnProperty,f=RegExp("^"+p.call(g).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function y(x){if(!r(x)||n(x))return!1;var S=i(x)?f:c;return S.test(s(x))}e.exports=y}}),f0=Ce({"../../node_modules/lodash/_getValue.js"(t,e){Q();function i(n,r){return n==null?void 0:n[r]}e.exports=i}}),oo=Ce({"../../node_modules/lodash/_getNative.js"(t,e){Q();var i=p0(),n=f0();function r(s,o){var c=n(s,o);return i(c)?c:void 0}e.exports=r}}),Uu=Ce({"../../node_modules/lodash/_Map.js"(t,e){Q();var i=oo(),n=ms(),r=i(n,"Map");e.exports=r}}),Pl=Ce({"../../node_modules/lodash/_nativeCreate.js"(t,e){Q();var i=oo(),n=i(Object,"create");e.exports=n}}),m0=Ce({"../../node_modules/lodash/_hashClear.js"(t,e){Q();var i=Pl();function n(){this.__data__=i?i(null):{},this.size=0}e.exports=n}}),g0=Ce({"../../node_modules/lodash/_hashDelete.js"(t,e){Q();function i(n){var r=this.has(n)&&delete this.__data__[n];return this.size-=r?1:0,r}e.exports=i}}),v0=Ce({"../../node_modules/lodash/_hashGet.js"(t,e){Q();var i=Pl(),n="__lodash_hash_undefined__",r=Object.prototype,s=r.hasOwnProperty;function o(c){var h=this.__data__;if(i){var l=h[c];return l===n?void 0:l}return s.call(h,c)?h[c]:void 0}e.exports=o}}),_0=Ce({"../../node_modules/lodash/_hashHas.js"(t,e){Q();var i=Pl(),n=Object.prototype,r=n.hasOwnProperty;function s(o){var c=this.__data__;return i?c[o]!==void 0:r.call(c,o)}e.exports=s}}),b0=Ce({"../../node_modules/lodash/_hashSet.js"(t,e){Q();var i=Pl(),n="__lodash_hash_undefined__";function r(s,o){var c=this.__data__;return this.size+=this.has(s)?0:1,c[s]=i&&o===void 0?n:o,this}e.exports=r}}),y0=Ce({"../../node_modules/lodash/_Hash.js"(t,e){Q();var i=m0(),n=g0(),r=v0(),s=_0(),o=b0();function c(h){var l=-1,p=h==null?0:h.length;for(this.clear();++l<p;){var g=h[l];this.set(g[0],g[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=r,c.prototype.has=s,c.prototype.set=o,e.exports=c}}),S0=Ce({"../../node_modules/lodash/_mapCacheClear.js"(t,e){Q();var i=y0(),n=Tl(),r=Uu();function s(){this.size=0,this.__data__={hash:new i,map:new(r||n),string:new i}}e.exports=s}}),w0=Ce({"../../node_modules/lodash/_isKeyable.js"(t,e){Q();function i(n){var r=typeof n;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?n!=="__proto__":n===null}e.exports=i}}),Ml=Ce({"../../node_modules/lodash/_getMapData.js"(t,e){Q();var i=w0();function n(r,s){var o=r.__data__;return i(s)?o[typeof s=="string"?"string":"hash"]:o.map}e.exports=n}}),x0=Ce({"../../node_modules/lodash/_mapCacheDelete.js"(t,e){Q();var i=Ml();function n(r){var s=i(this,r).delete(r);return this.size-=s?1:0,s}e.exports=n}}),E0=Ce({"../../node_modules/lodash/_mapCacheGet.js"(t,e){Q();var i=Ml();function n(r){return i(this,r).get(r)}e.exports=n}}),C0=Ce({"../../node_modules/lodash/_mapCacheHas.js"(t,e){Q();var i=Ml();function n(r){return i(this,r).has(r)}e.exports=n}}),T0=Ce({"../../node_modules/lodash/_mapCacheSet.js"(t,e){Q();var i=Ml();function n(r,s){var o=i(this,r),c=o.size;return o.set(r,s),this.size+=o.size==c?0:1,this}e.exports=n}}),Yf=Ce({"../../node_modules/lodash/_MapCache.js"(t,e){Q();var i=S0(),n=x0(),r=E0(),s=C0(),o=T0();function c(h){var l=-1,p=h==null?0:h.length;for(this.clear();++l<p;){var g=h[l];this.set(g[0],g[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=r,c.prototype.has=s,c.prototype.set=o,e.exports=c}}),R0=Ce({"../../node_modules/lodash/_stackSet.js"(t,e){Q();var i=Tl(),n=Uu(),r=Yf(),s=200;function o(c,h){var l=this.__data__;if(l instanceof i){var p=l.__data__;if(!n||p.length<s-1)return p.push([c,h]),this.size=++l.size,this;l=this.__data__=new r(p)}return l.set(c,h),this.size=l.size,this}e.exports=o}}),P0=Ce({"../../node_modules/lodash/_Stack.js"(t,e){Q();var i=Tl(),n=s0(),r=a0(),s=o0(),o=c0(),c=R0();function h(l){var p=this.__data__=new i(l);this.size=p.size}h.prototype.clear=n,h.prototype.delete=r,h.prototype.get=s,h.prototype.has=o,h.prototype.set=c,e.exports=h}}),M0=Ce({"../../node_modules/lodash/_setCacheAdd.js"(t,e){Q();var i="__lodash_hash_undefined__";function n(r){return this.__data__.set(r,i),this}e.exports=n}}),A0=Ce({"../../node_modules/lodash/_setCacheHas.js"(t,e){Q();function i(n){return this.__data__.has(n)}e.exports=i}}),D0=Ce({"../../node_modules/lodash/_SetCache.js"(t,e){Q();var i=Yf(),n=M0(),r=A0();function s(o){var c=-1,h=o==null?0:o.length;for(this.__data__=new i;++c<h;)this.add(o[c])}s.prototype.add=s.prototype.push=n,s.prototype.has=r,e.exports=s}}),I0=Ce({"../../node_modules/lodash/_arraySome.js"(t,e){Q();function i(n,r){for(var s=-1,o=n==null?0:n.length;++s<o;)if(r(n[s],s,n))return!0;return!1}e.exports=i}}),L0=Ce({"../../node_modules/lodash/_cacheHas.js"(t,e){Q();function i(n,r){return n.has(r)}e.exports=i}}),Jf=Ce({"../../node_modules/lodash/_equalArrays.js"(t,e){Q();var i=D0(),n=I0(),r=L0(),s=1,o=2;function c(h,l,p,g,f,y){var x=p&s,S=h.length,v=l.length;if(S!=v&&!(x&&v>S))return!1;var m=y.get(h),w=y.get(l);if(m&&w)return m==l&&w==h;var b=-1,C=!0,A=p&o?new i:void 0;for(y.set(h,l),y.set(l,h);++b<S;){var M=h[b],F=l[b];if(g)var N=x?g(F,M,b,l,h,y):g(M,F,b,h,l,y);if(N!==void 0){if(N)continue;C=!1;break}if(A){if(!n(l,function(P,j){if(!r(A,j)&&(M===P||f(M,P,p,g,y)))return A.push(j)})){C=!1;break}}else if(!(M===F||f(M,F,p,g,y))){C=!1;break}}return y.delete(h),y.delete(l),C}e.exports=c}}),F0=Ce({"../../node_modules/lodash/_Uint8Array.js"(t,e){Q();var i=ms(),n=i.Uint8Array;e.exports=n}}),k0=Ce({"../../node_modules/lodash/_mapToArray.js"(t,e){Q();function i(n){var r=-1,s=Array(n.size);return n.forEach(function(o,c){s[++r]=[c,o]}),s}e.exports=i}}),N0=Ce({"../../node_modules/lodash/_setToArray.js"(t,e){Q();function i(n){var r=-1,s=Array(n.size);return n.forEach(function(o){s[++r]=o}),s}e.exports=i}}),O0=Ce({"../../node_modules/lodash/_equalByTag.js"(t,e){Q();var i=Ou(),n=F0(),r=Wf(),s=Jf(),o=k0(),c=N0(),h=1,l=2,p="[object Boolean]",g="[object Date]",f="[object Error]",y="[object Map]",x="[object Number]",S="[object RegExp]",v="[object Set]",m="[object String]",w="[object Symbol]",b="[object ArrayBuffer]",C="[object DataView]",A=i?i.prototype:void 0,M=A?A.valueOf:void 0;function F(N,P,j,K,X,ie,q){switch(j){case C:if(N.byteLength!=P.byteLength||N.byteOffset!=P.byteOffset)return!1;N=N.buffer,P=P.buffer;case b:return!(N.byteLength!=P.byteLength||!ie(new n(N),new n(P)));case p:case g:case x:return r(+N,+P);case f:return N.name==P.name&&N.message==P.message;case S:case m:return N==P+"";case y:var ae=o;case v:var pe=K&h;if(ae||(ae=c),N.size!=P.size&&!pe)return!1;var ue=q.get(N);if(ue)return ue==P;K|=l,q.set(N,P);var xe=s(ae(N),ae(P),K,X,ie,q);return q.delete(N),xe;case w:if(M)return M.call(N)==M.call(P)}return!1}e.exports=F}}),U0=Ce({"../../node_modules/lodash/_arrayPush.js"(t,e){Q();function i(n,r){for(var s=-1,o=r.length,c=n.length;++s<o;)n[c+s]=r[s];return n}e.exports=i}}),Bu=Ce({"../../node_modules/lodash/isArray.js"(t,e){Q();var i=Array.isArray;e.exports=i}}),B0=Ce({"../../node_modules/lodash/_baseGetAllKeys.js"(t,e){Q();var i=U0(),n=Bu();function r(s,o,c){var h=o(s);return n(s)?h:i(h,c(s))}e.exports=r}}),H0=Ce({"../../node_modules/lodash/_arrayFilter.js"(t,e){Q();function i(n,r){for(var s=-1,o=n==null?0:n.length,c=0,h=[];++s<o;){var l=n[s];r(l,s,n)&&(h[c++]=l)}return h}e.exports=i}}),j0=Ce({"../../node_modules/lodash/stubArray.js"(t,e){Q();function i(){return[]}e.exports=i}}),V0=Ce({"../../node_modules/lodash/_getSymbols.js"(t,e){Q();var i=H0(),n=j0(),r=Object.prototype,s=r.propertyIsEnumerable,o=Object.getOwnPropertySymbols,c=o?function(h){return h==null?[]:(h=Object(h),i(o(h),function(l){return s.call(h,l)}))}:n;e.exports=c}}),z0=Ce({"../../node_modules/lodash/_baseTimes.js"(t,e){Q();function i(n,r){for(var s=-1,o=Array(n);++s<n;)o[s]=r(s);return o}e.exports=i}}),Al=Ce({"../../node_modules/lodash/isObjectLike.js"(t,e){Q();function i(n){return n!=null&&typeof n=="object"}e.exports=i}}),G0=Ce({"../../node_modules/lodash/_baseIsArguments.js"(t,e){Q();var i=Rl(),n=Al(),r="[object Arguments]";function s(o){return n(o)&&i(o)==r}e.exports=s}}),q0=Ce({"../../node_modules/lodash/isArguments.js"(t,e){Q();var i=G0(),n=Al(),r=Object.prototype,s=r.hasOwnProperty,o=r.propertyIsEnumerable,c=i(function(){return arguments}())?i:function(h){return n(h)&&s.call(h,"callee")&&!o.call(h,"callee")};e.exports=c}}),W0=Ce({"../../node_modules/lodash/stubFalse.js"(t,e){Q();function i(){return!1}e.exports=i}}),Qf=Ce({"../../node_modules/lodash/isBuffer.js"(t,e){Q();var i=ms(),n=W0(),r=typeof t=="object"&&t&&!t.nodeType&&t,s=r&&typeof e=="object"&&e&&!e.nodeType&&e,o=s&&s.exports===r,c=o?i.Buffer:void 0,h=c?c.isBuffer:void 0,l=h||n;e.exports=l}}),K0=Ce({"../../node_modules/lodash/_isIndex.js"(t,e){Q();var i=9007199254740991,n=/^(?:0|[1-9]\d*)$/;function r(s,o){var c=typeof s;return o=o??i,!!o&&(c=="number"||c!="symbol"&&n.test(s))&&s>-1&&s%1==0&&s<o}e.exports=r}}),em=Ce({"../../node_modules/lodash/isLength.js"(t,e){Q();var i=9007199254740991;function n(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=i}e.exports=n}}),X0=Ce({"../../node_modules/lodash/_baseIsTypedArray.js"(t,e){Q();var i=Rl(),n=em(),r=Al(),s="[object Arguments]",o="[object Array]",c="[object Boolean]",h="[object Date]",l="[object Error]",p="[object Function]",g="[object Map]",f="[object Number]",y="[object Object]",x="[object RegExp]",S="[object Set]",v="[object String]",m="[object WeakMap]",w="[object ArrayBuffer]",b="[object DataView]",C="[object Float32Array]",A="[object Float64Array]",M="[object Int8Array]",F="[object Int16Array]",N="[object Int32Array]",P="[object Uint8Array]",j="[object Uint8ClampedArray]",K="[object Uint16Array]",X="[object Uint32Array]",ie={};ie[C]=ie[A]=ie[M]=ie[F]=ie[N]=ie[P]=ie[j]=ie[K]=ie[X]=!0,ie[s]=ie[o]=ie[w]=ie[c]=ie[b]=ie[h]=ie[l]=ie[p]=ie[g]=ie[f]=ie[y]=ie[x]=ie[S]=ie[v]=ie[m]=!1;function q(ae){return r(ae)&&n(ae.length)&&!!ie[i(ae)]}e.exports=q}}),$0=Ce({"../../node_modules/lodash/_baseUnary.js"(t,e){Q();function i(n){return function(r){return n(r)}}e.exports=i}}),Z0=Ce({"../../node_modules/lodash/_nodeUtil.js"(t,e){Q();var i=Kf(),n=typeof t=="object"&&t&&!t.nodeType&&t,r=n&&typeof e=="object"&&e&&!e.nodeType&&e,s=r&&r.exports===n,o=s&&i.process,c=function(){try{var h=r&&r.require&&r.require("util").types;return h||o&&o.binding&&o.binding("util")}catch{}}();e.exports=c}}),tm=Ce({"../../node_modules/lodash/isTypedArray.js"(t,e){Q();var i=X0(),n=$0(),r=Z0(),s=r&&r.isTypedArray,o=s?n(s):i;e.exports=o}}),Y0=Ce({"../../node_modules/lodash/_arrayLikeKeys.js"(t,e){Q();var i=z0(),n=q0(),r=Bu(),s=Qf(),o=K0(),c=tm(),h=Object.prototype,l=h.hasOwnProperty;function p(g,f){var y=r(g),x=!y&&n(g),S=!y&&!x&&s(g),v=!y&&!x&&!S&&c(g),m=y||x||S||v,w=m?i(g.length,String):[],b=w.length;for(var C in g)(f||l.call(g,C))&&!(m&&(C=="length"||S&&(C=="offset"||C=="parent")||v&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||o(C,b)))&&w.push(C);return w}e.exports=p}}),J0=Ce({"../../node_modules/lodash/_isPrototype.js"(t,e){Q();var i=Object.prototype;function n(r){var s=r&&r.constructor,o=typeof s=="function"&&s.prototype||i;return r===o}e.exports=n}}),Q0=Ce({"../../node_modules/lodash/_overArg.js"(t,e){Q();function i(n,r){return function(s){return n(r(s))}}e.exports=i}}),eb=Ce({"../../node_modules/lodash/_nativeKeys.js"(t,e){Q();var i=Q0(),n=i(Object.keys,Object);e.exports=n}}),tb=Ce({"../../node_modules/lodash/_baseKeys.js"(t,e){Q();var i=J0(),n=eb(),r=Object.prototype,s=r.hasOwnProperty;function o(c){if(!i(c))return n(c);var h=[];for(var l in Object(c))s.call(c,l)&&l!="constructor"&&h.push(l);return h}e.exports=o}}),ib=Ce({"../../node_modules/lodash/isArrayLike.js"(t,e){Q();var i=$f(),n=em();function r(s){return s!=null&&n(s.length)&&!i(s)}e.exports=r}}),nb=Ce({"../../node_modules/lodash/keys.js"(t,e){Q();var i=Y0(),n=tb(),r=ib();function s(o){return r(o)?i(o):n(o)}e.exports=s}}),rb=Ce({"../../node_modules/lodash/_getAllKeys.js"(t,e){Q();var i=B0(),n=V0(),r=nb();function s(o){return i(o,r,n)}e.exports=s}}),sb=Ce({"../../node_modules/lodash/_equalObjects.js"(t,e){Q();var i=rb(),n=1,r=Object.prototype,s=r.hasOwnProperty;function o(c,h,l,p,g,f){var y=l&n,x=i(c),S=x.length,v=i(h),m=v.length;if(S!=m&&!y)return!1;for(var w=S;w--;){var b=x[w];if(!(y?b in h:s.call(h,b)))return!1}var C=f.get(c),A=f.get(h);if(C&&A)return C==h&&A==c;var M=!0;f.set(c,h),f.set(h,c);for(var F=y;++w<S;){b=x[w];var N=c[b],P=h[b];if(p)var j=y?p(P,N,b,h,c,f):p(N,P,b,c,h,f);if(!(j===void 0?N===P||g(N,P,l,p,f):j)){M=!1;break}F||(F=b=="constructor")}if(M&&!F){var K=c.constructor,X=h.constructor;K!=X&&"constructor"in c&&"constructor"in h&&!(typeof K=="function"&&K instanceof K&&typeof X=="function"&&X instanceof X)&&(M=!1)}return f.delete(c),f.delete(h),M}e.exports=o}}),ab=Ce({"../../node_modules/lodash/_DataView.js"(t,e){Q();var i=oo(),n=ms(),r=i(n,"DataView");e.exports=r}}),ob=Ce({"../../node_modules/lodash/_Promise.js"(t,e){Q();var i=oo(),n=ms(),r=i(n,"Promise");e.exports=r}}),cb=Ce({"../../node_modules/lodash/_Set.js"(t,e){Q();var i=oo(),n=ms(),r=i(n,"Set");e.exports=r}}),lb=Ce({"../../node_modules/lodash/_WeakMap.js"(t,e){Q();var i=oo(),n=ms(),r=i(n,"WeakMap");e.exports=r}}),db=Ce({"../../node_modules/lodash/_getTag.js"(t,e){Q();var i=ab(),n=Uu(),r=ob(),s=cb(),o=lb(),c=Rl(),h=Zf(),l="[object Map]",p="[object Object]",g="[object Promise]",f="[object Set]",y="[object WeakMap]",x="[object DataView]",S=h(i),v=h(n),m=h(r),w=h(s),b=h(o),C=c;(i&&C(new i(new ArrayBuffer(1)))!=x||n&&C(new n)!=l||r&&C(r.resolve())!=g||s&&C(new s)!=f||o&&C(new o)!=y)&&(C=function(A){var M=c(A),F=M==p?A.constructor:void 0,N=F?h(F):"";if(N)switch(N){case S:return x;case v:return l;case m:return g;case w:return f;case b:return y}return M}),e.exports=C}}),ub=Ce({"../../node_modules/lodash/_baseIsEqualDeep.js"(t,e){Q();var i=P0(),n=Jf(),r=O0(),s=sb(),o=db(),c=Bu(),h=Qf(),l=tm(),p=1,g="[object Arguments]",f="[object Array]",y="[object Object]",x=Object.prototype,S=x.hasOwnProperty;function v(m,w,b,C,A,M){var F=c(m),N=c(w),P=F?f:o(m),j=N?f:o(w);P=P==g?y:P,j=j==g?y:j;var K=P==y,X=j==y,ie=P==j;if(ie&&h(m)){if(!h(w))return!1;F=!0,K=!1}if(ie&&!K)return M||(M=new i),F||l(m)?n(m,w,b,C,A,M):r(m,w,P,b,C,A,M);if(!(b&p)){var q=K&&S.call(m,"__wrapped__"),ae=X&&S.call(w,"__wrapped__");if(q||ae){var pe=q?m.value():m,ue=ae?w.value():w;return M||(M=new i),A(pe,ue,b,C,M)}}return ie?(M||(M=new i),s(m,w,b,C,A,M)):!1}e.exports=v}}),hb=Ce({"../../node_modules/lodash/_baseIsEqual.js"(t,e){Q();var i=ub(),n=Al();function r(s,o,c,h,l){return s===o?!0:s==null||o==null||!n(s)&&!n(o)?s!==s&&o!==o:i(s,o,c,h,r,l)}e.exports=r}}),im=Ce({"../../node_modules/lodash/isEqual.js"(t,e){Q();var i=hb();function n(r,s){return i(r,s)}e.exports=n}}),pb=Ce({"../../node_modules/ms/index.js"(t,e){Q();var i=1e3,n=i*60,r=n*60,s=r*24,o=s*7,c=s*365.25;e.exports=function(f,y){y=y||{};var x=typeof f;if(x==="string"&&f.length>0)return h(f);if(x==="number"&&isFinite(f))return y.long?p(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function h(f){if(f=String(f),!(f.length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(y){var x=parseFloat(y[1]),S=(y[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return x*c;case"weeks":case"week":case"w":return x*o;case"days":case"day":case"d":return x*s;case"hours":case"hour":case"hrs":case"hr":case"h":return x*r;case"minutes":case"minute":case"mins":case"min":case"m":return x*n;case"seconds":case"second":case"secs":case"sec":case"s":return x*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return x;default:return}}}}function l(f){var y=Math.abs(f);return y>=s?Math.round(f/s)+"d":y>=r?Math.round(f/r)+"h":y>=n?Math.round(f/n)+"m":y>=i?Math.round(f/i)+"s":f+"ms"}function p(f){var y=Math.abs(f);return y>=s?g(f,y,s,"day"):y>=r?g(f,y,r,"hour"):y>=n?g(f,y,n,"minute"):y>=i?g(f,y,i,"second"):f+" ms"}function g(f,y,x,S){var v=y>=x*1.5;return Math.round(f/x)+" "+S+(v?"s":"")}}}),fb=Ce({"../../node_modules/debug/src/common.js"(t,e){Q();function i(n){s.debug=s,s.default=s,s.coerce=g,s.disable=l,s.enable=c,s.enabled=p,s.humanize=pb(),s.destroy=f,Object.keys(n).forEach(y=>{s[y]=n[y]}),s.names=[],s.skips=[],s.formatters={};function r(y){let x=0;for(let S=0;S<y.length;S++)x=(x<<5)-x+y.charCodeAt(S),x|=0;return s.colors[Math.abs(x)%s.colors.length]}s.selectColor=r;function s(y){let x,S=null,v,m;function w(...b){if(!w.enabled)return;const C=w,A=Number(new Date),M=A-(x||A);C.diff=M,C.prev=x,C.curr=A,x=A,b[0]=s.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let F=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(P,j)=>{if(P==="%%")return"%";F++;const K=s.formatters[j];if(typeof K=="function"){const X=b[F];P=K.call(C,X),b.splice(F,1),F--}return P}),s.formatArgs.call(C,b),(C.log||s.log).apply(C,b)}return w.namespace=y,w.useColors=s.useColors(),w.color=s.selectColor(y),w.extend=o,w.destroy=s.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(v!==s.namespaces&&(v=s.namespaces,m=s.enabled(y)),m),set:b=>{S=b}}),typeof s.init=="function"&&s.init(w),w}function o(y,x){const S=s(this.namespace+(typeof x>"u"?":":x)+y);return S.log=this.log,S}function c(y){s.save(y),s.namespaces=y,s.names=[],s.skips=[];const x=(typeof y=="string"?y:"").trim().replace(" ",",").split(",").filter(Boolean);for(const S of x)S[0]==="-"?s.skips.push(S.slice(1)):s.names.push(S)}function h(y,x){let S=0,v=0,m=-1,w=0;for(;S<y.length;)if(v<x.length&&(x[v]===y[S]||x[v]==="*"))x[v]==="*"?(m=v,w=S,v++):(S++,v++);else if(m!==-1)v=m+1,w++,S=w;else return!1;for(;v<x.length&&x[v]==="*";)v++;return v===x.length}function l(){const y=[...s.names,...s.skips.map(x=>"-"+x)].join(",");return s.enable(""),y}function p(y){for(const x of s.skips)if(h(y,x))return!1;for(const x of s.names)if(h(y,x))return!0;return!1}function g(y){return y instanceof Error?y.stack||y.message:y}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}e.exports=i}}),Dl=Ce({"../../node_modules/debug/src/browser.js"(t,e){Q(),t.formatArgs=n,t.save=r,t.load=s,t.useColors=i,t.storage=o(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;h.splice(1,0,l,"color: inherit");let p=0,g=0;h[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(p++,f==="%c"&&(g=p))}),h.splice(g,0,l)}t.log=console.debug||console.log||(()=>{});function r(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function s(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof Wa<"u"&&"env"in Wa&&(h=Wa.env.DEBUG),h}function o(){try{return localStorage}catch{}}e.exports=fb()(t);var{formatters:c}=e.exports;c.j=function(h){try{return JSON.stringify(h)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}}),mb=Ce({"../../node_modules/mediasoup-client/node_modules/ua-parser-js/src/main/ua-parser.js"(t,e){Q(),function(i,n){var r="2.0.3",s=500,o="user-agent",c="",h="?",l="function",p="undefined",g="object",f="string",y="browser",x="cpu",S="device",v="engine",m="os",w="result",b="name",C="type",A="vendor",M="version",F="architecture",N="major",P="model",j="console",K="mobile",X="tablet",ie="smarttv",q="wearable",ae="xr",pe="embedded",ue="inapp",xe="brands",Ee="formFactors",ye="fullVersionList",ge="platform",Te="platformVersion",rt="bitness",et="sec-ch-ua",tt=et+"-full-version-list",gt=et+"-arch",Lt=et+"-"+rt,St=et+"-form-factors",Kt=et+"-"+K,Ei=et+"-"+P,Ut=et+"-"+ge,Pe=Ut+"-version",_i=[xe,ye,K,P,ge,Te,F,Ee,rt],Mt="Amazon",xt="Apple",Bt="ASUS",li="BlackBerry",Ot="Google",Ht="Huawei",ei="Lenovo",Ci="Honor",yi="LG",ce="Microsoft",te="Motorola",De="Nvidia",He="OnePlus",Oe="OPPO",Fe="Samsung",it="Sharp",$e="Sony",st="Xiaomi",de="Zebra",ke="Chrome",Ve="Chromium",Ct="Chromecast",Tt="Edge",At="Firefox",wt="Opera",he="Facebook",nt="Sogou",Je="Mobile ",ct=" Browser",ot="Windows",Ke=typeof i!==p,lt=Ke&&i.navigator?i.navigator:n,It=lt&&lt.userAgentData?lt.userAgentData:n,Ii=function(Le,Xe){var at={},Nt=Xe;if(!Ui(Xe)){Nt={};for(var _t in Xe)for(var ni in Xe[_t])Nt[ni]=Xe[_t][ni].concat(Nt[ni]?Nt[ni]:[])}for(var ut in Le)at[ut]=Nt[ut]&&Nt[ut].length%2===0?Nt[ut].concat(Le[ut]):Le[ut];return at},hi=function(Le){for(var Xe={},at=0;at<Le.length;at++)Xe[Le[at].toUpperCase()]=Le[at];return Xe},pn=function(Le,Xe){if(typeof Le===g&&Le.length>0){for(var at in Le)if(Kn(Le[at])==Kn(Xe))return!0;return!1}return gr(Le)?Kn(Xe).indexOf(Kn(Le))!==-1:!1},Ui=function(Le,Xe){for(var at in Le)return/^(browser|cpu|device|engine|os)$/.test(at)||(Xe?Ui(Le[at]):!1)},gr=function(Le){return typeof Le===f},gs=function(Le){if(!Le)return n;for(var Xe=[],at=Xn(/\\?\"/g,Le).split(","),Nt=0;Nt<at.length;Nt++)if(at[Nt].indexOf(";")>-1){var _t=Jr(at[Nt]).split(";v=");Xe[Nt]={brand:_t[0],version:_t[1]}}else Xe[Nt]=Jr(at[Nt]);return Xe},Kn=function(Le){return gr(Le)?Le.toLowerCase():Le},Or=function(Le){return gr(Le)?Xn(/[^\d\.]/g,Le).split(".")[0]:n},Ln=function(Le){for(var Xe in Le){var at=Le[Xe];typeof at==g&&at.length==2?this[at[0]]=at[1]:this[at]=n}return this},Xn=function(Le,Xe){return gr(Xe)?Xe.replace(Le,c):Xe},Ur=function(Le){return Xn(/\\?\"/g,Le)},Jr=function(Le,Xe){if(gr(Le))return Le=Xn(/^\s\s*/,Le),typeof Xe===p?Le:Le.substring(0,s)},Gs=function(Le,Xe){if(!(!Le||!Xe))for(var at=0,Nt,_t,ni,ut,bt,Wt;at<Xe.length&&!bt;){var $t=Xe[at],Xi=Xe[at+1];for(Nt=_t=0;Nt<$t.length&&!bt&&$t[Nt];)if(bt=$t[Nt++].exec(Le),bt)for(ni=0;ni<Xi.length;ni++)Wt=bt[++_t],ut=Xi[ni],typeof ut===g&&ut.length>0?ut.length===2?typeof ut[1]==l?this[ut[0]]=ut[1].call(this,Wt):this[ut[0]]=ut[1]:ut.length===3?typeof ut[1]===l&&!(ut[1].exec&&ut[1].test)?this[ut[0]]=Wt?ut[1].call(this,Wt,ut[2]):n:this[ut[0]]=Wt?Wt.replace(ut[1],ut[2]):n:ut.length===4&&(this[ut[0]]=Wt?ut[3].call(this,Wt.replace(ut[1],ut[2])):n):this[ut]=Wt||n;at+=2}},or=function(Le,Xe){for(var at in Xe)if(typeof Xe[at]===g&&Xe[at].length>0){for(var Nt=0;Nt<Xe[at].length;Nt++)if(pn(Xe[at][Nt],Le))return at===h?n:at}else if(pn(Xe[at],Le))return at===h?n:at;return Xe.hasOwnProperty("*")?Xe["*"]:Le},oe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Me={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":n},Ue={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[M,[b,Je+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[M,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,M],[/opios[\/ ]+([\w\.]+)/i],[M,[b,wt+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[M,[b,wt+" GX"]],[/\bopr\/([\w\.]+)/i],[M,[b,wt]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[M,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[M,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[b,M],[/quark(?:pc)?\/([-\w\.]+)/i],[M,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[M,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[M,[b,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[M,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[M,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[M,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[M,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[M,[b,"Smart "+ei+ct]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure"+ct],M],[/\bfocus\/([\w\.]+)/i],[M,[b,At+" Focus"]],[/\bopt\/([\w\.]+)/i],[M,[b,wt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[M,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[M,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[M,[b,wt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[M,[b,"MIUI"+ct]],[/fxios\/([\w\.-]+)/i],[M,[b,Je+At]],[/\bqihoobrowser\/?([\w\.]*)/i],[M,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],M],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+ct],M],[/samsungbrowser\/([\w\.]+)/i],[M,[b,Fe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[M,[b,nt+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,nt+" Mobile"],M],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,M],[/(lbbrowser|rekonq)/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[M,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,he],M,[C,ue]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,M,[C,ue]],[/\bgsa\/([\w\.]+) .*safari\//i],[M,[b,"GSA"],[C,ue]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[M,[b,"TikTok"],[C,ue]],[/\[(linkedin)app\]/i],[b,[C,ue]],[/(chromium)[\/ ]([-\w\.]+)/i],[b,M],[/headlesschrome(?:\/([\w\.]+)| )/i],[M,[b,ke+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,ke+" WebView"],M],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[M,[b,"Android"+ct]],[/chrome\/([\w\.]+) mobile/i],[M,[b,Je+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,M],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[M,[b,Je+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[b,Je+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[M,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[M,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[b,M],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[b,Je+At],M],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],M],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,M],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[M,[b,At+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[b,[M,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[M,/[^\d\.]+./,c]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[F,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[F,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[F,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[F,/ower/,c,Kn]],[/ sun4\w[;\)]/i],[[F,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[F,Kn]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[P,[A,Fe],[C,X]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[P,[A,Fe],[C,K]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[P,[A,xt],[C,K]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[P,[A,xt],[C,X]],[/(macintosh);/i],[P,[A,xt]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[P,[A,it],[C,K]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[P,[A,Ci],[C,X]],[/honor([-\w ]+)[;\)]/i],[P,[A,Ci],[C,K]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[P,[A,Ht],[C,X]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[P,[A,Ht],[C,K]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[P,/_/g," "],[A,st],[C,X]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[P,/_/g," "],[A,st],[C,K]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[P,[A,Oe],[C,K]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[P,[A,or,{OnePlus:["304","403","203"],"*":Oe}],[C,X]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[P,[A,"BLU"],[C,K]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[P,[A,"Vivo"],[C,K]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[P,[A,"Realme"],[C,K]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[P,[A,te],[C,K]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[P,[A,te],[C,X]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[P,[A,yi],[C,X]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[P,[A,yi],[C,K]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[P,[A,ei],[C,X]],[/(nokia) (t[12][01])/i],[A,P,[C,X]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[P,/_/g," "],[C,K],[A,"Nokia"]],[/(pixel (c|tablet))\b/i],[P,[A,Ot],[C,X]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[P,[A,Ot],[C,K]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[P,[A,$e],[C,K]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[P,"Xperia Tablet"],[A,$e],[C,X]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[P,[A,He],[C,K]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[P,[A,Mt],[C,X]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[P,/(.+)/g,"Fire Phone $1"],[A,Mt],[C,K]],[/(playbook);[-\w\),; ]+(rim)/i],[P,A,[C,X]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[P,[A,li],[C,K]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[P,[A,Bt],[C,X]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[P,[A,Bt],[C,K]],[/(nexus 9)/i],[P,[A,"HTC"],[C,X]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[P,/_/g," "],[C,K]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[P,[A,"TCL"],[C,X]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[P,[A,"TCL"],[C,K]],[/(itel) ((\w+))/i],[[A,Kn],P,[C,or,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[P,[A,"Acer"],[C,X]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[P,[A,"Meizu"],[C,K]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[P,[A,"Ulefone"],[C,K]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[P,[A,"Energizer"],[C,K]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[P,[A,"Cat"],[C,K]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[P,[A,"Smartfren"],[C,K]],[/droid.+; (a(?:015|06[35]|142p?))/i],[P,[A,"Nothing"],[C,K]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[P,[A,"Archos"],[C,X]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[P,[A,"Archos"],[C,K]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[A,P,[C,X]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[A,P,[C,K]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[A,P,[C,X]],[/(surface duo)/i],[P,[A,ce],[C,X]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[P,[A,"Fairphone"],[C,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[P,[A,De],[C,X]],[/(sprint) (\w+)/i],[A,P,[C,K]],[/(kin\.[onetw]{3})/i],[[P,/\./g," "],[A,ce],[C,K]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[P,[A,de],[C,X]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[P,[A,de],[C,K]],[/smart-tv.+(samsung)/i],[A,[C,ie]],[/hbbtv.+maple;(\d+)/i],[[P,/^/,"SmartTV"],[A,Fe],[C,ie]],[/tcast.+(lg)e?. ([-\w]+)/i],[A,P,[C,ie]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,yi],[C,ie]],[/(apple) ?tv/i],[A,[P,xt+" TV"],[C,ie]],[/crkey.*devicetype\/chromecast/i],[[P,Ct+" Third Generation"],[A,Ot],[C,ie]],[/crkey.*devicetype\/([^/]*)/i],[[P,/^/,"Chromecast "],[A,Ot],[C,ie]],[/fuchsia.*crkey/i],[[P,Ct+" Nest Hub"],[A,Ot],[C,ie]],[/crkey/i],[[P,Ct],[A,Ot],[C,ie]],[/(portaltv)/i],[P,[A,he],[C,ie]],[/droid.+aft(\w+)( bui|\))/i],[P,[A,Mt],[C,ie]],[/(shield \w+ tv)/i],[P,[A,De],[C,ie]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[P,[A,it],[C,ie]],[/(bravia[\w ]+)( bui|\))/i],[P,[A,$e],[C,ie]],[/(mi(tv|box)-?\w+) bui/i],[P,[A,st],[C,ie]],[/Hbbtv.*(technisat) (.*);/i],[A,P,[C,ie]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,Jr],[P,Jr],[C,ie]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[P,[C,ie]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[C,ie]],[/(ouya)/i,/(nintendo) (\w+)/i],[A,P,[C,j]],[/droid.+; (shield)( bui|\))/i],[P,[A,De],[C,j]],[/(playstation \w+)/i],[P,[A,$e],[C,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[P,[A,ce],[C,j]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[P,[A,Fe],[C,q]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[A,P,[C,q]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[P,[A,Oe],[C,q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[P,[A,xt],[C,q]],[/(opwwe\d{3})/i],[P,[A,He],[C,q]],[/(moto 360)/i],[P,[A,te],[C,q]],[/(smartwatch 3)/i],[P,[A,$e],[C,q]],[/(g watch r)/i],[P,[A,yi],[C,q]],[/droid.+; (wt63?0{2,3})\)/i],[P,[A,de],[C,q]],[/droid.+; (glass) \d/i],[P,[A,Ot],[C,ae]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,P,[C,ae]],[/(quest( \d| pro)?s?).+vr/i],[P,[A,he],[C,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[C,pe]],[/(aeobc)\b/i],[P,[A,Mt],[C,pe]],[/(homepod).+mac os/i],[P,[A,xt],[C,pe]],[/windows iot/i],[[C,pe]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[P,[C,or,{mobile:"Mobile",xr:"VR","*":X}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[C,X]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[C,K]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[P,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[M,[b,Tt+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[b,M],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[M,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,M],[/ladybird\//i],[[b,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[M,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,M],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[b,[M,or,oe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[M,or,oe],[b,ot]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[M,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,"macOS"],[M,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[M,[b,Ct+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[M,[b,Ct+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[M,[b,Ct+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[M,[b,Ct+" Linux"]],[/crkey\/([\d\.]+)/i],[M,[b,Ct]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[M,b],[/(ubuntu) ([\w\.]+) like android/i],[[b,/(.+)/,"$1 Touch"],M],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[b,M],[/\(bb(10);/i],[M,[b,li]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[M,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[M,[b,At+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[M,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[M,[b,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,"Chrome OS"],M],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,M],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],M],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,M]]},Ae=function(){var Le={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Ln.call(Le.init,[[y,[b,M,N,C]],[x,[F]],[S,[C,P,A]],[v,[b,M]],[m,[b,M]]]),Ln.call(Le.isIgnore,[[y,[M,N]],[v,[M]],[m,[M]]]),Ln.call(Le.isIgnoreRgx,[[y,/ ?browser$/i],[m,/ ?os$/i]]),Ln.call(Le.toString,[[y,[b,M]],[x,[F]],[S,[A,P]],[v,[b,M]],[m,[b,M]]]),Le}(),Be=function(Le,Xe){var at=Ae.init[Xe],Nt=Ae.isIgnore[Xe]||0,_t=Ae.isIgnoreRgx[Xe]||0,ni=Ae.toString[Xe]||0;function ut(){Ln.call(this,at)}return ut.prototype.getItem=function(){return Le},ut.prototype.withClientHints=function(){return It?It.getHighEntropyValues(_i).then(function(bt){return Le.setCH(new vt(bt,!1)).parseCH().get()}):Le.parseCH().get()},ut.prototype.withFeatureCheck=function(){return Le.detectFeature().get()},Xe!=w&&(ut.prototype.is=function(bt){var Wt=!1;for(var $t in this)if(this.hasOwnProperty($t)&&!pn(Nt,$t)&&Kn(_t?Xn(_t,this[$t]):this[$t])==Kn(_t?Xn(_t,bt):bt)){if(Wt=!0,bt!=p)break}else if(bt==p&&Wt){Wt=!Wt;break}return Wt},ut.prototype.toString=function(){var bt=c;for(var Wt in ni)typeof this[ni[Wt]]!==p&&(bt+=(bt?" ":c)+this[ni[Wt]]);return bt||p}),It||(ut.prototype.then=function(bt){var Wt=this,$t=function(){for(var $n in Wt)Wt.hasOwnProperty($n)&&(this[$n]=Wt[$n])};$t.prototype={is:ut.prototype.is,toString:ut.prototype.toString};var Xi=new $t;return bt(Xi),Xi}),new ut};function vt(Le,Xe){if(Le=Le||{},Ln.call(this,_i),Xe)Ln.call(this,[[xe,gs(Le[et])],[ye,gs(Le[tt])],[K,/\?1/.test(Le[Kt])],[P,Ur(Le[Ei])],[ge,Ur(Le[Ut])],[Te,Ur(Le[Pe])],[F,Ur(Le[gt])],[Ee,gs(Le[St])],[rt,Ur(Le[Lt])]]);else for(var at in Le)this.hasOwnProperty(at)&&typeof Le[at]!==p&&(this[at]=Le[at])}function Ft(Le,Xe,at,Nt){return this.get=function(_t){return _t?this.data.hasOwnProperty(_t)?this.data[_t]:n:this.data},this.set=function(_t,ni){return this.data[_t]=ni,this},this.setCH=function(_t){return this.uaCH=_t,this},this.detectFeature=function(){if(lt&&lt.userAgent==this.ua)switch(this.itemType){case y:lt.brave&&typeof lt.brave.isBrave==l&&this.set(b,"Brave");break;case S:!this.get(C)&&It&&It[K]&&this.set(C,K),this.get(P)=="Macintosh"&&lt&&typeof lt.standalone!==p&&lt.maxTouchPoints&&lt.maxTouchPoints>2&&this.set(P,"iPad").set(C,X);break;case m:!this.get(b)&&It&&It[ge]&&this.set(b,It[ge]);break;case w:var _t=this.data,ni=function(ut){return _t[ut].getItem().detectFeature().get()};this.set(y,ni(y)).set(x,ni(x)).set(S,ni(S)).set(v,ni(v)).set(m,ni(m))}return this},this.parseUA=function(){return this.itemType!=w&&Gs.call(this.data,this.ua,this.rgxMap),this.itemType==y&&this.set(N,Or(this.get(M))),this},this.parseCH=function(){var _t=this.uaCH,ni=this.rgxMap;switch(this.itemType){case y:case v:var ut=_t[ye]||_t[xe],bt;if(ut)for(var Wt in ut){var $t=ut[Wt].brand||ut[Wt],Xi=ut[Wt].version;this.itemType==y&&!/not.a.brand/i.test($t)&&(!bt||/chrom/i.test(bt)&&$t!=Ve)&&($t=or($t,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(b,$t).set(M,Xi).set(N,Or(Xi)),bt=$t),this.itemType==v&&$t==Ve&&this.set(M,Xi)}break;case x:var $n=_t[F];$n&&($n&&_t[rt]=="64"&&($n+="64"),Gs.call(this.data,$n+";",ni));break;case S:if(_t[K]&&this.set(C,K),_t[P]&&(this.set(P,_t[P]),!this.get(C)||!this.get(A))){var Zn={};Gs.call(Zn,"droid 9; "+_t[P]+")",ni),!this.get(C)&&Zn.type&&this.set(C,Zn.type),!this.get(A)&&Zn.vendor&&this.set(A,Zn.vendor)}if(_t[Ee]){var Br;if(typeof _t[Ee]!="string")for(var di=0;!Br&&di<_t[Ee].length;)Br=or(_t[Ee][di++],Me);else Br=or(_t[Ee],Me);this.set(C,Br)}break;case m:var Yn=_t[ge];if(Yn){var Qr=_t[Te];Yn==ot&&(Qr=parseInt(Or(Qr),10)>=13?"11":"10"),this.set(b,Yn).set(M,Qr)}this.get(b)==ot&&_t[P]=="Xbox"&&this.set(b,"Xbox").set(M,n);break;case w:var sn=this.data,Jn=function(ho){return sn[ho].getItem().setCH(_t).parseCH().get()};this.set(y,Jn(y)).set(x,Jn(x)).set(S,Jn(S)).set(v,Jn(v)).set(m,Jn(m))}return this},Ln.call(this,[["itemType",Le],["ua",Xe],["uaCH",Nt],["rgxMap",at],["data",Be(this,Le)]]),this}function Et(Le,Xe,at){if(typeof Le===g?(Ui(Le,!0)?(typeof Xe===g&&(at=Xe),Xe=Le):(at=Le,Xe=n),Le=n):typeof Le===f&&!Ui(Xe,!0)&&(at=Xe,Xe=n),at&&typeof at.append===l){var Nt={};at.forEach(function(Wt,$t){Nt[$t]=Wt}),at=Nt}if(!(this instanceof Et))return new Et(Le,Xe,at).getResult();var _t=typeof Le===f?Le:at&&at[o]?at[o]:lt&&lt.userAgent?lt.userAgent:c,ni=new vt(at,!0),ut=Xe?Ii(Ue,Xe):Ue,bt=function(Wt){return Wt==w?function(){return new Ft(Wt,_t,ut,ni).set("ua",_t).set(y,this.getBrowser()).set(x,this.getCPU()).set(S,this.getDevice()).set(v,this.getEngine()).set(m,this.getOS()).get()}:function(){return new Ft(Wt,_t,ut[Wt],ni).parseUA().get()}};return Ln.call(this,[["getBrowser",bt(y)],["getCPU",bt(x)],["getDevice",bt(S)],["getEngine",bt(v)],["getOS",bt(m)],["getResult",bt(w)],["getUA",function(){return _t}],["setUA",function(Wt){return gr(Wt)&&(_t=Wt.length>s?Jr(Wt,s):Wt),this}]]).setUA(_t),this}Et.VERSION=r,Et.BROWSER=hi([b,M,N,C]),Et.CPU=hi([F]),Et.DEVICE=hi([P,A,C,j,K,ie,X,q,pe]),Et.ENGINE=Et.OS=hi([b,M]),typeof t!==p?(typeof e!==p&&e.exports&&(t=e.exports=Et),t.UAParser=Et):typeof define===l&&define.amd?define(function(){return Et}):Ke&&(i.UAParser=Et);var kt=Ke&&(i.jQuery||i.Zepto);if(kt&&!kt.ua){var Xt=new Et;kt.ua=Xt.getResult(),kt.ua.get=function(){return Xt.getUA()},kt.ua.set=function(Le){Xt.setUA(Le);var Xe=Xt.getResult();for(var at in Xe)kt.ua[at]=Xe[at]}}}(typeof window=="object"?window:t)}}),Vi=Ce({"../../node_modules/mediasoup-client/lib/Logger.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var e=Dl(),i="mediasoup-client",n=class{constructor(r){le(this,"_debug"),le(this,"_warn"),le(this,"_error"),r?(this._debug=(0,e.default)(`${i}:${r}`),this._warn=(0,e.default)(`${i}:WARN:${r}`),this._error=(0,e.default)(`${i}:ERROR:${r}`)):(this._debug=(0,e.default)(i),this._warn=(0,e.default)(`${i}:WARN`),this._error=(0,e.default)(`${i}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};t.Logger=n}}),gb=Ce({"../../node_modules/npm-events-package/events.js"(t,e){Q();var i=typeof Reflect=="object"?Reflect:null,n=i&&typeof i.apply=="function"?i.apply:function(F,N,P){return Function.prototype.apply.call(F,N,P)},r;i&&typeof i.ownKeys=="function"?r=i.ownKeys:Object.getOwnPropertySymbols?r=function(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:r=function(F){return Object.getOwnPropertyNames(F)};function s(M){console&&console.warn&&console.warn(M)}var o=Number.isNaN||function(F){return F!==F};function c(){c.init.call(this)}e.exports=c,e.exports.once=b,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var h=10;function l(M){if(typeof M!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(M){if(typeof M!="number"||M<0||o(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");h=M}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(F){if(typeof F!="number"||F<0||o(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this};function p(M){return M._maxListeners===void 0?c.defaultMaxListeners:M._maxListeners}c.prototype.getMaxListeners=function(){return p(this)},c.prototype.emit=function(F){for(var N=[],P=1;P<arguments.length;P++)N.push(arguments[P]);var j=F==="error",K=this._events;if(K!==void 0)j=j&&K.error===void 0;else if(!j)return!1;if(j){var X;if(N.length>0&&(X=N[0]),X instanceof Error)throw X;var ie=new Error("Unhandled error."+(X?" ("+X.message+")":""));throw ie.context=X,ie}var q=K[F];if(q===void 0)return!1;if(typeof q=="function")n(q,this,N);else for(var ae=q.length,pe=v(q,ae),P=0;P<ae;++P)n(pe[P],this,N);return!0};function g(M,F,N,P){var j,K,X;if(l(N),K=M._events,K===void 0?(K=M._events=Object.create(null),M._eventsCount=0):(K.newListener!==void 0&&(M.emit("newListener",F,N.listener?N.listener:N),K=M._events),X=K[F]),X===void 0)X=K[F]=N,++M._eventsCount;else if(typeof X=="function"?X=K[F]=P?[N,X]:[X,N]:P?X.unshift(N):X.push(N),j=p(M),j>0&&X.length>j&&!X.warned){X.warned=!0;var ie=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+String(F)+" listeners added. Use emitter.setMaxListeners() to increase limit");ie.name="MaxListenersExceededWarning",ie.emitter=M,ie.type=F,ie.count=X.length,s(ie)}return M}c.prototype.addListener=function(F,N){return g(this,F,N,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(F,N){return g(this,F,N,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(M,F,N){var P={fired:!1,wrapFn:void 0,target:M,type:F,listener:N},j=f.bind(P);return j.listener=N,P.wrapFn=j,j}c.prototype.once=function(F,N){return l(N),this.on(F,y(this,F,N)),this},c.prototype.prependOnceListener=function(F,N){return l(N),this.prependListener(F,y(this,F,N)),this},c.prototype.removeListener=function(F,N){var P,j,K,X,ie;if(l(N),j=this._events,j===void 0)return this;if(P=j[F],P===void 0)return this;if(P===N||P.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete j[F],j.removeListener&&this.emit("removeListener",F,P.listener||N));else if(typeof P!="function"){for(K=-1,X=P.length-1;X>=0;X--)if(P[X]===N||P[X].listener===N){ie=P[X].listener,K=X;break}if(K<0)return this;K===0?P.shift():m(P,K),P.length===1&&(j[F]=P[0]),j.removeListener!==void 0&&this.emit("removeListener",F,ie||N)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(F){var N,P,j;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[F]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[F]),this;if(arguments.length===0){var K=Object.keys(P),X;for(j=0;j<K.length;++j)X=K[j],X!=="removeListener"&&this.removeAllListeners(X);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=P[F],typeof N=="function")this.removeListener(F,N);else if(N!==void 0)for(j=N.length-1;j>=0;j--)this.removeListener(F,N[j]);return this};function x(M,F,N){var P=M._events;if(P===void 0)return[];var j=P[F];return j===void 0?[]:typeof j=="function"?N?[j.listener||j]:[j]:N?w(j):v(j,j.length)}c.prototype.listeners=function(F){return x(this,F,!0)},c.prototype.rawListeners=function(F){return x(this,F,!1)},c.listenerCount=function(M,F){return typeof M.listenerCount=="function"?M.listenerCount(F):S.call(M,F)},c.prototype.listenerCount=S;function S(M){var F=this._events;if(F!==void 0){var N=F[M];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function v(M,F){for(var N=new Array(F),P=0;P<F;++P)N[P]=M[P];return N}function m(M,F){for(;F+1<M.length;F++)M[F]=M[F+1];M.pop()}function w(M){for(var F=new Array(M.length),N=0;N<F.length;++N)F[N]=M[N].listener||M[N];return F}function b(M,F){return new Promise(function(N,P){function j(X){M.removeListener(F,K),P(X)}function K(){typeof M.removeListener=="function"&&M.removeListener("error",j),N([].slice.call(arguments))}A(M,F,K,{once:!0}),F!=="error"&&C(M,j,{once:!0})})}function C(M,F,N){typeof M.on=="function"&&A(M,"error",F,N)}function A(M,F,N,P){if(typeof M.on=="function")P.once?M.once(F,N):M.on(F,N);else if(typeof M.addEventListener=="function")M.addEventListener(F,function j(K){P.once&&M.removeEventListener(F,j),N(K)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M)}}}),Bs=Ce({"../../node_modules/mediasoup-client/lib/enhancedEvents.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;var e=gb(),i=Vi(),n=new i.Logger("EnhancedEventEmitter"),r=class extends e.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(s,...o){return super.emit(s,...o)}safeEmit(s,...o){try{return super.emit(s,...o)}catch(c){n.error("safeEmit() | event listener threw an error [eventName:%s]:%o",s,c);try{super.emit("listenererror",s,c)}catch{}return!!super.listenerCount(s)}}on(s,o){return super.on(s,o),this}off(s,o){return super.off(s,o),this}addListener(s,o){return super.on(s,o),this}prependListener(s,o){return super.prependListener(s,o),this}once(s,o){return super.once(s,o),this}prependOnceListener(s,o){return super.prependOnceListener(s,o),this}removeListener(s,o){return super.off(s,o),this}removeAllListeners(s){return super.removeAllListeners(s),this}listenerCount(s){return super.listenerCount(s)}listeners(s){return super.listeners(s)}rawListeners(s){return super.rawListeners(s)}};t.EnhancedEventEmitter=r}}),Sn=Ce({"../../node_modules/mediasoup-client/lib/errors.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;var e=class nm extends Error{constructor(r){super(r),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,nm):this.stack=new Error(r).stack}};t.UnsupportedError=e;var i=class rm extends Error{constructor(r){super(r),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,rm):this.stack=new Error(r).stack}};t.InvalidStateError=i}}),Qi=Ce({"../../node_modules/mediasoup-client/lib/utils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.clone=e,t.generateRandomNumber=i,t.deepFreeze=n;function e(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}function i(){return Math.round(Math.random()*1e7)}function n(r){const s=Reflect.ownKeys(r);for(const o of s){const c=r[o];(c&&typeof c=="object"||typeof c=="function")&&n(c)}return Object.freeze(r)}}}),vb=Ce({"../../node_modules/h264-profile-level-id/lib/Logger.js"(t){Q();var e=t&&t.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var i=e(Dl()),n="h264-profile-level-id",r=class{constructor(s){s?(this._debug=(0,i.default)(`${n}:${s}`),this._warn=(0,i.default)(`${n}:WARN:${s}`),this._error=(0,i.default)(`${n}:ERROR:${s}`)):(this._debug=(0,i.default)(n),this._warn=(0,i.default)(`${n}:WARN`),this._error=(0,i.default)(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};t.Logger=r}}),_b=Ce({"../../node_modules/h264-profile-level-id/lib/index.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileLevelId=t.Level=t.Profile=void 0,t.parseProfileLevelId=g,t.profileLevelIdToString=f,t.profileToString=y,t.levelToString=x,t.parseSdpProfileLevelId=S,t.isSameProfile=v,t.isSameProfileAndLevel=m,t.generateProfileLevelIdStringForAnswer=w,t.supportedLevel=b;var e=vb(),i=new e.Logger,n;(function(N){N[N.ConstrainedBaseline=1]="ConstrainedBaseline",N[N.Baseline=2]="Baseline",N[N.Main=3]="Main",N[N.ConstrainedHigh=4]="ConstrainedHigh",N[N.High=5]="High",N[N.PredictiveHigh444=6]="PredictiveHigh444"})(n||(t.Profile=n={}));var r;(function(N){N[N.L1_b=0]="L1_b",N[N.L1=10]="L1",N[N.L1_1=11]="L1_1",N[N.L1_2=12]="L1_2",N[N.L1_3=13]="L1_3",N[N.L2=20]="L2",N[N.L2_1=21]="L2_1",N[N.L2_2=22]="L2_2",N[N.L3=30]="L3",N[N.L3_1=31]="L3_1",N[N.L3_2=32]="L3_2",N[N.L4=40]="L4",N[N.L4_1=41]="L4_1",N[N.L4_2=42]="L4_2",N[N.L5=50]="L5",N[N.L5_1=51]="L5_1",N[N.L5_2=52]="L5_2"})(r||(t.Level=r={}));var s=class{constructor(N,P){this.profile=N,this.level=P}};t.ProfileLevelId=s;var o=new s(n.ConstrainedBaseline,r.L3_1),c=class{constructor(N){this.mask=~C("x",N),this.masked_value=C("1",N)}isMatch(N){return this.masked_value===(N&this.mask)}},h=class{constructor(N,P,j){this.profile_idc=N,this.profile_iop=P,this.profile=j}},l=[new h(66,new c("x1xx0000"),n.ConstrainedBaseline),new h(77,new c("1xxx0000"),n.ConstrainedBaseline),new h(88,new c("11xx0000"),n.ConstrainedBaseline),new h(66,new c("x0xx0000"),n.Baseline),new h(88,new c("10xx0000"),n.Baseline),new h(77,new c("0x0x0000"),n.Main),new h(100,new c("00000000"),n.High),new h(100,new c("00001100"),n.ConstrainedHigh),new h(244,new c("00000000"),n.PredictiveHigh444)],p=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:r.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:r.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:r.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:r.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:r.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:r.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:r.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:r.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:r.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:r.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:r.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:r.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:r.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:r.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:r.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:r.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:r.L5_2}];function g(N){if(typeof N!="string"||N.length!==6)return;const j=parseInt(N,16);if(j===0)return;const K=j&255,X=j>>8&255,ie=j>>16&255;let q;switch(K){case r.L1_1:{q=(X&16)!==0?r.L1_b:r.L1_1;break}case r.L1:case r.L1_2:case r.L1_3:case r.L2:case r.L2_1:case r.L2_2:case r.L3:case r.L3_1:case r.L3_2:case r.L4:case r.L4_1:case r.L4_2:case r.L5:case r.L5_1:case r.L5_2:{q=K;break}default:{i.warn(`parseProfileLevelId() | unrecognized level_idc [str:${N}, level_idc:${K}]`);return}}for(const ae of l)if(ie===ae.profile_idc&&ae.profile_iop.isMatch(X))return i.debug(`parseProfileLevelId() | result [str:${N}, profile:${ae.profile}, level:${q}]`),new s(ae.profile,q);i.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${N}, profile_idc:${ie}, profile_iop:${X}]`)}function f(N){if(N.level==r.L1_b)switch(N.profile){case n.ConstrainedBaseline:return"42f00b";case n.Baseline:return"42100b";case n.Main:return"4d100b";default:{i.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${N.profile}`);return}}let P;switch(N.profile){case n.ConstrainedBaseline:{P="42e0";break}case n.Baseline:{P="4200";break}case n.Main:{P="4d00";break}case n.ConstrainedHigh:{P="640c";break}case n.High:{P="6400";break}case n.PredictiveHigh444:{P="f400";break}default:{i.warn(`profileLevelIdToString() | unrecognized profile ${N.profile}`);return}}let j=N.level.toString(16);return j.length===1&&(j=`0${j}`),`${P}${j}`}function y(N){switch(N){case n.ConstrainedBaseline:return"ConstrainedBaseline";case n.Baseline:return"Baseline";case n.Main:return"Main";case n.ConstrainedHigh:return"ConstrainedHigh";case n.High:return"High";case n.PredictiveHigh444:return"PredictiveHigh444";default:{i.warn(`profileToString() | unrecognized profile ${N}`);return}}}function x(N){switch(N){case r.L1_b:return"1b";case r.L1:return"1";case r.L1_1:return"1.1";case r.L1_2:return"1.2";case r.L1_3:return"1.3";case r.L2:return"2";case r.L2_1:return"2.1";case r.L2_2:return"2.2";case r.L3:return"3";case r.L3_1:return"3.1";case r.L3_2:return"3.2";case r.L4:return"4";case r.L4_1:return"4.1";case r.L4_2:return"4.2";case r.L5:return"5";case r.L5_1:return"5.1";case r.L5_2:return"5.2";default:{i.warn(`levelToString() | unrecognized level ${N}`);return}}}function S(N={}){const P=N["profile-level-id"];return P?g(P):o}function v(N={},P={}){const j=S(N),K=S(P);return!!(j&&K&&j.profile===K.profile)}function m(N={},P={}){const j=S(N),K=S(P);return!!(j&&K&&j.profile===K.profile&&j.level==K.level)}function w(N={},P={}){if(!N["profile-level-id"]&&!P["profile-level-id"]){i.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const j=S(N),K=S(P);if(!j)throw new TypeError("invalid local_profile_level_id");if(!K)throw new TypeError("invalid remote_profile_level_id");if(j.profile!==K.profile)throw new TypeError("H264 Profile mismatch");const X=F(N)&&F(P),ie=j.level,q=K.level,ae=M(ie,q),pe=X?ie:ae;return i.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${j.profile}, level:${pe}]`),f(new s(j.profile,pe))}function b(N,P){for(let K=p.length-1;K>=0;--K){const X=p[K];if(X.max_macroblock_frame_size*256<=N&&X.max_macroblocks_per_second<=P*X.max_macroblock_frame_size)return i.debug(`supportedLevel() | result [max_frame_pixel_count:${N}, max_fps:${P}, level:${X.level}]`),X.level}i.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${N}, max_fps:${P}]`)}function C(N,P){return+(P[0]===N)<<7|+(P[1]===N)<<6|+(P[2]===N)<<5|+(P[3]===N)<<4|+(P[4]===N)<<3|+(P[5]===N)<<2|+(P[6]===N)<<1|+(P[7]===N)<<0}function A(N,P){return N===r.L1_b?P!==r.L1&&P!==r.L1_b:P===r.L1_b?N!==r.L1:N<P}function M(N,P){return A(N,P)?N:P}function F(N={}){const P=N["level-asymmetry-allowed"];return P===!0||P===1||P==="1"}}}),wn=Ce({"../../node_modules/mediasoup-client/lib/ortc.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.validateRtpCapabilities=o,t.validateRtpParameters=c,t.validateSctpStreamParameters=h,t.validateSctpCapabilities=l,t.getExtendedRtpCapabilities=p,t.getRecvRtpCapabilities=g,t.getSendingRtpParameters=f,t.getSendingRemoteRtpParameters=y,t.reduceCodecs=x,t.generateProbatorRtpParameters=S,t.canSend=v,t.canReceive=m;var e=_b(),i=Qi(),n="probator",r=1234,s=127;function o(q){if(typeof q!="object")throw new TypeError("caps is not an object");if(q.codecs&&!Array.isArray(q.codecs))throw new TypeError("caps.codecs is not an array");q.codecs||(q.codecs=[]);for(const ae of q.codecs)w(ae);if(q.headerExtensions&&!Array.isArray(q.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");q.headerExtensions||(q.headerExtensions=[]);for(const ae of q.headerExtensions)C(ae)}function c(q){if(typeof q!="object")throw new TypeError("params is not an object");if(q.mid&&typeof q.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(q.codecs))throw new TypeError("missing params.codecs");for(const ae of q.codecs)A(ae);if(q.headerExtensions&&!Array.isArray(q.headerExtensions))throw new TypeError("params.headerExtensions is not an array");q.headerExtensions||(q.headerExtensions=[]);for(const ae of q.headerExtensions)M(ae);if(q.encodings&&!Array.isArray(q.encodings))throw new TypeError("params.encodings is not an array");q.encodings||(q.encodings=[]);for(const ae of q.encodings)F(ae);if(q.rtcp&&typeof q.rtcp!="object")throw new TypeError("params.rtcp is not an object");q.rtcp||(q.rtcp={}),N(q.rtcp)}function h(q){if(typeof q!="object")throw new TypeError("params is not an object");if(typeof q.streamId!="number")throw new TypeError("missing params.streamId");let ae=!1;if(typeof q.ordered=="boolean"?ae=!0:q.ordered=!0,q.maxPacketLifeTime&&typeof q.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(q.maxRetransmits&&typeof q.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(q.maxPacketLifeTime&&q.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(ae&&q.ordered&&(q.maxPacketLifeTime||q.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!ae&&(q.maxPacketLifeTime||q.maxRetransmits)&&(q.ordered=!1),q.label&&typeof q.label!="string")throw new TypeError("invalid params.label");if(q.protocol&&typeof q.protocol!="string")throw new TypeError("invalid params.protocol")}function l(q){if(typeof q!="object")throw new TypeError("caps is not an object");if(!q.numStreams||typeof q.numStreams!="object")throw new TypeError("missing caps.numStreams");P(q.numStreams)}function p(q,ae){var pe,ue;const xe={codecs:[],headerExtensions:[]};for(const Ee of(pe=ae.codecs)!=null?pe:[]){if(j(Ee))continue;const ye=((ue=q.codecs)!=null?ue:[]).find(Te=>K(Te,Ee,{strict:!0,modify:!0}));if(!ye)continue;const ge={mimeType:ye.mimeType,kind:ye.kind,clockRate:ye.clockRate,channels:ye.channels,localPayloadType:ye.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:Ee.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:ye.parameters,remoteParameters:Ee.parameters,rtcpFeedback:ie(ye,Ee)};xe.codecs.push(ge)}for(const Ee of xe.codecs){const ye=q.codecs.find(Te=>j(Te)&&Te.parameters.apt===Ee.localPayloadType),ge=ae.codecs.find(Te=>j(Te)&&Te.parameters.apt===Ee.remotePayloadType);ye&&ge&&(Ee.localRtxPayloadType=ye.preferredPayloadType,Ee.remoteRtxPayloadType=ge.preferredPayloadType)}for(const Ee of ae.headerExtensions){const ye=q.headerExtensions.find(Te=>X(Te,Ee));if(!ye)continue;const ge={kind:Ee.kind,uri:Ee.uri,sendId:ye.preferredId,recvId:Ee.preferredId,encrypt:ye.preferredEncrypt,direction:"sendrecv"};switch(Ee.direction){case"sendrecv":{ge.direction="sendrecv";break}case"recvonly":{ge.direction="sendonly";break}case"sendonly":{ge.direction="recvonly";break}case"inactive":{ge.direction="inactive";break}}xe.headerExtensions.push(ge)}return xe}function g(q){const ae={codecs:[],headerExtensions:[]};for(const pe of q.codecs){const ue={mimeType:pe.mimeType,kind:pe.kind,preferredPayloadType:pe.remotePayloadType,clockRate:pe.clockRate,channels:pe.channels,parameters:pe.localParameters,rtcpFeedback:pe.rtcpFeedback};if(ae.codecs.push(ue),!pe.remoteRtxPayloadType)continue;const xe={mimeType:`${pe.kind}/rtx`,kind:pe.kind,preferredPayloadType:pe.remoteRtxPayloadType,clockRate:pe.clockRate,parameters:{apt:pe.remotePayloadType},rtcpFeedback:[]};ae.codecs.push(xe)}for(const pe of q.headerExtensions){if(pe.direction!=="sendrecv"&&pe.direction!=="recvonly")continue;const ue={kind:pe.kind,uri:pe.uri,preferredId:pe.recvId,preferredEncrypt:pe.encrypt,direction:pe.direction};ae.headerExtensions.push(ue)}return ae}function f(q,ae){const pe={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const ue of ae.codecs){if(ue.kind!==q)continue;const xe={mimeType:ue.mimeType,payloadType:ue.localPayloadType,clockRate:ue.clockRate,channels:ue.channels,parameters:ue.localParameters,rtcpFeedback:ue.rtcpFeedback};if(pe.codecs.push(xe),ue.localRtxPayloadType){const Ee={mimeType:`${ue.kind}/rtx`,payloadType:ue.localRtxPayloadType,clockRate:ue.clockRate,parameters:{apt:ue.localPayloadType},rtcpFeedback:[]};pe.codecs.push(Ee)}}for(const ue of ae.headerExtensions){if(ue.kind&&ue.kind!==q||ue.direction!=="sendrecv"&&ue.direction!=="sendonly")continue;const xe={uri:ue.uri,id:ue.sendId,encrypt:ue.encrypt,parameters:{}};pe.headerExtensions.push(xe)}return pe}function y(q,ae){var pe,ue,xe;const Ee={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const ye of ae.codecs){if(ye.kind!==q)continue;const ge={mimeType:ye.mimeType,payloadType:ye.localPayloadType,clockRate:ye.clockRate,channels:ye.channels,parameters:ye.remoteParameters,rtcpFeedback:ye.rtcpFeedback};if(Ee.codecs.push(ge),ye.localRtxPayloadType){const Te={mimeType:`${ye.kind}/rtx`,payloadType:ye.localRtxPayloadType,clockRate:ye.clockRate,parameters:{apt:ye.localPayloadType},rtcpFeedback:[]};Ee.codecs.push(Te)}}for(const ye of ae.headerExtensions){if(ye.kind&&ye.kind!==q||ye.direction!=="sendrecv"&&ye.direction!=="sendonly")continue;const ge={uri:ye.uri,id:ye.sendId,encrypt:ye.encrypt,parameters:{}};Ee.headerExtensions.push(ge)}if(Ee.headerExtensions.some(ye=>ye.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const ye of Ee.codecs)ye.rtcpFeedback=((pe=ye.rtcpFeedback)!=null?pe:[]).filter(ge=>ge.type!=="goog-remb");else if(Ee.headerExtensions.some(ye=>ye.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const ye of Ee.codecs)ye.rtcpFeedback=((ue=ye.rtcpFeedback)!=null?ue:[]).filter(ge=>ge.type!=="transport-cc");else for(const ye of Ee.codecs)ye.rtcpFeedback=((xe=ye.rtcpFeedback)!=null?xe:[]).filter(ge=>ge.type!=="transport-cc"&&ge.type!=="goog-remb");return Ee}function x(q,ae){const pe=[];if(!ae)pe.push(q[0]),j(q[1])&&pe.push(q[1]);else{for(let ue=0;ue<q.length;++ue)if(K(q[ue],ae,{strict:!0})){pe.push(q[ue]),j(q[ue+1])&&pe.push(q[ue+1]);break}if(pe.length===0)throw new TypeError("no matching codec found")}return pe}function S(q){q=i.clone(q),c(q);const ae={mid:n,codecs:[],headerExtensions:[],encodings:[{ssrc:r}],rtcp:{cname:"probator"}};return ae.codecs.push(q.codecs[0]),ae.codecs[0].payloadType=s,ae.headerExtensions=q.headerExtensions,ae}function v(q,ae){return ae.codecs.some(pe=>pe.kind===q)}function m(q,ae){if(c(q),q.codecs.length===0)return!1;const pe=q.codecs[0];return ae.codecs.some(ue=>ue.remotePayloadType===pe.payloadType)}function w(q){const ae=new RegExp("^(audio|video)/(.+)","i");if(typeof q!="object")throw new TypeError("codec is not an object");if(!q.mimeType||typeof q.mimeType!="string")throw new TypeError("missing codec.mimeType");const pe=ae.exec(q.mimeType);if(!pe)throw new TypeError("invalid codec.mimeType");if(q.kind=pe[1].toLowerCase(),q.preferredPayloadType&&typeof q.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof q.clockRate!="number")throw new TypeError("missing codec.clockRate");q.kind==="audio"?typeof q.channels!="number"&&(q.channels=1):delete q.channels,(!q.parameters||typeof q.parameters!="object")&&(q.parameters={});for(const ue of Object.keys(q.parameters)){let xe=q.parameters[ue];if(xe===void 0&&(q.parameters[ue]="",xe=""),typeof xe!="string"&&typeof xe!="number")throw new TypeError(`invalid codec parameter [key:${ue}s, value:${xe}]`);if(ue==="apt"&&typeof xe!="number")throw new TypeError("invalid codec apt parameter")}(!q.rtcpFeedback||!Array.isArray(q.rtcpFeedback))&&(q.rtcpFeedback=[]);for(const ue of q.rtcpFeedback)b(ue)}function b(q){if(typeof q!="object")throw new TypeError("fb is not an object");if(!q.type||typeof q.type!="string")throw new TypeError("missing fb.type");(!q.parameter||typeof q.parameter!="string")&&(q.parameter="")}function C(q){if(typeof q!="object")throw new TypeError("ext is not an object");if(q.kind!=="audio"&&q.kind!=="video")throw new TypeError("invalid ext.kind");if(!q.uri||typeof q.uri!="string")throw new TypeError("missing ext.uri");if(typeof q.preferredId!="number")throw new TypeError("missing ext.preferredId");if(q.preferredEncrypt&&typeof q.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(q.preferredEncrypt||(q.preferredEncrypt=!1),q.direction&&typeof q.direction!="string")throw new TypeError("invalid ext.direction");q.direction||(q.direction="sendrecv")}function A(q){const ae=new RegExp("^(audio|video)/(.+)","i");if(typeof q!="object")throw new TypeError("codec is not an object");if(!q.mimeType||typeof q.mimeType!="string")throw new TypeError("missing codec.mimeType");const pe=ae.exec(q.mimeType);if(!pe)throw new TypeError("invalid codec.mimeType");if(typeof q.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof q.clockRate!="number")throw new TypeError("missing codec.clockRate");pe[1].toLowerCase()==="audio"?typeof q.channels!="number"&&(q.channels=1):delete q.channels,(!q.parameters||typeof q.parameters!="object")&&(q.parameters={});for(const xe of Object.keys(q.parameters)){let Ee=q.parameters[xe];if(Ee===void 0&&(q.parameters[xe]="",Ee=""),typeof Ee!="string"&&typeof Ee!="number")throw new TypeError(`invalid codec parameter [key:${xe}s, value:${Ee}]`);if(xe==="apt"&&typeof Ee!="number")throw new TypeError("invalid codec apt parameter")}(!q.rtcpFeedback||!Array.isArray(q.rtcpFeedback))&&(q.rtcpFeedback=[]);for(const xe of q.rtcpFeedback)b(xe)}function M(q){if(typeof q!="object")throw new TypeError("ext is not an object");if(!q.uri||typeof q.uri!="string")throw new TypeError("missing ext.uri");if(typeof q.id!="number")throw new TypeError("missing ext.id");if(q.encrypt&&typeof q.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");q.encrypt||(q.encrypt=!1),(!q.parameters||typeof q.parameters!="object")&&(q.parameters={});for(const ae of Object.keys(q.parameters)){let pe=q.parameters[ae];if(pe===void 0&&(q.parameters[ae]="",pe=""),typeof pe!="string"&&typeof pe!="number")throw new TypeError("invalid header extension parameter")}}function F(q){if(typeof q!="object")throw new TypeError("encoding is not an object");if(q.ssrc&&typeof q.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(q.rid&&typeof q.rid!="string")throw new TypeError("invalid encoding.rid");if(q.rtx&&typeof q.rtx!="object")throw new TypeError("invalid encoding.rtx");if(q.rtx&&typeof q.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!q.dtx||typeof q.dtx!="boolean")&&(q.dtx=!1),q.scalabilityMode&&typeof q.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function N(q){if(typeof q!="object")throw new TypeError("rtcp is not an object");if(q.cname&&typeof q.cname!="string")throw new TypeError("invalid rtcp.cname");(!q.reducedSize||typeof q.reducedSize!="boolean")&&(q.reducedSize=!0)}function P(q){if(typeof q!="object")throw new TypeError("numStreams is not an object");if(typeof q.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof q.MIS!="number")throw new TypeError("missing numStreams.MIS")}function j(q){return q?/.+\/rtx$/i.test(q.mimeType):!1}function K(q,ae,{strict:pe=!1,modify:ue=!1}={}){var xe,Ee,ye,ge;const Te=q.mimeType.toLowerCase(),rt=ae.mimeType.toLowerCase();if(Te!==rt||q.clockRate!==ae.clockRate||q.channels!==ae.channels)return!1;switch(Te){case"video/h264":{if(pe){const et=(xe=q.parameters["packetization-mode"])!=null?xe:0,tt=(Ee=ae.parameters["packetization-mode"])!=null?Ee:0;if(et!==tt||!e.isSameProfile(q.parameters,ae.parameters))return!1;let gt;try{gt=e.generateProfileLevelIdStringForAnswer(q.parameters,ae.parameters)}catch{return!1}ue&&(gt?(q.parameters["profile-level-id"]=gt,ae.parameters["profile-level-id"]=gt):(delete q.parameters["profile-level-id"],delete ae.parameters["profile-level-id"]))}break}case"video/vp9":{if(pe){const et=(ye=q.parameters["profile-id"])!=null?ye:0,tt=(ge=ae.parameters["profile-id"])!=null?ge:0;if(et!==tt)return!1}break}}return!0}function X(q,ae){return!(q.kind&&ae.kind&&q.kind!==ae.kind||q.uri!==ae.uri)}function ie(q,ae){var pe,ue;const xe=[];for(const Ee of(pe=q.rtcpFeedback)!=null?pe:[]){const ye=((ue=ae.rtcpFeedback)!=null?ue:[]).find(ge=>ge.type===Ee.type&&(ge.parameter===Ee.parameter||!ge.parameter&&!Ee.parameter));ye&&xe.push(ye)}return xe}}}),bb=Ce({"../../node_modules/awaitqueue/lib/Logger.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var e=Dl(),i="awaitqueue",n=class{constructor(r){le(this,"_debug"),le(this,"_warn"),le(this,"_error"),r?(this._debug=e(`${i}:${r}`),this._warn=e(`${i}:WARN:${r}`),this._error=e(`${i}:ERROR:${r}`)):(this._debug=e(i),this._warn=e(`${i}:WARN`),this._error=e(`${i}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};t.Logger=n}}),sm=Ce({"../../node_modules/awaitqueue/lib/errors.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;var e=class am extends Error{constructor(r){super(r??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,am)}};t.AwaitQueueStoppedError=e;var i=class om extends Error{constructor(r){super(r??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,om)}};t.AwaitQueueRemovedTaskError=i}}),yb=Ce({"../../node_modules/awaitqueue/lib/AwaitQueue.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=void 0;var e=bb(),i=sm(),n=new e.Logger("AwaitQueue"),r=class{constructor(){le(this,"pendingTasks",new Map),le(this,"nextTaskId",0),le(this,"stopping",!1),n.debug("constructor()")}get size(){return this.pendingTasks.size}push(s,o){return B(this,null,function*(){if(o=o??s.name,n.debug(`push() [name:${o}]`),typeof s!="function")throw new TypeError("given task is not a function");if(o)try{Object.defineProperty(s,"name",{value:o})}catch{}return new Promise((c,h)=>{const l={id:this.nextTaskId++,task:s,name:o,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:p=>{if(l.completed)return;l.completed=!0,this.pendingTasks.delete(l.id),n.debug(`resolving task [name:${l.name}]`),c(p);const[g]=this.pendingTasks.values();g&&!g.executedAt&&this.execute(g)},reject:p=>{if(!l.completed&&(l.completed=!0,this.pendingTasks.delete(l.id),n.debug(`rejecting task [name:${l.name}]: %s`,String(p)),h(p),!this.stopping)){const[g]=this.pendingTasks.values();g&&!g.executedAt&&this.execute(g)}}};this.pendingTasks.set(l.id,l),this.pendingTasks.size===1&&this.execute(l)})})}stop(){n.debug("stop()"),this.stopping=!0;for(const s of this.pendingTasks.values())n.debug(`stop() | stopping task [name:${s.name}]`),s.reject(new i.AwaitQueueStoppedError);this.stopping=!1}remove(s){n.debug(`remove() [taskIdx:${s}]`);const o=Array.from(this.pendingTasks.values())[s];if(!o){n.debug(`stop() | no task with given idx [taskIdx:${s}]`);return}o.reject(new i.AwaitQueueRemovedTaskError)}dump(){const s=Date.now();let o=0;return Array.from(this.pendingTasks.values()).map(c=>({idx:o++,task:c.task,name:c.name,enqueuedTime:c.executedAt?c.executedAt-c.enqueuedAt:s-c.enqueuedAt,executionTime:c.executedAt?s-c.executedAt:0}))}execute(s){return B(this,null,function*(){if(n.debug(`execute() [name:${s.name}]`),s.executedAt)throw new Error("task already being executed");s.executedAt=Date.now();try{const o=yield s.task();s.resolve(o)}catch(o){s.reject(o)}})}};t.AwaitQueue=r}}),Sb=Ce({"../../node_modules/awaitqueue/lib/index.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=t.AwaitQueue=void 0;var e=yb();Object.defineProperty(t,"AwaitQueue",{enumerable:!0,get:function(){return e.AwaitQueue}});var i=sm();Object.defineProperty(t,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return i.AwaitQueueStoppedError}}),Object.defineProperty(t,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return i.AwaitQueueRemovedTaskError}})}}),cm=Ce({"../../node_modules/mediasoup-client/lib/Producer.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;var e=Vi(),i=Bs(),n=Sn(),r=new e.Logger("Producer"),s=class extends i.EnhancedEventEmitter{constructor({id:o,localId:c,rtpSender:h,track:l,rtpParameters:p,stopTracks:g,disableTrackOnPause:f,zeroRtpOnPause:y,appData:x}){super(),le(this,"_id"),le(this,"_localId"),le(this,"_closed",!1),le(this,"_rtpSender"),le(this,"_track"),le(this,"_kind"),le(this,"_rtpParameters"),le(this,"_paused"),le(this,"_maxSpatialLayer"),le(this,"_stopTracks"),le(this,"_disableTrackOnPause"),le(this,"_zeroRtpOnPause"),le(this,"_appData"),le(this,"_observer",new i.EnhancedEventEmitter),r.debug("constructor()"),this._id=o,this._localId=c,this._rtpSender=h,this._track=l,this._kind=l.kind,this._rtpParameters=p,this._paused=f?!l.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=g,this._disableTrackOnPause=f,this._zeroRtpOnPause=y,this._appData=x??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(r.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(r.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return B(this,null,function*(){if(this._closed)throw new n.InvalidStateError("closed");return new Promise((o,c)=>{this.safeEmit("@getstats",o,c)})})}pause(){if(r.debug("pause()"),this._closed){r.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((o,c)=>{this.safeEmit("@pause",o,c)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(r.debug("resume()"),this._closed){r.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((o,c)=>{this.safeEmit("@resume",o,c)}).catch(()=>{}),this._observer.safeEmit("resume")}replaceTrack(o){return B(this,arguments,function*({track:c}){if(r.debug("replaceTrack() [track:%o]",c),this._closed){if(c&&this._stopTracks)try{c.stop()}catch{}throw new n.InvalidStateError("closed")}else if(c&&c.readyState==="ended")throw new n.InvalidStateError("track ended");if(c===this._track){r.debug("replaceTrack() | same track, ignored");return}yield new Promise((h,l)=>{this.safeEmit("@replacetrack",c,h,l)}),this.destroyTrack(),this._track=c,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()})}setMaxSpatialLayer(o){return B(this,null,function*(){if(this._closed)throw new n.InvalidStateError("closed");if(this._kind!=="video")throw new n.UnsupportedError("not a video Producer");if(typeof o!="number")throw new TypeError("invalid spatialLayer");o!==this._maxSpatialLayer&&(yield new Promise((c,h)=>{this.safeEmit("@setmaxspatiallayer",o,c,h)}).catch(()=>{}),this._maxSpatialLayer=o)})}setRtpEncodingParameters(o){return B(this,null,function*(){if(this._closed)throw new n.InvalidStateError("closed");if(typeof o!="object")throw new TypeError("invalid params");yield new Promise((c,h)=>{this.safeEmit("@setrtpencodingparameters",o,c,h)})})}onTrackEnded(){r.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};t.Producer=s}}),lm=Ce({"../../node_modules/mediasoup-client/lib/Consumer.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;var e=Vi(),i=Bs(),n=Sn(),r=new e.Logger("Consumer"),s=class extends i.EnhancedEventEmitter{constructor({id:o,localId:c,producerId:h,rtpReceiver:l,track:p,rtpParameters:g,appData:f}){super(),le(this,"_id"),le(this,"_localId"),le(this,"_producerId"),le(this,"_closed",!1),le(this,"_rtpReceiver"),le(this,"_track"),le(this,"_rtpParameters"),le(this,"_paused"),le(this,"_appData"),le(this,"_observer",new i.EnhancedEventEmitter),r.debug("constructor()"),this._id=o,this._localId=c,this._producerId=h,this._rtpReceiver=l,this._track=p,this._rtpParameters=g,this._paused=!p.enabled,this._appData=f??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(r.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(r.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return B(this,null,function*(){if(this._closed)throw new n.InvalidStateError("closed");return new Promise((o,c)=>{this.safeEmit("@getstats",o,c)})})}pause(){if(r.debug("pause()"),this._closed){r.error("pause() | Consumer closed");return}if(this._paused){r.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(r.debug("resume()"),this._closed){r.error("resume() | Consumer closed");return}if(!this._paused){r.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){r.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};t.Consumer=s}}),dm=Ce({"../../node_modules/mediasoup-client/lib/DataProducer.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;var e=Vi(),i=Bs(),n=Sn(),r=new e.Logger("DataProducer"),s=class extends i.EnhancedEventEmitter{constructor({id:o,dataChannel:c,sctpStreamParameters:h,appData:l}){super(),le(this,"_id"),le(this,"_dataChannel"),le(this,"_closed",!1),le(this,"_sctpStreamParameters"),le(this,"_appData"),le(this,"_observer",new i.EnhancedEventEmitter),r.debug("constructor()"),this._id=o,this._dataChannel=c,this._sctpStreamParameters=h,this._appData=l??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(o){this._dataChannel.bufferedAmountLowThreshold=o}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(r.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(r.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(o){if(r.debug("send()"),this._closed)throw new n.InvalidStateError("closed");this._dataChannel.send(o)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(r.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",o=>{if(this._closed)return;let{error:c}=o;c||(c=new Error("unknown DataChannel error")),c.errorDetail==="sctp-failure"?r.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",c.sctpCauseCode,c.message):r.error('DataChannel "error" event: %o',c),this.safeEmit("error",c)}),this._dataChannel.addEventListener("close",()=>{this._closed||(r.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||r.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};t.DataProducer=s}}),um=Ce({"../../node_modules/mediasoup-client/lib/DataConsumer.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;var e=Vi(),i=Bs(),n=new e.Logger("DataConsumer"),r=class extends i.EnhancedEventEmitter{constructor({id:s,dataProducerId:o,dataChannel:c,sctpStreamParameters:h,appData:l}){super(),le(this,"_id"),le(this,"_dataProducerId"),le(this,"_dataChannel"),le(this,"_closed",!1),le(this,"_sctpStreamParameters"),le(this,"_appData"),le(this,"_observer",new i.EnhancedEventEmitter),n.debug("constructor()"),this._id=s,this._dataProducerId=o,this._dataChannel=c,this._sctpStreamParameters=h,this._appData=l??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(s){this._dataChannel.binaryType=s}get appData(){return this._appData}set appData(s){this._appData=s}get observer(){return this._observer}close(){this._closed||(n.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(n.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",s=>{if(this._closed)return;let{error:o}=s;o||(o=new Error("unknown DataChannel error")),o.errorDetail==="sctp-failure"?n.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",o.sctpCauseCode,o.message):n.error('DataChannel "error" event: %o',o),this.safeEmit("error",o)}),this._dataChannel.addEventListener("close",()=>{this._closed||(n.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",s=>{this._closed||this.safeEmit("message",s.data)})}};t.DataConsumer=r}}),hm=Ce({"../../node_modules/mediasoup-client/lib/Transport.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;var e=Sb(),i=Vi(),n=Bs(),r=Sn(),s=Qi(),o=wn(),c=cm(),h=lm(),l=dm(),p=um(),g=new i.Logger("Transport"),f=class{constructor(x){le(this,"consumerOptions"),le(this,"promise"),le(this,"resolve"),le(this,"reject"),this.consumerOptions=x,this.promise=new Promise((S,v)=>{this.resolve=S,this.reject=v})}},y=class extends n.EnhancedEventEmitter{constructor({direction:x,id:S,iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,iceServers:C,iceTransportPolicy:A,additionalSettings:M,proprietaryConstraints:F,appData:N,handlerFactory:P,extendedRtpCapabilities:j,canProduceByKind:K}){var X;super(),le(this,"_id"),le(this,"_closed",!1),le(this,"_direction"),le(this,"_extendedRtpCapabilities"),le(this,"_canProduceByKind"),le(this,"_maxSctpMessageSize"),le(this,"_handler"),le(this,"_iceGatheringState","new"),le(this,"_connectionState","new"),le(this,"_appData"),le(this,"_producers",new Map),le(this,"_consumers",new Map),le(this,"_dataProducers",new Map),le(this,"_dataConsumers",new Map),le(this,"_probatorConsumerCreated",!1),le(this,"_awaitQueue",new e.AwaitQueue),le(this,"_pendingConsumerTasks",[]),le(this,"_consumerCreationInProgress",!1),le(this,"_pendingPauseConsumers",new Map),le(this,"_consumerPauseInProgress",!1),le(this,"_pendingResumeConsumers",new Map),le(this,"_consumerResumeInProgress",!1),le(this,"_pendingCloseConsumers",new Map),le(this,"_consumerCloseInProgress",!1),le(this,"_observer",new n.EnhancedEventEmitter),g.debug("constructor() [id:%s, direction:%s]",S,x),this._id=S,this._direction=x,this._extendedRtpCapabilities=j,this._canProduceByKind=K,this._maxSctpMessageSize=b?b.maxMessageSize:null;const ie=(X=s.clone(M))!=null?X:{};delete ie.iceServers,delete ie.iceTransportPolicy,delete ie.bundlePolicy,delete ie.rtcpMuxPolicy,delete ie.sdpSemantics,this._handler=P(),this._handler.run({direction:x,iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,iceServers:C,iceTransportPolicy:A,additionalSettings:ie,proprietaryConstraints:F,extendedRtpCapabilities:j}),this._appData=N??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(x){this._appData=x}get observer(){return this._observer}close(){if(!this._closed){g.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const x of this._producers.values())x.transportClosed();this._producers.clear();for(const x of this._consumers.values())x.transportClosed();this._consumers.clear();for(const x of this._dataProducers.values())x.transportClosed();this._dataProducers.clear();for(const x of this._dataConsumers.values())x.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}getStats(){return B(this,null,function*(){if(this._closed)throw new r.InvalidStateError("closed");return this._handler.getTransportStats()})}restartIce(x){return B(this,arguments,function*({iceParameters:S}){if(g.debug("restartIce()"),this._closed)throw new r.InvalidStateError("closed");if(!S)throw new TypeError("missing iceParameters");return this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.restartIce(S)}),"transport.restartIce()")})}updateIceServers(){return B(this,arguments,function*({iceServers:x}={}){if(g.debug("updateIceServers()"),this._closed)throw new r.InvalidStateError("closed");if(!Array.isArray(x))throw new TypeError("missing iceServers");return this._awaitQueue.push(()=>B(this,null,function*(){return this._handler.updateIceServers(x)}),"transport.updateIceServers()")})}produce(){return B(this,arguments,function*({track:x,encodings:S,codecOptions:v,codec:m,stopTracks:w=!0,disableTrackOnPause:b=!0,zeroRtpOnPause:C=!1,onRtpSender:A,appData:M={}}={}){if(g.debug("produce() [track:%o]",x),this._closed)throw new r.InvalidStateError("closed");if(x){if(this._direction!=="send")throw new r.UnsupportedError("not a sending Transport");if(this._canProduceByKind[x.kind]){if(x.readyState==="ended")throw new r.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(M&&typeof M!="object")throw new TypeError("if given, appData must be an object")}else throw new r.UnsupportedError(`cannot produce ${x.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(()=>B(this,null,function*(){let F;if(S&&!Array.isArray(S))throw TypeError("encodings must be an array");S&&S.length===0?F=void 0:S&&(F=S.map(K=>{const X={active:!0};return K.active===!1&&(X.active=!1),typeof K.dtx=="boolean"&&(X.dtx=K.dtx),typeof K.scalabilityMode=="string"&&(X.scalabilityMode=K.scalabilityMode),typeof K.scaleResolutionDownBy=="number"&&(X.scaleResolutionDownBy=K.scaleResolutionDownBy),typeof K.maxBitrate=="number"&&(X.maxBitrate=K.maxBitrate),typeof K.maxFramerate=="number"&&(X.maxFramerate=K.maxFramerate),typeof K.adaptivePtime=="boolean"&&(X.adaptivePtime=K.adaptivePtime),typeof K.priority=="string"&&(X.priority=K.priority),typeof K.networkPriority=="string"&&(X.networkPriority=K.networkPriority),X}));const{localId:N,rtpParameters:P,rtpSender:j}=yield this._handler.send({track:x,encodings:F,codecOptions:v,codec:m,onRtpSender:A});try{o.validateRtpParameters(P);const{id:K}=yield new Promise((ie,q)=>{this.safeEmit("produce",{kind:x.kind,rtpParameters:P,appData:M},ie,q)}),X=new c.Producer({id:K,localId:N,rtpSender:j,track:x,rtpParameters:P,stopTracks:w,disableTrackOnPause:b,zeroRtpOnPause:C,appData:M});return this._producers.set(X.id,X),this.handleProducer(X),this._observer.safeEmit("newproducer",X),X}catch(K){throw this._handler.stopSending(N).catch(()=>{}),K}}),"transport.produce()").catch(F=>{if(w)try{x.stop()}catch{}throw F})})}consume(x){return B(this,arguments,function*({id:S,producerId:v,kind:m,rtpParameters:w,streamId:b,onRtpReceiver:C,appData:A={}}){if(g.debug("consume()"),this._closed)throw new r.InvalidStateError("closed");if(this._direction!=="recv")throw new r.UnsupportedError("not a receiving Transport");if(typeof S!="string")throw new TypeError("missing id");if(typeof v!="string")throw new TypeError("missing producerId");if(m!=="audio"&&m!=="video")throw new TypeError(`invalid kind '${m}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(A&&typeof A!="object")throw new TypeError("if given, appData must be an object");const M=s.clone(w);if(!o.canReceive(M,this._extendedRtpCapabilities))throw new r.UnsupportedError("cannot consume this Producer");const N=new f({id:S,producerId:v,kind:m,rtpParameters:M,streamId:b,onRtpReceiver:C,appData:A});return this._pendingConsumerTasks.push(N),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),N.promise})}produceData(){return B(this,arguments,function*({ordered:x=!0,maxPacketLifeTime:S,maxRetransmits:v,label:m="",protocol:w="",appData:b={}}={}){if(g.debug("produceData()"),this._closed)throw new r.InvalidStateError("closed");if(this._direction!=="send")throw new r.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(b&&typeof b!="object")throw new TypeError("if given, appData must be an object")}else throw new r.UnsupportedError("SCTP not enabled by remote Transport");return(S||v)&&(x=!1),this._awaitQueue.push(()=>B(this,null,function*(){const{dataChannel:C,sctpStreamParameters:A}=yield this._handler.sendDataChannel({ordered:x,maxPacketLifeTime:S,maxRetransmits:v,label:m,protocol:w});o.validateSctpStreamParameters(A);const{id:M}=yield new Promise((N,P)=>{this.safeEmit("producedata",{sctpStreamParameters:A,label:m,protocol:w,appData:b},N,P)}),F=new l.DataProducer({id:M,dataChannel:C,sctpStreamParameters:A,appData:b});return this._dataProducers.set(F.id,F),this.handleDataProducer(F),this._observer.safeEmit("newdataproducer",F),F}),"transport.produceData()")})}consumeData(x){return B(this,arguments,function*({id:S,dataProducerId:v,sctpStreamParameters:m,label:w="",protocol:b="",appData:C={}}){if(g.debug("consumeData()"),this._closed)throw new r.InvalidStateError("closed");if(this._direction!=="recv")throw new r.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof S!="string")throw new TypeError("missing id");if(typeof v!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(C&&typeof C!="object")throw new TypeError("if given, appData must be an object")}else throw new r.UnsupportedError("SCTP not enabled by remote Transport");const A=s.clone(m);return o.validateSctpStreamParameters(A),this._awaitQueue.push(()=>B(this,null,function*(){const{dataChannel:M}=yield this._handler.receiveDataChannel({sctpStreamParameters:A,label:w,protocol:b}),F=new p.DataConsumer({id:S,dataProducerId:v,dataChannel:M,sctpStreamParameters:A,appData:C});return this._dataConsumers.set(F.id,F),this.handleDataConsumer(F),this._observer.safeEmit("newdataconsumer",F),F}),"transport.consumeData()")})}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingConsumerTasks.length===0){g.debug("createPendingConsumers() | there is no Consumer to be created");return}const x=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let S;const v=[];for(const m of x){const{id:w,kind:b,rtpParameters:C,streamId:A,onRtpReceiver:M}=m.consumerOptions;v.push({trackId:w,kind:b,rtpParameters:C,streamId:A,onRtpReceiver:M})}try{const m=yield this._handler.receive(v);for(let w=0;w<m.length;++w){const b=x[w],C=m[w],{id:A,producerId:M,kind:F,rtpParameters:N,appData:P}=b.consumerOptions,{localId:j,rtpReceiver:K,track:X}=C,ie=new h.Consumer({id:A,localId:j,producerId:M,rtpReceiver:K,track:X,rtpParameters:N,appData:P});this._consumers.set(ie.id,ie),this.handleConsumer(ie),!this._probatorConsumerCreated&&!S&&F==="video"&&(S=ie),this._observer.safeEmit("newconsumer",ie),b.resolve(ie)}}catch(m){for(const w of x)w.reject(m)}if(S)try{const m=o.generateProbatorRtpParameters(S.rtpParameters);yield this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:m}]),g.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(m){g.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",m)}}),"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingPauseConsumers.size===0){g.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const x=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const S=x.map(v=>v.localId);yield this._handler.pauseReceiving(S)}catch(S){g.error("pausePendingConsumers() | failed to pause Consumers:",S)}}),"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingResumeConsumers.size===0){g.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const x=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const S=x.map(v=>v.localId);yield this._handler.resumeReceiving(S)}catch(S){g.error("resumePendingConsumers() | failed to resume Consumers:",S)}}),"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingCloseConsumers.size===0){g.debug("closePendingConsumers() | there is no Consumer to be closed");return}const x=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{yield this._handler.stopReceiving(x.map(S=>S.localId))}catch(S){g.error("closePendingConsumers() | failed to close Consumers:",S)}}),"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const x=this._handler;x.on("@connect",({dtlsParameters:S},v,m)=>{if(this._closed){m(new r.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:S},v,m)}),x.on("@icegatheringstatechange",S=>{S!==this._iceGatheringState&&(g.debug("ICE gathering state changed to %s",S),this._iceGatheringState=S,this._closed||this.safeEmit("icegatheringstatechange",S))}),x.on("@icecandidateerror",S=>{g.warn(`ICE candidate error [url:${S.url}, localAddress:${S.address}, localPort:${S.port}]: ${S.errorCode} "${S.errorText}"`),this.safeEmit("icecandidateerror",S)}),x.on("@connectionstatechange",S=>{S!==this._connectionState&&(g.debug("connection state changed to %s",S),this._connectionState=S,this._closed||this.safeEmit("connectionstatechange",S))})}handleProducer(x){x.on("@close",()=>{this._producers.delete(x.id),!this._closed&&this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.stopSending(x.localId)}),"producer @close event").catch(S=>g.warn("producer.close() failed:%o",S))}),x.on("@pause",(S,v)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.pauseSending(x.localId)}),"producer @pause event").then(S).catch(v)}),x.on("@resume",(S,v)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.resumeSending(x.localId)}),"producer @resume event").then(S).catch(v)}),x.on("@replacetrack",(S,v,m)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.replaceTrack(x.localId,S)}),"producer @replacetrack event").then(v).catch(m)}),x.on("@setmaxspatiallayer",(S,v,m)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.setMaxSpatialLayer(x.localId,S)}),"producer @setmaxspatiallayer event").then(v).catch(m)}),x.on("@setrtpencodingparameters",(S,v,m)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.setRtpEncodingParameters(x.localId,S)}),"producer @setrtpencodingparameters event").then(v).catch(m)}),x.on("@getstats",(S,v)=>{if(this._closed)return v(new r.InvalidStateError("closed"));this._handler.getSenderStats(x.localId).then(S).catch(v)})}handleConsumer(x){x.on("@close",()=>{this._consumers.delete(x.id),this._pendingPauseConsumers.delete(x.id),this._pendingResumeConsumers.delete(x.id),!this._closed&&(this._pendingCloseConsumers.set(x.id,x),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),x.on("@pause",()=>{this._pendingResumeConsumers.has(x.id)&&this._pendingResumeConsumers.delete(x.id),this._pendingPauseConsumers.set(x.id,x),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),x.on("@resume",()=>{this._pendingPauseConsumers.has(x.id)&&this._pendingPauseConsumers.delete(x.id),this._pendingResumeConsumers.set(x.id,x),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),x.on("@getstats",(S,v)=>{if(this._closed)return v(new r.InvalidStateError("closed"));this._handler.getReceiverStats(x.localId).then(S).catch(v)})}handleDataProducer(x){x.on("@close",()=>{this._dataProducers.delete(x.id)})}handleDataConsumer(x){x.on("@close",()=>{this._dataConsumers.delete(x.id)})}};t.Transport=y}}),Fr=Ce({"../../node_modules/mediasoup-client/lib/handlers/sdp/commonUtils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.extractRtpCapabilities=i,t.extractDtlsParameters=n,t.getCname=r,t.applyCodecParameters=s;var e=hn();function i({sdpObject:o}){var c,h,l;const p=new Map,g=[];let f=!1,y=!1;for(const S of o.media){const v=S.type;switch(v){case"audio":{if(f)continue;f=!0;break}case"video":{if(y)continue;y=!0;break}default:continue}for(const m of S.rtp){const w={kind:v,mimeType:`${v}/${m.codec}`,preferredPayloadType:m.payload,clockRate:m.rate,channels:m.encoding,parameters:{},rtcpFeedback:[]};p.set(w.preferredPayloadType,w)}for(const m of(c=S.fmtp)!=null?c:[]){const w=e.parseParams(m.config),b=p.get(m.payload);b&&(w!=null&&w.hasOwnProperty("profile-level-id")&&(w["profile-level-id"]=String(w["profile-level-id"])),b.parameters=w)}for(const m of(h=S.rtcpFb)!=null?h:[]){const w={type:m.type,parameter:m.subtype};if(w.parameter||delete w.parameter,m.payload!=="*"){const b=p.get(m.payload);if(!b)continue;b.rtcpFeedback.push(w)}else for(const b of p.values())b.kind===v&&!/.+\/rtx$/i.test(b.mimeType)&&b.rtcpFeedback.push(w)}for(const m of(l=S.ext)!=null?l:[]){if(m["encrypt-uri"])continue;const w={kind:v,uri:m.uri,preferredId:m.value};g.push(w)}}return{codecs:Array.from(p.values()),headerExtensions:g}}function n({sdpObject:o}){var c;let h=o.setup,l=o.fingerprint;if(!h||!l){const f=((c=o.media)!=null?c:[]).find(y=>y.port!==0);f&&(h??(h=f.setup),l??(l=f.fingerprint))}if(h){if(!l)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let p;switch(h){case"active":{p="client";break}case"passive":{p="server";break}case"actpass":{p="auto";break}}return{role:p,fingerprints:[{algorithm:l.type,value:l.hash}]}}function r({offerMediaObject:o}){var c;const h=((c=o.ssrcs)!=null?c:[]).find(l=>l.attribute==="cname");return h?h.value:""}function s({offerRtpParameters:o,answerMediaObject:c}){var h,l;for(const p of o.codecs){const g=p.mimeType.toLowerCase();if(g!=="audio/opus"||!((h=c.rtp)!=null?h:[]).find(S=>S.payload===p.payloadType))continue;c.fmtp=(l=c.fmtp)!=null?l:[];let y=c.fmtp.find(S=>S.payload===p.payloadType);y||(y={payload:p.payloadType,config:""},c.fmtp.push(y));const x=e.parseParams(y.config);switch(g){case"audio/opus":{const S=p.parameters["sprop-stereo"];S!==void 0&&(x.stereo=Number(S)?1:0);break}}y.config="";for(const S of Object.keys(x))y.config&&(y.config+=";"),y.config+=`${S}=${x[S]}`}}}}),va=Ce({"../../node_modules/mediasoup-client/lib/handlers/sdp/unifiedPlanUtils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=e,t.addLegacySimulcast=i;function e({offerMediaObject:n}){var r,s;const o=new Set;for(const l of(r=n.ssrcs)!=null?r:[]){const p=l.id;o.add(p)}if(o.size===0)throw new Error("no a=ssrc lines found");const c=new Map;for(const l of(s=n.ssrcGroups)!=null?s:[]){if(l.semantics!=="FID")continue;let[p,g]=l.ssrcs.split(/\s+/);p=Number(p),g=Number(g),o.has(p)&&(o.delete(p),o.delete(g),c.set(p,g))}for(const l of o)c.set(l,null);const h=[];for(const[l,p]of c){const g={ssrc:l};p&&(g.rtx={ssrc:p}),h.push(g)}return h}function i({offerMediaObject:n,numStreams:r}){var s,o;if(r<=1)throw new TypeError("numStreams must be greater than 1");const c=((s=n.ssrcs)!=null?s:[]).find(v=>v.attribute==="msid");if(!c)throw new Error("a=ssrc line with msid information not found");const[h,l]=c.value.split(" "),p=Number(c.id);let g;((o=n.ssrcGroups)!=null?o:[]).some(v=>{if(v.semantics!=="FID")return!1;const m=v.ssrcs.split(/\s+/);return Number(m[0])===p?(g=Number(m[1]),!0):!1});const f=n.ssrcs.find(v=>v.attribute==="cname");if(!f)throw new Error("a=ssrc line with cname information not found");const y=f.value,x=[],S=[];for(let v=0;v<r;++v)x.push(p+v),g&&S.push(g+v);n.ssrcGroups=[],n.ssrcs=[],n.ssrcGroups.push({semantics:"SIM",ssrcs:x.join(" ")});for(const v of x)n.ssrcs.push({id:v,attribute:"cname",value:y}),n.ssrcs.push({id:v,attribute:"msid",value:`${h} ${l}`});for(let v=0;v<S.length;++v){const m=x[v],w=S[v];n.ssrcs.push({id:w,attribute:"cname",value:y}),n.ssrcs.push({id:w,attribute:"msid",value:`${h} ${l}`}),n.ssrcGroups.push({semantics:"FID",ssrcs:`${m} ${w}`})}}}}),Il=Ce({"../../node_modules/mediasoup-client/lib/handlers/ortc/utils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSupportForOpus=e;function e(i){var n,r;for(const s of(n=i.codecs)!=null?n:[])(s.mimeType.toLowerCase()==="audio/opus"||s.mimeType.toLowerCase()==="audio/multiopus")&&!((r=s.rtcpFeedback)!=null&&r.some(o=>o.type==="nack"&&!o.parameter))&&(s.rtcpFeedback||(s.rtcpFeedback=[]),s.rtcpFeedback.push({type:"nack"}))}}}),Wn=Ce({"../../node_modules/mediasoup-client/lib/handlers/HandlerInterface.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;var e=Bs(),i=class extends e.EnhancedEventEmitter{constructor(){super()}};t.HandlerInterface=i}}),wb=Ce({"../../node_modules/mediasoup-client/lib/handlers/sdp/MediaSection.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;var e=hn(),i=Qi(),n=class{constructor({iceParameters:c,iceCandidates:h,dtlsParameters:l,planB:p=!1}){le(this,"_mediaObject"),le(this,"_planB");var g;if(this._mediaObject={},this._planB=p,c&&this.setIceParameters(c),h){this._mediaObject.candidates=[];for(const f of h){const y={};y.component=1,y.foundation=f.foundation,y.ip=(g=f.address)!=null?g:f.ip,y.port=f.port,y.priority=f.priority,y.transport=f.protocol,y.type=f.type,f.tcpType&&(y.tcptype=f.tcpType),this._mediaObject.candidates.push(y)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}l&&this.setDtlsRole(l.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(c){this._mediaObject.iceUfrag=c.usernameFragment,this._mediaObject.icePwd=c.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};t.MediaSection=n;var r=class extends n{constructor({iceParameters:c,iceCandidates:h,dtlsParameters:l,sctpParameters:p,plainRtpParameters:g,planB:f=!1,offerMediaObject:y,offerRtpParameters:x,answerRtpParameters:S,codecOptions:v}){var m,w,b,C,A;switch(super({iceParameters:c,iceCandidates:h,dtlsParameters:l,planB:f}),this._mediaObject.mid=String(y.mid),this._mediaObject.type=y.type,this._mediaObject.protocol=y.protocol,g?(this._mediaObject.connection={ip:g.ip,version:g.ipVersion},this._mediaObject.port=g.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),y.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const M of S.codecs){const F={payload:M.payloadType,codec:o(M),rate:M.clockRate};M.channels>1&&(F.encoding=M.channels),this._mediaObject.rtp.push(F);const N=(m=i.clone(M.parameters))!=null?m:{};let P=(w=i.clone(M.rtcpFeedback))!=null?w:[];if(v){const{opusStereo:K,opusFec:X,opusDtx:ie,opusMaxPlaybackRate:q,opusMaxAverageBitrate:ae,opusPtime:pe,opusNack:ue,videoGoogleStartBitrate:xe,videoGoogleMaxBitrate:Ee,videoGoogleMinBitrate:ye}=v,ge=x.codecs.find(Te=>Te.payloadType===M.payloadType);switch(M.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{K!==void 0&&(ge.parameters["sprop-stereo"]=K?1:0,N.stereo=K?1:0),X!==void 0&&(ge.parameters.useinbandfec=X?1:0,N.useinbandfec=X?1:0),ie!==void 0&&(ge.parameters.usedtx=ie?1:0,N.usedtx=ie?1:0),q!==void 0&&(N.maxplaybackrate=q),ae!==void 0&&(N.maxaveragebitrate=ae),pe!==void 0&&(ge.parameters.ptime=pe,N.ptime=pe),ue||(ge.rtcpFeedback=ge.rtcpFeedback.filter(Te=>Te.type!=="nack"||Te.parameter),P=P.filter(Te=>Te.type!=="nack"||Te.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{xe!==void 0&&(N["x-google-start-bitrate"]=xe),Ee!==void 0&&(N["x-google-max-bitrate"]=Ee),ye!==void 0&&(N["x-google-min-bitrate"]=ye);break}}}const j={payload:M.payloadType,config:""};for(const K of Object.keys(N))j.config&&(j.config+=";"),j.config+=`${K}=${N[K]}`;j.config&&this._mediaObject.fmtp.push(j);for(const K of P)this._mediaObject.rtcpFb.push({payload:M.payloadType,type:K.type,subtype:K.parameter})}this._mediaObject.payloads=S.codecs.map(M=>M.payloadType).join(" "),this._mediaObject.ext=[];for(const M of S.headerExtensions)((b=y.ext)!=null?b:[]).some(N=>N.uri===M.uri)&&this._mediaObject.ext.push({uri:M.uri,value:M.id});if(y.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),y.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:y.simulcast.list1},this._mediaObject.rids=[];for(const M of(C=y.rids)!=null?C:[])M.direction==="send"&&this._mediaObject.rids.push({id:M.id,direction:"recv"})}else if(y.simulcast_03){this._mediaObject.simulcast_03={value:y.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const M of(A=y.rids)!=null?A:[])M.direction==="send"&&this._mediaObject.rids.push({id:M.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof y.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=p.port,this._mediaObject.maxMessageSize=p.maxMessageSize):y.sctpmap&&(this._mediaObject.payloads=p.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:p.port,maxMessageSize:p.maxMessageSize});break}}}setDtlsRole(c){switch(c){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(c){var h,l;if(!((h=this._mediaObject.simulcast)!=null&&h.list1))return;const p={};for(const y of c)y.rid&&(p[y.rid]=y);const g=this._mediaObject.simulcast.list1,f=e.parseSimulcastStreamList(g);for(const y of f)for(const x of y)x.paused=!((l=p[x.scid])!=null&&l.active);this._mediaObject.simulcast.list1=f.map(y=>y.map(x=>`${x.paused?"~":""}${x.scid}`).join(",")).join(";")}};t.AnswerMediaSection=r;var s=class extends n{constructor({iceParameters:c,iceCandidates:h,dtlsParameters:l,sctpParameters:p,plainRtpParameters:g,planB:f=!1,mid:y,kind:x,offerRtpParameters:S,streamId:v,trackId:m,oldDataChannelSpec:w=!1}){var b;switch(super({iceParameters:c,iceCandidates:h,dtlsParameters:l,planB:f}),this._mediaObject.mid=String(y),this._mediaObject.type=x,g?(this._mediaObject.connection={ip:g.ip,version:g.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=g.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},p?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",x){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${v??"-"} ${m}`);for(const F of S.codecs){const N={payload:F.payloadType,codec:o(F),rate:F.clockRate};F.channels>1&&(N.encoding=F.channels),this._mediaObject.rtp.push(N);const P={payload:F.payloadType,config:""};for(const j of Object.keys(F.parameters))P.config&&(P.config+=";"),P.config+=`${j}=${F.parameters[j]}`;P.config&&this._mediaObject.fmtp.push(P);for(const j of F.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:F.payloadType,type:j.type,subtype:j.parameter})}this._mediaObject.payloads=S.codecs.map(F=>F.payloadType).join(" "),this._mediaObject.ext=[];for(const F of S.headerExtensions)this._mediaObject.ext.push({uri:F.uri,value:F.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const C=S.encodings[0],A=C.ssrc,M=(b=C.rtx)==null?void 0:b.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],S.rtcp.cname&&this._mediaObject.ssrcs.push({id:A,attribute:"cname",value:S.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:A,attribute:"msid",value:`${v??"-"} ${m}`}),M&&(S.rtcp.cname&&this._mediaObject.ssrcs.push({id:M,attribute:"cname",value:S.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:M,attribute:"msid",value:`${v??"-"} ${m}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${A} ${M}`}));break}case"application":{w?(this._mediaObject.payloads=p.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:p.port,maxMessageSize:p.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=p.port,this._mediaObject.maxMessageSize=p.maxMessageSize);break}}}setDtlsRole(c){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:c,streamId:h,trackId:l}){var p;const g=c.encodings[0],f=g.ssrc,y=(p=g.rtx)==null?void 0:p.ssrc,x=this._mediaObject.payloads.split(" ");for(const S of c.codecs){if(x.includes(String(S.payloadType)))continue;const v={payload:S.payloadType,codec:o(S),rate:S.clockRate};S.channels>1&&(v.encoding=S.channels),this._mediaObject.rtp.push(v);const m={payload:S.payloadType,config:""};for(const w of Object.keys(S.parameters))m.config&&(m.config+=";"),m.config+=`${w}=${S.parameters[w]}`;m.config&&this._mediaObject.fmtp.push(m);for(const w of S.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:S.payloadType,type:w.type,subtype:w.parameter})}this._mediaObject.payloads+=` ${c.codecs.filter(S=>!this._mediaObject.payloads.includes(S.payloadType)).map(S=>S.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),c.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:c.rtcp.cname}),this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${h??"-"} ${l}`}),y&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:y,attribute:"cname",value:c.rtcp.cname}),this._mediaObject.ssrcs.push({id:y,attribute:"msid",value:`${h??"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${y}`}))}planBStopReceiving({offerRtpParameters:c}){var h;const l=c.encodings[0],p=l.ssrc,g=(h=l.rtx)==null?void 0:h.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(f=>f.id!==p&&f.id!==g),g&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(f=>f.ssrcs!==`${p} ${g}`))}};t.OfferMediaSection=s;function o(c){const l=new RegExp("^(audio|video)/(.+)","i").exec(c.mimeType);if(!l)throw new TypeError("invalid codec.mimeType");return l[2]}}}),kr=Ce({"../../node_modules/mediasoup-client/lib/handlers/sdp/RemoteSdp.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;var e=hn(),i=Vi(),n=wb(),r=new i.Logger("RemoteSdp"),s=class{constructor({iceParameters:o,iceCandidates:c,dtlsParameters:h,sctpParameters:l,plainRtpParameters:p,planB:g=!1}){if(le(this,"_iceParameters"),le(this,"_iceCandidates"),le(this,"_dtlsParameters"),le(this,"_sctpParameters"),le(this,"_plainRtpParameters"),le(this,"_planB"),le(this,"_mediaSections",[]),le(this,"_midToIndex",new Map),le(this,"_firstMid"),le(this,"_sdpObject"),this._iceParameters=o,this._iceCandidates=c,this._dtlsParameters=h,this._sctpParameters=l,this._plainRtpParameters=p,this._planB=g,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},o!=null&&o.iceLite&&(this._sdpObject.icelite="ice-lite"),h){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const f=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:h.fingerprints[f-1].algorithm,hash:h.fingerprints[f-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}p&&(this._sdpObject.origin.address=p.ip,this._sdpObject.origin.ipVer=p.ipVersion)}updateIceParameters(o){r.debug("updateIceParameters() [iceParameters:%o]",o),this._iceParameters=o,this._sdpObject.icelite=o.iceLite?"ice-lite":void 0;for(const c of this._mediaSections)c.setIceParameters(o)}updateDtlsRole(o){r.debug("updateDtlsRole() [role:%s]",o),this._dtlsParameters.role=o;for(const c of this._mediaSections)c.setDtlsRole(o)}setSessionExtmapAllowMixed(){r.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let o=0;o<this._mediaSections.length;++o){const c=this._mediaSections[o];if(c.closed)return{idx:o,reuseMid:c.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:o,reuseMid:c,offerRtpParameters:h,answerRtpParameters:l,codecOptions:p}){const g=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:o,offerRtpParameters:h,answerRtpParameters:l,codecOptions:p});c?this._replaceMediaSection(g,c):this._midToIndex.has(g.mid)?this._replaceMediaSection(g):this._addMediaSection(g)}receive({mid:o,kind:c,offerRtpParameters:h,streamId:l,trackId:p}){const g=this._midToIndex.get(o);let f;if(g!==void 0&&(f=this._mediaSections[g]),this.setSessionExtmapAllowMixed(),f)f.planBReceive({offerRtpParameters:h,streamId:l,trackId:p}),this._replaceMediaSection(f);else{f=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:o,kind:c,offerRtpParameters:h,streamId:l,trackId:p});const y=this._mediaSections.find(x=>x.closed);y?this._replaceMediaSection(f,y.mid):this._addMediaSection(f)}}pauseMediaSection(o){this._findMediaSection(o).pause()}resumeSendingMediaSection(o){this._findMediaSection(o).resume()}resumeReceivingMediaSection(o){this._findMediaSection(o).resume()}disableMediaSection(o){this._findMediaSection(o).disable()}closeMediaSection(o){const c=this._findMediaSection(o);return o===this._firstMid?(r.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",o),this.disableMediaSection(o),!1):(c.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(o,c){const h=this._findMediaSection(o);h.muxSimulcastStreams(c),this._replaceMediaSection(h)}planBStopReceiving({mid:o,offerRtpParameters:c}){const h=this._findMediaSection(o);h.planBStopReceiving({offerRtpParameters:c}),this._replaceMediaSection(h)}sendSctpAssociation({offerMediaObject:o}){const c=new n.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:o});this._addMediaSection(c)}receiveSctpAssociation({oldDataChannelSpec:o=!1}={}){const c=new n.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:o});this._addMediaSection(c)}getSdp(){return this._sdpObject.origin.sessionVersion++,e.write(this._sdpObject)}_addMediaSection(o){this._firstMid||(this._firstMid=o.mid),this._mediaSections.push(o),this._midToIndex.set(o.mid,this._mediaSections.length-1),this._sdpObject.media.push(o.getObject()),this._regenerateBundleMids()}_replaceMediaSection(o,c){if(typeof c=="string"){const h=this._midToIndex.get(c);if(h===void 0)throw new Error(`no media section found for reuseMid '${c}'`);const l=this._mediaSections[h];this._mediaSections[h]=o,this._midToIndex.delete(l.mid),this._midToIndex.set(o.mid,h),this._sdpObject.media[h]=o.getObject(),this._regenerateBundleMids()}else{const h=this._midToIndex.get(o.mid);if(h===void 0)throw new Error(`no media section found with mid '${o.mid}'`);this._mediaSections[h]=o,this._sdpObject.media[h]=o.getObject()}}_findMediaSection(o){const c=this._midToIndex.get(o);if(c===void 0)throw new Error(`no media section found with mid '${o}'`);return this._mediaSections[c]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(o=>!o.closed).map(o=>o.mid).join(" "))}};t.RemoteSdp=s}}),Hs=Ce({"../../node_modules/mediasoup-client/lib/scalabilityModes.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.parse=i;var e=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function i(n){const r=e.exec(n??"");return r?{spatialLayers:Number(r[1]),temporalLayers:Number(r[2])}:{spatialLayers:1,temporalLayers:1}}}}),xb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Chrome111.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=va(),c=Il(),h=Sn(),l=Wn(),p=kr(),g=Hs(),f=new i.Logger("Chrome111"),y="Chrome111",x={OS:1024,MIS:1024},S=class pm extends l.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new pm}get name(){return y}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){f.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{m.addTransceiver("audio"),m.addTransceiver("video");const w=yield m.createOffer();try{m.close()}catch{}const b=e.parse(w.sdp),C=s.extractRtpCapabilities({sdpObject:b});return c.addNackSupportForOpus(C),C}catch(w){try{m.close()}catch{}throw w}})}getNativeSctpCapabilities(){return B(this,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:x}})}run({direction:m,iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A,iceServers:M,iceTransportPolicy:F,additionalSettings:N,proprietaryConstraints:P,extendedRtpCapabilities:j}){this.assertNotClosed(),f.debug("run()"),this._direction=m,this._remoteSdp=new p.RemoteSdp({iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",j),video:r.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",j),video:r.getSendingRemoteRtpParameters("video",j)},C.role&&C.role!=="auto"&&(this._forcedLocalDtlsRole=C.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:M??[],iceTransportPolicy:F??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},N),P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",K=>{this.emit("@icecandidateerror",K)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}updateIceServers(m){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=m,this._pc.setConfiguration(w)})}restartIce(m){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const w=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(m){return B(this,arguments,function*({track:w,encodings:b,codecOptions:C,codec:A,onRtpSender:M}){var F;if(this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),b&&b.length>1){let ue=1;for(const xe of b){const Ee=xe.scalabilityMode?(0,g.parse)(xe.scalabilityMode).temporalLayers:3;Ee>ue&&(ue=Ee)}b.forEach((xe,Ee)=>{xe.rid=`r${Ee}`,xe.scalabilityMode=`L1T${ue}`})}const N=n.clone(this._sendingRtpParametersByKind[w.kind]);N.codecs=r.reduceCodecs(N.codecs,A);const P=n.clone(this._sendingRemoteRtpParametersByKind[w.kind]);P.codecs=r.reduceCodecs(P.codecs,A);const j=this._remoteSdp.getNextMediaSectionIdx(),K=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream],sendEncodings:b});M&&M(K.sender);const X=yield this._pc.createOffer();let ie=e.parse(X.sdp);ie.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:ie})),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X);const q=K.mid;N.mid=q,ie=e.parse(this._pc.localDescription.sdp);const ae=ie.media[j.idx];if(N.rtcp.cname=s.getCname({offerMediaObject:ae}),!b)N.encodings=o.getRtpEncodings({offerMediaObject:ae});else if(b.length===1){const ue=o.getRtpEncodings({offerMediaObject:ae});Object.assign(ue[0],b[0]),N.encodings=ue}else N.encodings=b;this._remoteSdp.send({offerMediaObject:ae,reuseMid:j.reuseMid,offerRtpParameters:N,answerRtpParameters:P,codecOptions:C});const pe={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",pe),yield this._pc.setRemoteDescription(pe),this._mapMidTransceiver.set(q,K),{localId:q,rtpParameters:N,rtpSender:K.sender}})}stopSending(m){return B(this,null,function*(){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",m),this._closed)return;const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");if(w.sender.replaceTrack(null),this._pc.removeTrack(w.sender),this._remoteSdp.closeMediaSection(w.mid))try{w.stop()}catch{}const C=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A),this._mapMidTransceiver.delete(m)})}pauseSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(m);const b=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}resumeSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(this._remoteSdp.resumeSendingMediaSection(m),!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="sendonly";const b=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}replaceTrack(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),w?f.debug("replaceTrack() [localId:%s, track.id:%s]",m,w.id):f.debug("replaceTrack() [localId:%s, no track]",m);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");yield b.sender.replaceTrack(w)})}setMaxSpatialLayer(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{N<=w?F.active=!0:F.active=!1}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}setRtpEncodingParameters(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{C.encodings[N]=ne(ne({},F),w)}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}getSenderStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.sender.getStats()})}sendDataChannel(m){return B(this,arguments,function*({ordered:w,maxPacketLifeTime:b,maxRetransmits:C,label:A,protocol:M}){var F;this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:b,maxRetransmits:C,protocol:M};f.debug("sendDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(A,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const K=yield this._pc.createOffer(),X=e.parse(K.sdp),ie=X.media.find(ae=>ae.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:X})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K),this._remoteSdp.sendSctpAssociation({offerMediaObject:ie});const q={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q),this._hasDataChannelMediaSection=!0}const j={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:P,sctpStreamParameters:j}})}receive(m){return B(this,null,function*(){var w,b;this.assertNotClosed(),this.assertRecvDirection();const C=[],A=new Map;for(const P of m){const{trackId:j,kind:K,rtpParameters:X,streamId:ie}=P;f.debug("receive() [trackId:%s, kind:%s]",j,K);const q=(w=X.mid)!=null?w:String(this._mapMidTransceiver.size);A.set(j,q),this._remoteSdp.receive({mid:q,kind:K,offerRtpParameters:X,streamId:ie??X.rtcp.cname,trackId:j})}const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",M),yield this._pc.setRemoteDescription(M);for(const P of m){const{trackId:j,onRtpReceiver:K}=P;if(K){const X=A.get(j),ie=this._pc.getTransceivers().find(q=>q.mid===X);if(!ie)throw new Error("transceiver not found");K(ie.receiver)}}let F=yield this._pc.createAnswer();const N=e.parse(F.sdp);for(const P of m){const{trackId:j,rtpParameters:K}=P,X=A.get(j),ie=N.media.find(q=>String(q.mid)===X);s.applyCodecParameters({offerRtpParameters:K,answerMediaObject:ie})}F={type:"answer",sdp:e.write(N)},this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:N})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",F),yield this._pc.setLocalDescription(F);for(const P of m){const{trackId:j}=P,K=A.get(j),X=this._pc.getTransceivers().find(ie=>ie.mid===K);if(X)this._mapMidTransceiver.set(K,X),C.push({localId:K,track:X.receiver.track,rtpReceiver:X.receiver});else throw new Error("new RTCRtpTransceiver not found")}return C})}stopReceiving(m){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const C of m){f.debug("stopReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(A.mid)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b);for(const C of m)this._mapMidTransceiver.delete(C)})}pauseReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("pauseReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="inactive",this._remoteSdp.pauseMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}resumeReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("resumeReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}getReceiverStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.receiver.getStats()})}receiveDataChannel(m){return B(this,arguments,function*({sctpStreamParameters:w,label:b,protocol:C}){var A;this.assertNotClosed(),this.assertRecvDirection();const{streamId:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P}=w,j={negotiated:!0,id:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P,protocol:C};f.debug("receiveDataChannel() [options:%o]",j);const K=this._pc.createDataChannel(b,j);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const X={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ie=yield this._pc.createAnswer();if(!this._transportReady){const q=e.parse(ie.sdp);yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:q})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ie),yield this._pc.setLocalDescription(ie),this._hasDataChannelMediaSection=!0}return{dataChannel:K}})}setupTransport(m){return B(this,arguments,function*({localDtlsRole:w,localSdpObject:b}){b||(b=e.parse(this._pc.localDescription.sdp));const C=s.extractDtlsParameters({sdpObject:b});C.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),yield new Promise((A,M)=>{this.safeEmit("@connect",{dtlsParameters:C},A,M)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Chrome111=S}}),Eb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Chrome74.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=va(),c=Il(),h=Sn(),l=Wn(),p=kr(),g=Hs(),f=new i.Logger("Chrome74"),y="Chrome74",x={OS:1024,MIS:1024},S=class fm extends l.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new fm}get name(){return y}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){f.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{m.addTransceiver("audio"),m.addTransceiver("video");const w=yield m.createOffer();try{m.close()}catch{}const b=e.parse(w.sdp),C=s.extractRtpCapabilities({sdpObject:b});return c.addNackSupportForOpus(C),C}catch(w){try{m.close()}catch{}throw w}})}getNativeSctpCapabilities(){return B(this,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:x}})}run({direction:m,iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A,iceServers:M,iceTransportPolicy:F,additionalSettings:N,proprietaryConstraints:P,extendedRtpCapabilities:j}){f.debug("run()"),this._direction=m,this._remoteSdp=new p.RemoteSdp({iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",j),video:r.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",j),video:r.getSendingRemoteRtpParameters("video",j)},C.role&&C.role!=="auto"&&(this._forcedLocalDtlsRole=C.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:M??[],iceTransportPolicy:F??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},N),P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",K=>{this.emit("@icecandidateerror",K)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}updateIceServers(m){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=m,this._pc.setConfiguration(w)})}restartIce(m){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const w=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(m){return B(this,arguments,function*({track:w,encodings:b,codecOptions:C,codec:A}){var M;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),b&&b.length>1&&b.forEach((xe,Ee)=>{xe.rid=`r${Ee}`});const F=n.clone(this._sendingRtpParametersByKind[w.kind]);F.codecs=r.reduceCodecs(F.codecs,A);const N=n.clone(this._sendingRemoteRtpParametersByKind[w.kind]);N.codecs=r.reduceCodecs(N.codecs,A);const P=this._remoteSdp.getNextMediaSectionIdx(),j=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream],sendEncodings:b});let K=yield this._pc.createOffer(),X=e.parse(K.sdp);X.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let ie;this._transportReady||(yield this.setupTransport({localDtlsRole:(M=this._forcedLocalDtlsRole)!=null?M:"client",localSdpObject:X}));let q=!1;const ae=(0,g.parse)((b??[{}])[0].scalabilityMode);b&&b.length===1&&ae.spatialLayers>1&&F.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),q=!0,X=e.parse(K.sdp),ie=X.media[P.idx],o.addLegacySimulcast({offerMediaObject:ie,numStreams:ae.spatialLayers}),K={type:"offer",sdp:e.write(X)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K);const pe=j.mid;if(F.mid=pe,X=e.parse(this._pc.localDescription.sdp),ie=X.media[P.idx],F.rtcp.cname=s.getCname({offerMediaObject:ie}),!b)F.encodings=o.getRtpEncodings({offerMediaObject:ie});else if(b.length===1){let xe=o.getRtpEncodings({offerMediaObject:ie});Object.assign(xe[0],b[0]),q&&(xe=[xe[0]]),F.encodings=xe}else F.encodings=b;if(F.encodings.length>1&&(F.codecs[0].mimeType.toLowerCase()==="video/vp8"||F.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const xe of F.encodings)xe.scalabilityMode?xe.scalabilityMode=`L1T${ae.temporalLayers}`:xe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ie,reuseMid:P.reuseMid,offerRtpParameters:F,answerRtpParameters:N,codecOptions:C});const ue={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ue),yield this._pc.setRemoteDescription(ue),this._mapMidTransceiver.set(pe,j),{localId:pe,rtpParameters:F,rtpSender:j.sender}})}stopSending(m){return B(this,null,function*(){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",m),this._closed)return;const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");if(w.sender.replaceTrack(null),this._pc.removeTrack(w.sender),this._remoteSdp.closeMediaSection(w.mid))try{w.stop()}catch{}const C=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A),this._mapMidTransceiver.delete(m)})}pauseSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(m);const b=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}resumeSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(this._remoteSdp.resumeSendingMediaSection(m),!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="sendonly";const b=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}replaceTrack(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),w?f.debug("replaceTrack() [localId:%s, track.id:%s]",m,w.id):f.debug("replaceTrack() [localId:%s, no track]",m);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");yield b.sender.replaceTrack(w)})}setMaxSpatialLayer(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{N<=w?F.active=!0:F.active=!1}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}setRtpEncodingParameters(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{C.encodings[N]=ne(ne({},F),w)}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}getSenderStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.sender.getStats()})}sendDataChannel(m){return B(this,arguments,function*({ordered:w,maxPacketLifeTime:b,maxRetransmits:C,label:A,protocol:M}){var F;this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:b,maxRetransmits:C,protocol:M};f.debug("sendDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(A,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const K=yield this._pc.createOffer(),X=e.parse(K.sdp),ie=X.media.find(ae=>ae.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:X})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K),this._remoteSdp.sendSctpAssociation({offerMediaObject:ie});const q={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q),this._hasDataChannelMediaSection=!0}const j={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:P,sctpStreamParameters:j}})}receive(m){return B(this,null,function*(){var w,b;this.assertNotClosed(),this.assertRecvDirection();const C=[],A=new Map;for(const P of m){const{trackId:j,kind:K,rtpParameters:X,streamId:ie}=P;f.debug("receive() [trackId:%s, kind:%s]",j,K);const q=(w=X.mid)!=null?w:String(this._mapMidTransceiver.size);A.set(j,q),this._remoteSdp.receive({mid:q,kind:K,offerRtpParameters:X,streamId:ie??X.rtcp.cname,trackId:j})}const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",M),yield this._pc.setRemoteDescription(M);let F=yield this._pc.createAnswer();const N=e.parse(F.sdp);for(const P of m){const{trackId:j,rtpParameters:K}=P,X=A.get(j),ie=N.media.find(q=>String(q.mid)===X);s.applyCodecParameters({offerRtpParameters:K,answerMediaObject:ie})}F={type:"answer",sdp:e.write(N)},this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:N})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",F),yield this._pc.setLocalDescription(F);for(const P of m){const{trackId:j}=P,K=A.get(j),X=this._pc.getTransceivers().find(ie=>ie.mid===K);if(X)this._mapMidTransceiver.set(K,X),C.push({localId:K,track:X.receiver.track,rtpReceiver:X.receiver});else throw new Error("new RTCRtpTransceiver not found")}return C})}stopReceiving(m){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const C of m){f.debug("stopReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(A.mid)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b);for(const C of m)this._mapMidTransceiver.delete(C)})}pauseReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("pauseReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="inactive",this._remoteSdp.pauseMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}resumeReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("resumeReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}getReceiverStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.receiver.getStats()})}receiveDataChannel(m){return B(this,arguments,function*({sctpStreamParameters:w,label:b,protocol:C}){var A;this.assertNotClosed(),this.assertRecvDirection();const{streamId:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P}=w,j={negotiated:!0,id:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P,protocol:C};f.debug("receiveDataChannel() [options:%o]",j);const K=this._pc.createDataChannel(b,j);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const X={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ie=yield this._pc.createAnswer();if(!this._transportReady){const q=e.parse(ie.sdp);yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:q})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ie),yield this._pc.setLocalDescription(ie),this._hasDataChannelMediaSection=!0}return{dataChannel:K}})}setupTransport(m){return B(this,arguments,function*({localDtlsRole:w,localSdpObject:b}){b||(b=e.parse(this._pc.localDescription.sdp));const C=s.extractDtlsParameters({sdpObject:b});C.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),yield new Promise((A,M)=>{this.safeEmit("@connect",{dtlsParameters:C},A,M)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Chrome74=S}}),Cb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Chrome70.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=va(),c=Wn(),h=kr(),l=Hs(),p=new i.Logger("Chrome70"),g="Chrome70",f={OS:1024,MIS:1024},y=class mm extends c.HandlerInterface{constructor(){super(),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new mm}get name(){return g}close(){if(p.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){p.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{S.addTransceiver("audio"),S.addTransceiver("video");const v=yield S.createOffer();try{S.close()}catch{}const m=e.parse(v.sdp);return s.extractRtpCapabilities({sdpObject:m})}catch(v){try{S.close()}catch{}throw v}})}getNativeSctpCapabilities(){return B(this,null,function*(){return p.debug("getNativeSctpCapabilities()"),{numStreams:f}})}run({direction:S,iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,iceServers:C,iceTransportPolicy:A,additionalSettings:M,proprietaryConstraints:F,extendedRtpCapabilities:N}){p.debug("run()"),this._direction=S,this._remoteSdp=new h.RemoteSdp({iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",N),video:r.getSendingRtpParameters("video",N)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",N),video:r.getSendingRemoteRtpParameters("video",N)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:C??[],iceTransportPolicy:A??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},M),F),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(S){return B(this,null,function*(){p.debug("updateIceServers()");const v=this._pc.getConfiguration();v.iceServers=S,this._pc.setConfiguration(v)})}restartIce(S){return B(this,null,function*(){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const v=yield this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",v),yield this._pc.setLocalDescription(v);const m={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m)}else{const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m)}})}getTransportStats(){return B(this,null,function*(){return this._pc.getStats()})}send(S){return B(this,arguments,function*({track:v,encodings:m,codecOptions:w,codec:b}){var C,A;this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",v.kind,v.id);const M=n.clone(this._sendingRtpParametersByKind[v.kind]);M.codecs=r.reduceCodecs(M.codecs,b);const F=n.clone(this._sendingRemoteRtpParametersByKind[v.kind]);F.codecs=r.reduceCodecs(F.codecs,b);const N=this._remoteSdp.getNextMediaSectionIdx(),P=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream]});let j=yield this._pc.createOffer(),K=e.parse(j.sdp);K.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let X;this._transportReady||(yield this.setupTransport({localDtlsRole:(C=this._forcedLocalDtlsRole)!=null?C:"client",localSdpObject:K})),m&&m.length>1&&(p.debug("send() | enabling legacy simulcast"),K=e.parse(j.sdp),X=K.media[N.idx],o.addLegacySimulcast({offerMediaObject:X,numStreams:m.length}),j={type:"offer",sdp:e.write(K)});let ie=!1;const q=(0,l.parse)((m??[{}])[0].scalabilityMode);if(m&&m.length===1&&q.spatialLayers>1&&M.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(p.debug("send() | enabling legacy simulcast for VP9 SVC"),ie=!0,K=e.parse(j.sdp),X=K.media[N.idx],o.addLegacySimulcast({offerMediaObject:X,numStreams:q.spatialLayers}),j={type:"offer",sdp:e.write(K)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",j),yield this._pc.setLocalDescription(j),m){p.debug("send() | applying given encodings");const ue=P.sender.getParameters();for(let xe=0;xe<((A=ue.encodings)!=null?A:[]).length;++xe){const Ee=ue.encodings[xe],ye=m[xe];if(!ye)break;ue.encodings[xe]=Object.assign(Ee,ye)}yield P.sender.setParameters(ue)}const ae=P.mid;if(M.mid=ae,K=e.parse(this._pc.localDescription.sdp),X=K.media[N.idx],M.rtcp.cname=s.getCname({offerMediaObject:X}),M.encodings=o.getRtpEncodings({offerMediaObject:X}),m)for(let ue=0;ue<M.encodings.length;++ue)m[ue]&&Object.assign(M.encodings[ue],m[ue]);if(ie&&(M.encodings=[M.encodings[0]]),M.encodings.length>1&&(M.codecs[0].mimeType.toLowerCase()==="video/vp8"||M.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ue of M.encodings)ue.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:X,reuseMid:N.reuseMid,offerRtpParameters:M,answerRtpParameters:F,codecOptions:w});const pe={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",pe),yield this._pc.setRemoteDescription(pe),this._mapMidTransceiver.set(ae,P),{localId:ae,rtpParameters:M,rtpSender:P.sender}})}stopSending(S){return B(this,null,function*(){this.assertSendDirection(),p.debug("stopSending() [localId:%s]",S);const v=this._mapMidTransceiver.get(S);if(!v)throw new Error("associated RTCRtpTransceiver not found");if(v.sender.replaceTrack(null),this._pc.removeTrack(v.sender),this._remoteSdp.closeMediaSection(v.mid))try{v.stop()}catch{}const w=yield this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(S)})}pauseSending(S){return B(this,null,function*(){})}resumeSending(S){return B(this,null,function*(){})}replaceTrack(S,v){return B(this,null,function*(){this.assertSendDirection(),v?p.debug("replaceTrack() [localId:%s, track.id:%s]",S,v.id):p.debug("replaceTrack() [localId:%s, no track]",S);const m=this._mapMidTransceiver.get(S);if(!m)throw new Error("associated RTCRtpTransceiver not found");yield m.sender.replaceTrack(v)})}setMaxSpatialLayer(S,v){return B(this,null,function*(){this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,v);const m=this._mapMidTransceiver.get(S);if(!m)throw new Error("associated RTCRtpTransceiver not found");const w=m.sender.getParameters();w.encodings.forEach((A,M)=>{M<=v?A.active=!0:A.active=!1}),yield m.sender.setParameters(w),this._remoteSdp.muxMediaSectionSimulcast(S,w.encodings);const b=yield this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}setRtpEncodingParameters(S,v){return B(this,null,function*(){this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,v);const m=this._mapMidTransceiver.get(S);if(!m)throw new Error("associated RTCRtpTransceiver not found");const w=m.sender.getParameters();w.encodings.forEach((A,M)=>{w.encodings[M]=ne(ne({},A),v)}),yield m.sender.setParameters(w),this._remoteSdp.muxMediaSectionSimulcast(S,w.encodings);const b=yield this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}getSenderStats(S){return B(this,null,function*(){this.assertSendDirection();const v=this._mapMidTransceiver.get(S);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.sender.getStats()})}sendDataChannel(S){return B(this,arguments,function*({ordered:v,maxPacketLifeTime:m,maxRetransmits:w,label:b,protocol:C}){var A;this.assertSendDirection();const M={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:m,maxRetransmitTime:m,maxRetransmits:w,protocol:C};p.debug("sendDataChannel() [options:%o]",M);const F=this._pc.createDataChannel(b,M);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const P=yield this._pc.createOffer(),j=e.parse(P.sdp),K=j.media.find(ie=>ie.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:j})),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:K});const X={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X),this._hasDataChannelMediaSection=!0}const N={streamId:M.id,ordered:M.ordered,maxPacketLifeTime:M.maxPacketLifeTime,maxRetransmits:M.maxRetransmits};return{dataChannel:F,sctpStreamParameters:N}})}receive(S){return B(this,null,function*(){var v,m;this.assertRecvDirection();const w=[],b=new Map;for(const F of S){const{trackId:N,kind:P,rtpParameters:j,streamId:K}=F;p.debug("receive() [trackId:%s, kind:%s]",N,P);const X=(v=j.mid)!=null?v:String(this._mapMidTransceiver.size);b.set(N,X),this._remoteSdp.receive({mid:X,kind:P,offerRtpParameters:j,streamId:K??j.rtcp.cname,trackId:N})}const C={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",C),yield this._pc.setRemoteDescription(C);let A=yield this._pc.createAnswer();const M=e.parse(A.sdp);for(const F of S){const{trackId:N,rtpParameters:P}=F,j=b.get(N),K=M.media.find(X=>String(X.mid)===j);s.applyCodecParameters({offerRtpParameters:P,answerMediaObject:K})}A={type:"answer",sdp:e.write(M)},this._transportReady||(yield this.setupTransport({localDtlsRole:(m=this._forcedLocalDtlsRole)!=null?m:"client",localSdpObject:M})),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",A),yield this._pc.setLocalDescription(A);for(const F of S){const{trackId:N}=F,P=b.get(N),j=this._pc.getTransceivers().find(K=>K.mid===P);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(P,j),w.push({localId:P,track:j.receiver.track,rtpReceiver:j.receiver})}return w})}stopReceiving(S){return B(this,null,function*(){this.assertRecvDirection();for(const w of S){p.debug("stopReceiving() [localId:%s]",w);const b=this._mapMidTransceiver.get(w);if(!b)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(b.mid)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m);for(const w of S)this._mapMidTransceiver.delete(w)})}pauseReceiving(S){return B(this,null,function*(){})}resumeReceiving(S){return B(this,null,function*(){})}getReceiverStats(S){return B(this,null,function*(){this.assertRecvDirection();const v=this._mapMidTransceiver.get(S);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.receiver.getStats()})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:v,label:m,protocol:w}){var b;this.assertRecvDirection();const{streamId:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F}=v,N={negotiated:!0,id:C,ordered:A,maxPacketLifeTime:M,maxRetransmitTime:M,maxRetransmits:F,protocol:w};p.debug("receiveDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(m,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),yield this._pc.setRemoteDescription(j);const K=yield this._pc.createAnswer();if(!this._transportReady){const X=e.parse(K.sdp);yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:X})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K),this._hasDataChannelMediaSection=!0}return{dataChannel:P}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:v,localSdpObject:m}){m||(m=e.parse(this._pc.localDescription.sdp));const w=s.extractDtlsParameters({sdpObject:m});w.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),yield new Promise((b,C)=>{this.safeEmit("@connect",{dtlsParameters:w},b,C)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Chrome70=y}}),Ll=Ce({"../../node_modules/mediasoup-client/lib/handlers/sdp/planBUtils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=e,t.addLegacySimulcast=i;function e({offerMediaObject:n,track:r}){var s,o;const c=new Set;for(const p of(s=n.ssrcs)!=null?s:[]){if(p.attribute!=="msid")continue;if(p.value.split(" ")[1]===r.id){const f=p.id;c.add(f)}}if(c.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${r.id}]`);const h=new Map;for(const p of(o=n.ssrcGroups)!=null?o:[]){if(p.semantics!=="FID")continue;let[g,f]=p.ssrcs.split(/\s+/);g=Number(g),f=Number(f),c.has(g)&&(c.delete(g),c.delete(f),h.set(g,f))}for(const p of c)h.set(p,null);const l=[];for(const[p,g]of h){const f={ssrc:p};g&&(f.rtx={ssrc:g}),l.push(f)}return l}function i({offerMediaObject:n,track:r,numStreams:s}){var o,c,h,l;if(s<=1)throw new TypeError("numStreams must be greater than 1");let p,g,f;if(!((o=n.ssrcs)!=null?o:[]).find(w=>w.attribute!=="msid"?!1:w.value.split(" ")[1]===r.id?(p=w.id,f=w.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${r.id}]`);((c=n.ssrcGroups)!=null?c:[]).some(w=>{if(w.semantics!=="FID")return!1;const b=w.ssrcs.split(/\s+/);return Number(b[0])===p?(g=Number(b[1]),!0):!1});const x=n.ssrcs.find(w=>w.attribute==="cname"&&w.id===p);if(!x)throw new Error(`a=ssrc line with cname information not found [track.id:${r.id}]`);const S=x.value,v=[],m=[];for(let w=0;w<s;++w)v.push(p+w),g&&m.push(g+w);n.ssrcGroups=(h=n.ssrcGroups)!=null?h:[],n.ssrcs=(l=n.ssrcs)!=null?l:[],n.ssrcGroups.push({semantics:"SIM",ssrcs:v.join(" ")});for(const w of v)n.ssrcs.push({id:w,attribute:"cname",value:S}),n.ssrcs.push({id:w,attribute:"msid",value:`${f} ${r.id}`});for(let w=0;w<m.length;++w){const b=v[w],C=m[w];n.ssrcs.push({id:C,attribute:"cname",value:S}),n.ssrcs.push({id:C,attribute:"msid",value:`${f} ${r.id}`}),n.ssrcGroups.push({semantics:"FID",ssrcs:`${b} ${C}`})}}}}),Tb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Chrome67.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=Ll(),c=Wn(),h=kr(),l=new i.Logger("Chrome67"),p="Chrome67",g={OS:1024,MIS:1024},f=class gm extends c.HandlerInterface{constructor(){super(),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_sendStream",new MediaStream),le(this,"_mapSendLocalIdRtpSender",new Map),le(this,"_nextSendLocalId",0),le(this,"_mapRecvLocalIdInfo",new Map),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new gm}get name(){return p}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){l.debug("getNativeRtpCapabilities()");const x=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const S=yield x.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{x.close()}catch{}const v=e.parse(S.sdp);return s.extractRtpCapabilities({sdpObject:v})}catch(S){try{x.close()}catch{}throw S}})}getNativeSctpCapabilities(){return B(this,null,function*(){return l.debug("getNativeSctpCapabilities()"),{numStreams:g}})}run({direction:x,iceParameters:S,iceCandidates:v,dtlsParameters:m,sctpParameters:w,iceServers:b,iceTransportPolicy:C,additionalSettings:A,proprietaryConstraints:M,extendedRtpCapabilities:F}){l.debug("run()"),this._direction=x,this._remoteSdp=new h.RemoteSdp({iceParameters:S,iceCandidates:v,dtlsParameters:m,sctpParameters:w,planB:!0}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",F),video:r.getSendingRtpParameters("video",F)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",F),video:r.getSendingRemoteRtpParameters("video",F)},m.role&&m.role!=="auto"&&(this._forcedLocalDtlsRole=m.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:b??[],iceTransportPolicy:C??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},A),M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",N=>{this.emit("@icecandidateerror",N)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(x){return B(this,null,function*(){l.debug("updateIceServers()");const S=this._pc.getConfiguration();S.iceServers=x,this._pc.setConfiguration(S)})}restartIce(x){return B(this,null,function*(){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(x),!!this._transportReady)if(this._direction==="send"){const S=yield this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",S),yield this._pc.setLocalDescription(S);const v={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",v),yield this._pc.setRemoteDescription(v)}else{const S={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const v=yield this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",v),yield this._pc.setLocalDescription(v)}})}getTransportStats(){return B(this,null,function*(){return this._pc.getStats()})}send(x){return B(this,arguments,function*({track:S,encodings:v,codecOptions:m,codec:w}){var b;this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),w&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let C=yield this._pc.createOffer(),A=e.parse(C.sdp);A.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let M;const F=n.clone(this._sendingRtpParametersByKind[S.kind]);F.codecs=r.reduceCodecs(F.codecs);const N=n.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(N.codecs=r.reduceCodecs(N.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:A})),S.kind==="video"&&v&&v.length>1&&(l.debug("send() | enabling simulcast"),A=e.parse(C.sdp),M=A.media.find(X=>X.type==="video"),o.addLegacySimulcast({offerMediaObject:M,track:S,numStreams:v.length}),C={type:"offer",sdp:e.write(A)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C),A=e.parse(this._pc.localDescription.sdp),M=A.media.find(X=>X.type===S.kind),F.rtcp.cname=s.getCname({offerMediaObject:M}),F.encodings=o.getRtpEncodings({offerMediaObject:M,track:S}),v)for(let X=0;X<F.encodings.length;++X)v[X]&&Object.assign(F.encodings[X],v[X]);if(F.encodings.length>1&&F.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const X of F.encodings)X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:M,offerRtpParameters:F,answerRtpParameters:N,codecOptions:m});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),yield this._pc.setRemoteDescription(P);const j=String(this._nextSendLocalId);this._nextSendLocalId++;const K=this._pc.getSenders().find(X=>X.track===S);return this._mapSendLocalIdRtpSender.set(j,K),{localId:j,rtpParameters:F,rtpSender:K}})}stopSending(x){return B(this,null,function*(){this.assertSendDirection(),l.debug("stopSending() [localId:%s]",x);const S=this._mapSendLocalIdRtpSender.get(x);if(!S)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(S),S.track&&this._sendStream.removeTrack(S.track),this._mapSendLocalIdRtpSender.delete(x);const v=yield this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v);try{yield this._pc.setLocalDescription(v)}catch(w){if(this._sendStream.getTracks().length===0){l.warn("stopSending() | ignoring expected error due no sending tracks: %s",w.toString());return}throw w}if(this._pc.signalingState==="stable")return;const m={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m)})}pauseSending(x){return B(this,null,function*(){})}resumeSending(x){return B(this,null,function*(){})}replaceTrack(x,S){return B(this,null,function*(){this.assertSendDirection(),S?l.debug("replaceTrack() [localId:%s, track.id:%s]",x,S.id):l.debug("replaceTrack() [localId:%s, no track]",x);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.track;yield v.replaceTrack(S),m&&this._sendStream.removeTrack(m),S&&this._sendStream.addTrack(S)})}setMaxSpatialLayer(x,S){return B(this,null,function*(){this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",x,S);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.getParameters();m.encodings.forEach((w,b)=>{b<=S?w.active=!0:w.active=!1}),yield v.setParameters(m)})}setRtpEncodingParameters(x,S){return B(this,null,function*(){this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",x,S);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.getParameters();m.encodings.forEach((w,b)=>{m.encodings[b]=ne(ne({},w),S)}),yield v.setParameters(m)})}getSenderStats(x){return B(this,null,function*(){this.assertSendDirection();const S=this._mapSendLocalIdRtpSender.get(x);if(!S)throw new Error("associated RTCRtpSender not found");return S.getStats()})}sendDataChannel(x){return B(this,arguments,function*({ordered:S,maxPacketLifeTime:v,maxRetransmits:m,label:w,protocol:b}){var C;this.assertSendDirection();const A={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:v,maxRetransmitTime:v,maxRetransmits:m,protocol:b};l.debug("sendDataChannel() [options:%o]",A);const M=this._pc.createDataChannel(w,A);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const N=yield this._pc.createOffer(),P=e.parse(N.sdp),j=P.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(C=this._forcedLocalDtlsRole)!=null?C:"client",localSdpObject:P})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",N),yield this._pc.setLocalDescription(N),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const K={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setRemoteDescription(K),this._hasDataChannelMediaSection=!0}const F={streamId:A.id,ordered:A.ordered,maxPacketLifeTime:A.maxPacketLifeTime,maxRetransmits:A.maxRetransmits};return{dataChannel:M,sctpStreamParameters:F}})}receive(x){return B(this,null,function*(){var S;this.assertRecvDirection();const v=[];for(const C of x){const{trackId:A,kind:M,rtpParameters:F,streamId:N}=C;l.debug("receive() [trackId:%s, kind:%s]",A,M);const P=M;this._remoteSdp.receive({mid:P,kind:M,offerRtpParameters:F,streamId:N??F.rtcp.cname,trackId:A})}const m={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);let w=yield this._pc.createAnswer();const b=e.parse(w.sdp);for(const C of x){const{kind:A,rtpParameters:M}=C,F=A,N=b.media.find(P=>String(P.mid)===F);s.applyCodecParameters({offerRtpParameters:M,answerMediaObject:N})}w={type:"answer",sdp:e.write(b)},this._transportReady||(yield this.setupTransport({localDtlsRole:(S=this._forcedLocalDtlsRole)!=null?S:"client",localSdpObject:b})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const C of x){const{kind:A,trackId:M,rtpParameters:F}=C,N=M,P=A,j=this._pc.getReceivers().find(K=>K.track&&K.track.id===N);if(!j)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(N,{mid:P,rtpParameters:F,rtpReceiver:j}),v.push({localId:N,track:j.track,rtpReceiver:j})}return v})}stopReceiving(x){return B(this,null,function*(){var S;this.assertRecvDirection();for(const w of x){l.debug("stopReceiving() [localId:%s]",w);const{mid:b,rtpParameters:C}=(S=this._mapRecvLocalIdInfo.get(w))!=null?S:{};this._mapRecvLocalIdInfo.delete(w),this._remoteSdp.planBStopReceiving({mid:b,offerRtpParameters:C})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m)})}pauseReceiving(x){return B(this,null,function*(){})}resumeReceiving(x){return B(this,null,function*(){})}getReceiverStats(x){return B(this,null,function*(){var S;this.assertRecvDirection();const{rtpReceiver:v}=(S=this._mapRecvLocalIdInfo.get(x))!=null?S:{};if(!v)throw new Error("associated RTCRtpReceiver not found");return v.getStats()})}receiveDataChannel(x){return B(this,arguments,function*({sctpStreamParameters:S,label:v,protocol:m}){var w;this.assertRecvDirection();const{streamId:b,ordered:C,maxPacketLifeTime:A,maxRetransmits:M}=S,F={negotiated:!0,id:b,ordered:C,maxPacketLifeTime:A,maxRetransmitTime:A,maxRetransmits:M,protocol:m};l.debug("receiveDataChannel() [options:%o]",F);const N=this._pc.createDataChannel(v,F);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const P={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",P),yield this._pc.setRemoteDescription(P);const j=yield this._pc.createAnswer();if(!this._transportReady){const K=e.parse(j.sdp);yield this.setupTransport({localDtlsRole:(w=this._forcedLocalDtlsRole)!=null?w:"client",localSdpObject:K})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),yield this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:N}})}setupTransport(x){return B(this,arguments,function*({localDtlsRole:S,localSdpObject:v}){v||(v=e.parse(this._pc.localDescription.sdp));const m=s.extractDtlsParameters({sdpObject:v});m.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),yield new Promise((w,b)=>{this.safeEmit("@connect",{dtlsParameters:m},w,b)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Chrome67=f}}),Rb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Chrome55.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;var e=hn(),i=Vi(),n=Sn(),r=Qi(),s=wn(),o=Fr(),c=Ll(),h=Wn(),l=kr(),p=new i.Logger("Chrome55"),g="Chrome55",f={OS:1024,MIS:1024},y=class vm extends h.HandlerInterface{constructor(){super(),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_sendStream",new MediaStream),le(this,"_mapSendLocalIdTrack",new Map),le(this,"_nextSendLocalId",0),le(this,"_mapRecvLocalIdInfo",new Map),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new vm}get name(){return g}close(){if(p.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){p.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const v=yield S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const m=e.parse(v.sdp);return o.extractRtpCapabilities({sdpObject:m})}catch(v){try{S.close()}catch{}throw v}})}getNativeSctpCapabilities(){return B(this,null,function*(){return p.debug("getNativeSctpCapabilities()"),{numStreams:f}})}run({direction:S,iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,iceServers:C,iceTransportPolicy:A,additionalSettings:M,proprietaryConstraints:F,extendedRtpCapabilities:N}){p.debug("run()"),this._direction=S,this._remoteSdp=new l.RemoteSdp({iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,planB:!0}),this._sendingRtpParametersByKind={audio:s.getSendingRtpParameters("audio",N),video:s.getSendingRtpParameters("video",N)},this._sendingRemoteRtpParametersByKind={audio:s.getSendingRemoteRtpParameters("audio",N),video:s.getSendingRemoteRtpParameters("video",N)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:C??[],iceTransportPolicy:A??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},M),F),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(S){return B(this,null,function*(){p.debug("updateIceServers()");const v=this._pc.getConfiguration();v.iceServers=S,this._pc.setConfiguration(v)})}restartIce(S){return B(this,null,function*(){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const v=yield this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",v),yield this._pc.setLocalDescription(v);const m={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m)}else{const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m)}})}getTransportStats(){return B(this,null,function*(){return this._pc.getStats()})}send(S){return B(this,arguments,function*({track:v,encodings:m,codecOptions:w,codec:b}){var C;this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),b&&p.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(v),this._pc.addStream(this._sendStream);let A=yield this._pc.createOffer(),M=e.parse(A.sdp);M.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let F;const N=r.clone(this._sendingRtpParametersByKind[v.kind]);N.codecs=s.reduceCodecs(N.codecs);const P=r.clone(this._sendingRemoteRtpParametersByKind[v.kind]);if(P.codecs=s.reduceCodecs(P.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(C=this._forcedLocalDtlsRole)!=null?C:"client",localSdpObject:M})),v.kind==="video"&&m&&m.length>1&&(p.debug("send() | enabling simulcast"),M=e.parse(A.sdp),F=M.media.find(X=>X.type==="video"),c.addLegacySimulcast({offerMediaObject:F,track:v,numStreams:m.length}),A={type:"offer",sdp:e.write(M)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A),M=e.parse(this._pc.localDescription.sdp),F=M.media.find(X=>X.type===v.kind),N.rtcp.cname=o.getCname({offerMediaObject:F}),N.encodings=c.getRtpEncodings({offerMediaObject:F,track:v}),m)for(let X=0;X<N.encodings.length;++X)m[X]&&Object.assign(N.encodings[X],m[X]);if(N.encodings.length>1&&N.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const X of N.encodings)X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:F,offerRtpParameters:N,answerRtpParameters:P,codecOptions:w});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",j),yield this._pc.setRemoteDescription(j);const K=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(K,v),{localId:K,rtpParameters:N}})}stopSending(S){return B(this,null,function*(){this.assertSendDirection(),p.debug("stopSending() [localId:%s]",S);const v=this._mapSendLocalIdTrack.get(S);if(!v)throw new Error("track not found");this._mapSendLocalIdTrack.delete(S),this._sendStream.removeTrack(v),this._pc.addStream(this._sendStream);const m=yield this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",m);try{yield this._pc.setLocalDescription(m)}catch(b){if(this._sendStream.getTracks().length===0){p.warn("stopSending() | ignoring expected error due no sending tracks: %s",b.toString());return}throw b}if(this._pc.signalingState==="stable")return;const w={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)})}pauseSending(S){return B(this,null,function*(){})}resumeSending(S){return B(this,null,function*(){})}replaceTrack(S,v){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}setMaxSpatialLayer(S,v){return B(this,null,function*(){throw new n.UnsupportedError(" not implemented")})}setRtpEncodingParameters(S,v){return B(this,null,function*(){throw new n.UnsupportedError("not supported")})}getSenderStats(S){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}sendDataChannel(S){return B(this,arguments,function*({ordered:v,maxPacketLifeTime:m,maxRetransmits:w,label:b,protocol:C}){var A;this.assertSendDirection();const M={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:m,maxRetransmitTime:m,maxRetransmits:w,protocol:C};p.debug("sendDataChannel() [options:%o]",M);const F=this._pc.createDataChannel(b,M);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const P=yield this._pc.createOffer(),j=e.parse(P.sdp),K=j.media.find(ie=>ie.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:j})),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:K});const X={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X),this._hasDataChannelMediaSection=!0}const N={streamId:M.id,ordered:M.ordered,maxPacketLifeTime:M.maxPacketLifeTime,maxRetransmits:M.maxRetransmits};return{dataChannel:F,sctpStreamParameters:N}})}receive(S){return B(this,null,function*(){var v,m;this.assertRecvDirection();const w=[];for(const M of S){const{trackId:F,kind:N,rtpParameters:P,streamId:j}=M;p.debug("receive() [trackId:%s, kind:%s]",F,N);const K=N;this._remoteSdp.receive({mid:K,kind:N,offerRtpParameters:P,streamId:j??P.rtcp.cname,trackId:F})}const b={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);let C=yield this._pc.createAnswer();const A=e.parse(C.sdp);for(const M of S){const{kind:F,rtpParameters:N}=M,P=F,j=A.media.find(K=>String(K.mid)===P);o.applyCodecParameters({offerRtpParameters:N,answerMediaObject:j})}C={type:"answer",sdp:e.write(A)},this._transportReady||(yield this.setupTransport({localDtlsRole:(v=this._forcedLocalDtlsRole)!=null?v:"client",localSdpObject:A})),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",C),yield this._pc.setLocalDescription(C);for(const M of S){const{kind:F,trackId:N,rtpParameters:P}=M,j=F,K=N,X=(m=M.streamId)!=null?m:P.rtcp.cname,q=this._pc.getRemoteStreams().find(ae=>ae.id===X).getTrackById(K);if(!q)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(K,{mid:j,rtpParameters:P}),w.push({localId:K,track:q})}return w})}stopReceiving(S){return B(this,null,function*(){var v;this.assertRecvDirection();for(const b of S){p.debug("stopReceiving() [localId:%s]",b);const{mid:C,rtpParameters:A}=(v=this._mapRecvLocalIdInfo.get(b))!=null?v:{};this._mapRecvLocalIdInfo.delete(b),this._remoteSdp.planBStopReceiving({mid:C,offerRtpParameters:A})}const m={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}pauseReceiving(S){return B(this,null,function*(){})}resumeReceiving(S){return B(this,null,function*(){})}getReceiverStats(S){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:v,label:m,protocol:w}){var b;this.assertRecvDirection();const{streamId:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F}=v,N={negotiated:!0,id:C,ordered:A,maxPacketLifeTime:M,maxRetransmitTime:M,maxRetransmits:F,protocol:w};p.debug("receiveDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(m,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const j={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),yield this._pc.setRemoteDescription(j);const K=yield this._pc.createAnswer();if(!this._transportReady){const X=e.parse(K.sdp);yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:X})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K),this._hasDataChannelMediaSection=!0}return{dataChannel:P}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:v,localSdpObject:m}){m||(m=e.parse(this._pc.localDescription.sdp));const w=o.extractDtlsParameters({sdpObject:m});w.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),yield new Promise((b,C)=>{this.safeEmit("@connect",{dtlsParameters:w},b,C)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Chrome55=y}}),Pb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Firefox120.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox120=void 0;var e=hn(),i=Vi(),n=Sn(),r=Qi(),s=wn(),o=Fr(),c=va(),h=Wn(),l=kr(),p=Hs(),g=new i.Logger("Firefox120"),f="Firefox120",y={OS:16,MIS:2048},x=class _m extends h.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new _m}get name(){return f}close(){if(g.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){g.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),m=document.createElement("canvas");m.getContext("2d");const b=m.captureStream().getVideoTracks()[0];try{v.addTransceiver("audio",{direction:"sendrecv"}),v.addTransceiver(b,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const C=yield v.createOffer();try{m.remove()}catch{}try{b.stop()}catch{}try{v.close()}catch{}const A=e.parse(C.sdp);return o.extractRtpCapabilities({sdpObject:A})}catch(C){try{m.remove()}catch{}try{b.stop()}catch{}try{v.close()}catch{}throw C}})}getNativeSctpCapabilities(){return B(this,null,function*(){return g.debug("getNativeSctpCapabilities()"),{numStreams:y}})}run({direction:v,iceParameters:m,iceCandidates:w,dtlsParameters:b,sctpParameters:C,iceServers:A,iceTransportPolicy:M,additionalSettings:F,proprietaryConstraints:N,extendedRtpCapabilities:P}){this.assertNotClosed(),g.debug("run()"),this._direction=v,this._remoteSdp=new l.RemoteSdp({iceParameters:m,iceCandidates:w,dtlsParameters:b,sctpParameters:C}),this._sendingRtpParametersByKind={audio:s.getSendingRtpParameters("audio",P),video:s.getSendingRtpParameters("video",P)},this._sendingRemoteRtpParametersByKind={audio:s.getSendingRemoteRtpParameters("audio",P),video:s.getSendingRemoteRtpParameters("video",P)},this._pc=new RTCPeerConnection(ne({iceServers:A??[],iceTransportPolicy:M??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},F),N),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",j=>{this.emit("@icecandidateerror",j)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(v){return B(this,null,function*(){throw this.assertNotClosed(),new n.UnsupportedError("not supported")})}restartIce(v){return B(this,null,function*(){if(this.assertNotClosed(),g.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const m=yield this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",m),yield this._pc.setLocalDescription(m);const w={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(v){return B(this,arguments,function*({track:m,encodings:w,codecOptions:b,codec:C,onRtpSender:A}){this.assertNotClosed(),this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",m.kind,m.id),w&&w.length>1&&w.forEach((ae,pe)=>{ae.rid=`r${pe}`});const M=r.clone(this._sendingRtpParametersByKind[m.kind]);M.codecs=s.reduceCodecs(M.codecs,C);const F=r.clone(this._sendingRemoteRtpParametersByKind[m.kind]);F.codecs=s.reduceCodecs(F.codecs,C);const N=this._pc.addTransceiver(m,{direction:"sendonly",streams:[this._sendStream],sendEncodings:w});A&&A(N.sender);const P=yield this._pc.createOffer();let j=e.parse(P.sdp);j.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:j}));const K=(0,p.parse)((w??[{}])[0].scalabilityMode);g.debug("send() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P);const X=N.mid;M.mid=X,j=e.parse(this._pc.localDescription.sdp);const ie=j.media[j.media.length-1];if(M.rtcp.cname=o.getCname({offerMediaObject:ie}),!w)M.encodings=c.getRtpEncodings({offerMediaObject:ie});else if(w.length===1){const ae=c.getRtpEncodings({offerMediaObject:ie});Object.assign(ae[0],w[0]),M.encodings=ae}else M.encodings=w;if(M.encodings.length>1&&(M.codecs[0].mimeType.toLowerCase()==="video/vp8"||M.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ae of M.encodings)ae.scalabilityMode?ae.scalabilityMode=`L1T${K.temporalLayers}`:ae.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ie,offerRtpParameters:M,answerRtpParameters:F,codecOptions:b});const q={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q),this._mapMidTransceiver.set(X,N),{localId:X,rtpParameters:M,rtpSender:N.sender}})}stopSending(v){return B(this,null,function*(){if(this.assertSendDirection(),g.debug("stopSending() [localId:%s]",v),this._closed)return;const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated transceiver not found");m.sender.replaceTrack(null),this._pc.removeTrack(m.sender),this._remoteSdp.disableMediaSection(m.mid);const w=yield this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(v)})}pauseSending(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",v);const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");m.direction="inactive",this._remoteSdp.pauseMediaSection(v);const w=yield this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)})}resumeSending(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",v);const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");m.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const w=yield this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)})}replaceTrack(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),m?g.debug("replaceTrack() [localId:%s, track.id:%s]",v,m.id):g.debug("replaceTrack() [localId:%s, no track]",v);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(m)})}setMaxSpatialLayer(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,m);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated transceiver not found");const b=w.sender.getParameters();b.encodings.forEach((M,F)=>{F<=m?M.active=!0:M.active=!1}),yield w.sender.setParameters(b),this._remoteSdp.muxMediaSectionSimulcast(v,b.encodings);const C=yield this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A)})}setRtpEncodingParameters(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,m);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated RTCRtpTransceiver not found");const b=w.sender.getParameters();b.encodings.forEach((M,F)=>{b.encodings[F]=ne(ne({},M),m)}),yield w.sender.setParameters(b),this._remoteSdp.muxMediaSectionSimulcast(v,b.encodings);const C=yield this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A)})}getSenderStats(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");return m.sender.getStats()})}sendDataChannel(v){return B(this,arguments,function*({ordered:m,maxPacketLifeTime:w,maxRetransmits:b,label:C,protocol:A}){this.assertNotClosed(),this.assertSendDirection();const M={negotiated:!0,id:this._nextSendSctpStreamId,ordered:m,maxPacketLifeTime:w,maxRetransmits:b,protocol:A};g.debug("sendDataChannel() [options:%o]",M);const F=this._pc.createDataChannel(C,M);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const P=yield this._pc.createOffer(),j=e.parse(P.sdp),K=j.media.find(ie=>ie.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:j})),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:K});const X={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X),this._hasDataChannelMediaSection=!0}const N={streamId:M.id,ordered:M.ordered,maxPacketLifeTime:M.maxPacketLifeTime,maxRetransmits:M.maxRetransmits};return{dataChannel:F,sctpStreamParameters:N}})}receive(v){return B(this,null,function*(){var m;this.assertNotClosed(),this.assertRecvDirection();const w=[],b=new Map;for(const F of v){const{trackId:N,kind:P,rtpParameters:j,streamId:K}=F;g.debug("receive() [trackId:%s, kind:%s]",N,P);const X=(m=j.mid)!=null?m:String(this._mapMidTransceiver.size);b.set(N,X),this._remoteSdp.receive({mid:X,kind:P,offerRtpParameters:j,streamId:K??j.rtcp.cname,trackId:N})}const C={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",C),yield this._pc.setRemoteDescription(C);for(const F of v){const{trackId:N,onRtpReceiver:P}=F;if(P){const j=b.get(N),K=this._pc.getTransceivers().find(X=>X.mid===j);if(!K)throw new Error("transceiver not found");P(K.receiver)}}let A=yield this._pc.createAnswer();const M=e.parse(A.sdp);for(const F of v){const{trackId:N,rtpParameters:P}=F,j=b.get(N),K=M.media.find(X=>String(X.mid)===j);o.applyCodecParameters({offerRtpParameters:P,answerMediaObject:K}),A={type:"answer",sdp:e.write(M)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:M})),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",A),yield this._pc.setLocalDescription(A);for(const F of v){const{trackId:N}=F,P=b.get(N),j=this._pc.getTransceivers().find(K=>K.mid===P);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(P,j),w.push({localId:P,track:j.receiver.track,rtpReceiver:j.receiver})}return w})}stopReceiving(v){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const b of v){g.debug("stopReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const b of v)this._mapMidTransceiver.delete(b)})}pauseReceiving(v){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const b of v){g.debug("pauseReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(b)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(v){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const b of v){g.debug("resumeReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(b)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(v){return B(this,null,function*(){this.assertRecvDirection();const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");return m.receiver.getStats()})}receiveDataChannel(v){return B(this,arguments,function*({sctpStreamParameters:m,label:w,protocol:b}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F}=m,N={negotiated:!0,id:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F,protocol:b};g.debug("receiveDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(w,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),yield this._pc.setRemoteDescription(j);const K=yield this._pc.createAnswer();if(!this._transportReady){const X=e.parse(K.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:X})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K),this._hasDataChannelMediaSection=!0}return{dataChannel:P}})}setupTransport(v){return B(this,arguments,function*({localDtlsRole:m,localSdpObject:w}){w||(w=e.parse(this._pc.localDescription.sdp));const b=o.extractDtlsParameters({sdpObject:w});b.role=m,this._remoteSdp.updateDtlsRole(m==="client"?"server":"client"),yield new Promise((C,A)=>{this.safeEmit("@connect",{dtlsParameters:b},C,A)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new n.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Firefox120=x}}),Mb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Firefox60.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;var e=hn(),i=Vi(),n=Sn(),r=Qi(),s=wn(),o=Fr(),c=va(),h=Wn(),l=kr(),p=Hs(),g=new i.Logger("Firefox60"),f="Firefox60",y={OS:16,MIS:2048},x=class bm extends h.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new bm}get name(){return f}close(){if(g.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){g.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),m=document.createElement("canvas");m.getContext("2d");const b=m.captureStream().getVideoTracks()[0];try{v.addTransceiver("audio",{direction:"sendrecv"});const C=v.addTransceiver(b,{direction:"sendrecv"}),A=C.sender.getParameters(),M=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];A.encodings=M,yield C.sender.setParameters(A);const F=yield v.createOffer();try{m.remove()}catch{}try{b.stop()}catch{}try{v.close()}catch{}const N=e.parse(F.sdp);return o.extractRtpCapabilities({sdpObject:N})}catch(C){try{m.remove()}catch{}try{b.stop()}catch{}try{v.close()}catch{}throw C}})}getNativeSctpCapabilities(){return B(this,null,function*(){return g.debug("getNativeSctpCapabilities()"),{numStreams:y}})}run({direction:v,iceParameters:m,iceCandidates:w,dtlsParameters:b,sctpParameters:C,iceServers:A,iceTransportPolicy:M,additionalSettings:F,proprietaryConstraints:N,extendedRtpCapabilities:P}){this.assertNotClosed(),g.debug("run()"),this._direction=v,this._remoteSdp=new l.RemoteSdp({iceParameters:m,iceCandidates:w,dtlsParameters:b,sctpParameters:C}),this._sendingRtpParametersByKind={audio:s.getSendingRtpParameters("audio",P),video:s.getSendingRtpParameters("video",P)},this._sendingRemoteRtpParametersByKind={audio:s.getSendingRemoteRtpParameters("audio",P),video:s.getSendingRemoteRtpParameters("video",P)},this._pc=new RTCPeerConnection(ne({iceServers:A??[],iceTransportPolicy:M??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},F),N),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",j=>{this.emit("@icecandidateerror",j)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(g.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(v){return B(this,null,function*(){throw this.assertNotClosed(),new n.UnsupportedError("not supported")})}restartIce(v){return B(this,null,function*(){if(this.assertNotClosed(),g.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),!!this._transportReady)if(this._direction==="send"){const m=yield this._pc.createOffer({iceRestart:!0});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",m),yield this._pc.setLocalDescription(m);const w={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(v){return B(this,arguments,function*({track:m,encodings:w,codecOptions:b,codec:C}){this.assertNotClosed(),this.assertSendDirection(),g.debug("send() [kind:%s, track.id:%s]",m.kind,m.id),w&&(w=r.clone(w),w.forEach((q,ae)=>{q.rid=`r${ae}`}),w.reverse());const A=r.clone(this._sendingRtpParametersByKind[m.kind]);A.codecs=s.reduceCodecs(A.codecs,C);const M=r.clone(this._sendingRemoteRtpParametersByKind[m.kind]);M.codecs=s.reduceCodecs(M.codecs,C);const F=this._pc.addTransceiver(m,{direction:"sendonly",streams:[this._sendStream]});if(w){const q=F.sender.getParameters();q.encodings=w,yield F.sender.setParameters(q)}const N=yield this._pc.createOffer();let P=e.parse(N.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:P}));const j=(0,p.parse)((w??[{}])[0].scalabilityMode);g.debug("send() | calling pc.setLocalDescription() [offer:%o]",N),yield this._pc.setLocalDescription(N);const K=F.mid;A.mid=K,P=e.parse(this._pc.localDescription.sdp);const X=P.media[P.media.length-1];if(A.rtcp.cname=o.getCname({offerMediaObject:X}),!w)A.encodings=c.getRtpEncodings({offerMediaObject:X});else if(w.length===1){const q=c.getRtpEncodings({offerMediaObject:X});Object.assign(q[0],w[0]),A.encodings=q}else A.encodings=w.reverse();if(A.encodings.length>1&&(A.codecs[0].mimeType.toLowerCase()==="video/vp8"||A.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const q of A.encodings)q.scalabilityMode?q.scalabilityMode=`L1T${j.temporalLayers}`:q.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:X,offerRtpParameters:A,answerRtpParameters:M,codecOptions:b});const ie={type:"answer",sdp:this._remoteSdp.getSdp()};return g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ie),yield this._pc.setRemoteDescription(ie),this._mapMidTransceiver.set(K,F),{localId:K,rtpParameters:A,rtpSender:F.sender}})}stopSending(v){return B(this,null,function*(){if(this.assertSendDirection(),g.debug("stopSending() [localId:%s]",v),this._closed)return;const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated transceiver not found");m.sender.replaceTrack(null),this._pc.removeTrack(m.sender),this._remoteSdp.disableMediaSection(m.mid);const w=yield this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b),this._mapMidTransceiver.delete(v)})}pauseSending(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("pauseSending() [localId:%s]",v);const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");m.direction="inactive",this._remoteSdp.pauseMediaSection(v);const w=yield this._pc.createOffer();g.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)})}resumeSending(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("resumeSending() [localId:%s]",v);const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");m.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const w=yield this._pc.createOffer();g.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)})}replaceTrack(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),m?g.debug("replaceTrack() [localId:%s, track.id:%s]",v,m.id):g.debug("replaceTrack() [localId:%s, no track]",v);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(m)})}setMaxSpatialLayer(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,m);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated transceiver not found");const b=w.sender.getParameters();m=b.encodings.length-1-m,b.encodings.forEach((M,F)=>{F>=m?M.active=!0:M.active=!1}),yield w.sender.setParameters(b),this._remoteSdp.muxMediaSectionSimulcast(v,b.encodings);const C=yield this._pc.createOffer();g.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A)})}setRtpEncodingParameters(v,m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,m);const w=this._mapMidTransceiver.get(v);if(!w)throw new Error("associated RTCRtpTransceiver not found");const b=w.sender.getParameters();b.encodings.forEach((M,F)=>{b.encodings[F]=ne(ne({},M),m)}),yield w.sender.setParameters(b),this._remoteSdp.muxMediaSectionSimulcast(v,b.encodings);const C=yield this._pc.createOffer();g.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A)})}getSenderStats(v){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");return m.sender.getStats()})}sendDataChannel(v){return B(this,arguments,function*({ordered:m,maxPacketLifeTime:w,maxRetransmits:b,label:C,protocol:A}){this.assertNotClosed(),this.assertSendDirection();const M={negotiated:!0,id:this._nextSendSctpStreamId,ordered:m,maxPacketLifeTime:w,maxRetransmits:b,protocol:A};g.debug("sendDataChannel() [options:%o]",M);const F=this._pc.createDataChannel(C,M);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const P=yield this._pc.createOffer(),j=e.parse(P.sdp),K=j.media.find(ie=>ie.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:j})),g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:K});const X={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X),this._hasDataChannelMediaSection=!0}const N={streamId:M.id,ordered:M.ordered,maxPacketLifeTime:M.maxPacketLifeTime,maxRetransmits:M.maxRetransmits};return{dataChannel:F,sctpStreamParameters:N}})}receive(v){return B(this,null,function*(){var m;this.assertNotClosed(),this.assertRecvDirection();const w=[],b=new Map;for(const F of v){const{trackId:N,kind:P,rtpParameters:j,streamId:K}=F;g.debug("receive() [trackId:%s, kind:%s]",N,P);const X=(m=j.mid)!=null?m:String(this._mapMidTransceiver.size);b.set(N,X),this._remoteSdp.receive({mid:X,kind:P,offerRtpParameters:j,streamId:K??j.rtcp.cname,trackId:N})}const C={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",C),yield this._pc.setRemoteDescription(C);let A=yield this._pc.createAnswer();const M=e.parse(A.sdp);for(const F of v){const{trackId:N,rtpParameters:P}=F,j=b.get(N),K=M.media.find(X=>String(X.mid)===j);o.applyCodecParameters({offerRtpParameters:P,answerMediaObject:K}),A={type:"answer",sdp:e.write(M)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:M})),g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",A),yield this._pc.setLocalDescription(A);for(const F of v){const{trackId:N}=F,P=b.get(N),j=this._pc.getTransceivers().find(K=>K.mid===P);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(P,j),w.push({localId:P,track:j.receiver.track,rtpReceiver:j.receiver})}return w})}stopReceiving(v){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const b of v){g.debug("stopReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(C.mid)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const b of v)this._mapMidTransceiver.delete(b)})}pauseReceiving(v){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const b of v){g.debug("pauseReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="inactive",this._remoteSdp.pauseMediaSection(b)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(v){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const b of v){g.debug("resumeReceiving() [localId:%s]",b);const C=this._mapMidTransceiver.get(b);if(!C)throw new Error("associated RTCRtpTransceiver not found");C.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(b)}const m={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();g.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(v){return B(this,null,function*(){this.assertRecvDirection();const m=this._mapMidTransceiver.get(v);if(!m)throw new Error("associated RTCRtpTransceiver not found");return m.receiver.getStats()})}receiveDataChannel(v){return B(this,arguments,function*({sctpStreamParameters:m,label:w,protocol:b}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F}=m,N={negotiated:!0,id:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F,protocol:b};g.debug("receiveDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(w,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),yield this._pc.setRemoteDescription(j);const K=yield this._pc.createAnswer();if(!this._transportReady){const X=e.parse(K.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:X})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K),this._hasDataChannelMediaSection=!0}return{dataChannel:P}})}setupTransport(v){return B(this,arguments,function*({localDtlsRole:m,localSdpObject:w}){w||(w=e.parse(this._pc.localDescription.sdp));const b=o.extractDtlsParameters({sdpObject:w});b.role=m,this._remoteSdp.updateDtlsRole(m==="client"?"server":"client"),yield new Promise((C,A)=>{this.safeEmit("@connect",{dtlsParameters:b},C,A)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new n.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Firefox60=x}}),Ab=Ce({"../../node_modules/mediasoup-client/lib/handlers/Safari12.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=va(),c=Il(),h=Sn(),l=Wn(),p=kr(),g=Hs(),f=new i.Logger("Safari12"),y="Safari12",x={OS:1024,MIS:1024},S=class ym extends l.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new ym}get name(){return y}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){f.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{m.addTransceiver("audio"),m.addTransceiver("video");const w=yield m.createOffer();try{m.close()}catch{}const b=e.parse(w.sdp),C=s.extractRtpCapabilities({sdpObject:b});return c.addNackSupportForOpus(C),C}catch(w){try{m.close()}catch{}throw w}})}getNativeSctpCapabilities(){return B(this,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:x}})}run({direction:m,iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A,iceServers:M,iceTransportPolicy:F,additionalSettings:N,proprietaryConstraints:P,extendedRtpCapabilities:j}){this.assertNotClosed(),f.debug("run()"),this._direction=m,this._remoteSdp=new p.RemoteSdp({iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",j),video:r.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",j),video:r.getSendingRemoteRtpParameters("video",j)},C.role&&C.role!=="auto"&&(this._forcedLocalDtlsRole=C.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:M??[],iceTransportPolicy:F??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},N),P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",K=>{this.emit("@icecandidateerror",K)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(m){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=m,this._pc.setConfiguration(w)})}restartIce(m){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const w=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(m){return B(this,arguments,function*({track:w,encodings:b,codecOptions:C,codec:A,onRtpSender:M}){var F;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",w.kind,w.id);const N=n.clone(this._sendingRtpParametersByKind[w.kind]);N.codecs=r.reduceCodecs(N.codecs,A);const P=n.clone(this._sendingRemoteRtpParametersByKind[w.kind]);P.codecs=r.reduceCodecs(P.codecs,A);const j=this._remoteSdp.getNextMediaSectionIdx(),K=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream]});M&&M(K.sender);let X=yield this._pc.createOffer(),ie=e.parse(X.sdp);ie.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let q;this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:ie}));const ae=(0,g.parse)((b??[{}])[0].scalabilityMode);b&&b.length>1&&(f.debug("send() | enabling legacy simulcast"),ie=e.parse(X.sdp),q=ie.media[j.idx],o.addLegacySimulcast({offerMediaObject:q,numStreams:b.length}),X={type:"offer",sdp:e.write(ie)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X);const pe=K.mid;if(N.mid=pe,ie=e.parse(this._pc.localDescription.sdp),q=ie.media[j.idx],N.rtcp.cname=s.getCname({offerMediaObject:q}),N.encodings=o.getRtpEncodings({offerMediaObject:q}),b)for(let xe=0;xe<N.encodings.length;++xe)b[xe]&&Object.assign(N.encodings[xe],b[xe]);if(N.encodings.length>1&&(N.codecs[0].mimeType.toLowerCase()==="video/vp8"||N.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const xe of N.encodings)xe.scalabilityMode?xe.scalabilityMode=`L1T${ae.temporalLayers}`:xe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:q,reuseMid:j.reuseMid,offerRtpParameters:N,answerRtpParameters:P,codecOptions:C});const ue={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ue),yield this._pc.setRemoteDescription(ue),this._mapMidTransceiver.set(pe,K),{localId:pe,rtpParameters:N,rtpSender:K.sender}})}stopSending(m){return B(this,null,function*(){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");if(w.sender.replaceTrack(null),this._pc.removeTrack(w.sender),this._remoteSdp.closeMediaSection(w.mid))try{w.stop()}catch{}const C=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A),this._mapMidTransceiver.delete(m)})}pauseSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(m);const b=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}resumeSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(m);const b=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}replaceTrack(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),w?f.debug("replaceTrack() [localId:%s, track.id:%s]",m,w.id):f.debug("replaceTrack() [localId:%s, no track]",m);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");yield b.sender.replaceTrack(w)})}setMaxSpatialLayer(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{N<=w?F.active=!0:F.active=!1}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}setRtpEncodingParameters(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{C.encodings[N]=ne(ne({},F),w)}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}getSenderStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.sender.getStats()})}sendDataChannel(m){return B(this,arguments,function*({ordered:w,maxPacketLifeTime:b,maxRetransmits:C,label:A,protocol:M}){var F;this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:b,maxRetransmits:C,protocol:M};f.debug("sendDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(A,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const K=yield this._pc.createOffer(),X=e.parse(K.sdp),ie=X.media.find(ae=>ae.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:X})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K),this._remoteSdp.sendSctpAssociation({offerMediaObject:ie});const q={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q),this._hasDataChannelMediaSection=!0}const j={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:P,sctpStreamParameters:j}})}receive(m){return B(this,null,function*(){var w,b;this.assertNotClosed(),this.assertRecvDirection();const C=[],A=new Map;for(const P of m){const{trackId:j,kind:K,rtpParameters:X,streamId:ie}=P;f.debug("receive() [trackId:%s, kind:%s]",j,K);const q=(w=X.mid)!=null?w:String(this._mapMidTransceiver.size);A.set(j,q),this._remoteSdp.receive({mid:q,kind:K,offerRtpParameters:X,streamId:ie??X.rtcp.cname,trackId:j})}const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",M),yield this._pc.setRemoteDescription(M);for(const P of m){const{trackId:j,onRtpReceiver:K}=P;if(K){const X=A.get(j),ie=this._pc.getTransceivers().find(q=>q.mid===X);if(!ie)throw new Error("transceiver not found");K(ie.receiver)}}let F=yield this._pc.createAnswer();const N=e.parse(F.sdp);for(const P of m){const{trackId:j,rtpParameters:K}=P,X=A.get(j),ie=N.media.find(q=>String(q.mid)===X);s.applyCodecParameters({offerRtpParameters:K,answerMediaObject:ie})}F={type:"answer",sdp:e.write(N)},this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:N})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",F),yield this._pc.setLocalDescription(F);for(const P of m){const{trackId:j}=P,K=A.get(j),X=this._pc.getTransceivers().find(ie=>ie.mid===K);if(!X)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(K,X),C.push({localId:K,track:X.receiver.track,rtpReceiver:X.receiver})}return C})}stopReceiving(m){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const C of m){f.debug("stopReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(A.mid)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b);for(const C of m)this._mapMidTransceiver.delete(C)})}pauseReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("pauseReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="inactive",this._remoteSdp.pauseMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}resumeReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("resumeReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}getReceiverStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.receiver.getStats()})}receiveDataChannel(m){return B(this,arguments,function*({sctpStreamParameters:w,label:b,protocol:C}){var A;this.assertNotClosed(),this.assertRecvDirection();const{streamId:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P}=w,j={negotiated:!0,id:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P,protocol:C};f.debug("receiveDataChannel() [options:%o]",j);const K=this._pc.createDataChannel(b,j);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const X={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ie=yield this._pc.createAnswer();if(!this._transportReady){const q=e.parse(ie.sdp);yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:q})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ie),yield this._pc.setLocalDescription(ie),this._hasDataChannelMediaSection=!0}return{dataChannel:K}})}setupTransport(m){return B(this,arguments,function*({localDtlsRole:w,localSdpObject:b}){b||(b=e.parse(this._pc.localDescription.sdp));const C=s.extractDtlsParameters({sdpObject:b});C.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),yield new Promise((A,M)=>{this.safeEmit("@connect",{dtlsParameters:C},A,M)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Safari12=S}}),Db=Ce({"../../node_modules/mediasoup-client/lib/handlers/Safari11.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=Ll(),c=Wn(),h=kr(),l=new i.Logger("Safari11"),p="Safari11",g={OS:1024,MIS:1024},f=class Sm extends c.HandlerInterface{constructor(){super(),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_sendStream",new MediaStream),le(this,"_mapSendLocalIdRtpSender",new Map),le(this,"_nextSendLocalId",0),le(this,"_mapRecvLocalIdInfo",new Map),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new Sm}get name(){return p}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){l.debug("getNativeRtpCapabilities()");const x=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const S=yield x.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{x.close()}catch{}const v=e.parse(S.sdp);return s.extractRtpCapabilities({sdpObject:v})}catch(S){try{x.close()}catch{}throw S}})}getNativeSctpCapabilities(){return B(this,null,function*(){return l.debug("getNativeSctpCapabilities()"),{numStreams:g}})}run({direction:x,iceParameters:S,iceCandidates:v,dtlsParameters:m,sctpParameters:w,iceServers:b,iceTransportPolicy:C,additionalSettings:A,proprietaryConstraints:M,extendedRtpCapabilities:F}){l.debug("run()"),this._direction=x,this._remoteSdp=new h.RemoteSdp({iceParameters:S,iceCandidates:v,dtlsParameters:m,sctpParameters:w,planB:!0}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",F),video:r.getSendingRtpParameters("video",F)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",F),video:r.getSendingRemoteRtpParameters("video",F)},m.role&&m.role!=="auto"&&(this._forcedLocalDtlsRole=m.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:b??[],iceTransportPolicy:C??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},A),M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",N=>{this.emit("@icecandidateerror",N)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(x){return B(this,null,function*(){l.debug("updateIceServers()");const S=this._pc.getConfiguration();S.iceServers=x,this._pc.setConfiguration(S)})}restartIce(x){return B(this,null,function*(){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(x),!!this._transportReady)if(this._direction==="send"){const S=yield this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",S),yield this._pc.setLocalDescription(S);const v={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",v),yield this._pc.setRemoteDescription(v)}else{const S={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const v=yield this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",v),yield this._pc.setLocalDescription(v)}})}getTransportStats(){return B(this,null,function*(){return this._pc.getStats()})}send(x){return B(this,arguments,function*({track:S,encodings:v,codecOptions:m,codec:w}){var b;this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),w&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let C=yield this._pc.createOffer(),A=e.parse(C.sdp);A.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let M;const F=n.clone(this._sendingRtpParametersByKind[S.kind]);F.codecs=r.reduceCodecs(F.codecs);const N=n.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(N.codecs=r.reduceCodecs(N.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:A})),S.kind==="video"&&v&&v.length>1&&(l.debug("send() | enabling simulcast"),A=e.parse(C.sdp),M=A.media.find(X=>X.type==="video"),o.addLegacySimulcast({offerMediaObject:M,track:S,numStreams:v.length}),C={type:"offer",sdp:e.write(A)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C),A=e.parse(this._pc.localDescription.sdp),M=A.media.find(X=>X.type===S.kind),F.rtcp.cname=s.getCname({offerMediaObject:M}),F.encodings=o.getRtpEncodings({offerMediaObject:M,track:S}),v)for(let X=0;X<F.encodings.length;++X)v[X]&&Object.assign(F.encodings[X],v[X]);if(F.encodings.length>1&&F.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const X of F.encodings)X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:M,offerRtpParameters:F,answerRtpParameters:N,codecOptions:m});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),yield this._pc.setRemoteDescription(P);const j=String(this._nextSendLocalId);this._nextSendLocalId++;const K=this._pc.getSenders().find(X=>X.track===S);return this._mapSendLocalIdRtpSender.set(j,K),{localId:j,rtpParameters:F,rtpSender:K}})}stopSending(x){return B(this,null,function*(){this.assertSendDirection();const S=this._mapSendLocalIdRtpSender.get(x);if(!S)throw new Error("associated RTCRtpSender not found");S.track&&this._sendStream.removeTrack(S.track),this._mapSendLocalIdRtpSender.delete(x);const v=yield this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v);try{yield this._pc.setLocalDescription(v)}catch(w){if(this._sendStream.getTracks().length===0){l.warn("stopSending() | ignoring expected error due no sending tracks: %s",w.toString());return}throw w}if(this._pc.signalingState==="stable")return;const m={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m)})}pauseSending(x){return B(this,null,function*(){})}resumeSending(x){return B(this,null,function*(){})}replaceTrack(x,S){return B(this,null,function*(){this.assertSendDirection(),S?l.debug("replaceTrack() [localId:%s, track.id:%s]",x,S.id):l.debug("replaceTrack() [localId:%s, no track]",x);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.track;yield v.replaceTrack(S),m&&this._sendStream.removeTrack(m),S&&this._sendStream.addTrack(S)})}setMaxSpatialLayer(x,S){return B(this,null,function*(){this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",x,S);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.getParameters();m.encodings.forEach((w,b)=>{b<=S?w.active=!0:w.active=!1}),yield v.setParameters(m)})}setRtpEncodingParameters(x,S){return B(this,null,function*(){this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",x,S);const v=this._mapSendLocalIdRtpSender.get(x);if(!v)throw new Error("associated RTCRtpSender not found");const m=v.getParameters();m.encodings.forEach((w,b)=>{m.encodings[b]=ne(ne({},w),S)}),yield v.setParameters(m)})}getSenderStats(x){return B(this,null,function*(){this.assertSendDirection();const S=this._mapSendLocalIdRtpSender.get(x);if(!S)throw new Error("associated RTCRtpSender not found");return S.getStats()})}sendDataChannel(x){return B(this,arguments,function*({ordered:S,maxPacketLifeTime:v,maxRetransmits:m,label:w,protocol:b}){var C;this.assertSendDirection();const A={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:v,maxRetransmits:m,protocol:b};l.debug("sendDataChannel() [options:%o]",A);const M=this._pc.createDataChannel(w,A);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const N=yield this._pc.createOffer(),P=e.parse(N.sdp),j=P.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(C=this._forcedLocalDtlsRole)!=null?C:"client",localSdpObject:P})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",N),yield this._pc.setLocalDescription(N),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const K={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setRemoteDescription(K),this._hasDataChannelMediaSection=!0}const F={streamId:A.id,ordered:A.ordered,maxPacketLifeTime:A.maxPacketLifeTime,maxRetransmits:A.maxRetransmits};return{dataChannel:M,sctpStreamParameters:F}})}receive(x){return B(this,null,function*(){var S;this.assertRecvDirection();const v=[];for(const C of x){const{trackId:A,kind:M,rtpParameters:F,streamId:N}=C;l.debug("receive() [trackId:%s, kind:%s]",A,M);const P=M;this._remoteSdp.receive({mid:P,kind:M,offerRtpParameters:F,streamId:N??F.rtcp.cname,trackId:A})}const m={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);let w=yield this._pc.createAnswer();const b=e.parse(w.sdp);for(const C of x){const{kind:A,rtpParameters:M}=C,F=A,N=b.media.find(P=>String(P.mid)===F);s.applyCodecParameters({offerRtpParameters:M,answerMediaObject:N})}w={type:"answer",sdp:e.write(b)},this._transportReady||(yield this.setupTransport({localDtlsRole:(S=this._forcedLocalDtlsRole)!=null?S:"client",localSdpObject:b})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const C of x){const{kind:A,trackId:M,rtpParameters:F}=C,N=A,P=M,j=this._pc.getReceivers().find(K=>K.track&&K.track.id===P);if(!j)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(P,{mid:N,rtpParameters:F,rtpReceiver:j}),v.push({localId:P,track:j.track,rtpReceiver:j})}return v})}stopReceiving(x){return B(this,null,function*(){var S;this.assertRecvDirection();for(const w of x){l.debug("stopReceiving() [localId:%s]",w);const{mid:b,rtpParameters:C}=(S=this._mapRecvLocalIdInfo.get(w))!=null?S:{};this._mapRecvLocalIdInfo.delete(w),this._remoteSdp.planBStopReceiving({mid:b,offerRtpParameters:C})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m)})}getReceiverStats(x){return B(this,null,function*(){var S;this.assertRecvDirection();const{rtpReceiver:v}=(S=this._mapRecvLocalIdInfo.get(x))!=null?S:{};if(!v)throw new Error("associated RTCRtpReceiver not found");return v.getStats()})}pauseReceiving(x){return B(this,null,function*(){})}resumeReceiving(x){return B(this,null,function*(){})}receiveDataChannel(x){return B(this,arguments,function*({sctpStreamParameters:S,label:v,protocol:m}){var w;this.assertRecvDirection();const{streamId:b,ordered:C,maxPacketLifeTime:A,maxRetransmits:M}=S,F={negotiated:!0,id:b,ordered:C,maxPacketLifeTime:A,maxRetransmits:M,protocol:m};l.debug("receiveDataChannel() [options:%o]",F);const N=this._pc.createDataChannel(v,F);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const P={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",P),yield this._pc.setRemoteDescription(P);const j=yield this._pc.createAnswer();if(!this._transportReady){const K=e.parse(j.sdp);yield this.setupTransport({localDtlsRole:(w=this._forcedLocalDtlsRole)!=null?w:"client",localSdpObject:K})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),yield this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:N}})}setupTransport(x){return B(this,arguments,function*({localDtlsRole:S,localSdpObject:v}){v||(v=e.parse(this._pc.localDescription.sdp));const m=s.extractDtlsParameters({sdpObject:v});m.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),yield new Promise((w,b)=>{this.safeEmit("@connect",{dtlsParameters:m},w,b)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.Safari11=f}}),Ib=Ce({"../../node_modules/mediasoup-client/lib/handlers/ortc/edgeUtils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.getCapabilities=i,t.mangleRtpParameters=n;var e=Qi();function i(){var r,s,o;const c=RTCRtpReceiver.getCapabilities(),h=e.clone(c);for(const l of(r=h.codecs)!=null?r:[]){if(l.channels=l.numChannels,delete l.numChannels,l.mimeType=(s=l.mimeType)!=null?s:`${l.kind}/${l.name}`,l.parameters){const p=l.parameters;p.apt&&(p.apt=Number(p.apt)),p["packetization-mode"]&&(p["packetization-mode"]=Number(p["packetization-mode"]))}for(const p of(o=l.rtcpFeedback)!=null?o:[])p.parameter||(p.parameter="")}return h}function n(r){const s=e.clone(r);s.mid&&(s.muxId=s.mid,delete s.mid);for(const o of s.codecs)o.channels&&(o.numChannels=o.channels,delete o.channels),o.mimeType&&!o.name&&(o.name=o.mimeType.split("/")[1]),delete o.mimeType;return s}}}),Lb=Ce({"../../node_modules/mediasoup-client/lib/handlers/Edge11.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;var e=Vi(),i=Sn(),n=Qi(),r=wn(),s=Ib(),o=Wn(),c=new e.Logger("Edge11"),h="Edge11",l=class wm extends o.HandlerInterface{constructor(){super(),le(this,"_sendingRtpParametersByKind"),le(this,"_remoteIceParameters"),le(this,"_remoteIceCandidates"),le(this,"_remoteDtlsParameters"),le(this,"_iceGatherer"),le(this,"_iceTransport"),le(this,"_dtlsTransport"),le(this,"_rtpSenders",new Map),le(this,"_rtpReceivers",new Map),le(this,"_nextSendLocalId",0),le(this,"_cname"),le(this,"_transportReady",!1)}static createFactory(){return()=>new wm}get name(){return h}close(){c.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const g of this._rtpSenders.values())try{g.stop()}catch{}for(const g of this._rtpReceivers.values())try{g.stop()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){return c.debug("getNativeRtpCapabilities()"),s.getCapabilities()})}getNativeSctpCapabilities(){return B(this,null,function*(){return c.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}})}run({direction:g,iceParameters:f,iceCandidates:y,dtlsParameters:x,sctpParameters:S,iceServers:v,iceTransportPolicy:m,additionalSettings:w,proprietaryConstraints:b,extendedRtpCapabilities:C}){c.debug("run()"),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",C),video:r.getSendingRtpParameters("video",C)},this._remoteIceParameters=f,this._remoteIceCandidates=y,this._remoteDtlsParameters=x,this._cname=`CNAME-${n.generateRandomNumber()}`,this.setIceGatherer({iceServers:v,iceTransportPolicy:m}),this.setIceTransport(),this.setDtlsTransport()}updateIceServers(g){return B(this,null,function*(){throw new i.UnsupportedError("not supported")})}restartIce(g){return B(this,null,function*(){if(c.debug("restartIce()"),this._remoteIceParameters=g,!!this._transportReady){c.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,g,"controlling");for(const f of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(f);this._iceTransport.addRemoteCandidate({})}})}getTransportStats(){return B(this,null,function*(){return this._iceTransport.getStats()})}send(g){return B(this,arguments,function*({track:f,encodings:y,codecOptions:x,codec:S}){c.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),c.debug("send() | calling new RTCRtpSender()");const v=new RTCRtpSender(f,this._dtlsTransport),m=n.clone(this._sendingRtpParametersByKind[f.kind]);m.codecs=r.reduceCodecs(m.codecs,S);const w=m.codecs.some(A=>/.+\/rtx$/i.test(A.mimeType));y||(y=[{}]);for(const A of y)A.ssrc=n.generateRandomNumber(),w&&(A.rtx={ssrc:n.generateRandomNumber()});m.encodings=y,m.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const b=s.mangleRtpParameters(m);c.debug("send() | calling rtpSender.send() [params:%o]",b),yield v.send(b);const C=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(C,v),{localId:C,rtpParameters:m,rtpSender:v}})}stopSending(g){return B(this,null,function*(){c.debug("stopSending() [localId:%s]",g);const f=this._rtpSenders.get(g);if(!f)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(g);try{c.debug("stopSending() | calling rtpSender.stop()"),f.stop()}catch(y){throw c.warn("stopSending() | rtpSender.stop() failed:%o",y),y}})}pauseSending(g){return B(this,null,function*(){})}resumeSending(g){return B(this,null,function*(){})}replaceTrack(g,f){return B(this,null,function*(){f?c.debug("replaceTrack() [localId:%s, track.id:%s]",g,f.id):c.debug("replaceTrack() [localId:%s, no track]",g);const y=this._rtpSenders.get(g);if(!y)throw new Error("RTCRtpSender not found");y.setTrack(f)})}setMaxSpatialLayer(g,f){return B(this,null,function*(){c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",g,f);const y=this._rtpSenders.get(g);if(!y)throw new Error("RTCRtpSender not found");const x=y.getParameters();x.encodings.forEach((S,v)=>{v<=f?S.active=!0:S.active=!1}),yield y.setParameters(x)})}setRtpEncodingParameters(g,f){return B(this,null,function*(){c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",g,f);const y=this._rtpSenders.get(g);if(!y)throw new Error("RTCRtpSender not found");const x=y.getParameters();x.encodings.forEach((S,v)=>{x.encodings[v]=ne(ne({},S),f)}),yield y.setParameters(x)})}getSenderStats(g){return B(this,null,function*(){const f=this._rtpSenders.get(g);if(!f)throw new Error("RTCRtpSender not found");return f.getStats()})}sendDataChannel(g){return B(this,null,function*(){throw new i.UnsupportedError("not implemented")})}receive(g){return B(this,null,function*(){const f=[];for(const y of g){const{trackId:x,kind:S}=y;c.debug("receive() [trackId:%s, kind:%s]",x,S)}this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));for(const y of g){const{trackId:x,kind:S,rtpParameters:v}=y;c.debug("receive() | calling new RTCRtpReceiver()");const m=new RTCRtpReceiver(this._dtlsTransport,S);m.addEventListener("error",C=>{c.error('rtpReceiver "error" event [event:%o]',C)});const w=s.mangleRtpParameters(v);c.debug("receive() | calling rtpReceiver.receive() [params:%o]",w),yield m.receive(w);const b=x;this._rtpReceivers.set(b,m),f.push({localId:b,track:m.track,rtpReceiver:m})}return f})}stopReceiving(g){return B(this,null,function*(){for(const f of g){c.debug("stopReceiving() [localId:%s]",f);const y=this._rtpReceivers.get(f);if(!y)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(f);try{c.debug("stopReceiving() | calling rtpReceiver.stop()"),y.stop()}catch(x){c.warn("stopReceiving() | rtpReceiver.stop() failed:%o",x)}}})}pauseReceiving(g){return B(this,null,function*(){})}resumeReceiving(g){return B(this,null,function*(){})}getReceiverStats(g){return B(this,null,function*(){const f=this._rtpReceivers.get(g);if(!f)throw new Error("RTCRtpReceiver not found");return f.getStats()})}receiveDataChannel(g){return B(this,null,function*(){throw new i.UnsupportedError("not implemented")})}setIceGatherer({iceServers:g,iceTransportPolicy:f}){const y=new RTCIceGatherer({iceServers:g??[],gatherPolicy:f??"all"});y.addEventListener("error",x=>{c.error('iceGatherer "error" event [event:%o]',x)});try{y.gather()}catch(x){c.debug("setIceGatherer() | iceGatherer.gather() failed: %s",x.toString())}this._iceGatherer=y}setIceTransport(){const g=new RTCIceTransport(this._iceGatherer);g.addEventListener("statechange",()=>{switch(g.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),g.addEventListener("icestatechange",()=>{switch(g.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),g.addEventListener("candidatepairchange",f=>{c.debug('iceTransport "candidatepairchange" event [pair:%o]',f.pair)}),this._iceTransport=g}setDtlsTransport(){const g=new RTCDtlsTransport(this._iceTransport);g.addEventListener("statechange",()=>{c.debug('dtlsTransport "statechange" event [state:%s]',g.state)}),g.addEventListener("dtlsstatechange",()=>{c.debug('dtlsTransport "dtlsstatechange" event [state:%s]',g.state),g.state==="closed"&&this.emit("@connectionstatechange","closed")}),g.addEventListener("error",f=>{c.error('dtlsTransport "error" event [event:%o]',f)}),this._dtlsTransport=g}setupTransport(g){return B(this,arguments,function*({localDtlsRole:f}){c.debug("setupTransport()");const y=this._dtlsTransport.getLocalParameters();y.role=f,yield new Promise((x,S)=>{this.safeEmit("@connect",{dtlsParameters:y},x,S)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const x of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(x);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(x=>x.algorithm==="sha-256"||x.algorithm==="sha-384"||x.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0})}};t.Edge11=l}}),Fb=Ce({"../../node_modules/mediasoup-client/lib/handlers/ReactNativeUnifiedPlan.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;var e=hn(),i=Vi(),n=Qi(),r=wn(),s=Fr(),o=va(),c=Il(),h=Sn(),l=Wn(),p=kr(),g=Hs(),f=new i.Logger("ReactNativeUnifiedPlan"),y="ReactNativeUnifiedPlan",x={OS:1024,MIS:1024},S=class xm extends l.HandlerInterface{constructor(){super(),le(this,"_closed",!1),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_mapMidTransceiver",new Map),le(this,"_sendStream",new MediaStream),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new xm}get name(){return y}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}getNativeRtpCapabilities(){return B(this,null,function*(){f.debug("getNativeRtpCapabilities()");const m=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{m.addTransceiver("audio"),m.addTransceiver("video");const w=yield m.createOffer();try{m.close()}catch{}const b=e.parse(w.sdp),C=s.extractRtpCapabilities({sdpObject:b});return c.addNackSupportForOpus(C),C}catch(w){try{m.close()}catch{}throw w}})}getNativeSctpCapabilities(){return B(this,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:x}})}run({direction:m,iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A,iceServers:M,iceTransportPolicy:F,additionalSettings:N,proprietaryConstraints:P,extendedRtpCapabilities:j}){this.assertNotClosed(),f.debug("run()"),this._direction=m,this._remoteSdp=new p.RemoteSdp({iceParameters:w,iceCandidates:b,dtlsParameters:C,sctpParameters:A}),this._sendingRtpParametersByKind={audio:r.getSendingRtpParameters("audio",j),video:r.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:r.getSendingRemoteRtpParameters("audio",j),video:r.getSendingRemoteRtpParameters("video",j)},C.role&&C.role!=="auto"&&(this._forcedLocalDtlsRole=C.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:M??[],iceTransportPolicy:F??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},N),P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",K=>{this.emit("@icecandidateerror",K)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(m){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=m,this._pc.setConfiguration(w)})}restartIce(m){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(m),!!this._transportReady)if(this._direction==="send"){const w=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const b={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(m){return B(this,arguments,function*({track:w,encodings:b,codecOptions:C,codec:A,onRtpSender:M}){var F,N;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),b&&b.length>1&&b.forEach((ye,ge)=>{ye.rid=`r${ge}`});const P=n.clone(this._sendingRtpParametersByKind[w.kind]);P.codecs=r.reduceCodecs(P.codecs,A);const j=n.clone(this._sendingRemoteRtpParametersByKind[w.kind]);j.codecs=r.reduceCodecs(j.codecs,A);const K=this._remoteSdp.getNextMediaSectionIdx(),X=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream],sendEncodings:b});M&&M(X.sender);let ie=yield this._pc.createOffer(),q=e.parse(ie.sdp);q.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let ae;this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:q}));let pe=!1;const ue=(0,g.parse)((b??[{}])[0].scalabilityMode);b&&b.length===1&&ue.spatialLayers>1&&P.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),pe=!0,q=e.parse(ie.sdp),ae=q.media[K.idx],o.addLegacySimulcast({offerMediaObject:ae,numStreams:ue.spatialLayers}),ie={type:"offer",sdp:e.write(q)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",ie),yield this._pc.setLocalDescription(ie);let xe=(N=X.mid)!=null?N:void 0;if(xe||f.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),P.mid=xe,q=e.parse(this._pc.localDescription.sdp),ae=q.media[K.idx],P.rtcp.cname=s.getCname({offerMediaObject:ae}),!b)P.encodings=o.getRtpEncodings({offerMediaObject:ae});else if(b.length===1){let ye=o.getRtpEncodings({offerMediaObject:ae});Object.assign(ye[0],b[0]),pe&&(ye=[ye[0]]),P.encodings=ye}else P.encodings=b;if(P.encodings.length>1&&(P.codecs[0].mimeType.toLowerCase()==="video/vp8"||P.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ye of P.encodings)ye.scalabilityMode?ye.scalabilityMode=`L1T${ue.temporalLayers}`:ye.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ae,reuseMid:K.reuseMid,offerRtpParameters:P,answerRtpParameters:j,codecOptions:C});const Ee={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Ee),yield this._pc.setRemoteDescription(Ee),xe||(xe=X.mid,P.mid=xe),this._mapMidTransceiver.set(xe,X),{localId:xe,rtpParameters:P,rtpSender:X.sender}})}stopSending(m){return B(this,null,function*(){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");if(w.sender.replaceTrack(null),this._pc.removeTrack(w.sender),this._remoteSdp.closeMediaSection(w.mid))try{w.stop()}catch{}const C=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",C),yield this._pc.setLocalDescription(C);const A={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",A),yield this._pc.setRemoteDescription(A),this._mapMidTransceiver.delete(m)})}pauseSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(m);const b=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}resumeSending(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",m);const w=this._mapMidTransceiver.get(m);if(this._remoteSdp.resumeSendingMediaSection(m),!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="sendonly";const b=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const C={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",C),yield this._pc.setRemoteDescription(C)})}replaceTrack(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),w?f.debug("replaceTrack() [localId:%s, track.id:%s]",m,w.id):f.debug("replaceTrack() [localId:%s, no track]",m);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");yield b.sender.replaceTrack(w)})}setMaxSpatialLayer(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{N<=w?F.active=!0:F.active=!1}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}setRtpEncodingParameters(m,w){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",m,w);const b=this._mapMidTransceiver.get(m);if(!b)throw new Error("associated RTCRtpTransceiver not found");const C=b.sender.getParameters();C.encodings.forEach((F,N)=>{C.encodings[N]=ne(ne({},F),w)}),yield b.sender.setParameters(C),this._remoteSdp.muxMediaSectionSimulcast(m,C.encodings);const A=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A);const M={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",M),yield this._pc.setRemoteDescription(M)})}getSenderStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.sender.getStats()})}sendDataChannel(m){return B(this,arguments,function*({ordered:w,maxPacketLifeTime:b,maxRetransmits:C,label:A,protocol:M}){var F;this.assertNotClosed(),this.assertSendDirection();const N={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:b,maxRetransmits:C,protocol:M};f.debug("sendDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(A,N);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const K=yield this._pc.createOffer(),X=e.parse(K.sdp),ie=X.media.find(ae=>ae.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!=null?F:"client",localSdpObject:X})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K),this._remoteSdp.sendSctpAssociation({offerMediaObject:ie});const q={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q),this._hasDataChannelMediaSection=!0}const j={streamId:N.id,ordered:N.ordered,maxPacketLifeTime:N.maxPacketLifeTime,maxRetransmits:N.maxRetransmits};return{dataChannel:P,sctpStreamParameters:j}})}receive(m){return B(this,null,function*(){var w,b;this.assertNotClosed(),this.assertRecvDirection();const C=[],A=new Map;for(const P of m){const{trackId:j,kind:K,rtpParameters:X,streamId:ie}=P;f.debug("receive() [trackId:%s, kind:%s]",j,K);const q=(w=X.mid)!=null?w:String(this._mapMidTransceiver.size);A.set(j,q),this._remoteSdp.receive({mid:q,kind:K,offerRtpParameters:X,streamId:ie??X.rtcp.cname,trackId:j})}const M={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",M),yield this._pc.setRemoteDescription(M);for(const P of m){const{trackId:j,onRtpReceiver:K}=P;if(K){const X=A.get(j),ie=this._pc.getTransceivers().find(q=>q.mid===X);if(!ie)throw new Error("transceiver not found");K(ie.receiver)}}let F=yield this._pc.createAnswer();const N=e.parse(F.sdp);for(const P of m){const{trackId:j,rtpParameters:K}=P,X=A.get(j),ie=N.media.find(q=>String(q.mid)===X);s.applyCodecParameters({offerRtpParameters:K,answerMediaObject:ie})}F={type:"answer",sdp:e.write(N)},this._transportReady||(yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:N})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",F),yield this._pc.setLocalDescription(F);for(const P of m){const{trackId:j}=P,K=A.get(j),X=this._pc.getTransceivers().find(ie=>ie.mid===K);if(X)this._mapMidTransceiver.set(K,X),C.push({localId:K,track:X.receiver.track,rtpReceiver:X.receiver});else throw new Error("new RTCRtpTransceiver not found")}return C})}stopReceiving(m){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const C of m){f.debug("stopReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(A.mid)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b);for(const C of m)this._mapMidTransceiver.delete(C)})}pauseReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("pauseReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="inactive",this._remoteSdp.pauseMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}resumeReceiving(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const C of m){f.debug("resumeReceiving() [localId:%s]",C);const A=this._mapMidTransceiver.get(C);if(!A)throw new Error("associated RTCRtpTransceiver not found");A.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(C)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);const b=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}getReceiverStats(m){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const w=this._mapMidTransceiver.get(m);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.receiver.getStats()})}receiveDataChannel(m){return B(this,arguments,function*({sctpStreamParameters:w,label:b,protocol:C}){var A;this.assertNotClosed(),this.assertRecvDirection();const{streamId:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P}=w,j={negotiated:!0,id:M,ordered:F,maxPacketLifeTime:N,maxRetransmits:P,protocol:C};f.debug("receiveDataChannel() [options:%o]",j);const K=this._pc.createDataChannel(b,j);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const X={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ie=yield this._pc.createAnswer();if(!this._transportReady){const q=e.parse(ie.sdp);yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:q})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ie),yield this._pc.setLocalDescription(ie),this._hasDataChannelMediaSection=!0}return{dataChannel:K}})}setupTransport(m){return B(this,arguments,function*({localDtlsRole:w,localSdpObject:b}){b||(b=e.parse(this._pc.localDescription.sdp));const C=s.extractDtlsParameters({sdpObject:b});C.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),yield new Promise((A,M)=>{this.safeEmit("@connect",{dtlsParameters:C},A,M)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new h.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.ReactNativeUnifiedPlan=S}}),kb=Ce({"../../node_modules/mediasoup-client/lib/handlers/ReactNative.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;var e=hn(),i=Vi(),n=Sn(),r=Qi(),s=wn(),o=Fr(),c=Ll(),h=Wn(),l=kr(),p=new i.Logger("ReactNative"),g="ReactNative",f={OS:1024,MIS:1024},y=class Em extends h.HandlerInterface{constructor(){super(),le(this,"_direction"),le(this,"_remoteSdp"),le(this,"_sendingRtpParametersByKind"),le(this,"_sendingRemoteRtpParametersByKind"),le(this,"_forcedLocalDtlsRole"),le(this,"_pc"),le(this,"_sendStream",new MediaStream),le(this,"_mapSendLocalIdTrack",new Map),le(this,"_nextSendLocalId",0),le(this,"_mapRecvLocalIdInfo",new Map),le(this,"_hasDataChannelMediaSection",!1),le(this,"_nextSendSctpStreamId",0),le(this,"_transportReady",!1)}static createFactory(){return()=>new Em}get name(){return g}close(){if(p.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return B(this,null,function*(){p.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const v=yield S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const m=e.parse(v.sdp);return o.extractRtpCapabilities({sdpObject:m})}catch(v){try{S.close()}catch{}throw v}})}getNativeSctpCapabilities(){return B(this,null,function*(){return p.debug("getNativeSctpCapabilities()"),{numStreams:f}})}run({direction:S,iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,iceServers:C,iceTransportPolicy:A,additionalSettings:M,proprietaryConstraints:F,extendedRtpCapabilities:N}){p.debug("run()"),this._direction=S,this._remoteSdp=new l.RemoteSdp({iceParameters:v,iceCandidates:m,dtlsParameters:w,sctpParameters:b,planB:!0}),this._sendingRtpParametersByKind={audio:s.getSendingRtpParameters("audio",N),video:s.getSendingRtpParameters("video",N)},this._sendingRemoteRtpParametersByKind={audio:s.getSendingRemoteRtpParameters("audio",N),video:s.getSendingRemoteRtpParameters("video",N)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ne({iceServers:C??[],iceTransportPolicy:A??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},M),F),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}updateIceServers(S){return B(this,null,function*(){p.debug("updateIceServers()");const v=this._pc.getConfiguration();v.iceServers=S,this._pc.setConfiguration(v)})}restartIce(S){return B(this,null,function*(){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const v=yield this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",v),yield this._pc.setLocalDescription(v);const m={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m)}else{const v={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",v),yield this._pc.setRemoteDescription(v);const m=yield this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",m),yield this._pc.setLocalDescription(m)}})}getTransportStats(){return B(this,null,function*(){return this._pc.getStats()})}send(S){return B(this,arguments,function*({track:v,encodings:m,codecOptions:w,codec:b}){var C;this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),b&&p.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(v),this._pc.addStream(this._sendStream);let A=yield this._pc.createOffer(),M=e.parse(A.sdp);M.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let F;const N=r.clone(this._sendingRtpParametersByKind[v.kind]);N.codecs=s.reduceCodecs(N.codecs);const P=r.clone(this._sendingRemoteRtpParametersByKind[v.kind]);if(P.codecs=s.reduceCodecs(P.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(C=this._forcedLocalDtlsRole)!=null?C:"client",localSdpObject:M})),v.kind==="video"&&m&&m.length>1&&(p.debug("send() | enabling simulcast"),M=e.parse(A.sdp),F=M.media.find(X=>X.type==="video"),c.addLegacySimulcast({offerMediaObject:F,track:v,numStreams:m.length}),A={type:"offer",sdp:e.write(M)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",A),yield this._pc.setLocalDescription(A),M=e.parse(this._pc.localDescription.sdp),F=M.media.find(X=>X.type===v.kind),N.rtcp.cname=o.getCname({offerMediaObject:F}),N.encodings=c.getRtpEncodings({offerMediaObject:F,track:v}),m)for(let X=0;X<N.encodings.length;++X)m[X]&&Object.assign(N.encodings[X],m[X]);if(N.encodings.length>1&&(N.codecs[0].mimeType.toLowerCase()==="video/vp8"||N.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const X of N.encodings)X.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:F,offerRtpParameters:N,answerRtpParameters:P,codecOptions:w});const j={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",j),yield this._pc.setRemoteDescription(j);const K=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(K,v),{localId:K,rtpParameters:N}})}stopSending(S){return B(this,null,function*(){this.assertSendDirection(),p.debug("stopSending() [localId:%s]",S);const v=this._mapSendLocalIdTrack.get(S);if(!v)throw new Error("track not found");this._mapSendLocalIdTrack.delete(S),this._sendStream.removeTrack(v),this._pc.addStream(this._sendStream);const m=yield this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",m);try{yield this._pc.setLocalDescription(m)}catch(b){if(this._sendStream.getTracks().length===0){p.warn("stopSending() | ignoring expected error due no sending tracks: %s",b.toString());return}throw b}if(this._pc.signalingState==="stable")return;const w={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)})}pauseSending(S){return B(this,null,function*(){})}resumeSending(S){return B(this,null,function*(){})}replaceTrack(S,v){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}setMaxSpatialLayer(S,v){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}setRtpEncodingParameters(S,v){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}getSenderStats(S){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}sendDataChannel(S){return B(this,arguments,function*({ordered:v,maxPacketLifeTime:m,maxRetransmits:w,label:b,protocol:C}){var A;this.assertSendDirection();const M={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:m,maxRetransmitTime:m,maxRetransmits:w,protocol:C};p.debug("sendDataChannel() [options:%o]",M);const F=this._pc.createDataChannel(b,M);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const P=yield this._pc.createOffer(),j=e.parse(P.sdp),K=j.media.find(ie=>ie.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(A=this._forcedLocalDtlsRole)!=null?A:"client",localSdpObject:j})),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),yield this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:K});const X={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X),this._hasDataChannelMediaSection=!0}const N={streamId:M.id,ordered:M.ordered,maxPacketLifeTime:M.maxPacketLifeTime,maxRetransmits:M.maxRetransmits};return{dataChannel:F,sctpStreamParameters:N}})}receive(S){return B(this,null,function*(){var v,m;this.assertRecvDirection();const w=[],b=new Map;for(const F of S){const{trackId:N,kind:P,rtpParameters:j}=F;p.debug("receive() [trackId:%s, kind:%s]",N,P);const K=P;let X=(v=F.streamId)!=null?v:j.rtcp.cname;p.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),X+=`-hack-${r.generateRandomNumber()}`,b.set(N,X),this._remoteSdp.receive({mid:K,kind:P,offerRtpParameters:j,streamId:X,trackId:N})}const C={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",C),yield this._pc.setRemoteDescription(C);let A=yield this._pc.createAnswer();const M=e.parse(A.sdp);for(const F of S){const{kind:N,rtpParameters:P}=F,j=N,K=M.media.find(X=>String(X.mid)===j);o.applyCodecParameters({offerRtpParameters:P,answerMediaObject:K})}A={type:"answer",sdp:e.write(M)},this._transportReady||(yield this.setupTransport({localDtlsRole:(m=this._forcedLocalDtlsRole)!=null?m:"client",localSdpObject:M})),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",A),yield this._pc.setLocalDescription(A);for(const F of S){const{kind:N,trackId:P,rtpParameters:j}=F,K=P,X=N,ie=b.get(P),ae=this._pc.getRemoteStreams().find(pe=>pe.id===ie).getTrackById(K);if(!ae)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(K,{mid:X,rtpParameters:j}),w.push({localId:K,track:ae})}return w})}stopReceiving(S){return B(this,null,function*(){var v;this.assertRecvDirection();for(const b of S){p.debug("stopReceiving() [localId:%s]",b);const{mid:C,rtpParameters:A}=(v=this._mapRecvLocalIdInfo.get(b))!=null?v:{};this._mapRecvLocalIdInfo.delete(b),this._remoteSdp.planBStopReceiving({mid:C,offerRtpParameters:A})}const m={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",m),yield this._pc.setRemoteDescription(m);const w=yield this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}pauseReceiving(S){return B(this,null,function*(){})}resumeReceiving(S){return B(this,null,function*(){})}getReceiverStats(S){return B(this,null,function*(){throw new n.UnsupportedError("not implemented")})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:v,label:m,protocol:w}){var b;this.assertRecvDirection();const{streamId:C,ordered:A,maxPacketLifeTime:M,maxRetransmits:F}=v,N={negotiated:!0,id:C,ordered:A,maxPacketLifeTime:M,maxRetransmitTime:M,maxRetransmits:F,protocol:w};p.debug("receiveDataChannel() [options:%o]",N);const P=this._pc.createDataChannel(m,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const j={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),yield this._pc.setRemoteDescription(j);const K=yield this._pc.createAnswer();if(!this._transportReady){const X=e.parse(K.sdp);yield this.setupTransport({localDtlsRole:(b=this._forcedLocalDtlsRole)!=null?b:"client",localSdpObject:X})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K),this._hasDataChannelMediaSection=!0}return{dataChannel:P}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:v,localSdpObject:m}){m||(m=e.parse(this._pc.localDescription.sdp));const w=o.extractDtlsParameters({sdpObject:m});w.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),yield new Promise((b,C)=>{this.safeEmit("@connect",{dtlsParameters:w},b,C)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};t.ReactNative=y}}),Cm=Ce({"../../node_modules/mediasoup-client/lib/Device.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.Device=void 0,t.detectDevice=A;var e=mb(),i=Vi(),n=Bs(),r=Sn(),s=Qi(),o=wn(),c=hm(),h=xb(),l=Eb(),p=Cb(),g=Tb(),f=Rb(),y=Pb(),x=Mb(),S=Ab(),v=Db(),m=Lb(),w=Fb(),b=kb(),C=new i.Logger("Device");function A(F){var N,P,j,K,X,ie;if(!F&&typeof navigator=="object"&&navigator.product==="ReactNative"){if(C.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"){C.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(C.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(C.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(F||typeof navigator=="object"&&typeof navigator.userAgent=="string"){F??(F=navigator.userAgent);const q=new e.UAParser(F);C.debug("detectDevice() | browser detected [userAgent:%s, parsed:%o]",F,q.getResult());const ae=q.getBrowser(),pe=(N=ae.name)==null?void 0:N.toLowerCase(),ue=parseInt((P=ae.major)!=null?P:"0"),Ee=(j=q.getEngine().name)==null?void 0:j.toLowerCase(),ye=q.getOS(),ge=(K=ye.name)==null?void 0:K.toLowerCase(),Te=parseFloat((X=ye.version)!=null?X:"0"),et=(ie=q.getDevice().model)==null?void 0:ie.toLowerCase(),tt=ge==="ios"||et==="ipad",gt=pe&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(pe),Lt=pe&&["firefox","mobile firefox","mobile focus"].includes(pe),St=pe&&["safari","mobile safari"].includes(pe),Kt=pe&&["edge"].includes(pe);if((gt||Kt)&&!tt&&ue>=111)return"Chrome111";if(gt&&!tt&&ue>=74||Kt&&!tt&&ue>=88)return"Chrome74";if(gt&&!tt&&ue>=70)return"Chrome70";if(gt&&!tt&&ue>=67)return"Chrome67";if(gt&&!tt&&ue>=55)return"Chrome55";if(Lt&&!tt&&ue>=120)return"Firefox120";if(Lt&&!tt&&ue>=60)return"Firefox60";if(Lt&&tt&&Te>=14.3)return"Safari12";if(St&&ue>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(St&&ue>=11)return"Safari11";if(Kt&&!tt&&ue>=11&&ue<=18)return"Edge11";if(Ee==="webkit"&&tt&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(Ee==="blink"){const Ei=F.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(Ei){const Ut=Number(Ei[1]);return Ut>=111?"Chrome111":Ut>=74?"Chrome74":Ut>=70?"Chrome70":Ut>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{C.warn("detectDevice() | browser not supported [name:%s, version:%s]",pe,ue);return}}else{C.warn("detectDevice() | unknown device");return}}var M=class{constructor({handlerName:F,handlerFactory:N}={}){if(le(this,"_handlerFactory"),le(this,"_handlerName"),le(this,"_loaded",!1),le(this,"_extendedRtpCapabilities"),le(this,"_recvRtpCapabilities"),le(this,"_canProduceByKind"),le(this,"_sctpCapabilities"),le(this,"_observer",new n.EnhancedEventEmitter),C.debug("constructor()"),F&&N)throw new TypeError("just one of handlerName or handlerInterface can be given");if(N)this._handlerFactory=N;else{if(F)C.debug("constructor() | handler given: %s",F);else if(F=A(),F)C.debug("constructor() | detected handler: %s",F);else throw new r.UnsupportedError("device not supported");switch(F){case"Chrome111":{this._handlerFactory=h.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=l.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=p.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=g.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=f.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=y.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=x.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=S.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=v.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=m.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=w.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=b.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${F}"`)}}const P=this._handlerFactory();this._handlerName=P.name,P.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new r.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new r.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(F){return B(this,arguments,function*({routerRtpCapabilities:N}){C.debug("load() [routerRtpCapabilities:%o]",N);let P;try{if(this._loaded)throw new r.InvalidStateError("already loaded");const j=s.clone(N);o.validateRtpCapabilities(j),P=this._handlerFactory();const K=yield P.getNativeRtpCapabilities();C.debug("load() | got native RTP capabilities:%o",K);const X=s.clone(K);o.validateRtpCapabilities(X),this._extendedRtpCapabilities=o.getExtendedRtpCapabilities(X,j),C.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=o.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=o.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=o.getRecvRtpCapabilities(this._extendedRtpCapabilities),o.validateRtpCapabilities(this._recvRtpCapabilities),C.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=yield P.getNativeSctpCapabilities(),C.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),o.validateSctpCapabilities(this._sctpCapabilities),C.debug("load() succeeded"),this._loaded=!0,P.close()}catch(j){throw P&&P.close(),j}})}canProduce(F){if(this._loaded){if(F!=="audio"&&F!=="video")throw new TypeError(`invalid kind "${F}"`)}else throw new r.InvalidStateError("not loaded");return this._canProduceByKind[F]}createSendTransport({id:F,iceParameters:N,iceCandidates:P,dtlsParameters:j,sctpParameters:K,iceServers:X,iceTransportPolicy:ie,additionalSettings:q,proprietaryConstraints:ae,appData:pe}){return C.debug("createSendTransport()"),this.createTransport({direction:"send",id:F,iceParameters:N,iceCandidates:P,dtlsParameters:j,sctpParameters:K,iceServers:X,iceTransportPolicy:ie,additionalSettings:q,proprietaryConstraints:ae,appData:pe})}createRecvTransport({id:F,iceParameters:N,iceCandidates:P,dtlsParameters:j,sctpParameters:K,iceServers:X,iceTransportPolicy:ie,additionalSettings:q,proprietaryConstraints:ae,appData:pe}){return C.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:F,iceParameters:N,iceCandidates:P,dtlsParameters:j,sctpParameters:K,iceServers:X,iceTransportPolicy:ie,additionalSettings:q,proprietaryConstraints:ae,appData:pe})}createTransport({direction:F,id:N,iceParameters:P,iceCandidates:j,dtlsParameters:K,sctpParameters:X,iceServers:ie,iceTransportPolicy:q,additionalSettings:ae,proprietaryConstraints:pe,appData:ue}){if(this._loaded){if(typeof N!="string")throw new TypeError("missing id");if(typeof P!="object")throw new TypeError("missing iceParameters");if(Array.isArray(j)){if(typeof K!="object")throw new TypeError("missing dtlsParameters");if(X&&typeof X!="object")throw new TypeError("wrong sctpParameters");if(ue&&typeof ue!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new r.InvalidStateError("not loaded");const xe=new c.Transport({direction:F,id:N,iceParameters:P,iceCandidates:j,dtlsParameters:K,sctpParameters:X,iceServers:ie,iceTransportPolicy:q,additionalSettings:ae,proprietaryConstraints:pe,appData:ue,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",xe),xe}};t.Device=M}}),Nb=Ce({"../../node_modules/mediasoup-client/lib/RtpParameters.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0})}}),Ob=Ce({"../../node_modules/mediasoup-client/lib/SctpParameters.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0})}}),Ub=Ce({"../../node_modules/mediasoup-client/lib/types.js"(t){Q();var e=t&&t.__createBinding||(Object.create?function(n,r,s,o){o===void 0&&(o=s);var c=Object.getOwnPropertyDescriptor(r,s);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(n,o,c)}:function(n,r,s,o){o===void 0&&(o=s),n[o]=r[s]}),i=t&&t.__exportStar||function(n,r){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&e(r,n,s)};Object.defineProperty(t,"__esModule",{value:!0}),i(Cm(),t),i(hm(),t),i(cm(),t),i(lm(),t),i(dm(),t),i(um(),t),i(Nb(),t),i(Ob(),t),i(Wn(),t),i(Sn(),t)}}),Bb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/max.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"}}),Hb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/nil.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"}}),jb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/regex.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i}}),Fl=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/validate.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=jb();function i(n){return typeof n=="string"&&e.default.test(n)}t.default=i}}),kl=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/parse.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=Fl();function i(n){if(!(0,e.default)(n))throw TypeError("Invalid UUID");let r;return Uint8Array.of((r=parseInt(n.slice(0,8),16))>>>24,r>>>16&255,r>>>8&255,r&255,(r=parseInt(n.slice(9,13),16))>>>8,r&255,(r=parseInt(n.slice(14,18),16))>>>8,r&255,(r=parseInt(n.slice(19,23),16))>>>8,r&255,(r=parseInt(n.slice(24,36),16))/1099511627776&255,r/4294967296&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255)}t.default=i}}),js=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/stringify.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeStringify=void 0;var e=Fl(),i=[];for(let s=0;s<256;++s)i.push((s+256).toString(16).slice(1));function n(s,o=0){return(i[s[o+0]]+i[s[o+1]]+i[s[o+2]]+i[s[o+3]]+"-"+i[s[o+4]]+i[s[o+5]]+"-"+i[s[o+6]]+i[s[o+7]]+"-"+i[s[o+8]]+i[s[o+9]]+"-"+i[s[o+10]]+i[s[o+11]]+i[s[o+12]]+i[s[o+13]]+i[s[o+14]]+i[s[o+15]]).toLowerCase()}t.unsafeStringify=n;function r(s,o=0){const c=n(s,o);if(!(0,e.default)(c))throw TypeError("Stringified UUID is invalid");return c}t.default=r}}),Hu=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/rng.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e,i=new Uint8Array(16);function n(){if(!e){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(i)}t.default=n}}),Tm=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v1.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.updateV1State=void 0;var e=Hu(),i=js(),n={};function r(c,h,l){var p,g,f,y;let x;const S=(p=c==null?void 0:c._v6)!=null?p:!1;if(c){const v=Object.keys(c);v.length===1&&v[0]==="_v6"&&(c=void 0)}if(c)x=o((y=(f=c.random)!=null?f:(g=c.rng)==null?void 0:g.call(c))!=null?y:(0,e.default)(),c.msecs,c.nsecs,c.clockseq,c.node,h,l);else{const v=Date.now(),m=(0,e.default)();s(n,v,m),x=o(m,n.msecs,n.nsecs,S?void 0:n.clockseq,S?void 0:n.node,h,l)}return h??(0,i.unsafeStringify)(x)}function s(c,h,l){var p,g;return(p=c.msecs)!=null||(c.msecs=-1/0),(g=c.nsecs)!=null||(c.nsecs=0),h===c.msecs?(c.nsecs++,c.nsecs>=1e4&&(c.node=void 0,c.nsecs=0)):h>c.msecs?c.nsecs=0:h<c.msecs&&(c.node=void 0),c.node||(c.node=l.slice(10,16),c.node[0]|=1,c.clockseq=(l[8]<<8|l[9])&16383),c.msecs=h,c}t.updateV1State=s;function o(c,h,l,p,g,f,y=0){if(c.length<16)throw new Error("Random bytes length must be >= 16");if(!f)f=new Uint8Array(16),y=0;else if(y<0||y+16>f.length)throw new RangeError(`UUID byte range ${y}:${y+15} is out of buffer bounds`);h??(h=Date.now()),l??(l=0),p??(p=(c[8]<<8|c[9])&16383),g??(g=c.slice(10,16)),h+=122192928e5;const x=((h&268435455)*1e4+l)%4294967296;f[y++]=x>>>24&255,f[y++]=x>>>16&255,f[y++]=x>>>8&255,f[y++]=x&255;const S=h/4294967296*1e4&268435455;f[y++]=S>>>8&255,f[y++]=S&255,f[y++]=S>>>24&15|16,f[y++]=S>>>16&255,f[y++]=p>>>8|128,f[y++]=p&255;for(let v=0;v<6;++v)f[y++]=g[v];return f}t.default=r}}),Rm=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v1ToV6.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=kl(),i=js();function n(s){const o=typeof s=="string"?(0,e.default)(s):s,c=r(o);return typeof s=="string"?(0,i.unsafeStringify)(c):c}t.default=n;function r(s){return Uint8Array.of((s[6]&15)<<4|s[7]>>4&15,(s[7]&15)<<4|(s[4]&240)>>4,(s[4]&15)<<4|(s[5]&240)>>4,(s[5]&15)<<4|(s[0]&240)>>4,(s[0]&15)<<4|(s[1]&240)>>4,(s[1]&15)<<4|(s[2]&240)>>4,96|s[2]&15,s[3],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15])}}}),Vb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/md5.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});function e(y){const x=s(y),S=r(x,y.length*8);return i(S)}function i(y){const x=new Uint8Array(y.length*4);for(let S=0;S<y.length*4;S++)x[S]=y[S>>2]>>>S%4*8&255;return x}function n(y){return(y+64>>>9<<4)+14+1}function r(y,x){const S=new Uint32Array(n(x)).fill(0);S.set(y),S[x>>5]|=128<<x%32,S[S.length-1]=x,y=S;let v=1732584193,m=-271733879,w=-1732584194,b=271733878;for(let C=0;C<y.length;C+=16){const A=v,M=m,F=w,N=b;v=l(v,m,w,b,y[C],7,-680876936),b=l(b,v,m,w,y[C+1],12,-389564586),w=l(w,b,v,m,y[C+2],17,606105819),m=l(m,w,b,v,y[C+3],22,-1044525330),v=l(v,m,w,b,y[C+4],7,-176418897),b=l(b,v,m,w,y[C+5],12,1200080426),w=l(w,b,v,m,y[C+6],17,-1473231341),m=l(m,w,b,v,y[C+7],22,-45705983),v=l(v,m,w,b,y[C+8],7,1770035416),b=l(b,v,m,w,y[C+9],12,-1958414417),w=l(w,b,v,m,y[C+10],17,-42063),m=l(m,w,b,v,y[C+11],22,-1990404162),v=l(v,m,w,b,y[C+12],7,1804603682),b=l(b,v,m,w,y[C+13],12,-40341101),w=l(w,b,v,m,y[C+14],17,-1502002290),m=l(m,w,b,v,y[C+15],22,1236535329),v=p(v,m,w,b,y[C+1],5,-165796510),b=p(b,v,m,w,y[C+6],9,-1069501632),w=p(w,b,v,m,y[C+11],14,643717713),m=p(m,w,b,v,y[C],20,-373897302),v=p(v,m,w,b,y[C+5],5,-701558691),b=p(b,v,m,w,y[C+10],9,38016083),w=p(w,b,v,m,y[C+15],14,-660478335),m=p(m,w,b,v,y[C+4],20,-405537848),v=p(v,m,w,b,y[C+9],5,568446438),b=p(b,v,m,w,y[C+14],9,-1019803690),w=p(w,b,v,m,y[C+3],14,-187363961),m=p(m,w,b,v,y[C+8],20,1163531501),v=p(v,m,w,b,y[C+13],5,-1444681467),b=p(b,v,m,w,y[C+2],9,-51403784),w=p(w,b,v,m,y[C+7],14,1735328473),m=p(m,w,b,v,y[C+12],20,-1926607734),v=g(v,m,w,b,y[C+5],4,-378558),b=g(b,v,m,w,y[C+8],11,-2022574463),w=g(w,b,v,m,y[C+11],16,1839030562),m=g(m,w,b,v,y[C+14],23,-35309556),v=g(v,m,w,b,y[C+1],4,-1530992060),b=g(b,v,m,w,y[C+4],11,1272893353),w=g(w,b,v,m,y[C+7],16,-155497632),m=g(m,w,b,v,y[C+10],23,-1094730640),v=g(v,m,w,b,y[C+13],4,681279174),b=g(b,v,m,w,y[C],11,-358537222),w=g(w,b,v,m,y[C+3],16,-722521979),m=g(m,w,b,v,y[C+6],23,76029189),v=g(v,m,w,b,y[C+9],4,-640364487),b=g(b,v,m,w,y[C+12],11,-421815835),w=g(w,b,v,m,y[C+15],16,530742520),m=g(m,w,b,v,y[C+2],23,-995338651),v=f(v,m,w,b,y[C],6,-198630844),b=f(b,v,m,w,y[C+7],10,1126891415),w=f(w,b,v,m,y[C+14],15,-1416354905),m=f(m,w,b,v,y[C+5],21,-57434055),v=f(v,m,w,b,y[C+12],6,1700485571),b=f(b,v,m,w,y[C+3],10,-1894986606),w=f(w,b,v,m,y[C+10],15,-1051523),m=f(m,w,b,v,y[C+1],21,-2054922799),v=f(v,m,w,b,y[C+8],6,1873313359),b=f(b,v,m,w,y[C+15],10,-30611744),w=f(w,b,v,m,y[C+6],15,-1560198380),m=f(m,w,b,v,y[C+13],21,1309151649),v=f(v,m,w,b,y[C+4],6,-145523070),b=f(b,v,m,w,y[C+11],10,-1120210379),w=f(w,b,v,m,y[C+2],15,718787259),m=f(m,w,b,v,y[C+9],21,-343485551),v=o(v,A),m=o(m,M),w=o(w,F),b=o(b,N)}return Uint32Array.of(v,m,w,b)}function s(y){if(y.length===0)return new Uint32Array;const x=new Uint32Array(n(y.length*8)).fill(0);for(let S=0;S<y.length;S++)x[S>>2]|=(y[S]&255)<<S%4*8;return x}function o(y,x){const S=(y&65535)+(x&65535);return(y>>16)+(x>>16)+(S>>16)<<16|S&65535}function c(y,x){return y<<x|y>>>32-x}function h(y,x,S,v,m,w){return o(c(o(o(x,y),o(v,w)),m),S)}function l(y,x,S,v,m,w,b){return h(x&S|~x&v,y,x,m,w,b)}function p(y,x,S,v,m,w,b){return h(x&v|S&~v,y,x,m,w,b)}function g(y,x,S,v,m,w,b){return h(x^S^v,y,x,m,w,b)}function f(y,x,S,v,m,w,b){return h(S^(x|~v),y,x,m,w,b)}t.default=e}}),sl=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v35.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=t.stringToBytes=void 0;var e=kl(),i=js();function n(s){s=unescape(encodeURIComponent(s));const o=new Uint8Array(s.length);for(let c=0;c<s.length;++c)o[c]=s.charCodeAt(c);return o}t.stringToBytes=n,t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function r(s,o,c,h,l,p){const g=typeof c=="string"?n(c):c,f=typeof h=="string"?(0,e.default)(h):h;if(typeof h=="string"&&(h=(0,e.default)(h)),(h==null?void 0:h.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let y=new Uint8Array(16+g.length);if(y.set(f),y.set(g,f.length),y=o(y),y[6]=y[6]&15|s,y[8]=y[8]&63|128,l){p=p||0;for(let x=0;x<16;++x)l[p+x]=y[x];return l}return(0,i.unsafeStringify)(y)}t.default=r}}),zb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v3.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;var e=Vb(),i=sl(),n=sl();Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return n.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return n.URL}});function r(s,o,c,h){return(0,i.default)(48,e.default,s,o,c,h)}r.DNS=i.DNS,r.URL=i.URL,t.default=r}}),Gb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/native.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);t.default={randomUUID:e}}}),qb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v4.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=Gb(),i=Hu(),n=js();function r(s,o,c){var h,l,p;if(e.default.randomUUID&&!o&&!s)return e.default.randomUUID();s=s||{};const g=(p=(l=s.random)!=null?l:(h=s.rng)==null?void 0:h.call(s))!=null?p:(0,i.default)();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,o){if(c=c||0,c<0||c+16>o.length)throw new RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let f=0;f<16;++f)o[c+f]=g[f];return o}return(0,n.unsafeStringify)(g)}t.default=r}}),Wb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/sha1.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});function e(r,s,o,c){switch(r){case 0:return s&o^~s&c;case 1:return s^o^c;case 2:return s&o^s&c^o&c;case 3:return s^o^c}}function i(r,s){return r<<s|r>>>32-s}function n(r){const s=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520],c=new Uint8Array(r.length+1);c.set(r),c[r.length]=128,r=c;const h=r.length/4+2,l=Math.ceil(h/16),p=new Array(l);for(let g=0;g<l;++g){const f=new Uint32Array(16);for(let y=0;y<16;++y)f[y]=r[g*64+y*4]<<24|r[g*64+y*4+1]<<16|r[g*64+y*4+2]<<8|r[g*64+y*4+3];p[g]=f}p[l-1][14]=(r.length-1)*8/Math.pow(2,32),p[l-1][14]=Math.floor(p[l-1][14]),p[l-1][15]=(r.length-1)*8&4294967295;for(let g=0;g<l;++g){const f=new Uint32Array(80);for(let w=0;w<16;++w)f[w]=p[g][w];for(let w=16;w<80;++w)f[w]=i(f[w-3]^f[w-8]^f[w-14]^f[w-16],1);let y=o[0],x=o[1],S=o[2],v=o[3],m=o[4];for(let w=0;w<80;++w){const b=Math.floor(w/20),C=i(y,5)+e(b,x,S,v)+m+s[b]+f[w]>>>0;m=v,v=S,S=i(x,30)>>>0,x=y,y=C}o[0]=o[0]+y>>>0,o[1]=o[1]+x>>>0,o[2]=o[2]+S>>>0,o[3]=o[3]+v>>>0,o[4]=o[4]+m>>>0}return Uint8Array.of(o[0]>>24,o[0]>>16,o[0]>>8,o[0],o[1]>>24,o[1]>>16,o[1]>>8,o[1],o[2]>>24,o[2]>>16,o[2]>>8,o[2],o[3]>>24,o[3]>>16,o[3]>>8,o[3],o[4]>>24,o[4]>>16,o[4]>>8,o[4])}t.default=n}}),Kb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v5.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;var e=Wb(),i=sl(),n=sl();Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return n.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return n.URL}});function r(s,o,c,h){return(0,i.default)(80,e.default,s,o,c,h)}r.DNS=i.DNS,r.URL=i.URL,t.default=r}}),Xb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v6.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=js(),i=Tm(),n=Rm();function r(s,o,c){s??(s={}),c??(c=0);let h=(0,i.default)(we(ne({},s),{_v6:!0}),new Uint8Array(16));if(h=(0,n.default)(h),o){for(let l=0;l<16;l++)o[c+l]=h[l];return o}return(0,e.unsafeStringify)(h)}t.default=r}}),$b=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v6ToV1.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=kl(),i=js();function n(s){const o=typeof s=="string"?(0,e.default)(s):s,c=r(o);return typeof s=="string"?(0,i.unsafeStringify)(c):c}t.default=n;function r(s){return Uint8Array.of((s[3]&15)<<4|s[4]>>4&15,(s[4]&15)<<4|(s[5]&240)>>4,(s[5]&15)<<4|s[6]&15,s[7],(s[1]&15)<<4|(s[2]&240)>>4,(s[2]&15)<<4|(s[3]&240)>>4,16|(s[0]&240)>>4,(s[0]&15)<<4|(s[1]&240)>>4,s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15])}}}),Zb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/v7.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.updateV7State=void 0;var e=Hu(),i=js(),n={};function r(c,h,l){var p,g,f;let y;if(c)y=o((f=(g=c.random)!=null?g:(p=c.rng)==null?void 0:p.call(c))!=null?f:(0,e.default)(),c.msecs,c.seq,h,l);else{const x=Date.now(),S=(0,e.default)();s(n,x,S),y=o(S,n.msecs,n.seq,h,l)}return h??(0,i.unsafeStringify)(y)}function s(c,h,l){var p,g;return(p=c.msecs)!=null||(c.msecs=-1/0),(g=c.seq)!=null||(c.seq=0),h>c.msecs?(c.seq=l[6]<<23|l[7]<<16|l[8]<<8|l[9],c.msecs=h):(c.seq=c.seq+1|0,c.seq===0&&c.msecs++),c}t.updateV7State=s;function o(c,h,l,p,g=0){if(c.length<16)throw new Error("Random bytes length must be >= 16");if(!p)p=new Uint8Array(16),g=0;else if(g<0||g+16>p.length)throw new RangeError(`UUID byte range ${g}:${g+15} is out of buffer bounds`);return h??(h=Date.now()),l??(l=c[6]*127<<24|c[7]<<16|c[8]<<8|c[9]),p[g++]=h/1099511627776&255,p[g++]=h/4294967296&255,p[g++]=h/16777216&255,p[g++]=h/65536&255,p[g++]=h/256&255,p[g++]=h&255,p[g++]=112|l>>>28&15,p[g++]=l>>>20&255,p[g++]=128|l>>>14&63,p[g++]=l>>>6&255,p[g++]=l<<2&255|c[10]&3,p[g++]=c[11],p[g++]=c[12],p[g++]=c[13],p[g++]=c[14],p[g++]=c[15],p}t.default=r}}),Yb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/version.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0});var e=Fl();function i(n){if(!(0,e.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}t.default=i}}),Jb=Ce({"../../node_modules/fake-mediastreamtrack/node_modules/uuid/dist/cjs-browser/index.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.validate=t.v7=t.v6ToV1=t.v6=t.v5=t.v4=t.v3=t.v1ToV6=t.v1=t.stringify=t.parse=t.NIL=t.MAX=void 0;var e=Bb();Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return e.default}});var i=Hb();Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return i.default}});var n=kl();Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return n.default}});var r=js();Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return r.default}});var s=Tm();Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return s.default}});var o=Rm();Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return o.default}});var c=zb();Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return c.default}});var h=qb();Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return h.default}});var l=Kb();Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return l.default}});var p=Xb();Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return p.default}});var g=$b();Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return g.default}});var f=Zb();Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return f.default}});var y=Fl();Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return y.default}});var x=Yb();Object.defineProperty(t,"version",{enumerable:!0,get:function(){return x.default}})}}),Qb=Ce({"../../node_modules/fake-mediastreamtrack/lib/utils.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.clone=e;function e(i){if(i!==void 0)return Number.isNaN(i)?NaN:typeof structuredClone=="function"?structuredClone(i):JSON.parse(JSON.stringify(i))}}}),ey=Ce({"../../node_modules/fake-mediastreamtrack/lib/index.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.FakeMediaStreamTrack=void 0;var e=Jb(),i=Qb(),n,r,s,o,c,h,l,p,g,f,y,x,S,v,m,w,b=class Pm extends EventTarget{constructor({kind:M,id:F,label:N,contentHint:P,enabled:j,muted:K,readyState:X,capabilities:ie,constraints:q,settings:ae,data:pe}){super(),gn(this,n),gn(this,r),gn(this,s),gn(this,o),gn(this,c),gn(this,h),gn(this,l),gn(this,p),gn(this,g),gn(this,f),gn(this,y),gn(this,x,null),gn(this,S,null),gn(this,v,null),gn(this,m,null),gn(this,w,null),Li(this,n,F??(0,e.v4)()),Li(this,r,M),Li(this,s,N??""),Li(this,l,P??""),Li(this,c,j??!0),Li(this,h,K??!1),Li(this,o,X??"live"),Li(this,p,ie??{}),Li(this,g,q??{}),Li(this,f,ae??{}),Li(this,y,pe??{})}get id(){return Jt(this,n)}get kind(){return Jt(this,r)}get label(){return Jt(this,s)}get contentHint(){return Jt(this,l)}set contentHint(M){Li(this,l,M)}get enabled(){return Jt(this,c)}set enabled(M){const F=Jt(this,c)!==M;Li(this,c,M),F&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return Jt(this,h)}get readyState(){return Jt(this,o)}get data(){return Jt(this,y)}set data(M){Li(this,y,M)}get onmute(){return Jt(this,x)}set onmute(M){Jt(this,x)&&this.removeEventListener("mute",Jt(this,x)),Li(this,x,M),M&&this.addEventListener("mute",M)}get onunmute(){return Jt(this,S)}set onunmute(M){Jt(this,S)&&this.removeEventListener("unmute",Jt(this,S)),Li(this,S,M),M&&this.addEventListener("unmute",M)}get onended(){return Jt(this,v)}set onended(M){Jt(this,v)&&this.removeEventListener("ended",Jt(this,v)),Li(this,v,M),M&&this.addEventListener("ended",M)}get onenabledchange(){return Jt(this,m)}set onenabledchange(M){Jt(this,m)&&this.removeEventListener("enabledchange",Jt(this,m)),Li(this,m,M),M&&this.addEventListener("enabledchange",M)}get onstopped(){return Jt(this,w)}set onstopped(M){Jt(this,w)&&this.removeEventListener("stopped",Jt(this,w)),Li(this,w,M),M&&this.addEventListener("stopped",M)}addEventListener(M,F,N){super.addEventListener(M,F,N)}removeEventListener(M,F,N){super.removeEventListener(M,F,N)}stop(){Jt(this,o)!=="ended"&&(Li(this,o,"ended"),this.dispatchEvent(new Event("stopped")))}clone({id:M,data:F}={}){return new Pm({id:M??(0,e.v4)(),kind:Jt(this,r),label:Jt(this,s),contentHint:Jt(this,l),enabled:Jt(this,c),muted:Jt(this,h),readyState:Jt(this,o),capabilities:(0,i.clone)(Jt(this,p)),constraints:(0,i.clone)(Jt(this,g)),settings:(0,i.clone)(Jt(this,f)),data:F??(0,i.clone)(Jt(this,y))})}getCapabilities(){return Jt(this,p)}getConstraints(){return Jt(this,g)}applyConstraints(){return B(this,arguments,function*(M={}){return Li(this,g,M),Promise.resolve()})}getSettings(){return Jt(this,f)}remoteStop(){Jt(this,o)!=="ended"&&(Li(this,o,"ended"),this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){Jt(this,h)||(Li(this,h,!0),this.dispatchEvent(new Event("mute")))}remoteUnmute(){Jt(this,h)&&(Li(this,h,!1),this.dispatchEvent(new Event("unmute")))}};n=new WeakMap,r=new WeakMap,s=new WeakMap,o=new WeakMap,c=new WeakMap,h=new WeakMap,l=new WeakMap,p=new WeakMap,g=new WeakMap,f=new WeakMap,y=new WeakMap,x=new WeakMap,S=new WeakMap,v=new WeakMap,m=new WeakMap,w=new WeakMap;var C=b;t.FakeMediaStreamTrack=C}}),ty=Ce({"../../node_modules/mediasoup-client/lib/handlers/FakeHandler.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.FakeHandler=void 0;var e=ey(),i=Bs(),n=Vi(),r=Qi(),s=wn(),o=Sn(),c=Wn(),h=new n.Logger("FakeHandler"),l="FakeHandler",p=class extends i.EnhancedEventEmitter{constructor({id:f,ordered:y,maxPacketLifeTime:x,maxRetransmits:S,label:v,protocol:m}){super(),le(this,"id"),le(this,"ordered"),le(this,"maxPacketLifeTime"),le(this,"maxRetransmits"),le(this,"label"),le(this,"protocol"),this.id=f,this.ordered=y,this.maxPacketLifeTime=x,this.maxRetransmits=S,this.label=v,this.protocol=m}close(){this.safeEmit("close"),this.emit("@close")}send(f){this.safeEmit("message",f)}addEventListener(f,y){this.on(f,y)}},g=class Mm extends c.HandlerInterface{constructor(y){super(),le(this,"_closed",!1),le(this,"fakeParameters"),le(this,"_rtpParametersByKind"),le(this,"_cname",`CNAME-${r.generateRandomNumber()}`),le(this,"_transportReady",!1),le(this,"_nextLocalId",1),le(this,"_tracks",new Map),le(this,"_nextSctpStreamId",0),this.fakeParameters=y}static createFactory(y){return()=>new Mm(y)}get name(){return l}close(){h.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(y){this.emit("@icegatheringstatechange",y)}setConnectionState(y){this.emit("@connectionstatechange",y)}getNativeRtpCapabilities(){return B(this,null,function*(){return h.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()})}getNativeSctpCapabilities(){return B(this,null,function*(){return h.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()})}run({direction:y,iceParameters:x,iceCandidates:S,dtlsParameters:v,sctpParameters:m,iceServers:w,iceTransportPolicy:b,proprietaryConstraints:C,extendedRtpCapabilities:A}){this.assertNotClosed(),h.debug("run()"),this._rtpParametersByKind={audio:s.getSendingRtpParameters("audio",A),video:s.getSendingRtpParameters("video",A)}}updateIceServers(y){return B(this,null,function*(){this.assertNotClosed(),h.debug("updateIceServers()")})}restartIce(y){return B(this,null,function*(){this.assertNotClosed(),h.debug("restartIce()")})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),new Map})}send(y){return B(this,arguments,function*({track:x,encodings:S,codecOptions:v,codec:m}){this.assertNotClosed(),h.debug("send() [kind:%s, track.id:%s]",x.kind,x.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));const w=r.clone(this._rtpParametersByKind[x.kind]),b=w.codecs.some(A=>/.+\/rtx$/i.test(A.mimeType));w.mid=`mid-${r.generateRandomNumber()}`,S||(S=[{}]);for(const A of S)A.ssrc=r.generateRandomNumber(),b&&(A.rtx={ssrc:r.generateRandomNumber()});w.encodings=S,w.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const C=this._nextLocalId++;return this._tracks.set(C,x),{localId:String(C),rtpParameters:w}})}stopSending(y){return B(this,null,function*(){if(h.debug("stopSending() [localId:%s]",y),!this._closed){if(!this._tracks.has(Number(y)))throw new Error("local track not found");this._tracks.delete(Number(y))}})}pauseSending(y){return B(this,null,function*(){this.assertNotClosed()})}resumeSending(y){return B(this,null,function*(){this.assertNotClosed()})}replaceTrack(y,x){return B(this,null,function*(){this.assertNotClosed(),x?h.debug("replaceTrack() [localId:%s, track.id:%s]",y,x.id):h.debug("replaceTrack() [localId:%s, no track]",y),this._tracks.delete(Number(y)),this._tracks.set(Number(y),x)})}setMaxSpatialLayer(y,x){return B(this,null,function*(){this.assertNotClosed(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,x)})}setRtpEncodingParameters(y,x){return B(this,null,function*(){this.assertNotClosed(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,x)})}getSenderStats(y){return B(this,null,function*(){return this.assertNotClosed(),new Map})}sendDataChannel(y){return B(this,arguments,function*({ordered:x,maxPacketLifeTime:S,maxRetransmits:v,label:m,protocol:w}){this.assertNotClosed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),h.debug("sendDataChannel()");const b=new p({id:this._nextSctpStreamId++,ordered:x,maxPacketLifeTime:S,maxRetransmits:v,label:m,protocol:w}),C={streamId:this._nextSctpStreamId,ordered:x,maxPacketLifeTime:S,maxRetransmits:v};return{dataChannel:b,sctpStreamParameters:C}})}receive(y){return B(this,null,function*(){this.assertNotClosed();const x=[];for(const S of y){const{trackId:v,kind:m}=S;this._transportReady||(yield this.setupTransport({localDtlsRole:"client"})),h.debug("receive() [trackId:%s, kind:%s]",v,m);const w=this._nextLocalId++,b=new e.FakeMediaStreamTrack({kind:m});this._tracks.set(w,b),x.push({localId:String(w),track:b})}return x})}stopReceiving(y){return B(this,null,function*(){if(!this._closed)for(const x of y)h.debug("stopReceiving() [localId:%s]",x),this._tracks.delete(Number(x))})}pauseReceiving(y){return B(this,null,function*(){this.assertNotClosed()})}resumeReceiving(y){return B(this,null,function*(){this.assertNotClosed()})}getReceiverStats(y){return B(this,null,function*(){return this.assertNotClosed(),new Map})}receiveDataChannel(y){return B(this,arguments,function*({sctpStreamParameters:x,label:S,protocol:v}){return this.assertNotClosed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"client"})),h.debug("receiveDataChannel()"),{dataChannel:new p({id:x.streamId,ordered:x.ordered,maxPacketLifeTime:x.maxPacketLifeTime,maxRetransmits:x.maxRetransmits,label:S,protocol:v})}})}setupTransport(y){return B(this,arguments,function*({localDtlsRole:x,localSdpObject:S}){const v=r.clone(this.fakeParameters.generateLocalDtlsParameters());x&&(v.role=x),this.emit("@connectionstatechange","connecting"),yield new Promise((m,w)=>this.emit("@connect",{dtlsParameters:v},m,w)),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new o.InvalidStateError("method called in a closed handler")}};t.FakeHandler=g}}),iy=Ce({"../../node_modules/mediasoup-client/lib/test/fakeParameters.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.generateRouterRtpCapabilities=n,t.generateNativeRtpCapabilities=r,t.generateNativeSctpCapabilities=s,t.generateLocalDtlsParameters=o,t.generateTransportRemoteParameters=c,t.generateProducerRemoteParameters=h,t.generateConsumerRemoteParameters=l,t.generateDataProducerRemoteParameters=p,t.generateDataConsumerRemoteParameters=g;var e=Qi();function i(){return String(e.generateRandomNumber())}function n(){return e.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function r(){return e.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function s(){return e.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function o(){return e.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function c(){return{id:i(),iceParameters:e.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:e.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:e.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:e.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function h(){return e.deepFreeze({id:i()})}function l({id:f,codecMimeType:y}={}){switch(y){case"audio/opus":return{id:f??i(),producerId:i(),kind:"audio",rtpParameters:e.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:f??i(),producerId:i(),kind:"audio",rtpParameters:e.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:f??i(),producerId:i(),kind:"video",rtpParameters:e.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:f??i(),producerId:i(),kind:"video",rtpParameters:e.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${y}'`)}}function p(){return e.deepFreeze({id:i()})}function g({id:f}={}){return{id:f??i(),dataProducerId:i(),sctpStreamParameters:e.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}}}),ny=Ce({"../../node_modules/mediasoup-client/lib/index.js"(t){Q(),Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.testFakeParameters=t.FakeHandler=t.ortc=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;var e=Dl();t.debug=e.default,t.types=Ub(),t.version="3.9.8";var i=Cm();Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return i.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return i.detectDevice}});var n=Hs();Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return n.parse}}),t.ortc=wn();var r=ty();Object.defineProperty(t,"FakeHandler",{enumerable:!0,get:function(){return r.FakeHandler}}),t.testFakeParameters=iy()}});Q();Q();Q();Q();Q();Q();Q();var Ch=["disable","error","warn","info","debug"],tc=class Ao{constructor(e){this.debug=(...i)=>(this._log("debug",...i),Date.now()),this.info=(...i)=>(this._log("info",...i),Date.now()),this.warn=(...i)=>{this._log("warn",...i)},this.error=(...i)=>{this._log("error",...i)},this.elapsed=(i,...n)=>{const r=Date.now()-i;this._log("info",`elapsed ms:${r}`,...n)},this.prefix=e}_log(e,...i){const n=Ch.indexOf(e);if(Ch.indexOf(Ao.level)>=n){const s=new Date(Date.now()+324e5).toISOString()+"+JST";i=[this.prefix,...i].map(h=>{if(h instanceof Error)return h.toJSON?h.toJSON():{name:h.name,message:h.message,stack:h.stack};if(typeof h=="object")try{return JSON.parse(JSON.stringify(h))}catch{return"json error"}return h});let c=[s,e,...i];switch(Ao.format==="string"&&(c=[s+" "+e+" "+JSON.stringify(i)]),e){case"debug":console.debug(...c);break;case"info":console.info(...c);break;case"warn":console.warn(...c);break;case"error":console.error(...c);break}Ao.onLog({id:Ao.id,timestamp:s,level:e,message:i})}}createBlock(e){return{warn:(...i)=>{this.warn(ne({},e),...i)},debug:(...i)=>{this.debug(ne({},e),...i)},info:(...i)=>{this.info(ne({},e),...i)},error:(...i)=>{this.error(ne({},e),...i)}}}};tc.level="error";tc.format="object";tc.onLog=()=>{};tc.id=Math.random().toString().slice(2,7);var mt=tc,ry=new mt("packages/common/src/error.ts"),rr=class extends Error{constructor(t,e=!0){if(super(t.info.detail),this.id=Math.random().toString().slice(2,10),Object.assign(this,t),this.name=this.info.name,e){const i=["SkyWayError",`name:${this.info.name}, detail:${this.info.detail}, solution:${this.info.solution}`];this.path&&i.push(this.path),this.error&&i.push(this.error),this.payload&&i.push(this.payload),i.push(this.id),ry.warn(...i)}}toJSON(){return{id:this.id,info:this.info,path:this.path,payload:this.payload,error:this.error,stack:this.stack}}};Q();var sy=new mt("packages/common/src/event.ts"),yt=class{constructor(t=()=>{}){this._onSetListener=t,this._stack=[],this._eventIndex=0,this.emit=e=>{for(const i of this._stack)try{i.execute(e)}catch(n){sy.error("task throws error",n)}},this.removeAllListeners=()=>{this._stack=[]},this.pipe=e=>this.add(i=>e.emit(i)),this.add=e=>{const i=this._eventIndex;this._stack.push({execute:e,id:i}),this._eventIndex++;const n=()=>{this._stack=this._stack.filter(s=>s.id!==i&&s)},r=s=>{s.push(n)};return this._onSetListener(),{removeListener:n,disposer:r}},this.once=e=>{const i=this.add(n=>{i.removeListener(),e(n)});return i},this.asPromise=e=>new Promise((i,n)=>{const r=e&&setTimeout(()=>{n(new Th("Event asPromise timeout : "+e))},e);this.once(s=>{r&&clearTimeout(r),i(s)})}),this.watch=(e,i)=>new Promise((n,r)=>{const s=i&&setTimeout(()=>{r(new Th("Event watch timeout : "+i))},i),{removeListener:o}=this.add(c=>{e(c)&&(s&&clearTimeout(s),o(),n(c))})})}get length(){return this._stack.length}},Zr=class{constructor(){this.events=[]}make(){const t=new yt;return this.events.push(t),t}dispose(){this.events.forEach(t=>t.removeAllListeners()),this.events=[]}},ar=class{constructor(){this._disposer=[]}push(t){this._disposer.push(t)}dispose(){this._disposer.forEach(t=>t()),this._disposer=[]}},Th=class extends Error{toJSON(){return{name:this.name,message:this.message,stack:this.stack}}};Q();Q();Q();Q();Q();function Am(t,e){return function(){return t.apply(e,arguments)}}var{toString:ay}=Object.prototype,{getPrototypeOf:ju}=Object,{iterator:Nl,toStringTag:Dm}=Symbol,Ol=(t=>e=>{const i=ay.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Nr=t=>(t=t.toLowerCase(),e=>Ol(e)===t),Ul=t=>e=>typeof e===t,{isArray:co}=Array,Oo=Ul("undefined");function oy(t){return t!==null&&!Oo(t)&&t.constructor!==null&&!Oo(t.constructor)&&jn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}var Im=Nr("ArrayBuffer");function cy(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Im(t.buffer),e}var ly=Ul("string"),jn=Ul("function"),Lm=Ul("number"),Bl=t=>t!==null&&typeof t=="object",dy=t=>t===!0||t===!1,$c=t=>{if(Ol(t)!=="object")return!1;const e=ju(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Dm in t)&&!(Nl in t)},uy=Nr("Date"),hy=Nr("File"),py=Nr("Blob"),fy=Nr("FileList"),my=t=>Bl(t)&&jn(t.pipe),gy=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||jn(t.append)&&((e=Ol(t))==="formdata"||e==="object"&&jn(t.toString)&&t.toString()==="[object FormData]"))},vy=Nr("URLSearchParams"),[_y,by,yy,Sy]=["ReadableStream","Request","Response","Headers"].map(Nr),wy=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ic(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),co(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const s=i?Object.getOwnPropertyNames(t):Object.keys(t),o=s.length;let c;for(n=0;n<o;n++)c=s[n],e.call(null,t[c],c,t)}}function Fm(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}var ra=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,km=t=>!Oo(t)&&t!==ra;function ru(){const{caseless:t}=km(this)&&this||{},e={},i=(n,r)=>{const s=t&&Fm(e,r)||r;$c(e[s])&&$c(n)?e[s]=ru(e[s],n):$c(n)?e[s]=ru({},n):co(n)?e[s]=n.slice():e[s]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&ic(arguments[n],i);return e}var xy=(t,e,i,{allOwnKeys:n}={})=>(ic(e,(r,s)=>{i&&jn(r)?t[s]=Am(r,i):t[s]=r},{allOwnKeys:n}),t),Ey=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Cy=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Ty=(t,e,i,n)=>{let r,s,o;const c={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)o=r[s],(!n||n(o,t,e))&&!c[o]&&(e[o]=t[o],c[o]=!0);t=i!==!1&&ju(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Ry=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},Py=t=>{if(!t)return null;if(co(t))return t;let e=t.length;if(!Lm(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},My=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&ju(Uint8Array)),Ay=(t,e)=>{const n=(t&&t[Nl]).call(t);let r;for(;(r=n.next())&&!r.done;){const s=r.value;e.call(t,s[0],s[1])}},Dy=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},Iy=Nr("HTMLFormElement"),Ly=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),Rh=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),Fy=Nr("RegExp"),Nm=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};ic(i,(r,s)=>{let o;(o=e(r,s,t))!==!1&&(n[s]=o||r)}),Object.defineProperties(t,n)},ky=t=>{Nm(t,(e,i)=>{if(jn(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(jn(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},Ny=(t,e)=>{const i={},n=r=>{r.forEach(s=>{i[s]=!0})};return co(t)?n(t):n(String(t).split(e)),i},Oy=()=>{},Uy=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function By(t){return!!(t&&jn(t.append)&&t[Dm]==="FormData"&&t[Nl])}var Hy=t=>{const e=new Array(10),i=(n,r)=>{if(Bl(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const s=co(n)?[]:{};return ic(n,(o,c)=>{const h=i(o,r+1);!Oo(h)&&(s[c]=h)}),e[r]=void 0,s}}return n};return i(t,0)},jy=Nr("AsyncFunction"),Vy=t=>t&&(Bl(t)||jn(t))&&jn(t.then)&&jn(t.catch),Om=((t,e)=>t?setImmediate:e?((i,n)=>(ra.addEventListener("message",({source:r,data:s})=>{r===ra&&s===i&&n.length&&n.shift()()},!1),r=>{n.push(r),ra.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",jn(ra.postMessage)),zy=typeof queueMicrotask<"u"?queueMicrotask.bind(ra):typeof Wa<"u"&&Wa.nextTick||Om,Gy=t=>t!=null&&jn(t[Nl]),Ne={isArray:co,isArrayBuffer:Im,isBuffer:oy,isFormData:gy,isArrayBufferView:cy,isString:ly,isNumber:Lm,isBoolean:dy,isObject:Bl,isPlainObject:$c,isReadableStream:_y,isRequest:by,isResponse:yy,isHeaders:Sy,isUndefined:Oo,isDate:uy,isFile:hy,isBlob:py,isRegExp:Fy,isFunction:jn,isStream:my,isURLSearchParams:vy,isTypedArray:My,isFileList:fy,forEach:ic,merge:ru,extend:xy,trim:wy,stripBOM:Ey,inherits:Cy,toFlatObject:Ty,kindOf:Ol,kindOfTest:Nr,endsWith:Ry,toArray:Py,forEachEntry:Ay,matchAll:Dy,isHTMLForm:Iy,hasOwnProperty:Rh,hasOwnProp:Rh,reduceDescriptors:Nm,freezeMethods:ky,toObjectSet:Ny,toCamelCase:Ly,noop:Oy,toFiniteNumber:Uy,findKey:Fm,global:ra,isContextDefined:km,isSpecCompliantForm:By,toJSONObject:Hy,isAsyncFn:jy,isThenable:Vy,setImmediate:Om,asap:zy,isIterable:Gy};Q();Q();Q();Q();Q();function Za(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}Ne.inherits(Za,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ne.toJSONObject(this.config),code:this.code,status:this.status}}});var Um=Za.prototype,Bm={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Bm[t]={value:t}});Object.defineProperties(Za,Bm);Object.defineProperty(Um,"isAxiosError",{value:!0});Za.from=(t,e,i,n,r,s)=>{const o=Object.create(Um);return Ne.toFlatObject(t,o,function(h){return h!==Error.prototype},c=>c!=="isAxiosError"),Za.call(o,t.message,e,i,n,r),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};var oi=Za;Q();var qy=null;function su(t){return Ne.isPlainObject(t)||Ne.isArray(t)}function Hm(t){return Ne.endsWith(t,"[]")?t.slice(0,-2):t}function Ph(t,e,i){return t?t.concat(e).map(function(r,s){return r=Hm(r),!i&&s?"["+r+"]":r}).join(i?".":""):e}function Wy(t){return Ne.isArray(t)&&!t.some(su)}var Ky=Ne.toFlatObject(Ne,{},null,function(e){return/^is[A-Z]/.test(e)});function Xy(t,e,i){if(!Ne.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ne.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,v){return!Ne.isUndefined(v[S])});const n=i.metaTokens,r=i.visitor||p,s=i.dots,o=i.indexes,h=(i.Blob||typeof Blob<"u"&&Blob)&&Ne.isSpecCompliantForm(e);if(!Ne.isFunction(r))throw new TypeError("visitor must be a function");function l(x){if(x===null)return"";if(Ne.isDate(x))return x.toISOString();if(!h&&Ne.isBlob(x))throw new oi("Blob is not supported. Use a Buffer instead.");return Ne.isArrayBuffer(x)||Ne.isTypedArray(x)?h&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function p(x,S,v){let m=x;if(x&&!v&&typeof x=="object"){if(Ne.endsWith(S,"{}"))S=n?S:S.slice(0,-2),x=JSON.stringify(x);else if(Ne.isArray(x)&&Wy(x)||(Ne.isFileList(x)||Ne.endsWith(S,"[]"))&&(m=Ne.toArray(x)))return S=Hm(S),m.forEach(function(b,C){!(Ne.isUndefined(b)||b===null)&&e.append(o===!0?Ph([S],C,s):o===null?S:S+"[]",l(b))}),!1}return su(x)?!0:(e.append(Ph(v,S,s),l(x)),!1)}const g=[],f=Object.assign(Ky,{defaultVisitor:p,convertValue:l,isVisitable:su});function y(x,S){if(!Ne.isUndefined(x)){if(g.indexOf(x)!==-1)throw Error("Circular reference detected in "+S.join("."));g.push(x),Ne.forEach(x,function(m,w){(!(Ne.isUndefined(m)||m===null)&&r.call(e,m,Ne.isString(w)?w.trim():w,S,f))===!0&&y(m,S?S.concat(w):[w])}),g.pop()}}if(!Ne.isObject(t))throw new TypeError("data must be an object");return y(t),e}var Hl=Xy;function Mh(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function jm(t,e){this._pairs=[],t&&Hl(t,this,e)}var Vm=jm.prototype;Vm.append=function(e,i){this._pairs.push([e,i])};Vm.toString=function(e){const i=e?function(n){return e.call(this,n,Mh)}:Mh;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};var zm=jm;function $y(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Gm(t,e,i){if(!e)return t;const n=i&&i.encode||$y;Ne.isFunction(i)&&(i={serialize:i});const r=i&&i.serialize;let s;if(r?s=r(e,i):s=Ne.isURLSearchParams(e)?e.toString():new zm(e,i).toString(n),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}Q();var Zy=class{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ne.forEach(this.handlers,function(i){i!==null&&t(i)})}},Ah=Zy;Q();Q();Q();Q();var qm={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};Q();Q();Q();Q();var Yy=typeof URLSearchParams<"u"?URLSearchParams:zm;Q();var Jy=typeof FormData<"u"?FormData:null;Q();var Qy=typeof Blob<"u"?Blob:null,eS={isBrowser:!0,classes:{URLSearchParams:Yy,FormData:Jy,Blob:Qy},protocols:["http","https","file","blob","url","data"]},Wm={};W_(Wm,{hasBrowserEnv:()=>Vu,hasStandardBrowserEnv:()=>tS,hasStandardBrowserWebWorkerEnv:()=>iS,navigator:()=>au,origin:()=>nS});Q();var Vu=typeof window<"u"&&typeof document<"u",au=typeof navigator=="object"&&navigator||void 0,tS=Vu&&(!au||["ReactNative","NativeScript","NS"].indexOf(au.product)<0),iS=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",nS=Vu&&window.location.href||"http://localhost",yn=ne(ne({},Wm),eS);function rS(t,e){return Hl(t,new yn.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,s){return yn.isNode&&Ne.isBuffer(i)?(this.append(n,i.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}Q();function sS(t){return Ne.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function aS(t){const e={},i=Object.keys(t);let n;const r=i.length;let s;for(n=0;n<r;n++)s=i[n],e[s]=t[s];return e}function oS(t){function e(i,n,r,s){let o=i[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),h=s>=i.length;return o=!o&&Ne.isArray(r)?r.length:o,h?(Ne.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!c):((!r[o]||!Ne.isObject(r[o]))&&(r[o]=[]),e(i,n,r[o],s)&&Ne.isArray(r[o])&&(r[o]=aS(r[o])),!c)}if(Ne.isFormData(t)&&Ne.isFunction(t.entries)){const i={};return Ne.forEachEntry(t,(n,r)=>{e(sS(n),r,i,0)}),i}return null}var Km=oS;function cS(t,e,i){if(Ne.isString(t))try{return(e||JSON.parse)(t),Ne.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}var zu={transitional:qm,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,s=Ne.isObject(e);if(s&&Ne.isHTMLForm(e)&&(e=new FormData(e)),Ne.isFormData(e))return r?JSON.stringify(Km(e)):e;if(Ne.isArrayBuffer(e)||Ne.isBuffer(e)||Ne.isStream(e)||Ne.isFile(e)||Ne.isBlob(e)||Ne.isReadableStream(e))return e;if(Ne.isArrayBufferView(e))return e.buffer;if(Ne.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return rS(e,this.formSerializer).toString();if((c=Ne.isFileList(e))||n.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Hl(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return s||r?(i.setContentType("application/json",!1),cS(e)):e}],transformResponse:[function(e){const i=this.transitional||zu.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(Ne.isResponse(e)||Ne.isReadableStream(e))return e;if(e&&Ne.isString(e)&&(n&&!this.responseType||r)){const o=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?oi.from(c,oi.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yn.classes.FormData,Blob:yn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ne.forEach(["delete","get","head","post","put","patch"],t=>{zu.headers[t]={}});var Gu=zu;Q();Q();var lS=Ne.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dS=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),i=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!i||e[i]&&lS[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},Dh=Symbol("internals");function _o(t){return t&&String(t).trim().toLowerCase()}function Zc(t){return t===!1||t==null?t:Ne.isArray(t)?t.map(Zc):String(t)}function uS(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}var hS=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ud(t,e,i,n,r){if(Ne.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!Ne.isString(e)){if(Ne.isString(n))return e.indexOf(n)!==-1;if(Ne.isRegExp(n))return n.test(e)}}function pS(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function fS(t,e){const i=Ne.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,s,o){return this[n].call(this,e,r,s,o)},configurable:!0})})}var jl=class{constructor(t){t&&this.set(t)}set(t,e,i){const n=this;function r(o,c,h){const l=_o(c);if(!l)throw new Error("header name must be a non-empty string");const p=Ne.findKey(n,l);(!p||n[p]===void 0||h===!0||h===void 0&&n[p]!==!1)&&(n[p||c]=Zc(o))}const s=(o,c)=>Ne.forEach(o,(h,l)=>r(h,l,c));if(Ne.isPlainObject(t)||t instanceof this.constructor)s(t,e);else if(Ne.isString(t)&&(t=t.trim())&&!hS(t))s(dS(t),e);else if(Ne.isObject(t)&&Ne.isIterable(t)){let o={},c,h;for(const l of t){if(!Ne.isArray(l))throw TypeError("Object iterator must return a key-value pair");o[h=l[0]]=(c=o[h])?Ne.isArray(c)?[...c,l[1]]:[c,l[1]]:l[1]}s(o,e)}else t!=null&&r(e,t,i);return this}get(t,e){if(t=_o(t),t){const i=Ne.findKey(this,t);if(i){const n=this[i];if(!e)return n;if(e===!0)return uS(n);if(Ne.isFunction(e))return e.call(this,n,i);if(Ne.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=_o(t),t){const i=Ne.findKey(this,t);return!!(i&&this[i]!==void 0&&(!e||ud(this,this[i],i,e)))}return!1}delete(t,e){const i=this;let n=!1;function r(s){if(s=_o(s),s){const o=Ne.findKey(i,s);o&&(!e||ud(i,i[o],o,e))&&(delete i[o],n=!0)}}return Ne.isArray(t)?t.forEach(r):r(t),n}clear(t){const e=Object.keys(this);let i=e.length,n=!1;for(;i--;){const r=e[i];(!t||ud(this,this[r],r,t,!0))&&(delete this[r],n=!0)}return n}normalize(t){const e=this,i={};return Ne.forEach(this,(n,r)=>{const s=Ne.findKey(i,r);if(s){e[s]=Zc(n),delete e[r];return}const o=t?pS(r):String(r).trim();o!==r&&delete e[r],e[o]=Zc(n),i[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return Ne.forEach(this,(i,n)=>{i!=null&&i!==!1&&(e[n]=t&&Ne.isArray(i)?i.join(", "):i)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach(n=>i.set(n)),i}static accessor(t){const i=(this[Dh]=this[Dh]={accessors:{}}).accessors,n=this.prototype;function r(s){const o=_o(s);i[o]||(fS(n,s),i[o]=!0)}return Ne.isArray(t)?t.forEach(r):r(t),this}};jl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ne.reduceDescriptors(jl.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});Ne.freezeMethods(jl);var Dr=jl;function hd(t,e){const i=this||Gu,n=e||i,r=Dr.from(n.headers);let s=n.data;return Ne.forEach(t,function(c){s=c.call(i,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}Q();function Xm(t){return!!(t&&t.__CANCEL__)}Q();function $m(t,e,i){oi.call(this,t??"canceled",oi.ERR_CANCELED,e,i),this.name="CanceledError"}Ne.inherits($m,oi,{__CANCEL__:!0});var nc=$m;Q();Q();Q();function Zm(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new oi("Request failed with status code "+i.status,[oi.ERR_BAD_REQUEST,oi.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}Q();function mS(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}Q();Q();function gS(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(h){const l=Date.now(),p=n[s];o||(o=l),i[r]=h,n[r]=l;let g=s,f=0;for(;g!==r;)f+=i[g++],g=g%t;if(r=(r+1)%t,r===s&&(s=(s+1)%t),l-o<e)return;const y=p&&l-p;return y?Math.round(f*1e3/y):void 0}}var vS=gS;Q();function _S(t,e){let i=0,n=1e3/e,r,s;const o=(l,p=Date.now())=>{i=p,r=null,s&&(clearTimeout(s),s=null),t.apply(null,l)};return[(...l)=>{const p=Date.now(),g=p-i;g>=n?o(l,p):(r=l,s||(s=setTimeout(()=>{s=null,o(r)},n-g)))},()=>r&&o(r)]}var bS=_S,al=(t,e,i=3)=>{let n=0;const r=vS(50,250);return bS(s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,h=o-n,l=r(h),p=o<=c;n=o;const g={loaded:o,total:c,progress:c?o/c:void 0,bytes:h,rate:l||void 0,estimated:l&&c&&p?(c-o)/l:void 0,event:s,lengthComputable:c!=null,[e?"download":"upload"]:!0};t(g)},i)},Ih=(t,e)=>{const i=t!=null;return[n=>e[0]({lengthComputable:i,total:t,loaded:n}),e[1]]},Lh=t=>(...e)=>Ne.asap(()=>t(...e));Q();Q();var yS=yn.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,yn.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(yn.origin),yn.navigator&&/(msie|trident)/i.test(yn.navigator.userAgent)):()=>!0;Q();var SS=yn.hasStandardBrowserEnv?{write(t,e,i,n,r,s){const o=[t+"="+encodeURIComponent(e)];Ne.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),Ne.isString(n)&&o.push("path="+n),Ne.isString(r)&&o.push("domain="+r),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};Q();Q();function wS(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}Q();function xS(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Ym(t,e,i){let n=!wS(e);return t&&(n||i==!1)?xS(t,e):e}Q();var Fh=t=>t instanceof Dr?ne({},t):t;function ua(t,e){e=e||{};const i={};function n(l,p,g,f){return Ne.isPlainObject(l)&&Ne.isPlainObject(p)?Ne.merge.call({caseless:f},l,p):Ne.isPlainObject(p)?Ne.merge({},p):Ne.isArray(p)?p.slice():p}function r(l,p,g,f){if(Ne.isUndefined(p)){if(!Ne.isUndefined(l))return n(void 0,l,g,f)}else return n(l,p,g,f)}function s(l,p){if(!Ne.isUndefined(p))return n(void 0,p)}function o(l,p){if(Ne.isUndefined(p)){if(!Ne.isUndefined(l))return n(void 0,l)}else return n(void 0,p)}function c(l,p,g){if(g in e)return n(l,p);if(g in t)return n(void 0,l)}const h={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(l,p,g)=>r(Fh(l),Fh(p),g,!0)};return Ne.forEach(Object.keys(Object.assign({},t,e)),function(p){const g=h[p]||r,f=g(t[p],e[p],p);Ne.isUndefined(f)&&g!==c||(i[p]=f)}),i}var Jm=t=>{const e=ua({},t);let{data:i,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:c}=e;e.headers=o=Dr.from(o),e.url=Gm(Ym(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let h;if(Ne.isFormData(i)){if(yn.hasStandardBrowserEnv||yn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((h=o.getContentType())!==!1){const[l,...p]=h?h.split(";").map(g=>g.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...p].join("; "))}}if(yn.hasStandardBrowserEnv&&(n&&Ne.isFunction(n)&&(n=n(e)),n||n!==!1&&yS(e.url))){const l=r&&s&&SS.read(s);l&&o.set(r,l)}return e},ES=typeof XMLHttpRequest<"u",CS=ES&&function(t){return new Promise(function(i,n){const r=Jm(t);let s=r.data;const o=Dr.from(r.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:l}=r,p,g,f,y,x;function S(){y&&y(),x&&x(),r.cancelToken&&r.cancelToken.unsubscribe(p),r.signal&&r.signal.removeEventListener("abort",p)}let v=new XMLHttpRequest;v.open(r.method.toUpperCase(),r.url,!0),v.timeout=r.timeout;function m(){if(!v)return;const b=Dr.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),A={data:!c||c==="text"||c==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:b,config:t,request:v};Zm(function(F){i(F),S()},function(F){n(F),S()},A),v=null}"onloadend"in v?v.onloadend=m:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(m)},v.onabort=function(){v&&(n(new oi("Request aborted",oi.ECONNABORTED,t,v)),v=null)},v.onerror=function(){n(new oi("Network Error",oi.ERR_NETWORK,t,v)),v=null},v.ontimeout=function(){let C=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const A=r.transitional||qm;r.timeoutErrorMessage&&(C=r.timeoutErrorMessage),n(new oi(C,A.clarifyTimeoutError?oi.ETIMEDOUT:oi.ECONNABORTED,t,v)),v=null},s===void 0&&o.setContentType(null),"setRequestHeader"in v&&Ne.forEach(o.toJSON(),function(C,A){v.setRequestHeader(A,C)}),Ne.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),c&&c!=="json"&&(v.responseType=r.responseType),l&&([f,x]=al(l,!0),v.addEventListener("progress",f)),h&&v.upload&&([g,y]=al(h),v.upload.addEventListener("progress",g),v.upload.addEventListener("loadend",y)),(r.cancelToken||r.signal)&&(p=b=>{v&&(n(!b||b.type?new nc(null,t,v):b),v.abort(),v=null)},r.cancelToken&&r.cancelToken.subscribe(p),r.signal&&(r.signal.aborted?p():r.signal.addEventListener("abort",p)));const w=mS(r.url);if(w&&yn.protocols.indexOf(w)===-1){n(new oi("Unsupported protocol "+w+":",oi.ERR_BAD_REQUEST,t));return}v.send(s||null)})};Q();Q();var TS=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let n=new AbortController,r;const s=function(l){if(!r){r=!0,c();const p=l instanceof Error?l:this.reason;n.abort(p instanceof oi?p:new nc(p instanceof Error?p.message:p))}};let o=e&&setTimeout(()=>{o=null,s(new oi(`timeout ${e} of ms exceeded`,oi.ETIMEDOUT))},e);const c=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(l=>{l.unsubscribe?l.unsubscribe(s):l.removeEventListener("abort",s)}),t=null)};t.forEach(l=>l.addEventListener("abort",s));const{signal:h}=n;return h.unsubscribe=()=>Ne.asap(c),h}},RS=TS;Q();var PS=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let n=0,r;for(;n<i;)r=n+e,yield t.slice(n,r),n=r},MS=function(t,e){return zf(this,null,function*(){try{for(var i=X_(AS(t)),n,r,s;n=!(r=yield new $a(i.next())).done;n=!1){const o=r.value;yield*Gf(PS(o,e))}}catch(o){s=[o]}finally{try{n&&(r=i.return)&&(yield new $a(r.call(i)))}finally{if(s)throw s[0]}}})},AS=function(t){return zf(this,null,function*(){if(t[Symbol.asyncIterator]){yield*Gf(t);return}const e=t.getReader();try{for(;;){const{done:i,value:n}=yield new $a(e.read());if(i)break;yield n}}finally{yield new $a(e.cancel())}})},kh=(t,e,i,n)=>{const r=MS(t,e);let s=0,o,c=h=>{o||(o=!0,n&&n(h))};return new ReadableStream({pull(h){return B(this,null,function*(){try{const{done:l,value:p}=yield r.next();if(l){c(),h.close();return}let g=p.byteLength;if(i){let f=s+=g;i(f)}h.enqueue(new Uint8Array(p))}catch(l){throw c(l),l}})},cancel(h){return c(h),r.return()}},{highWaterMark:2})},Vl=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Qm=Vl&&typeof ReadableStream=="function",DS=Vl&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):t=>B(null,null,function*(){return new Uint8Array(yield new Response(t).arrayBuffer())})),eg=(t,...e)=>{try{return!!t(...e)}catch{return!1}},IS=Qm&&eg(()=>{let t=!1;const e=new Request(yn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Nh=64*1024,ou=Qm&&eg(()=>Ne.isReadableStream(new Response("").body)),ol={stream:ou&&(t=>t.body)};Vl&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ol[e]&&(ol[e]=Ne.isFunction(t[e])?i=>i[e]():(i,n)=>{throw new oi(`Response type '${e}' is not supported`,oi.ERR_NOT_SUPPORT,n)})})})(new Response);var LS=t=>B(null,null,function*(){if(t==null)return 0;if(Ne.isBlob(t))return t.size;if(Ne.isSpecCompliantForm(t))return(yield new Request(yn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(Ne.isArrayBufferView(t)||Ne.isArrayBuffer(t))return t.byteLength;if(Ne.isURLSearchParams(t)&&(t=t+""),Ne.isString(t))return(yield DS(t)).byteLength}),FS=(t,e)=>B(null,null,function*(){const i=Ne.toFiniteNumber(t.getContentLength());return i??LS(e)}),kS=Vl&&(t=>B(null,null,function*(){let{url:e,method:i,data:n,signal:r,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:h,responseType:l,headers:p,withCredentials:g="same-origin",fetchOptions:f}=Jm(t);l=l?(l+"").toLowerCase():"text";let y=RS([r,s&&s.toAbortSignal()],o),x;const S=y&&y.unsubscribe&&(()=>{y.unsubscribe()});let v;try{if(h&&IS&&i!=="get"&&i!=="head"&&(v=yield FS(p,n))!==0){let A=new Request(e,{method:"POST",body:n,duplex:"half"}),M;if(Ne.isFormData(n)&&(M=A.headers.get("content-type"))&&p.setContentType(M),A.body){const[F,N]=Ih(v,al(Lh(h)));n=kh(A.body,Nh,F,N)}}Ne.isString(g)||(g=g?"include":"omit");const m="credentials"in Request.prototype;x=new Request(e,we(ne({},f),{signal:y,method:i.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:m?g:void 0}));let w=yield fetch(x);const b=ou&&(l==="stream"||l==="response");if(ou&&(c||b&&S)){const A={};["status","statusText","headers"].forEach(P=>{A[P]=w[P]});const M=Ne.toFiniteNumber(w.headers.get("content-length")),[F,N]=c&&Ih(M,al(Lh(c),!0))||[];w=new Response(kh(w.body,Nh,F,()=>{N&&N(),S&&S()}),A)}l=l||"text";let C=yield ol[Ne.findKey(ol,l)||"text"](w,t);return!b&&S&&S(),yield new Promise((A,M)=>{Zm(A,M,{data:C,headers:Dr.from(w.headers),status:w.status,statusText:w.statusText,config:t,request:x})})}catch(m){throw S&&S(),m&&m.name==="TypeError"&&/Load failed|fetch/i.test(m.message)?Object.assign(new oi("Network Error",oi.ERR_NETWORK,t,x),{cause:m.cause||m}):oi.from(m,m&&m.code,t,x)}})),cu={http:qy,xhr:CS,fetch:kS};Ne.forEach(cu,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});var Oh=t=>`- ${t}`,NS=t=>Ne.isFunction(t)||t===null||t===!1,tg={getAdapter:t=>{t=Ne.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let s=0;s<e;s++){i=t[s];let o;if(n=i,!NS(i)&&(n=cu[(o=String(i)).toLowerCase()],n===void 0))throw new oi(`Unknown adapter '${o}'`);if(n)break;r[o||"#"+s]=n}if(!n){const s=Object.entries(r).map(([c,h])=>`adapter ${c} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Oh).join(`
`):" "+Oh(s[0]):"as no adapter specified";throw new oi("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:cu};function pd(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new nc(null,t)}function Uh(t){return pd(t),t.headers=Dr.from(t.headers),t.data=hd.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),tg.getAdapter(t.adapter||Gu.adapter)(t).then(function(n){return pd(t),n.data=hd.call(t,t.transformResponse,n),n.headers=Dr.from(n.headers),n},function(n){return Xm(n)||(pd(t),n&&n.response&&(n.response.data=hd.call(t,t.transformResponse,n.response),n.response.headers=Dr.from(n.response.headers))),Promise.reject(n)})}Q();Q();var ig="1.9.0",zl={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{zl[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var Bh={};zl.transitional=function(e,i,n){function r(s,o){return"[Axios v"+ig+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,c)=>{if(e===!1)throw new oi(r(o," has been removed"+(i?" in "+i:"")),oi.ERR_DEPRECATED);return i&&!Bh[o]&&(Bh[o]=!0,console.warn(r(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(s,o,c):!0}};zl.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function OS(t,e,i){if(typeof t!="object")throw new oi("options must be an object",oi.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const s=n[r],o=e[s];if(o){const c=t[s],h=c===void 0||o(c,s,t);if(h!==!0)throw new oi("option "+s+" must be "+h,oi.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new oi("Unknown option "+s,oi.ERR_BAD_OPTION)}}var Yc={assertOptions:OS,validators:zl},zr=Yc.validators,cl=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Ah,response:new Ah}}request(t,e){return B(this,null,function*(){try{return yield this._request(t,e)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?r&&!String(i.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+r):i.stack=r}catch{}}throw i}})}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ua(this.defaults,e);const{transitional:i,paramsSerializer:n,headers:r}=e;i!==void 0&&Yc.assertOptions(i,{silentJSONParsing:zr.transitional(zr.boolean),forcedJSONParsing:zr.transitional(zr.boolean),clarifyTimeoutError:zr.transitional(zr.boolean)},!1),n!=null&&(Ne.isFunction(n)?e.paramsSerializer={serialize:n}:Yc.assertOptions(n,{encode:zr.function,serialize:zr.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Yc.assertOptions(e,{baseUrl:zr.spelling("baseURL"),withXsrfToken:zr.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&Ne.merge(r.common,r[e.method]);r&&Ne.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),e.headers=Dr.concat(s,r);const o=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(e)===!1||(c=c&&x.synchronous,o.unshift(x.fulfilled,x.rejected))});const h=[];this.interceptors.response.forEach(function(x){h.push(x.fulfilled,x.rejected)});let l,p=0,g;if(!c){const y=[Uh.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,h),g=y.length,l=Promise.resolve(e);p<g;)l=l.then(y[p++],y[p++]);return l}g=o.length;let f=e;for(p=0;p<g;){const y=o[p++],x=o[p++];try{f=y(f)}catch(S){x.call(this,S);break}}try{l=Uh.call(this,f)}catch(y){return Promise.reject(y)}for(p=0,g=h.length;p<g;)l=l.then(h[p++],h[p++]);return l}getUri(t){t=ua(this.defaults,t);const e=Ym(t.baseURL,t.url,t.allowAbsoluteUrls);return Gm(e,t.params,t.paramsSerializer)}};Ne.forEach(["delete","get","head","options"],function(e){cl.prototype[e]=function(i,n){return this.request(ua(n||{},{method:e,url:i,data:(n||{}).data}))}});Ne.forEach(["post","put","patch"],function(e){function i(n){return function(s,o,c){return this.request(ua(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}cl.prototype[e]=i(),cl.prototype[e+"Form"]=i(!0)});var Jc=cl;Q();var US=class ng{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(s){i=s});const n=this;this.promise.then(r=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](r);n._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(c=>{n.subscribe(c),s=c}).then(r);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,c){n.reason||(n.reason=new nc(s,o,c),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new ng(function(r){e=r}),cancel:e}}},BS=US;Q();function HS(t){return function(i){return t.apply(null,i)}}Q();function jS(t){return Ne.isObject(t)&&t.isAxiosError===!0}Q();var lu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lu).forEach(([t,e])=>{lu[e]=t});var VS=lu;function rg(t){const e=new Jc(t),i=Am(Jc.prototype.request,e);return Ne.extend(i,Jc.prototype,e,{allOwnKeys:!0}),Ne.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return rg(ua(t,r))},i}var Ki=rg(Gu);Ki.Axios=Jc;Ki.CanceledError=nc;Ki.CancelToken=BS;Ki.isCancel=Xm;Ki.VERSION=ig;Ki.toFormData=Hl;Ki.AxiosError=oi;Ki.Cancel=Ki.CanceledError;Ki.all=function(e){return Promise.all(e)};Ki.spread=HS;Ki.isAxiosError=jS;Ki.mergeConfig=ua;Ki.AxiosHeaders=Dr;Ki.formToJSON=t=>Km(Ne.isHTMLForm(t)?new FormData(t):t);Ki.getAdapter=tg.getAdapter;Ki.HttpStatusCode=VS;Ki.default=Ki;var Ha=Ki,{Axios:$M,AxiosError:ZM,CanceledError:YM,isCancel:JM,CancelToken:QM,VERSION:eA,all:tA,Cancel:iA,isAxiosError:nA,spread:rA,toFormData:sA,AxiosHeaders:aA,HttpStatusCode:oA,formToJSON:cA,getAdapter:lA,mergeConfig:dA}=Ha,yr=new mt("packages/common/src/http.ts"),qu=class{constructor(t){this.api=Ha.create({baseURL:t})}get(t,e){return B(this,null,function*(){const i=yield this.api.get(t,e).catch(n=>n);if(Ha.isAxiosError(i)){const n=we(ne({},i.response),{message:i.message});if(e!=null&&e.retry){if(yield e.retry(n))return yr.warn("retry get",{url:t}),this.get(t,e);throw yr.warn("retry get failed",{url:t}),n}throw yr.warn("response error",{error:n}),n}else return i.data})}post(t,e,i){return B(this,null,function*(){var n,r,s;const o=yield this.api.post(t,e,i).catch(c=>c);if(Ha.isAxiosError(o)){const c={data:(n=o.response)==null?void 0:n.data,status:(r=o.response)==null?void 0:r.status,statusText:(s=o.response)==null?void 0:s.statusText,message:o.message};if(yr.warn("error received",c),i!=null&&i.retry){const h=yield i.retry(c);if(h)return yr.warn("retry post",t,{data:e,error:c,needRetry:h}),this.post(t,e,i);throw c}throw c}else return o.data})}put(t,e,i){return B(this,null,function*(){const n=yield this.api.put(t,e,i).catch(r=>r);if(Ha.isAxiosError(n)){const r=we(ne({},n.response),{message:n.message});if(i!=null&&i.retry){if(yield i.retry(r))return yr.warn("retry put",{url:t,data:e}),this.put(t,e,i);throw yr.warn("retry put failed",{url:t,data:e}),r}throw yr.warn("response error",{error:r}),r}else return n.data})}delete(t,e){return B(this,null,function*(){const i=yield this.api.delete(t,e).catch(n=>n);if(Ha.isAxiosError(i)){const n=we(ne({},i.response),{message:i.message});if(e!=null&&e.retry){if(yield e.retry(n))return yr.warn("retry delete",{url:t}),this.delete(t,e);throw yr.warn("retry delete failed",{url:t}),n}throw yr.warn("response error",{error:n}),n}else return i.data})}};Q();var zS=new mt("packages/common/src/promise.ts"),Vs=class{constructor(){this.id=Math.random().toString().slice(2),this.queue=[],this.running=!1,this.push=t=>new Promise((e,i)=>{this.queue.push({promise:t,done:e,failed:i}),this.running||this.run().catch(n=>{zS.error("push",n)})})}run(){return B(this,null,function*(){const t=this.queue.shift();if(t){this.running=!0;try{const e=yield t.promise();t.done(e)}catch(e){t.failed(e)}yield this.run()}else this.running=!1})}};Q();var Pr=class{constructor(t={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,t)}wait(){return B(this,null,function*(){if(this.exceeded)return!1;const t=this.timeout;return this.count++,yield new Promise(e=>setTimeout(e,t)),!0})}get timeout(){return Fs(this.count,2)*this.interval+Fs(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}},GS=t=>JSON.parse(JSON.stringify(t));Q();var Qe={internal:{name:"internal",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},missingProperty:{name:"missingProperty",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidArgumentValue:{name:"invalidArgumentValue",detail:"引数の値が不正です",solution:"正しい値を引数に渡してください"},invalidContentType:{name:"invalidContentType",detail:"contentTypeが正しくありません",solution:"ContentTypeを確認してください"},localPersonNotJoinedChannel:{name:"localPersonNotJoinedChannel",detail:"操作しようとしたPersonがChannelに居ないので、操作できません The person who tried to operate is not in the channel, so the operation is not possible",solution:"Channelに居ないPersonを操作している可能性があるので確認してください Please check as you may be operating a person which is not in the channel"},alreadyLocalPersonExist:{name:"alreadyLocalPersonExist",detail:"ChannelにすでにLocalPersonが存在します。一つのChannelインスタンスにはLocalPersonが一つしかJoinできません",solution:"複数のLocalPersonを用意したい場合は個別にChannelインスタンスを用意してください。"},alreadySameNameMemberExist:{name:"alreadySameNameMemberExist",detail:"Channelにすでに同じNameのMemberが存在します",solution:"別のNameを使用してください"},alreadyPublishedStream:{name:"alreadyPublishedStream",detail:"すでにPublishしたStreamを再度Publishすることはできません You cannot re-publish a stream that has already been published",solution:"そのStreamをPublishしたPublicationをUnpublishするか、別の新しいStreamを作ってPublishしてください Unpublish the publication that published that stream, or create another new stream and publish it"},alreadySubscribedPublication:{name:"alreadySubscribedPublication",detail:"すでにSubscribeしたPublicationをSubscribeすることはできません",solution:"ありません"},invalidTrackKind:{name:"invalidTrackKind",detail:"Streamの種類とMediaStreamTrackの種類が一致しません",solution:"Streamの種類と同じMediaStreamTrackを利用してください"},cantMoveSameIdChannel:{name:"cantMoveSameIdChannel",detail:"moveChannelで同じidのChannelに移動することは出来ません",solution:"移動先のChannelが正しいか確かめてください"},alreadyChannelClosed:{name:"alreadyChannelClosed",detail:"ChannelがすでにCloseされています",solution:"ありません"},disabledDataStream:{name:"disabledDataStream",detail:"関連するPublicationがDisableなDataStreamには書き込みできません",solution:"関連するPublicationをEnableしてから書き込んでください"},publicationNotExist:{name:"publicationNotExist",detail:"channelに該当するPublicationが存在しません",solution:"publicationIdが正しいか確かめてください"},subscriptionNotExist:{name:"subscriptionNotExist",detail:"channelに該当するSubscriptionが存在しません",solution:"subscriptionIdが正しいか確かめてください"},unknownMemberType:{name:"unknownMemberType",detail:"対象のMemberのSubtypeのプラグインが登録されていません",solution:"対象のMemberのSubtypeのプラグイン(SfuBotなど)をSkyWayContextに登録してください"},streamNotExistInSubscription:{name:"streamNotExistInSubscription",detail:"SubscriptionにStreamがありません。RemoteMemberのSubscriptionのStreamにはアクセスできません",solution:"参照しているSubscriptionが目的のものか確かめてください。"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},dataStreamNotSupportEncoding:{name:"dataStreamNotSupportEncoding",detail:"dataStreamはEncode設定の変更に対応していません",solution:"ありません"},correspondingEncodeNotExistForId:{name:"correspondingEncodeNotExistForId",detail:"指定されたIDに対応するEncode設定が存在しません",solution:"正しいEncodingIDを指定してください"},updateIceParamsFailed:{name:"updateIceParamsFailed",detail:"iceParamsの更新に失敗しました",solution:"ありません"},invalidElement:{name:"invalidElement",detail:"渡されたHTML Elementが正しくありません",solution:"要求された正しいElementを渡してください"},connectRtcApiFailed:{name:"connectRtcApiFailed",detail:"RtcAPIへの接続に失敗しました",solution:"インターネットへの接続できているか、もしくはTokenのパラメータが正しいかを確かめてください"},rtcApiFatalError:{name:"rtcApiFatalError",detail:"RtcAPIの回復不能なエラーです。サーバー側の問題の可能性があります",solution:"インターネットへの接続が出来ているかを確かめてください"},invalidExpireTokenValue:{name:"invalidExpireTokenValue",detail:"tokenのExpire時刻が不正です",solution:"正しい時刻を指定してください"},invalidRemindExpireTokenValue:{name:"invalidRemindExpireTokenValue",detail:"tokenのExpireをリマインドする時間の値が不正です",solution:"正しい時間を指定してください"},invalidTokenAppId:{name:"invalidTokenAppId",detail:"tokenのappIdが正しくありません",solution:"正しいappIdを含むTokenを使用してください"},mediaDevicesNotFound:{name:"mediaDevicesNotFound",detail:"navigator.mediaDevicesがみつかりません",solution:"アプリケーションをhttps,localhost,127.0.0.1のいずれかの環境で動作させてください"},canNotUseReplaceStream:{name:"canNotUseReplaceStream",detail:"remoteのPublicationからreplaceStreamできません",solution:"対象のPublicationがLocalのものか確認してください"},canNotEnableRemotePublication:{name:"canNotEnableRemotePublication",detail:"remoteのPublicationをenableすることはできません",solution:"対象のPublicationがLocalのものか確認してください"}};Q();Q();Q();var qS=qn($_());qn(hn());var WS=qn(J_()),KS=new mt("packages/core/src/util.ts");function Ya(t){const e=[];return t.forEach(i=>{e.push(i)}),e}function Qt(t){return B(this,arguments,function*({operationName:e,channel:i}){const n={operationName:e,appId:i.appId,channelId:i.id};if(i.localPerson){const r=i.localPerson,s=yield Promise.all(r.publications.map(c=>B(null,null,function*(){var h,l,p;const g={id:c.id,contentType:c.contentType,state:c.state,stats:{},connectionStats:{}};if(c.stream)for(const{memberId:f,stats:y}of yield c.stream._getStatsAll()){const x=y.find(S=>S.type.includes("local-candidate"));g.stats[f]={transportType:(h=x==null?void 0:x.protocol)!=null?h:"none",relayProtocol:(l=x==null?void 0:x.relayProtocol)!=null?l:"none",callType:(p=c.subscriptions.find(S=>S.subscriber.id===f))==null?void 0:p.subscriber.subtype,outbound:y.find(S=>S.type.includes("outbound-rtp")),localCandidate:x}}if(c.stream)for(const{memberId:f,connectionState:y}of c.stream._getConnectionStateAll())g.connectionStats[f]=y;return g})));n.publishing=s;const o=yield Promise.all(r.subscriptions.map(c=>B(null,null,function*(){const h={id:c.id,contentType:c.contentType,stats:{}};if(h.callType=c.publication.publisher.subtype,c.stream){const l=yield c.stream.getStats();h.stats=l.find(g=>g.type.includes("inbound-rtp"));const p=l.find(g=>g.type.includes("local-candidate"));h.transportType=p==null?void 0:p.protocol,h.relayProtocol=p==null?void 0:p.relayProtocol}return c.stream&&(h.connectionState=c.stream.getConnectionState()),h})));n.subscribing=o}return n})}function Wi({member:t,detail:e,channel:i,operationName:n,payload:r}){const s={operationName:n,payload:r,detail:e};return t&&(s.appId=t.channel.appId,s.channelId=t.channel.id,s.memberId=t.id),i&&(s.appId=i.appId,s.channelId=i.id),s}function qe({operationName:t,context:e,info:i,error:n,path:r,payload:s,channel:o}){const c={operationName:t,payload:s};return o&&(c.appId=o.appId,c.channelId=o.id,o.localPerson&&(c.memberId=o.localPerson.id)),e&&(c.info=e.info,c.plugins=e.plugins.map(h=>h.subtype)),new rr({error:n,info:i,payload:c,path:r})}var Hh=t=>B(null,[t],function*({stream:e,remoteMember:i,end:n,interval:r,timeout:s}){return new Promise((o,c)=>B(null,null,function*(){r??(r=100),s??(s=1e4);for(let h=0;;h+=r){if(h>=s){c(qe({operationName:"Peer.waitForStats",info:we(ne({},Qe.timeout),{detail:"waitForStats timeout"}),path:KS.prefix}));break}const l=yield e._getStats(i);if(n(l)){o(l);break}yield new Promise(p=>setTimeout(p,r))}}))}),XS=(t,e)=>{var i,n;return sg((n=(i=t.find(r=>r.payload===e))==null?void 0:i.config)!=null?n:"")},sg=t=>t.split(";").reduce((i,n)=>{const[r,s]=n.split("=");return r&&(i[r]=Number(s),r==="profile-level-id"&&(i[r]=s)),i},{}),ag=({isNotBrowser:t}={})=>{if(t)return t;const e=qS.default.getParser(window.navigator.userAgent),i=e.getOSName(),n=e.getOSVersion(),r=e.getBrowserName(),s=e.getBrowserVersion();return{browserName:r,browserVersion:s,osName:i,osVersion:n}};function jh(){var t,e,i,n,r,s,o,c;if(typeof navigator=="object"&&navigator.product==="ReactNative")return typeof RTCPeerConnection>"u"?void 0:typeof RTCRtpTransceiver<"u"?"ReactNativeUnifiedPlan":"ReactNative";if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const h=navigator.userAgent,l=new WS.UAParser(h),p=l.getBrowser(),g=(e=(t=p.name)==null?void 0:t.toLowerCase())!=null?e:"",f=parseInt((i=p.major)!=null?i:"0"),x=(r=(n=l.getEngine().name)==null?void 0:n.toLowerCase())!=null?r:"",S=l.getOS(),v=(o=(s=S.name)==null?void 0:s.toLowerCase())!=null?o:"",m=parseFloat((c=S.version)!=null?c:"0"),w=v==="ios",b=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(g),C=["firefox","mobile firefox","mobile focus"].includes(g),A=["safari","mobile safari"].includes(g),M=["edge"].includes(g);if((b||M)&&!w&&f>=111)return"Chrome111";if(b&&!w&&f>=74||M&&!w&&f>=88)return"Chrome74";if(b&&!w&&f>=70)return"Chrome70";if(b&&!w&&f>=67)return"Chrome67";if(b&&!w&&f>=55)return"Chrome55";if(C&&!w&&f>=60)return"Firefox60";if(C&&w&&m>=14.3)return"Safari12";if(A&&f>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(A&&f>=11)return"Safari11";if(M&&!w&&f>=11&&f<=18)return"Edge11";if(x==="webkit"&&w&&m>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(x==="blink"){const F=h.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(F){const N=Number(F[1]);return N>=111?"Chrome111":N>=74?"Chrome74":N>=70?"Chrome70":N>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else return}else return}var fd=new mt("packages/core/src/member/index.ts"),Gl=class{constructor(t){this._state="joined",this._events=new Zr,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.channel=t.channel,this.id=t.id,this.name=t.name,this._metadata=t.metadata,this.context=t.context}get metadata(){return this._metadata}get state(){return this._state}get publications(){return this.channel.publications.filter(t=>t.publisher.id===this.id)}get subscriptions(){return this.channel.subscriptions.filter(t=>t.subscriber.id===this.id)}toJSON(){return{id:this.id,name:this.name,type:this.type,subtype:this.subtype,metadata:this.metadata}}_left(){this._state="left",this.onLeft.emit(),this._events.dispose()}_metadataUpdated(t){this._metadata=t,this.onMetadataUpdated.emit(t)}updateMetadata(t){return B(this,null,function*(){yield this.channel._updateMemberMetadata(this.id,t)})}leave(){return B(this,null,function*(){const t=fd.info("[start] leave",yield Qt({operationName:"localPerson.leave",channel:this.channel}));if(this.state==="left")throw qe({operationName:"localPerson.leave",info:Qe.localPersonNotJoinedChannel,path:fd.prefix,context:this.context,channel:this.channel});yield this.channel.leave(this),fd.elapsed(t,"[end] leave")})}};Q();Q();var yc=new mt("packages/core/src/plugin/internal/unknown/connection.ts"),$S=class{constructor(t,e){this.localPerson=t,this.remoteMember=e,this.type="unknown",this.onDisconnect=new yt,this.onClose=new yt,this.closed=!1}close(){this.closed=!0,this.onClose.emit()}startPublishing(t){return B(this,null,function*(){yc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:t})})}stopPublishing(t){return B(this,null,function*(){yc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:t})})}startSubscribing(t){return B(this,null,function*(){yc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:t})})}stopSubscribing(t){return B(this,null,function*(){yc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:t})})}},og=class extends Gl{constructor(t){super(t),this.type="bot",this.side="remote",this._connections={},this.plugin=t.plugin,this.subtype=t.subtype}_getConnection(t){return this._connections[t]}_getOrCreateConnection(t){var e;return(e=this._getConnection(t.id))!=null?e:this._createConnection(t,this)}_createConnection(t,e){return new $S(t,e)}_dispose(){}};Q();Q();Q();Q();Q();Q();var cg=new mt("packages/core/src/media/stream/base.ts");function lg(t,e){var i;if(((i=t??{})==null?void 0:i.srcObject)===void 0)throw qe({operationName:"attachElement",info:Qe.invalidElement,payload:{element:t},path:cg.prefix});if(t.srcObject){const n=t.srcObject,r=n.getTracks().find(o=>o.readyState==="ended");r&&n.removeTrack(r);const s=n.getTracks().find(o=>o.kind===e.kind);s&&n.removeTrack(s),n.addTrack(e)}else t.srcObject=new MediaStream([e])}function dg(t,e){var i;if(((i=t??{})==null?void 0:i.srcObject)===void 0)throw qe({operationName:"attachElement",info:Qe.invalidElement,payload:{element:t},path:cg.prefix});const n=t.srcObject;n.getTracks().length>0&&n.removeTrack(e),n.getTracks().length===0&&(t.srcObject=null)}Q();Q();Q();Q();var Sc,ZS=new Uint8Array(16);function YS(){if(!Sc&&(Sc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sc(ZS)}Q();Q();Q();var JS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function QS(t){return typeof t=="string"&&JS.test(t)}var ew=QS,cn=[];for(let t=0;t<256;++t)cn.push((t+256).toString(16).slice(1));function tw(t,e=0){return cn[t[e+0]]+cn[t[e+1]]+cn[t[e+2]]+cn[t[e+3]]+"-"+cn[t[e+4]]+cn[t[e+5]]+"-"+cn[t[e+6]]+cn[t[e+7]]+"-"+cn[t[e+8]]+cn[t[e+9]]+"-"+cn[t[e+10]]+cn[t[e+11]]+cn[t[e+12]]+cn[t[e+13]]+cn[t[e+14]]+cn[t[e+15]]}Q();Q();var iw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vh={randomUUID:iw};function nw(t,e,i){if(Vh.randomUUID&&!e&&!t)return Vh.randomUUID();t=t||{};const n=t.random||(t.rng||YS)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){i=i||0;for(let r=0;r<16;++r)e[i+r]=n[r];return e}return tw(n)}var Yr=nw;Q();var rw=qn(Q_());Q();function du(t){this.message=t}du.prototype=new Error,du.prototype.name="InvalidCharacterError";var zh=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new du("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,n,r=0,s=0,o="";n=e.charAt(s++);~n&&(i=r%4?64*i+n:n,r++%4)?o+=String.fromCharCode(255&i>>(-2*r&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function sw(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(i){return decodeURIComponent(zh(i).replace(/(.)/g,function(n,r){var s=r.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch{return zh(e)}}function ll(t){this.message=t}function aw(t,e){if(typeof t!="string")throw new ll("Invalid token specified");var i=(e=e||{}).header===!0?0:1;try{return JSON.parse(sw(t.split(".")[i]))}catch(n){throw new ll("Invalid token specified: "+n.message)}}ll.prototype=new Error,ll.prototype.name="InvalidTokenError";var ow=aw;Q();var ui;(function(t){t.assertEqual=r=>r;function e(r){}t.assertIs=e;function i(r){throw new Error}t.assertNever=i,t.arrayToEnum=r=>{const s={};for(const o of r)s[o]=o;return s},t.getValidEnumValues=r=>{const s=t.objectKeys(r).filter(c=>typeof r[r[c]]!="number"),o={};for(const c of s)o[c]=r[c];return t.objectValues(o)},t.objectValues=r=>t.objectKeys(r).map(function(s){return r[s]}),t.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const s=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&s.push(o);return s},t.find=(r,s)=>{for(const o of r)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function n(r,s=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(r,s)=>typeof s=="bigint"?s.toString():s})(ui||(ui={}));var uu;(function(t){t.mergeShapes=(e,i)=>ne(ne({},e),i)})(uu||(uu={}));var ft=ui.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ls=t=>{switch(typeof t){case"undefined":return ft.undefined;case"string":return ft.string;case"number":return isNaN(t)?ft.nan:ft.number;case"boolean":return ft.boolean;case"function":return ft.function;case"bigint":return ft.bigint;case"symbol":return ft.symbol;case"object":return Array.isArray(t)?ft.array:t===null?ft.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ft.promise:typeof Map<"u"&&t instanceof Map?ft.map:typeof Set<"u"&&t instanceof Set?ft.set:typeof Date<"u"&&t instanceof Date?ft.date:ft.object;default:return ft.unknown}},Ye=ui.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),cw=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ir=class ug extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){const i=e||function(s){return s.message},n={_errors:[]},r=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)n._errors.push(i(o));else{let c=n,h=0;for(;h<o.path.length;){const l=o.path[h];h===o.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(i(o))):c[l]=c[l]||{_errors:[]},c=c[l],h++}}};return r(this),n}static assert(e){if(!(e instanceof ug))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ui.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){const i={},n=[];for(const r of this.issues)r.path.length>0?(i[r.path[0]]=i[r.path[0]]||[],i[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:i}}get formErrors(){return this.flatten()}};Ir.create=t=>new Ir(t);var Ja=(t,e)=>{let i;switch(t.code){case Ye.invalid_type:t.received===ft.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case Ye.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,ui.jsonStringifyReplacer)}`;break;case Ye.unrecognized_keys:i=`Unrecognized key(s) in object: ${ui.joinValues(t.keys,", ")}`;break;case Ye.invalid_union:i="Invalid input";break;case Ye.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ui.joinValues(t.options)}`;break;case Ye.invalid_enum_value:i=`Invalid enum value. Expected ${ui.joinValues(t.options)}, received '${t.received}'`;break;case Ye.invalid_arguments:i="Invalid function arguments";break;case Ye.invalid_return_type:i="Invalid function return type";break;case Ye.invalid_date:i="Invalid date";break;case Ye.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:ui.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case Ye.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case Ye.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case Ye.custom:i="Invalid input";break;case Ye.invalid_intersection_types:i="Intersection results could not be merged";break;case Ye.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case Ye.not_finite:i="Number must be finite";break;default:i=e.defaultError,ui.assertNever(t)}return{message:i}},hg=Ja;function lw(t){hg=t}function dl(){return hg}var ul=t=>{const{data:e,path:i,errorMaps:n,issueData:r}=t,s=[...i,...r.path||[]],o=we(ne({},r),{path:s});if(r.message!==void 0)return we(ne({},r),{path:s,message:r.message});let c="";const h=n.filter(l=>!!l).slice().reverse();for(const l of h)c=l(o,{data:e,defaultError:c}).message;return we(ne({},r),{path:s,message:c})},dw=[];function pt(t,e){const i=dl(),n=ul({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===Ja?void 0:Ja].filter(r=>!!r)});t.common.issues.push(n)}var Gn=class pg{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){const n=[];for(const r of i){if(r.status==="aborted")return zt;r.status==="dirty"&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,i){return B(this,null,function*(){const n=[];for(const r of i){const s=yield r.key,o=yield r.value;n.push({key:s,value:o})}return pg.mergeObjectSync(e,n)})}static mergeObjectSync(e,i){const n={};for(const r of i){const{key:s,value:o}=r;if(s.status==="aborted"||o.status==="aborted")return zt;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(n[s.value]=o.value)}return{status:e.value,value:n}}},zt=Object.freeze({status:"aborted"}),za=t=>({status:"dirty",value:t}),In=t=>({status:"valid",value:t}),hu=t=>t.status==="aborted",pu=t=>t.status==="dirty",ha=t=>t.status==="valid",Uo=t=>typeof Promise<"u"&&t instanceof Promise;function hl(t,e,i,n){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function fg(t,e,i,n,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}var Dt;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Dt||(Dt={}));var Do,Io,$r=class{constructor(t,e,i,n){this._cachedPath=[],this.parent=t,this.data=e,this._path=i,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Gh=(t,e)=>{if(ha(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new Ir(t.common.issues);return this._error=i,this._error}}};function Yt(t){if(!t)return{};const{errorMap:e,invalid_type_error:i,required_error:n,description:r}=t;if(e&&(i||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,c)=>{var h,l;const{message:p}=t;return o.code==="invalid_enum_value"?{message:p??c.defaultError}:typeof c.data>"u"?{message:(h=p??n)!==null&&h!==void 0?h:c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:(l=p??i)!==null&&l!==void 0?l:c.defaultError}},description:r}}var ii=class{get description(){return this._def.description}_getType(t){return ls(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:ls(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Gn,ctx:{common:t.parent.common,data:t.data,parsedType:ls(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(Uo(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const i=this.safeParse(t,e);if(i.success)return i.data;throw i.error}safeParse(t,e){var i;const n={common:{issues:[],async:(i=e==null?void 0:e.async)!==null&&i!==void 0?i:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ls(t)},r=this._parseSync({data:t,path:n.path,parent:n});return Gh(n,r)}"~validate"(t){var e,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ls(t)};if(!this["~standard"].async)try{const r=this._parseSync({data:t,path:[],parent:n});return ha(r)?{value:r.value}:{issues:n.common.issues}}catch(r){!((i=(e=r==null?void 0:r.message)===null||e===void 0?void 0:e.toLowerCase())===null||i===void 0)&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(r=>ha(r)?{value:r.value}:{issues:n.common.issues})}parseAsync(t,e){return B(this,null,function*(){const i=yield this.safeParseAsync(t,e);if(i.success)return i.data;throw i.error})}safeParseAsync(t,e){return B(this,null,function*(){const i={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ls(t)},n=this._parse({data:t,path:i.path,parent:i}),r=yield Uo(n)?n:Promise.resolve(n);return Gh(i,r)})}refine(t,e){const i=n=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(n):e;return this._refinement((n,r)=>{const s=t(n),o=()=>r.addIssue(ne({code:Ye.custom},i(n)));return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(t,e){return this._refinement((i,n)=>t(i)?!0:(n.addIssue(typeof e=="function"?e(i,n):e),!1))}_refinement(t){return new Lr({schema:this,typeName:Vt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Wr.create(this,this._def)}nullable(){return Ns.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return pa.create(this)}promise(){return to.create(this,this._def)}or(t){return qo.create([this,t],this._def)}and(t){return Wo.create(this,t,this._def)}transform(t){return new Lr(we(ne({},Yt(this._def)),{schema:this,typeName:Vt.ZodEffects,effect:{type:"transform",transform:t}}))}default(t){const e=typeof t=="function"?t:()=>t;return new Zo(we(ne({},Yt(this._def)),{innerType:this,defaultValue:e,typeName:Vt.ZodDefault}))}brand(){return new Wu(ne({typeName:Vt.ZodBranded,type:this},Yt(this._def)))}catch(t){const e=typeof t=="function"?t:()=>t;return new Yo(we(ne({},Yt(this._def)),{innerType:this,catchValue:e,typeName:Vt.ZodCatch}))}describe(t){const e=this.constructor;return new e(we(ne({},this._def),{description:t}))}pipe(t){return Ku.create(this,t)}readonly(){return Jo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},uw=/^c[^\s-]{8,}$/i,hw=/^[0-9a-z]+$/,pw=/^[0-9A-HJKMNP-TV-Z]{26}$/i,fw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,mw=/^[a-z0-9_-]{21}$/i,gw=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_w=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",md,yw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Sw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ww=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,xw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ew=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Cw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mg="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Tw=new RegExp(`^${mg}$`);function gg(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Rw(t){return new RegExp(`^${gg(t)}$`)}function vg(t){let e=`${mg}T${gg(t)}`;const i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function Pw(t,e){return!!((e==="v4"||!e)&&yw.test(t)||(e==="v6"||!e)&&ww.test(t))}function Mw(t,e){if(!gw.test(t))return!1;try{const[i]=t.split("."),n=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),r=JSON.parse(atob(n));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function Aw(t,e){return!!((e==="v4"||!e)&&Sw.test(t)||(e==="v6"||!e)&&xw.test(t))}var Qa=class Lo extends ii{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ft.string){const s=this._getOrReturnCtx(e);return pt(s,{code:Ye.invalid_type,expected:ft.string,received:s.parsedType}),zt}const n=new Gn;let r;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,c=e.data.length<s.value;(o||c)&&(r=this._getOrReturnCtx(e,r),o?pt(r,{code:Ye.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):c&&pt(r,{code:Ye.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")_w.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"email",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")md||(md=new RegExp(bw,"u")),md.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"emoji",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")fw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"uuid",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")mw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"nanoid",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")uw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"cuid",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"cuid2",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")pw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"ulid",code:Ye.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),pt(r,{validation:"url",code:Ye.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"regex",code:Ye.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?vg(s).test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?Tw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?Rw(s).test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?vw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"duration",code:Ye.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?Pw(e.data,s.version)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"ip",code:Ye.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?Mw(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"jwt",code:Ye.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?Aw(e.data,s.version)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"cidr",code:Ye.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?Ew.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"base64",code:Ye.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?Cw.test(e.data)||(r=this._getOrReturnCtx(e,r),pt(r,{validation:"base64url",code:Ye.invalid_string,message:s.message}),n.dirty()):ui.assertNever(s);return{status:n.value,value:e.data}}_regex(e,i,n){return this.refinement(r=>e.test(r),ne({validation:i,code:Ye.invalid_string},Dt.errToObj(n)))}_addCheck(e){return new Lo(we(ne({},this._def),{checks:[...this._def.checks,e]}))}email(e){return this._addCheck(ne({kind:"email"},Dt.errToObj(e)))}url(e){return this._addCheck(ne({kind:"url"},Dt.errToObj(e)))}emoji(e){return this._addCheck(ne({kind:"emoji"},Dt.errToObj(e)))}uuid(e){return this._addCheck(ne({kind:"uuid"},Dt.errToObj(e)))}nanoid(e){return this._addCheck(ne({kind:"nanoid"},Dt.errToObj(e)))}cuid(e){return this._addCheck(ne({kind:"cuid"},Dt.errToObj(e)))}cuid2(e){return this._addCheck(ne({kind:"cuid2"},Dt.errToObj(e)))}ulid(e){return this._addCheck(ne({kind:"ulid"},Dt.errToObj(e)))}base64(e){return this._addCheck(ne({kind:"base64"},Dt.errToObj(e)))}base64url(e){return this._addCheck(ne({kind:"base64url"},Dt.errToObj(e)))}jwt(e){return this._addCheck(ne({kind:"jwt"},Dt.errToObj(e)))}ip(e){return this._addCheck(ne({kind:"ip"},Dt.errToObj(e)))}cidr(e){return this._addCheck(ne({kind:"cidr"},Dt.errToObj(e)))}datetime(e){var i,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck(ne({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(i=e==null?void 0:e.offset)!==null&&i!==void 0?i:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1},Dt.errToObj(e==null?void 0:e.message)))}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck(ne({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision},Dt.errToObj(e==null?void 0:e.message)))}duration(e){return this._addCheck(ne({kind:"duration"},Dt.errToObj(e)))}regex(e,i){return this._addCheck(ne({kind:"regex",regex:e},Dt.errToObj(i)))}includes(e,i){return this._addCheck(ne({kind:"includes",value:e,position:i==null?void 0:i.position},Dt.errToObj(i==null?void 0:i.message)))}startsWith(e,i){return this._addCheck(ne({kind:"startsWith",value:e},Dt.errToObj(i)))}endsWith(e,i){return this._addCheck(ne({kind:"endsWith",value:e},Dt.errToObj(i)))}min(e,i){return this._addCheck(ne({kind:"min",value:e},Dt.errToObj(i)))}max(e,i){return this._addCheck(ne({kind:"max",value:e},Dt.errToObj(i)))}length(e,i){return this._addCheck(ne({kind:"length",value:e},Dt.errToObj(i)))}nonempty(e){return this.min(1,Dt.errToObj(e))}trim(){return new Lo(we(ne({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new Lo(we(ne({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new Lo(we(ne({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Qa.create=t=>{var e;return new Qa(ne({checks:[],typeName:Vt.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1},Yt(t)))};function Dw(t,e){const i=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,r=i>n?i:n,s=parseInt(t.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return s%o/Math.pow(10,r)}var Bo=class fu extends ii{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ft.number){const s=this._getOrReturnCtx(e);return pt(s,{code:Ye.invalid_type,expected:ft.number,received:s.parsedType}),zt}let n;const r=new Gn;for(const s of this._def.checks)s.kind==="int"?ui.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Dw(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.not_finite,message:s.message}),r.dirty()):ui.assertNever(s);return{status:r.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,Dt.toString(i))}gt(e,i){return this.setLimit("min",e,!1,Dt.toString(i))}lte(e,i){return this.setLimit("max",e,!0,Dt.toString(i))}lt(e,i){return this.setLimit("max",e,!1,Dt.toString(i))}setLimit(e,i,n,r){return new fu(we(ne({},this._def),{checks:[...this._def.checks,{kind:e,value:i,inclusive:n,message:Dt.toString(r)}]}))}_addCheck(e){return new fu(we(ne({},this._def),{checks:[...this._def.checks,e]}))}int(e){return this._addCheck({kind:"int",message:Dt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Dt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Dt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Dt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Dt.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:Dt.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:Dt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Dt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Dt.toString(e)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ui.isInteger(e.value))}get isFinite(){let e=null,i=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(i===null||n.value>i)&&(i=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(i)&&Number.isFinite(e)}};Bo.create=t=>new Bo(ne({checks:[],typeName:Vt.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1},Yt(t)));var Ho=class mu extends ii{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ft.bigint)return this._getInvalidInput(e);let n;const r=new Gn;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),pt(n,{code:Ye.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):ui.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){const i=this._getOrReturnCtx(e);return pt(i,{code:Ye.invalid_type,expected:ft.bigint,received:i.parsedType}),zt}gte(e,i){return this.setLimit("min",e,!0,Dt.toString(i))}gt(e,i){return this.setLimit("min",e,!1,Dt.toString(i))}lte(e,i){return this.setLimit("max",e,!0,Dt.toString(i))}lt(e,i){return this.setLimit("max",e,!1,Dt.toString(i))}setLimit(e,i,n,r){return new mu(we(ne({},this._def),{checks:[...this._def.checks,{kind:e,value:i,inclusive:n,message:Dt.toString(r)}]}))}_addCheck(e){return new mu(we(ne({},this._def),{checks:[...this._def.checks,e]}))}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Dt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Dt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Dt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Dt.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:Dt.toString(i)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}};Ho.create=t=>{var e;return new Ho(ne({checks:[],typeName:Vt.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1},Yt(t)))};var jo=class extends ii{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ft.boolean){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.boolean,received:i.parsedType}),zt}return In(t.data)}};jo.create=t=>new jo(ne({typeName:Vt.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1},Yt(t)));var Vo=class _g extends ii{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ft.date){const s=this._getOrReturnCtx(e);return pt(s,{code:Ye.invalid_type,expected:ft.date,received:s.parsedType}),zt}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return pt(s,{code:Ye.invalid_date}),zt}const n=new Gn;let r;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),pt(r,{code:Ye.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ui.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _g(we(ne({},this._def),{checks:[...this._def.checks,e]}))}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:Dt.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:Dt.toString(i)})}get minDate(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}};Vo.create=t=>new Vo(ne({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Vt.ZodDate},Yt(t)));var pl=class extends ii{_parse(t){if(this._getType(t)!==ft.symbol){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.symbol,received:i.parsedType}),zt}return In(t.data)}};pl.create=t=>new pl(ne({typeName:Vt.ZodSymbol},Yt(t)));var zo=class extends ii{_parse(t){if(this._getType(t)!==ft.undefined){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.undefined,received:i.parsedType}),zt}return In(t.data)}};zo.create=t=>new zo(ne({typeName:Vt.ZodUndefined},Yt(t)));var Go=class extends ii{_parse(t){if(this._getType(t)!==ft.null){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.null,received:i.parsedType}),zt}return In(t.data)}};Go.create=t=>new Go(ne({typeName:Vt.ZodNull},Yt(t)));var eo=class extends ii{constructor(){super(...arguments),this._any=!0}_parse(t){return In(t.data)}};eo.create=t=>new eo(ne({typeName:Vt.ZodAny},Yt(t)));var aa=class extends ii{constructor(){super(...arguments),this._unknown=!0}_parse(t){return In(t.data)}};aa.create=t=>new aa(ne({typeName:Vt.ZodUnknown},Yt(t)));var ps=class extends ii{_parse(t){const e=this._getOrReturnCtx(t);return pt(e,{code:Ye.invalid_type,expected:ft.never,received:e.parsedType}),zt}};ps.create=t=>new ps(ne({typeName:Vt.ZodNever},Yt(t)));var fl=class extends ii{_parse(t){if(this._getType(t)!==ft.undefined){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.void,received:i.parsedType}),zt}return In(t.data)}};fl.create=t=>new fl(ne({typeName:Vt.ZodVoid},Yt(t)));var pa=class Qc extends ii{_parse(e){const{ctx:i,status:n}=this._processInputParams(e),r=this._def;if(i.parsedType!==ft.array)return pt(i,{code:Ye.invalid_type,expected:ft.array,received:i.parsedType}),zt;if(r.exactLength!==null){const o=i.data.length>r.exactLength.value,c=i.data.length<r.exactLength.value;(o||c)&&(pt(i,{code:o?Ye.too_big:Ye.too_small,minimum:c?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&i.data.length<r.minLength.value&&(pt(i,{code:Ye.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&i.data.length>r.maxLength.value&&(pt(i,{code:Ye.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),i.common.async)return Promise.all([...i.data].map((o,c)=>r.type._parseAsync(new $r(i,o,i.path,c)))).then(o=>Gn.mergeArray(n,o));const s=[...i.data].map((o,c)=>r.type._parseSync(new $r(i,o,i.path,c)));return Gn.mergeArray(n,s)}get element(){return this._def.type}min(e,i){return new Qc(we(ne({},this._def),{minLength:{value:e,message:Dt.toString(i)}}))}max(e,i){return new Qc(we(ne({},this._def),{maxLength:{value:e,message:Dt.toString(i)}}))}length(e,i){return new Qc(we(ne({},this._def),{exactLength:{value:e,message:Dt.toString(i)}}))}nonempty(e){return this.min(1,e)}};pa.create=(t,e)=>new pa(ne({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Vt.ZodArray},Yt(e)));function ja(t){if(t instanceof mr){const e={};for(const i in t.shape){const n=t.shape[i];e[i]=Wr.create(ja(n))}return new mr(we(ne({},t._def),{shape:()=>e}))}else return t instanceof pa?new pa(we(ne({},t._def),{type:ja(t.element)})):t instanceof Wr?Wr.create(ja(t.unwrap())):t instanceof Ns?Ns.create(ja(t.unwrap())):t instanceof ks?ks.create(t.items.map(e=>ja(e))):t}var mr=class Cr extends ii{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),i=ui.objectKeys(e);return this._cached={shape:e,keys:i}}_parse(e){if(this._getType(e)!==ft.object){const l=this._getOrReturnCtx(e);return pt(l,{code:Ye.invalid_type,expected:ft.object,received:l.parsedType}),zt}const{status:n,ctx:r}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof ps&&this._def.unknownKeys==="strip"))for(const l in r.data)o.includes(l)||c.push(l);const h=[];for(const l of o){const p=s[l],g=r.data[l];h.push({key:{status:"valid",value:l},value:p._parse(new $r(r,g,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof ps){const l=this._def.unknownKeys;if(l==="passthrough")for(const p of c)h.push({key:{status:"valid",value:p},value:{status:"valid",value:r.data[p]}});else if(l==="strict")c.length>0&&(pt(r,{code:Ye.unrecognized_keys,keys:c}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const p of c){const g=r.data[p];h.push({key:{status:"valid",value:p},value:l._parse(new $r(r,g,r.path,p)),alwaysSet:p in r.data})}}return r.common.async?Promise.resolve().then(()=>B(this,null,function*(){const l=[];for(const p of h){const g=yield p.key,f=yield p.value;l.push({key:g,value:f,alwaysSet:p.alwaysSet})}return l})).then(l=>Gn.mergeObjectSync(n,l)):Gn.mergeObjectSync(n,h)}get shape(){return this._def.shape()}strict(e){return Dt.errToObj,new Cr(ne(we(ne({},this._def),{unknownKeys:"strict"}),e!==void 0?{errorMap:(i,n)=>{var r,s,o,c;const h=(o=(s=(r=this._def).errorMap)===null||s===void 0?void 0:s.call(r,i,n).message)!==null&&o!==void 0?o:n.defaultError;return i.code==="unrecognized_keys"?{message:(c=Dt.errToObj(e).message)!==null&&c!==void 0?c:h}:{message:h}}}:{}))}strip(){return new Cr(we(ne({},this._def),{unknownKeys:"strip"}))}passthrough(){return new Cr(we(ne({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new Cr(we(ne({},this._def),{shape:()=>ne(ne({},this._def.shape()),e)}))}merge(e){return new Cr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>ne(ne({},this._def.shape()),e._def.shape()),typeName:Vt.ZodObject})}setKey(e,i){return this.augment({[e]:i})}catchall(e){return new Cr(we(ne({},this._def),{catchall:e}))}pick(e){const i={};return ui.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(i[n]=this.shape[n])}),new Cr(we(ne({},this._def),{shape:()=>i}))}omit(e){const i={};return ui.objectKeys(this.shape).forEach(n=>{e[n]||(i[n]=this.shape[n])}),new Cr(we(ne({},this._def),{shape:()=>i}))}deepPartial(){return ja(this)}partial(e){const i={};return ui.objectKeys(this.shape).forEach(n=>{const r=this.shape[n];e&&!e[n]?i[n]=r:i[n]=r.optional()}),new Cr(we(ne({},this._def),{shape:()=>i}))}required(e){const i={};return ui.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])i[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Wr;)s=s._def.innerType;i[n]=s}}),new Cr(we(ne({},this._def),{shape:()=>i}))}keyof(){return Eg(ui.objectKeys(this.shape))}};mr.create=(t,e)=>new mr(ne({shape:()=>t,unknownKeys:"strip",catchall:ps.create(),typeName:Vt.ZodObject},Yt(e)));mr.strictCreate=(t,e)=>new mr(ne({shape:()=>t,unknownKeys:"strict",catchall:ps.create(),typeName:Vt.ZodObject},Yt(e)));mr.lazycreate=(t,e)=>new mr(ne({shape:t,unknownKeys:"strip",catchall:ps.create(),typeName:Vt.ZodObject},Yt(e)));var qo=class extends ii{_parse(t){const{ctx:e}=this._processInputParams(t),i=this._def.options;function n(r){for(const o of r)if(o.result.status==="valid")return o.result;for(const o of r)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;const s=r.map(o=>new Ir(o.ctx.common.issues));return pt(e,{code:Ye.invalid_union,unionErrors:s}),zt}if(e.common.async)return Promise.all(i.map(r=>B(this,null,function*(){const s=we(ne({},e),{common:we(ne({},e.common),{issues:[]}),parent:null});return{result:yield r._parseAsync({data:e.data,path:e.path,parent:s}),ctx:s}}))).then(n);{let r;const s=[];for(const c of i){const h=we(ne({},e),{common:we(ne({},e.common),{issues:[]}),parent:null}),l=c._parseSync({data:e.data,path:e.path,parent:h});if(l.status==="valid")return l;l.status==="dirty"&&!r&&(r={result:l,ctx:h}),h.common.issues.length&&s.push(h.common.issues)}if(r)return e.common.issues.push(...r.ctx.common.issues),r.result;const o=s.map(c=>new Ir(c));return pt(e,{code:Ye.invalid_union,unionErrors:o}),zt}}get options(){return this._def.options}};qo.create=(t,e)=>new qo(ne({options:t,typeName:Vt.ZodUnion},Yt(e)));var os=t=>t instanceof Ko?os(t.schema):t instanceof Lr?os(t.innerType()):t instanceof Xo?[t.value]:t instanceof rc?t.options:t instanceof $o?ui.objectValues(t.enum):t instanceof Zo?os(t._def.innerType):t instanceof zo?[void 0]:t instanceof Go?[null]:t instanceof Wr?[void 0,...os(t.unwrap())]:t instanceof Ns?[null,...os(t.unwrap())]:t instanceof Wu||t instanceof Jo?os(t.unwrap()):t instanceof Yo?os(t._def.innerType):[],bg=class yg extends ii{_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==ft.object)return pt(i,{code:Ye.invalid_type,expected:ft.object,received:i.parsedType}),zt;const n=this.discriminator,r=i.data[n],s=this.optionsMap.get(r);return s?i.common.async?s._parseAsync({data:i.data,path:i.path,parent:i}):s._parseSync({data:i.data,path:i.path,parent:i}):(pt(i,{code:Ye.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),zt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,i,n){const r=new Map;for(const s of i){const o=os(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of o){if(r.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);r.set(c,s)}}return new yg(ne({typeName:Vt.ZodDiscriminatedUnion,discriminator:e,options:i,optionsMap:r},Yt(n)))}};function gu(t,e){const i=ls(t),n=ls(e);if(t===e)return{valid:!0,data:t};if(i===ft.object&&n===ft.object){const r=ui.objectKeys(e),s=ui.objectKeys(t).filter(c=>r.indexOf(c)!==-1),o=ne(ne({},t),e);for(const c of s){const h=gu(t[c],e[c]);if(!h.valid)return{valid:!1};o[c]=h.data}return{valid:!0,data:o}}else if(i===ft.array&&n===ft.array){if(t.length!==e.length)return{valid:!1};const r=[];for(let s=0;s<t.length;s++){const o=t[s],c=e[s],h=gu(o,c);if(!h.valid)return{valid:!1};r.push(h.data)}return{valid:!0,data:r}}else return i===ft.date&&n===ft.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Wo=class extends ii{_parse(t){const{status:e,ctx:i}=this._processInputParams(t),n=(r,s)=>{if(hu(r)||hu(s))return zt;const o=gu(r.value,s.value);return o.valid?((pu(r)||pu(s))&&e.dirty(),{status:e.value,value:o.data}):(pt(i,{code:Ye.invalid_intersection_types}),zt)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([r,s])=>n(r,s)):n(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}};Wo.create=(t,e,i)=>new Wo(ne({left:t,right:e,typeName:Vt.ZodIntersection},Yt(i)));var ks=class Sg extends ii{_parse(e){const{status:i,ctx:n}=this._processInputParams(e);if(n.parsedType!==ft.array)return pt(n,{code:Ye.invalid_type,expected:ft.array,received:n.parsedType}),zt;if(n.data.length<this._def.items.length)return pt(n,{code:Ye.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),zt;!this._def.rest&&n.data.length>this._def.items.length&&(pt(n,{code:Ye.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const s=[...n.data].map((o,c)=>{const h=this._def.items[c]||this._def.rest;return h?h._parse(new $r(n,o,n.path,c)):null}).filter(o=>!!o);return n.common.async?Promise.all(s).then(o=>Gn.mergeArray(i,o)):Gn.mergeArray(i,s)}get items(){return this._def.items}rest(e){return new Sg(we(ne({},this._def),{rest:e}))}};ks.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ks(ne({items:t,typeName:Vt.ZodTuple,rest:null},Yt(e)))};var wg=class vu extends ii{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:i,ctx:n}=this._processInputParams(e);if(n.parsedType!==ft.object)return pt(n,{code:Ye.invalid_type,expected:ft.object,received:n.parsedType}),zt;const r=[],s=this._def.keyType,o=this._def.valueType;for(const c in n.data)r.push({key:s._parse(new $r(n,c,n.path,c)),value:o._parse(new $r(n,n.data[c],n.path,c)),alwaysSet:c in n.data});return n.common.async?Gn.mergeObjectAsync(i,r):Gn.mergeObjectSync(i,r)}get element(){return this._def.valueType}static create(e,i,n){return i instanceof ii?new vu(ne({keyType:e,valueType:i,typeName:Vt.ZodRecord},Yt(n))):new vu(ne({keyType:Qa.create(),valueType:e,typeName:Vt.ZodRecord},Yt(i)))}},ml=class extends ii{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==ft.map)return pt(i,{code:Ye.invalid_type,expected:ft.map,received:i.parsedType}),zt;const n=this._def.keyType,r=this._def.valueType,s=[...i.data.entries()].map(([o,c],h)=>({key:n._parse(new $r(i,o,i.path,[h,"key"])),value:r._parse(new $r(i,c,i.path,[h,"value"]))}));if(i.common.async){const o=new Map;return Promise.resolve().then(()=>B(this,null,function*(){for(const c of s){const h=yield c.key,l=yield c.value;if(h.status==="aborted"||l.status==="aborted")return zt;(h.status==="dirty"||l.status==="dirty")&&e.dirty(),o.set(h.value,l.value)}return{status:e.value,value:o}}))}else{const o=new Map;for(const c of s){const h=c.key,l=c.value;if(h.status==="aborted"||l.status==="aborted")return zt;(h.status==="dirty"||l.status==="dirty")&&e.dirty(),o.set(h.value,l.value)}return{status:e.value,value:o}}}};ml.create=(t,e,i)=>new ml(ne({valueType:e,keyType:t,typeName:Vt.ZodMap},Yt(i)));var gl=class _u extends ii{_parse(e){const{status:i,ctx:n}=this._processInputParams(e);if(n.parsedType!==ft.set)return pt(n,{code:Ye.invalid_type,expected:ft.set,received:n.parsedType}),zt;const r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(pt(n,{code:Ye.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),i.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(pt(n,{code:Ye.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),i.dirty());const s=this._def.valueType;function o(h){const l=new Set;for(const p of h){if(p.status==="aborted")return zt;p.status==="dirty"&&i.dirty(),l.add(p.value)}return{status:i.value,value:l}}const c=[...n.data.values()].map((h,l)=>s._parse(new $r(n,h,n.path,l)));return n.common.async?Promise.all(c).then(h=>o(h)):o(c)}min(e,i){return new _u(we(ne({},this._def),{minSize:{value:e,message:Dt.toString(i)}}))}max(e,i){return new _u(we(ne({},this._def),{maxSize:{value:e,message:Dt.toString(i)}}))}size(e,i){return this.min(e,i).max(e,i)}nonempty(e){return this.min(1,e)}};gl.create=(t,e)=>new gl(ne({valueType:t,minSize:null,maxSize:null,typeName:Vt.ZodSet},Yt(e)));var xg=class el extends ii{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==ft.function)return pt(i,{code:Ye.invalid_type,expected:ft.function,received:i.parsedType}),zt;function n(c,h){return ul({data:c,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,dl(),Ja].filter(l=>!!l),issueData:{code:Ye.invalid_arguments,argumentsError:h}})}function r(c,h){return ul({data:c,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,dl(),Ja].filter(l=>!!l),issueData:{code:Ye.invalid_return_type,returnTypeError:h}})}const s={errorMap:i.common.contextualErrorMap},o=i.data;if(this._def.returns instanceof to){const c=this;return In(function(...h){return B(this,null,function*(){const l=new Ir([]),p=yield c._def.args.parseAsync(h,s).catch(y=>{throw l.addIssue(n(h,y)),l}),g=yield Reflect.apply(o,this,p);return yield c._def.returns._def.type.parseAsync(g,s).catch(y=>{throw l.addIssue(r(g,y)),l})})})}else{const c=this;return In(function(...h){const l=c._def.args.safeParse(h,s);if(!l.success)throw new Ir([n(h,l.error)]);const p=Reflect.apply(o,this,l.data),g=c._def.returns.safeParse(p,s);if(!g.success)throw new Ir([r(p,g.error)]);return g.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new el(we(ne({},this._def),{args:ks.create(e).rest(aa.create())}))}returns(e){return new el(we(ne({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,i,n){return new el(ne({args:e||ks.create([]).rest(aa.create()),returns:i||aa.create(),typeName:Vt.ZodFunction},Yt(n)))}},Ko=class extends ii{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};Ko.create=(t,e)=>new Ko(ne({getter:t,typeName:Vt.ZodLazy},Yt(e)));var Xo=class extends ii{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return pt(e,{received:e.data,code:Ye.invalid_literal,expected:this._def.value}),zt}return{status:"valid",value:t.data}}get value(){return this._def.value}};Xo.create=(t,e)=>new Xo(ne({value:t,typeName:Vt.ZodLiteral},Yt(e)));function Eg(t,e){return new rc(ne({values:t,typeName:Vt.ZodEnum},Yt(e)))}var rc=class bu extends ii{constructor(){super(...arguments),Do.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const i=this._getOrReturnCtx(e),n=this._def.values;return pt(i,{expected:ui.joinValues(n),received:i.parsedType,code:Ye.invalid_type}),zt}if(hl(this,Do)||fg(this,Do,new Set(this._def.values)),!hl(this,Do).has(e.data)){const i=this._getOrReturnCtx(e),n=this._def.values;return pt(i,{received:i.data,code:Ye.invalid_enum_value,options:n}),zt}return In(e.data)}get options(){return this._def.values}get enum(){const e={};for(const i of this._def.values)e[i]=i;return e}get Values(){const e={};for(const i of this._def.values)e[i]=i;return e}get Enum(){const e={};for(const i of this._def.values)e[i]=i;return e}extract(e,i=this._def){return bu.create(e,ne(ne({},this._def),i))}exclude(e,i=this._def){return bu.create(this.options.filter(n=>!e.includes(n)),ne(ne({},this._def),i))}};Do=new WeakMap;rc.create=Eg;var $o=class extends ii{constructor(){super(...arguments),Io.set(this,void 0)}_parse(t){const e=ui.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==ft.string&&i.parsedType!==ft.number){const n=ui.objectValues(e);return pt(i,{expected:ui.joinValues(n),received:i.parsedType,code:Ye.invalid_type}),zt}if(hl(this,Io)||fg(this,Io,new Set(ui.getValidEnumValues(this._def.values))),!hl(this,Io).has(t.data)){const n=ui.objectValues(e);return pt(i,{received:i.data,code:Ye.invalid_enum_value,options:n}),zt}return In(t.data)}get enum(){return this._def.values}};Io=new WeakMap;$o.create=(t,e)=>new $o(ne({values:t,typeName:Vt.ZodNativeEnum},Yt(e)));var to=class extends ii{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==ft.promise&&e.common.async===!1)return pt(e,{code:Ye.invalid_type,expected:ft.promise,received:e.parsedType}),zt;const i=e.parsedType===ft.promise?e.data:Promise.resolve(e.data);return In(i.then(n=>this._def.type.parseAsync(n,{path:e.path,errorMap:e.common.contextualErrorMap})))}};to.create=(t,e)=>new to(ne({type:t,typeName:Vt.ZodPromise},Yt(e)));var Lr=class extends ii{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Vt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:i}=this._processInputParams(t),n=this._def.effect||null,r={addIssue:s=>{pt(i,s),s.fatal?e.abort():e.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),n.type==="preprocess"){const s=n.transform(i.data,r);if(i.common.async)return Promise.resolve(s).then(o=>B(this,null,function*(){if(e.value==="aborted")return zt;const c=yield this._def.schema._parseAsync({data:o,path:i.path,parent:i});return c.status==="aborted"?zt:c.status==="dirty"||e.value==="dirty"?za(c.value):c}));{if(e.value==="aborted")return zt;const o=this._def.schema._parseSync({data:s,path:i.path,parent:i});return o.status==="aborted"?zt:o.status==="dirty"||e.value==="dirty"?za(o.value):o}}if(n.type==="refinement"){const s=o=>{const c=n.refinement(o,r);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?zt:(o.status==="dirty"&&e.dirty(),s(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>o.status==="aborted"?zt:(o.status==="dirty"&&e.dirty(),s(o.value).then(()=>({status:e.value,value:o.value}))))}if(n.type==="transform")if(i.common.async===!1){const s=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!ha(s))return s;const o=n.transform(s.value,r);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(s=>ha(s)?Promise.resolve(n.transform(s.value,r)).then(o=>({status:e.value,value:o})):s);ui.assertNever(n)}};Lr.create=(t,e,i)=>new Lr(ne({schema:t,typeName:Vt.ZodEffects,effect:e},Yt(i)));Lr.createWithPreprocess=(t,e,i)=>new Lr(ne({schema:e,effect:{type:"preprocess",transform:t},typeName:Vt.ZodEffects},Yt(i)));var Wr=class extends ii{_parse(t){return this._getType(t)===ft.undefined?In(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Wr.create=(t,e)=>new Wr(ne({innerType:t,typeName:Vt.ZodOptional},Yt(e)));var Ns=class extends ii{_parse(t){return this._getType(t)===ft.null?In(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ns.create=(t,e)=>new Ns(ne({innerType:t,typeName:Vt.ZodNullable},Yt(e)));var Zo=class extends ii{_parse(t){const{ctx:e}=this._processInputParams(t);let i=e.data;return e.parsedType===ft.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};Zo.create=(t,e)=>new Zo(ne({innerType:t,typeName:Vt.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default},Yt(e)));var Yo=class extends ii{_parse(t){const{ctx:e}=this._processInputParams(t),i=we(ne({},e),{common:we(ne({},e.common),{issues:[]})}),n=this._def.innerType._parse({data:i.data,path:i.path,parent:ne({},i)});return Uo(n)?n.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ir(i.common.issues)},input:i.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Ir(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}};Yo.create=(t,e)=>new Yo(ne({innerType:t,typeName:Vt.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch},Yt(e)));var vl=class extends ii{_parse(t){if(this._getType(t)!==ft.nan){const i=this._getOrReturnCtx(t);return pt(i,{code:Ye.invalid_type,expected:ft.nan,received:i.parsedType}),zt}return{status:"valid",value:t.data}}};vl.create=t=>new vl(ne({typeName:Vt.ZodNaN},Yt(t)));var Iw=Symbol("zod_brand"),Wu=class extends ii{_parse(t){const{ctx:e}=this._processInputParams(t),i=e.data;return this._def.type._parse({data:i,path:e.path,parent:e})}unwrap(){return this._def.type}},Ku=class Cg extends ii{_parse(e){const{status:i,ctx:n}=this._processInputParams(e);if(n.common.async)return B(this,null,function*(){const s=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?zt:s.status==="dirty"?(i.dirty(),za(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})});{const r=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?zt:r.status==="dirty"?(i.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:n.path,parent:n})}}static create(e,i){return new Cg({in:e,out:i,typeName:Vt.ZodPipeline})}},Jo=class extends ii{_parse(t){const e=this._def.innerType._parse(t),i=n=>(ha(n)&&(n.value=Object.freeze(n.value)),n);return Uo(e)?e.then(n=>i(n)):i(e)}unwrap(){return this._def.innerType}};Jo.create=(t,e)=>new Jo(ne({innerType:t,typeName:Vt.ZodReadonly},Yt(e)));function qh(t,e){const i=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof i=="string"?{message:i}:i}function Tg(t,e={},i){return t?eo.create().superRefine((n,r)=>{var s,o;const c=t(n);if(c instanceof Promise)return c.then(h=>{var l,p;if(!h){const g=qh(e,n),f=(p=(l=g.fatal)!==null&&l!==void 0?l:i)!==null&&p!==void 0?p:!0;r.addIssue(we(ne({code:"custom"},g),{fatal:f}))}});if(!c){const h=qh(e,n),l=(o=(s=h.fatal)!==null&&s!==void 0?s:i)!==null&&o!==void 0?o:!0;r.addIssue(we(ne({code:"custom"},h),{fatal:l}))}}):eo.create()}var Lw={object:mr.lazycreate},Vt;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Vt||(Vt={}));var Fw=(t,e={message:`Input not instance of ${t.name}`})=>Tg(i=>i instanceof t,e),Rg=Qa.create,Pg=Bo.create,kw=vl.create,Nw=Ho.create,Mg=jo.create,Ow=Vo.create,Uw=pl.create,Bw=zo.create,Hw=Go.create,jw=eo.create,Vw=aa.create,zw=ps.create,Gw=fl.create,qw=pa.create,Ww=mr.create,Kw=mr.strictCreate,Xw=qo.create,$w=bg.create,Zw=Wo.create,Yw=ks.create,Jw=wg.create,Qw=ml.create,e1=gl.create,t1=xg.create,i1=Ko.create,n1=Xo.create,r1=rc.create,s1=$o.create,a1=to.create,Wh=Lr.create,o1=Wr.create,c1=Ns.create,l1=Lr.createWithPreprocess,d1=Ku.create,u1=()=>Rg().optional(),h1=()=>Pg().optional(),p1=()=>Mg().optional(),f1={string:t=>Qa.create(we(ne({},t),{coerce:!0})),number:t=>Bo.create(we(ne({},t),{coerce:!0})),boolean:t=>jo.create(we(ne({},t),{coerce:!0})),bigint:t=>Ho.create(we(ne({},t),{coerce:!0})),date:t=>Vo.create(we(ne({},t),{coerce:!0}))},m1=zt,ht=Object.freeze({__proto__:null,defaultErrorMap:Ja,setErrorMap:lw,getErrorMap:dl,makeIssue:ul,EMPTY_PATH:dw,addIssueToContext:pt,ParseStatus:Gn,INVALID:zt,DIRTY:za,OK:In,isAborted:hu,isDirty:pu,isValid:ha,isAsync:Uo,get util(){return ui},get objectUtil(){return uu},ZodParsedType:ft,getParsedType:ls,ZodType:ii,datetimeRegex:vg,ZodString:Qa,ZodNumber:Bo,ZodBigInt:Ho,ZodBoolean:jo,ZodDate:Vo,ZodSymbol:pl,ZodUndefined:zo,ZodNull:Go,ZodAny:eo,ZodUnknown:aa,ZodNever:ps,ZodVoid:fl,ZodArray:pa,ZodObject:mr,ZodUnion:qo,ZodDiscriminatedUnion:bg,ZodIntersection:Wo,ZodTuple:ks,ZodRecord:wg,ZodMap:ml,ZodSet:gl,ZodFunction:xg,ZodLazy:Ko,ZodLiteral:Xo,ZodEnum:rc,ZodNativeEnum:$o,ZodPromise:to,ZodEffects:Lr,ZodTransformer:Lr,ZodOptional:Wr,ZodNullable:Ns,ZodDefault:Zo,ZodCatch:Yo,ZodNaN:vl,BRAND:Iw,ZodBranded:Wu,ZodPipeline:Ku,ZodReadonly:Jo,custom:Tg,Schema:ii,ZodSchema:ii,late:Lw,get ZodFirstPartyTypeKind(){return Vt},coerce:f1,any:jw,array:qw,bigint:Nw,boolean:Mg,date:Ow,discriminatedUnion:$w,effect:Wh,enum:r1,function:t1,instanceof:Fw,intersection:Zw,lazy:i1,literal:n1,map:Qw,nan:kw,nativeEnum:s1,never:zw,null:Hw,nullable:c1,number:Pg,object:Ww,oboolean:p1,onumber:h1,optional:o1,ostring:u1,pipeline:d1,preprocess:l1,promise:a1,record:Jw,set:e1,strictObject:Kw,string:Rg,symbol:Uw,transformer:Wh,tuple:Yw,undefined:Bw,union:Xw,unknown:Vw,void:Gw,NEVER:m1,ZodIssueCode:Ye,quotelessJson:cw,ZodError:Ir}),bo=new mt("packages/token/src/encoder.ts"),io=class Ag{constructor(e){let i;try{i=j1.parse(e)}catch(n){throw n instanceof ht.ZodError?new rr({path:bo.prefix,info:yo.invalidParameter,error:new Error("Received invalid token. Please check your SkyWayAuthToken.")}):new rr({path:bo.prefix,info:yo.invalidParameter,error:new Error("Received invalid token. Please check your SkyWayAuthToken.")})}Object.assign(this,i)}static Decode(e){try{const i=ow(e),n=new Ag(i);return n.tokenString=e,n}catch(i){throw new rr({path:bo.prefix,info:yo.invalidParameter,error:i})}}encode(e){const i={jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,version:this.version};return this.tokenString=rw.default.KJUR.jws.JWS.sign("HS256",JSON.stringify({alg:"HS256",typ:"JWT"}),JSON.stringify(i),e),this.tokenString}toJSON(){return{jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,encoded:this.tokenString,version:this.version}}getAppId(){switch(this.version){case void 0:case 1:case 2:return this.scope.app.id;case 3:return this.scope.appId;default:throw new rr({path:bo.prefix,info:yo.invalidParameter,error:new Error(`invalid token version: version ${this.version} is not supported.`)})}}getAnalyticsEnabled(){var e,i,n;switch(this.version){case void 0:case 1:case 2:return(e=this.scope.app.analytics)!=null?e:!1;case 3:return(n=(i=this.scope.analytics)==null?void 0:i.enabled)!=null?n:!0;default:throw new rr({path:bo.prefix,info:yo.invalidParameter,error:new Error(`invalid token version: version ${this.version} is not supported.`)})}}};Q();var g1=["create","write","delete"],v1=ht.object({actions:ht.array(ht.enum(g1).refine(t=>typeof t=="string"))}).passthrough(),_1=["create","write","delete"],b1=ht.object({actions:ht.array(ht.enum(_1).refine(t=>typeof t=="string")),forwardings:ht.array(v1)}).passthrough();Q();var y1=["write","create","delete","updateMetadata","enable","disable"],S1=ht.object({actions:ht.array(ht.enum(y1).refine(t=>typeof t=="string"))}).passthrough(),w1=["write","create","delete"],x1=ht.object({actions:ht.array(ht.enum(w1).refine(t=>typeof t=="string"))}).passthrough(),E1=["write","create","delete","updateMetadata","signal"],C1=ht.object({id:ht.string().optional(),name:ht.string().optional()}).refine(t=>t.id!==void 0||t.name!==void 0,{message:"Either id or name is required."}),T1=ht.intersection(C1,ht.object({actions:ht.array(ht.enum(E1).refine(t=>typeof t=="string")),publication:S1.optional(),subscription:x1.optional()}).passthrough()),R1=["write","read","create","delete","updateMetadata"],P1=ht.object({id:ht.string().optional(),name:ht.string().optional()}).refine(t=>t.id!==void 0||t.name!==void 0,{message:"Either id or name is required."}),M1=ht.intersection(P1,ht.object({actions:ht.array(ht.enum(R1).refine(t=>typeof t=="string")),members:ht.array(T1),sfuBots:ht.array(b1).optional()}).passthrough()),A1=["listChannels","read","write"],D1=ht.object({id:ht.string(),analytics:ht.boolean().optional(),actions:ht.array(ht.enum(A1).refine(t=>typeof t=="string")).optional(),channels:ht.array(M1).optional(),turn:ht.boolean().optional()}).passthrough();Q();var I1=["publish","subscribe","updateMetadata"],L1=ht.object({id:ht.string().optional(),name:ht.string().optional()}).refine(t=>t.id!==void 0||t.name!==void 0,{message:"Either id or name is required."}),F1=ht.intersection(L1,ht.object({methods:ht.array(ht.enum(I1).refine(t=>typeof t=="string"))}).passthrough()),k1=["create","close","updateMetadata"],N1=ht.object({id:ht.string().optional(),name:ht.string().optional()}).refine(t=>t.id!==void 0||t.name!==void 0,{message:"Either id or name is required."}),O1=ht.intersection(N1,ht.object({methods:ht.array(ht.enum(k1).refine(t=>typeof t=="string")),member:F1.optional(),sfu:ht.object({enabled:ht.boolean().optional(),maxSubscribersLimit:ht.number().optional()}).optional()}).passthrough()),U1=ht.object({appId:ht.string(),analytics:ht.object({enabled:ht.boolean().optional()}).optional(),turn:ht.object({enabled:ht.boolean().optional()}).optional(),rooms:ht.array(O1)}).passthrough();Q();var Dg=ht.object({jti:ht.string().uuid(),iat:ht.number().nonnegative(),exp:ht.number().nonnegative()}),B1=ht.intersection(Dg,ht.object({scope:ht.object({app:D1}),version:ht.union([ht.literal(1),ht.literal(2),ht.literal(void 0)]).optional()})),H1=ht.intersection(Dg,ht.object({scope:U1,version:ht.literal(3)})),j1=ht.union([B1,H1]);Q();var yo={invalidParameter:{name:"invalidParameter",detail:"failed to decode token",solution:"Use the correct token according to the specification"}};Q();var Kh=()=>Math.floor(Date.now()/1e3),lo=Yr,Ig=class{constructor(t){this.contentType=t,this.side="local",this.onConnectionStateChanged=new yt,this._onConnectionStateChanged=new yt,this.id=lo(),this._label="",this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={},this._connectionState={},this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setLabel(t){this._label=t}_unpublished(){this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={}}_getTransport(t){var e,i;const n=typeof t=="string"?t:t.id;return(i=(e=this._getTransportCallbacks)[n])==null?void 0:i.call(e)}_setConnectionState(t,e){this._connectionState[t.id]!==e&&(this._connectionState[t.id]=e,this._onConnectionStateChanged.emit({remoteMember:t,state:e}))}getStats(t){return this._getStats(t)}_getStats(t){var e,i,n;const r=typeof t=="string"?t:t.id;return(n=(i=(e=this._getStatsCallbacks)[r])==null?void 0:i.call(e))!=null?n:[]}_getStatsAll(){return Promise.all(Object.entries(this._getStatsCallbacks).map(t=>B(this,[t],function*([e,i]){return{memberId:e,stats:yield i().catch(()=>[])}})))}getRTCPeerConnection(t){return this._getRTCPeerConnection(t)}_getRTCPeerConnection(t){var e;return(e=this._getTransport(t))==null?void 0:e.rtcPeerConnection}getConnectionState(t){return this._getConnectionState(t)}_getConnectionState(t){var e;const i=typeof t=="string"?t:t.id;return(e=this._connectionState[i])!=null?e:"new"}_getConnectionStateAll(){return Object.keys(this._getTransportCallbacks).map(t=>({memberId:t,connectionState:this._getConnectionState(t)}))}toJSON(){return{label:this._label,contentType:this.contentType,id:this.id,side:this.side}}},V1=new mt("packages/core/src/media/stream/local/media.ts"),Xu=class extends Ig{constructor(t,e,i={}){super(e),this.onTrackUpdated=new yt,this.onDestroyed=new yt,this._disposer=new ar,this._trackConstraints={},this._replacingTrack=!1,this._onReplacingTrackDone=new yt,this._onEnableChanged=new yt,this._track=t,this._listenTrackEvent(),this._options=i,this._trackConstraints=ne({},i)}get trackConstraints(){return this._trackConstraints}toJSON(){const t=super.toJSON();return we(ne({},t),{trackConstraints:this.trackConstraints,isEnabled:this.isEnabled,_options:this._options})}get track(){return this._track}attach(t){this._element=t,lg(t,this._track)}detach(){this._element&&(dg(this._element,this._track),this._element=void 0)}_disable(t){this._options.stopTrackWhenDisabled?(this._trackConstraints=ne(ne({},this.trackConstraints),this.track.getConstraints()),this.track.stop()):this._oldTrack=this.track;const e=t==="video"?Fg:z1;e.enabled=!1,this._onEnableChanged.emit(e),this._updateTrack(e)}_updateTrack(t){this._track=t,this._element&&this.attach(this._element),this.onTrackUpdated.emit(t),this._listenTrackEvent()}_listenTrackEvent(){const t=()=>{V1.info("onDestroyed",this.toJSON()),this.onDestroyed.emit()};this._track.addEventListener("ended",t),this._disposer.push(()=>this._track.removeEventListener("ended",t))}release(){this._disposer.dispose(),this._track.stop()}},Lg=new RTCPeerConnection,z1=Lg.addTransceiver("audio").receiver.track,Fg=Lg.addTransceiver("video").receiver.track,gd=new mt("packages/core/src/media/stream/local/audio.ts"),vd=class extends Xu{constructor(t,e={}){if(super(t,"audio",e),this.contentType="audio",this._isEnabled=!0,this._promiseQueue=new Vs,t.kind!=="audio")throw qe({operationName:"LocalAudioStream.constructor",path:gd.prefix,info:Qe.invalidTrackKind,payload:{track:t}})}setEnabled(t){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){if(this._isEnabled===!0&&t===!1)this._isEnabled=t,this._disable("audio"),gd.debug("stopped");else if(this._isEnabled===!1&&t===!0){if(this._isEnabled=t,this._options.stopTrackWhenDisabled){const e=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableMic();this._updateTrack(e),this._onEnableChanged.emit(e)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));gd.debug("resumed")}}))})}get isEnabled(){return this._isEnabled}enableMic(){return B(this,null,function*(){const[t]=(yield navigator.mediaDevices.getUserMedia({audio:this.trackConstraints})).getAudioTracks();return t})}enableDisplay(){return B(this,null,function*(){const[t]=(yield navigator.mediaDevices.getDisplayMedia({audio:this.trackConstraints})).getAudioTracks();return t})}};Q();var G1=new mt("packages/core/src/media/stream/local/customVideo.ts"),q1=class extends Xu{constructor(t={}){super(Fg,"video",t),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new Vs,this._stream=null}setStream(t){return B(this,null,function*(){if(this._stream)throw new Error("ProcessedStream is already exists");this._stream=t,this._updateTrack(t.track)})}setEnabled(t){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){var e;yield(e=this._stream)==null?void 0:e.setEnabled(t)}))})}updateTrack(t){return B(this,null,function*(){this._updateTrack(t),this._onEnableChanged.emit(t)})}get isEnabled(){return this._isEnabled}release(){var t;(t=this._stream)==null||t.dispose().catch(()=>{G1.error("release failed")})}};Q();var wc=new mt("packages/core/src/media/stream/local/video.ts"),_d=class extends Xu{constructor(t,e={}){if(super(t,"video",e),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new Vs,t.kind!=="video")throw qe({operationName:"LocalVideoStream.constructor",path:wc.prefix,info:Qe.invalidTrackKind,payload:{track:t}});wc.debug("LocalVideoStream spawned",this.toJSON())}setEnabled(t){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){if(this._isEnabled===!0&&t===!1)this._isEnabled=t,this._disable("video"),wc.debug("stopped",this.toJSON());else if(this._isEnabled===!1&&t===!0){if(this._isEnabled=t,this._options.stopTrackWhenDisabled){const e=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableCamera();this._updateTrack(e),this._onEnableChanged.emit(e)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));wc.debug("resumed",this.toJSON())}}))})}get isEnabled(){return this._isEnabled}enableCamera(){return B(this,null,function*(){const[t]=(yield navigator.mediaDevices.getUserMedia({video:this.trackConstraints})).getVideoTracks();return t})}enableDisplay(){return B(this,null,function*(){const[t]=(yield navigator.mediaDevices.getDisplayMedia({video:this.trackConstraints})).getVideoTracks();return t})}},W1=new mt("packages/core/src/media/stream/local/data.ts"),$u=class extends Ig{constructor(t={}){super("data"),this.options=t,this.contentType="data",this._onWriteData=new yt,this._isEnabled=!0,this._setLabel("LocalDataStream")}get isEnabled(){return this._isEnabled}setIsEnabled(t){this._isEnabled=t}write(t){if(!this._isEnabled)throw qe({operationName:"LocalDataStream.write",path:W1.prefix,info:Qe.disabledDataStream});!ArrayBuffer.isView(t)&&typeof t!="string"&&(t=yu+JSON.stringify(t)),this._onWriteData.emit(t)}},yu="skyway_object:";Q();function K1(t,{publisherId:e,stream:i,origin:n,metadata:r,codecCapabilities:s,encodings:o,contentType:c,id:h,isEnabled:l}){const p=t._getPublication(h);if(p)return p;c=c.toLowerCase();const g=n?t._getPublication(n):void 0;return g&&o.length===0&&(o=g.encodings),new kg({id:h,channel:t,publisher:t._getMember(e),contentType:c,metadata:r,origin:g,stream:i,codecCapabilities:s??[],encodings:o,isEnabled:l})}var Oi=new mt("packages/core/src/publication/index.ts"),kg=class{constructor(t){this._codecCapabilities=[],this._encodings=[],this._state="enabled",this._events=new Zr,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new yt,this._onEncodingsChanged=this._events.make(),this._onReplaceStream=this._events.make(),this._onEnabled=this._events.make(),this.streamEventDisposer=new ar,this.cancel=()=>new Promise((r,s)=>{let o=!1;this._channel._unpublish(this.id).catch(c=>{o=!0,s(c)}),this._setStream(void 0),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>r()).catch(c=>{o||s(c)})}),this.updateMetadata=r=>new Promise((s,o)=>B(this,null,function*(){const c=Oi.info("[start] updateMetadata",yield Qt({operationName:"Publication.updateMetadata",channel:this._channel}),this);let h=!1;this._channel._updatePublicationMetadata(this.id,r).catch(l=>{h=!0,o(l)}),this.onMetadataUpdated.watch(l=>l.metadata===r,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){s(),Oi.elapsed(c,"[end] updateMetadata",yield Qt({operationName:"Publication.updateMetadata",channel:this._channel}),this)})).catch(l=>{if(!h)throw qe({operationName:"PublicationImpl.updateMetadata",info:we(ne({},Qe.timeout),{detail:"publication onMetadataUpdated"}),path:Oi.prefix,context:this._context,channel:this._channel,error:l})})})),this.disable=()=>new Promise((r,s)=>B(this,null,function*(){const o=Oi.info("[start] disable",yield Qt({operationName:"Publication.disable",channel:this._channel}),this);yield this._disableStream();let c=!1;this._channel._disablePublication(this.id).catch(h=>{c=!0,s(h)}),this.onDisabled.asPromise(this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){r(),Oi.elapsed(o,"[end] disable",yield Qt({operationName:"Publication.disable",channel:this._channel}),this)})).catch(h=>{c||s(h)})})),this.enable=()=>new Promise((r,s)=>B(this,null,function*(){if(this.stream==null){s(qe({operationName:"Publication.enable",context:this._context,info:Qe.canNotEnableRemotePublication,path:Oi.prefix}));return}const o=Oi.info("[start] enable",yield Qt({operationName:"Publication.enable",channel:this._channel}),this);let c=!1;this._channel._enablePublication(this.id).catch(h=>{c=!0,s(h)}),this._onEnabled.asPromise(this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){yield this._enableStream(),this.onEnabled.emit(),this.onStateChanged.emit(),Oi.elapsed(o,"[end] enable",yield Qt({operationName:"Publication.enable",channel:this._channel}),this),r()})).catch(h=>{c||s(h)})}));var e,i,n;this.id=t.id,this._channel=t.channel,this._context=this._channel._context,this.publisher=t.publisher,this.contentType=t.contentType,this._metadata=t.metadata,this.origin=t.origin,this.setCodecCapabilities((e=t.codecCapabilities)!=null?e:[]),this.setEncodings(Su((i=t.encodings)!=null?i:[])),this._state=t.isEnabled?"enabled":"disabled",t.stream&&this._setStream(t.stream),this._analytics=(n=this._channel.localPerson)==null?void 0:n._analytics,Oi.debug("publication spawned",this.toJSON())}get codecCapabilities(){return this._codecCapabilities}setCodecCapabilities(t){this._codecCapabilities=t}get encodings(){return this._encodings}setEncodings(t){this._encodings=t}get stream(){return this._stream}_setStream(t){this._stream=t,t?t._onConnectionStateChanged.add(e=>{Oi.debug("onConnectionStateChanged",this.id,e),this.onConnectionStateChanged.emit(e)}).disposer(this.streamEventDisposer):this.streamEventDisposer.dispose()}get metadata(){return this._metadata}get state(){return this._state}get deviceName(){if(!(this.stream instanceof $u))return this.stream.track.label}get subscriptions(){return this._channel.subscriptions.filter(t=>t.publication.id===this.id)}_updateMetadata(t){this._metadata=t,this.onMetadataUpdated.emit({metadata:t})}_disable(){return B(this,null,function*(){yield this._disableStream(),this.onDisabled.emit(),this.onStateChanged.emit()})}_enable(){this.stream?this._onEnabled.emit():(this._state="enabled",this.onEnabled.emit(),this.onStateChanged.emit())}_unpublished(){this._state="canceled",this.stream&&this.stream._unpublished(),this.onCanceled.emit(),this.onStateChanged.emit(),this._dispose()}_subscribed(t){this.onSubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit()}_unsubscribed(t){this.onUnsubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit()}updateEncodings(t){Oi.info("updateEncodings",{encodings:t},this),this.setEncodings(Su(Ng(t))),this._onEncodingsChanged.emit(t),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:this.id,encodings:this.encodings,updatedAt:Date.now()})}_disableStream(){return B(this,null,function*(){this.state!=="disabled"&&(this._state="disabled",this.stream&&(this.stream.contentType==="data"?this.stream.setIsEnabled(!1):yield this.stream.setEnabled(!1).catch(t=>{Oi.warn(Wi({channel:this._channel,operationName:"Publication._disableStream",payload:t,detail:"setEnabled failed"}))}),Qt({operationName:"Publication._disableStream",channel:this._channel}).then(t=>Oi.info("publication _disableStream",t,{publication:this})).catch(()=>{})))})}_enableStream(){return B(this,null,function*(){this.state!=="enabled"&&(this._state="enabled",this.stream&&(Qt({operationName:"Publication._enableStream",channel:this._channel}).then(t=>Oi.info("publication _enableStream",t,{publication:this})).catch(()=>{}),this.stream.contentType==="data"?this.stream.setIsEnabled(!0):yield this.stream.setEnabled(!0).catch(t=>{Oi.warn(Wi({channel:this._channel,operationName:"Publication._disableStream",payload:t,detail:"setEnabled failed"}))})))})}replaceStream(t,e={}){var i;if(Oi.info("replaceStream",{stream:t,options:e},this),!this.stream)throw qe({operationName:"PublicationImpl.replaceStream",context:this._context,info:Qe.canNotUseReplaceStream,path:Oi.prefix});if(t.contentType!==this.contentType)throw qe({operationName:"PublicationImpl.replaceStream",context:this._context,info:Qe.invalidContentType,path:Oi.prefix});((i=e.releaseOldStream)==null||i)&&this.stream.release(),Qt({operationName:"PublicationImpl.replaceStream",channel:this._channel}).then(r=>Oi.debug(r,{old:this.stream,new:t})).catch(r=>r),t.setEnabled(this.stream.isEnabled).catch(r=>{Oi.error("replaceStream stream.setEnabled",r,this.toJSON())});const n=this._stream;this._setStream(t),this._onReplaceStream.emit({newStream:t,oldStream:n}),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendMediaDeviceReport({publicationId:this.id,mediaDeviceName:this.deviceName,mediaDeviceTrigger:"replaceStream",updatedAt:Date.now()})}getStats(t){if(!this.stream)throw qe({operationName:"PublicationImpl.getStats",context:this._context,info:Qe.streamNotExistInSubscription,path:Oi.prefix});return this.stream._getStats(t)}getRTCPeerConnection(t){if(!this.stream)throw qe({operationName:"PublicationImpl.getRTCPeerConnection",context:this._context,info:Qe.streamNotExistInSubscription,path:Oi.prefix});return this.stream._getRTCPeerConnection(t)}getConnectionState(t){if(!this.stream)throw qe({operationName:"PublicationImpl.getConnectionState",context:this._context,info:Qe.streamNotExistInSubscription,path:Oi.prefix});return this.stream._getConnectionState(t)}toJSON(){var t;return{id:this.id,channelId:this._channel.id,publisherId:this.publisher.id,origin:(t=this.origin)==null?void 0:t.id,contentType:this.contentType,metadata:this.metadata,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state,stream:this.stream}}_dispose(){this._events.dispose()}},Su=t=>t.map((e,i)=>{var n;return we(ne({},e),{id:(n=e.id)!=null?n:i.toString()})}),Ng=t=>{const[e]=t;return e.maxBitrate?t.sort((i,n)=>i.maxBitrate-n.maxBitrate):e.scaleResolutionDownBy?t.sort((i,n)=>n.scaleResolutionDownBy-i.scaleResolutionDownBy):e.maxFramerate?t.sort((i,n)=>i.maxFramerate-n.maxFramerate):t};Q();function X1(t){return t==null?!1:t.side==="remote"}Q();Q();var Xh=new mt("packages/core/src/dataPlane/agent/publishing.ts"),$1=class{constructor(t){this._localPerson=t,this.context=this._localPerson.context}startPublishing(t){return B(this,null,function*(){if(this.context.config.internal.disableDPlane){yield new Promise(r=>setTimeout(r,500));return}const e=t.publication,i=t.subscriber;e.stream||(yield this._localPerson.onStreamPublished.watch(r=>r.publication.id===e.id,this.context.config.rtcApi.timeout).catch(r=>{throw qe({operationName:"PublishingAgent.startPublishing",context:this.context,channel:this._localPerson.channel,info:we(ne({},Qe.timeout),{detail:"PublishingAgent onStreamPublished"}),path:Xh.prefix,payload:{publication:e},error:r})}));const n=i._getOrCreateConnection(this._localPerson);n.startPublishing&&(yield n.startPublishing(e,t.id))})}stopPublishing(t,e){return B(this,null,function*(){const i=e._getConnection(this._localPerson.id);i!=null&&i.stopPublishing&&i.stopPublishing(t).catch(n=>{Xh.error("stopPublishing failed",n)})})}};Q();var Z1=class{constructor(t){this._localPerson=t,this._disposers={},this._context=this._localPerson.context}startSubscribing(t){return B(this,null,function*(){if(this._context.config.internal.disableDPlane){yield new Promise(n=>setTimeout(n,500));return}const i=t.publication.publisher._getOrCreateConnection(this._localPerson);if(i.startSubscribing){yield i.startSubscribing(t);const{removeListener:n}=t._onChangeEncoding.add(()=>B(this,null,function*(){var r;yield(r=i.changePreferredEncoding)==null?void 0:r.call(i,t)}));this._disposers[t.id]=n}})}stopSubscribing(t){return B(this,null,function*(){var e,i;const r=t.publication.publisher._getConnection(this._localPerson.id);r!=null&&r.stopSubscribing&&(yield r.stopSubscribing(t),(i=(e=this._disposers)[t.id])==null||i.call(e))})}};Q();var $h=class{constructor(t){this._impl=t,this._events=new Zr,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberStateChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this.apply(t)}get keepaliveIntervalSec(){return this._impl.keepaliveIntervalSec}get keepaliveIntervalGapSec(){return this._impl.keepaliveIntervalGapSec}get disableSignaling(){return this._impl.disableSignaling}get disableAnalytics(){return this._impl.disableAnalytics}get type(){return this._impl.type}get subtype(){return this._impl.subtype}get side(){return this._impl.side}get id(){return this._impl.id}get name(){return this._impl.name}get channel(){return this._impl.channel}get metadata(){return this._impl.metadata}get state(){return this._impl.state}get publications(){return this._impl.publications}get subscriptions(){return this._impl.subscriptions}apply(t){this._impl=t,t.onLeft.pipe(this.onLeft),t.onMetadataUpdated.pipe(this.onMetadataUpdated),t.onStreamPublished.pipe(this.onStreamPublished),t.onStreamUnpublished.pipe(this.onStreamUnpublished),t.onPublicationListChanged.pipe(this.onPublicationListChanged),t.onPublicationSubscribed.pipe(this.onPublicationSubscribed),t.onPublicationUnsubscribed.pipe(this.onPublicationUnsubscribed),t.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged),t.onFatalError.pipe(this.onFatalError)}subscribe(t,e){return this._impl.subscribe(t,e)}unsubscribe(t){return this._impl.unsubscribe(t)}publish(t,e={}){return this._impl.publish(t,e)}unpublish(t){return this._impl.unpublish(t)}updateMetadata(t){return this._impl.updateMetadata(t)}leave(){return B(this,null,function*(){yield this._impl.leave()})}dispose(){this._impl.dispose()}};Q();Q();var Y1=24*60*60;Q();Q();Q();Q();var Sa=class{constructor(t,e){this.id=Yr(),this.type=t,this.payload=e}toJSON(){return{id:this.id,type:this.type,payload:this.payload}}};Q();function J1(t){return!(typeof t!="object"||t===null||Array.isArray(t))}function Q1(t){if(!t||typeof t!="object"||!t.statsRequest||typeof t.statsRequest!="object"||!t.statsRequest.intervalSec||typeof t.statsRequest.intervalSec!="number"||!t.statsRequest.types||!Array.isArray(t.statsRequest.types))return!1;for(const e of t.statsRequest.types){if(!e.type||typeof e.type!="string"||!e.properties||!J1(e.properties))return!1;for(const i of Object.keys(e.properties))if(!("normalization"in e.properties[i])||typeof e.properties[i].normalization!="boolean"||!e.properties[i].outputKey||typeof e.properties[i].outputKey!="string")return!1}return!0}var ex=["invalidPayload","unexpected"];function Zh(t){return!(!t||typeof t!="object"||typeof t.eventId!="string"||typeof t.ok!="boolean"||typeof t.reason<"u"&&(typeof t.reason!="string"||!ex.includes(t.reason)))}Q();var bd=qn(Nu());Q();var Ps=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=t=>{this._listeners.forEach(e=>e(t))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=t=>{const e=this._listenerIndex;return this._listeners.set(e,t),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(e)}}},this.addOneTimeListener=t=>{const e=this.addListener(i=>{e.removeListener(),t(i)});return e},this.asPromise=t=>new Promise((e,i)=>{let n=()=>{};const r=t&&setTimeout(()=>{i("Event asPromise timeout"),n()},t);n=this.addOneTimeListener(o=>{r&&clearTimeout(r),e(o)}).removeListener})}},tx=["Open","Acknowledge"],ix=t=>(Fs(2,t)+Math.random())*1e3,nx=class{constructor({channelId:t,channelName:e,memberId:i,memberName:n,sessionEndpoint:r,token:s,logger:o,sdkVersion:c}){this._isOpen=!1,this._isClosed=!1,this._reconnectCount=0,this.connectionState="connecting",this.onConnectionStateChanged=new Ps,this.onOpened=new Ps,this.onTokenExpired=new Ps,this.onEventReceived=new Ps,this.onConnectionFailed=new Ps,this._resendClientEvents=[],this._sessionEndpoint=r,this._channelId=t,this._channelName=e,this._memberId=i,this._memberName=n,this._token=s,this._logger=o,this._sdkVersion=c,this._connect()}_setConnectionState(t){this.connectionState!==t&&(this._logger.debug(`connectionState changed : ${t}`),this.connectionState=t,this.onConnectionStateChanged.emit(t))}_connect(){let t;try{const e=`SkyWayAuthToken!${this._token}`,i={channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,sdkPlatform:"js",sdkVersion:this._sdkVersion},n=Object.entries(i).filter(([s,o])=>o!==void 0).map(s=>s.join("=")).join("&"),r=`${this._sessionEndpoint}?${n}`;t=new bd.default(r,e),this._logger.debug(`Connecting to analytics-logging-server: ${this._sessionEndpoint}`),t.onerror=s=>{this._logger.error("WebSocket error occurred",s.error),t.close(4202)}}catch(e){const i=e instanceof Error?e:new Error;this._logger.error("Failed to create WebSocket instance",i),this.reconnect();return}t.onopen=()=>{this._logger.debug("Connected to analytics-logging-server")},t.onclose=e=>{const i="Close event fired: "+JSON.stringify({code:e.code,reason:e.reason,type:e.type});if(4100<=e.code&&e.code<=4199?this._logger.error(i,new Error):this._logger.debug(i),e.code!==1e3&&!(4e3<=e.code&&e.code<=4199)){e.code===4200?this.onTokenExpired.emit():this.reconnect();return}this._logger.debug("Closed the connection to analytics-logging-server"),this.onConnectionFailed.emit({code:e.code,reason:e.reason}),this.close()},t.onmessage=e=>{this._messageHandler(e.data)},this._ws=t}updateAuthToken(t){this._token=t}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=5)this.onConnectionFailed.emit({}),this.close(),this._logger.error("Failed to reconnect for five times",new Error);else{this._setConnectionState("reconnecting");const t=ix(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},t)}}close(){this._isClosed=!0,this.destroy()}destroy(){this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(t){return B(this,null,function*(){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==bd.default.OPEN){this._logger.debug("Try to reconnect because connection is lost"),this.resendAfterReconnect(t);return}const e=JSON.stringify(t.toJSON());this._ws.send(e,i=>{if(i){this._logger.debug(`Try to reconnect because failed to send: ${i.message}`),this.resendAfterReconnect(t);return}})})}resendAfterReconnect(t){this._resendClientEvents.some(i=>i.id===t.id)||this._resendClientEvents.push(t),this.connectionState!=="reconnecting"&&this.reconnect()}pushResendClientEventsQueue(t){this._resendClientEvents.push(t)}isClosed(){return this._isClosed}_messageHandler(t){if(typeof t!="string"){this._logger.error("Received invalid message: not string",new Error);return}let e;try{e=JSON.parse(t)}catch(i){const n=i instanceof Error?i:new Error;this._logger.error("Received invalid message: parse error",n);return}if(!rx(e)){this._logger.error(`Received invalid message: ${JSON.stringify(e)}`,new Error);return}if(e.type==="Open"){if(!Q1(e.payload)){this._logger.error(`Received invalid message: ${JSON.stringify(e.payload)}`,new Error);return}if(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this._resendClientEvents.length>0){for(const i of this._resendClientEvents){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==bd.default.OPEN){this._logger.error(`Failed to resend event because connection lost after reconnect: ${i}`,new Error);continue}const n=JSON.stringify(i.toJSON());this._ws.send(n,r=>{if(r){this._logger.error(`Failed to resend event: ${i}`,r);return}this._logger.debug(`Succeed to resend ClientEvent: ${i}`)})}this._logger.debug("Process of resending ClientEvents is completed"),this._resendClientEvents=[]}this.onOpened.emit(e.payload)}else this._logger.debug(`Received the event: ${e.type}, payload: ${JSON.stringify(e.payload)}`),this.onEventReceived.emit(e)}};function rx(t){return!(!t||typeof t!="object"||typeof t.type!="string"||!tx.includes(t.type)||typeof t.id!="string"||t.payload&&typeof t.payload!="object")}Q();var sx=class{constructor(t={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,t)}wait(){return B(this,null,function*(){if(this.exceeded)return!1;const t=this.timeout;return this.count++,yield new Promise(e=>setTimeout(e,t)),!0})}get timeout(){return Fs(this.count,2)*this.interval+Fs(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}stop(){this.count=this.times}},Yh="analytics-logging.skyway.ntt.com",ax="v1",ox=5,cx=class{constructor({token:t,channelId:e,channelName:i,memberId:n,memberName:r,sdkVersion:s},o){this.onConnectionStateChanged=new Ps,this.onConnectionFailed=new Ps,this.onAnalyticsNotEnabledError=new Ps,this._isClosed=!1,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._mediaDeviceVersion=new Map,this._encodingsVersion=new Map,this._preferredEncodingVersion=new Map,this._previousSubscriptionStats=new Map,this._statsRequest={intervalSec:5,types:[]},this._token=t,this._newToken=void 0,this._channelId=e,this._channelName=i,this._memberId=n,this._memberName=r,this._sdkVersion=s;const c={analyticsLoggingServerDomain:Yh,secure:!0,logger:{debug:(h,...l)=>{console.debug(h,...l)},warn:(h,...l)=>{console.warn(h,...l)},error:h=>{console.error(h)}}};this._options=Object.assign({},c,o??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var t,e;return(e=(t=this._socket)==null?void 0:t.connectionState)!=null?e:"closed"}connect(){return B(this,null,function*(){const t=this._options.secure?"wss":"ws",e=this._options.analyticsLoggingServerDomain||Yh;this._socket=new nx({sessionEndpoint:`${t}://${e}/${ax}/client/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger,sdkVersion:this._sdkVersion}),this._socket.onEventReceived.addListener(n=>{try{this._eventReceivedHandler(n)}catch(r){this._logger.error("in _eventReceivedHandler",r)}}),this._socket.onConnectionFailed.addListener(n=>{n.code===4e3&&this.onAnalyticsNotEnabledError.emit(n),this.onConnectionFailed.emit(),this._cleanupAnalyticsClientMaps()}),this._socket.onConnectionStateChanged.addListener(n=>{var r;n==="closed"&&!this.isClosed()&&((r=this._socket)!=null&&r.isClosed())&&(this._isClosed=!0,this.dispose()),this.onConnectionStateChanged.emit(n)}),this._socket.onTokenExpired.addListener(()=>{this._reconnectWithNewSkyWayAuthToken()});const i=yield this._socket.onOpened.asPromise();if(i!==void 0){this._statsRequest=i.statsRequest;return}else{this._logger.error("First time connection payload is undefined",new Error),this.onConnectionFailed.emit();return}})}dispose(){this._disconnect(),this._cleanupAnalyticsClientMaps()}setNewSkyWayAuthToken(t){this._socket!==void 0&&(this._newToken=t,this._logger.debug("setNewSkyWayAuthToken is success"))}cleanupOnUnpublished(t){this._mediaDeviceVersion.delete(t),this._encodingsVersion.delete(t)}cleanupOnUnsubscribed(t){this._preferredEncodingVersion.delete(t),this._previousSubscriptionStats.delete(t)}_disconnect(){var t;(t=this._socket)==null||t.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}sendMediaDeviceReport(t){return B(this,null,function*(){let e=this._mediaDeviceVersion.get(t.publicationId);e===void 0?e=0:e++,this._mediaDeviceVersion.set(t.publicationId,e);const i={publicationId:t.publicationId,mediaDeviceName:t.mediaDeviceName,mediaDeviceVersion:e,mediaDeviceTrigger:t.mediaDeviceTrigger,updatedAt:t.updatedAt},n=new Sa("MediaDeviceReport",i);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendMediaDeviceReport is failed",r)})})}sendBindingRtcPeerConnectionToSubscription(t){return B(this,null,function*(){const e=new Sa("BindingRtcPeerConnectionToSubscription",t);yield this._sendClientEvent(e).catch(i=>{this._logger.warn("_sendClientEvent in sendBindingRtcPeerConnectionToSubscription is failed",i)})})}filterStatsReport(t){const e=Array.from(t.values()).find(s=>s.type==="transport"&&s.dtlsState==="connected"),i=[];if(e){const s=Array.from(t.values()).find(o=>o.type==="candidate-pair"&&o.nominated&&o.id===(e==null?void 0:e.selectedCandidatePairId));s&&i.push(s.id,s.localCandidateId,s.remoteCandidateId,s.transportId)}else{const s=Array.from(t.values()).find(o=>o.type==="candidate-pair"&&o.nominated&&o.selected);s&&i.push(s.id,s.localCandidateId,s.remoteCandidateId,s.transportId)}const n=new Map,r=["candidate-pair","local-candidate","remote-candidate","transport"];for(const[s,o]of t.entries())r.includes(o.type)?i.includes(o.id)&&n.set(s,o):n.set(s,o);return n}bundleStatsReportByStatsType(t){const e={};for(const i of t.values())e[i.type]=i;return e}sendSubscriptionStatsReport(t,e){return B(this,null,function*(){var i;const n=this._previousSubscriptionStats.get(e.subscriptionId);if(this._previousSubscriptionStats.set(e.subscriptionId,{stats:t,createdAt:e.createdAt}),n===void 0)return;const r=this.filterStatsReport(n.stats),s=this.bundleStatsReportByStatsType(r),o=n.createdAt,c=(e.createdAt-o)/1e3;if(c<=0)throw new Error("duration must be greater than 0. also sendSubscriptionStatsReport was duplicated.");const h=this.filterStatsReport(t),l=this.bundleStatsReportByStatsType(h),p={};for(const{type:y,properties:x}of this._statsRequest.types)for(const[S,{normalization:v,outputKey:m,contentType:w}]of Object.entries(x)){if(!w.includes(e.contentType))continue;const b=l[y];if(!(b===void 0||b[S]===void 0))if(v){const C=(i=s[y])==null?void 0:i[S];if(C===void 0){this._logger.warn(`${y} in previous statsReport is undefined`);continue}const A=(Number(b[S])-Number(C))/c;p[y]=we(ne({},p[y]),{[m]:String(A)})}else p[y]=we(ne({},p[y]),{[m]:String(b[S])})}const g={subscriptionId:e.subscriptionId,stats:p,role:e.role,createdAt:e.createdAt},f=new Sa("SubscriptionStatsReport",g);yield this._sendClientEvent(f).catch(y=>{this._logger.warn("_sendClientEvent in sendSubscriptionStatsReport is failed",y)})})}sendRtcPeerConnectionEventReport(t){return B(this,null,function*(){const e=new Sa("RtcPeerConnectionEventReport",t);yield this._sendClientEvent(e).catch(i=>{this._logger.warn("_sendClientEvent in sendRtcPeerConnectionEventReport is failed",i)})})}sendPublicationUpdateEncodingsReport(t){return B(this,null,function*(){let e=this._encodingsVersion.get(t.publicationId);e===void 0?e=0:e++,this._encodingsVersion.set(t.publicationId,e);const i={publicationId:t.publicationId,encodings:t.encodings,encodingsVersion:e,updatedAt:t.updatedAt},n=new Sa("PublicationUpdateEncodingsReport",i);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendPublicationUpdateEncodingsReport is failed",r)})})}sendSubscriptionUpdatePreferredEncodingReport(t){return B(this,null,function*(){let e=this._preferredEncodingVersion.get(t.subscriptionId);e===void 0?e=0:e++,this._preferredEncodingVersion.set(t.subscriptionId,e);const i={subscriptionId:t.subscriptionId,preferredEncodingIndex:t.preferredEncodingIndex,preferredEncodingVersion:e,updatedAt:t.updatedAt},n=new Sa("SubscriptionUpdatePreferredEncodingReport",i);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendSubscriptionUpdatePreferredEncodingReport is failed",r)})})}_sendClientEvent(t){return B(this,null,function*(){return new Promise((e,i)=>B(this,null,function*(){if(this._socket===void 0||this._socket.connectionState==="closed"){i(new Error("websocket is not connected"));return}if(this._socket.connectionState==="connecting"){this._socket.pushResendClientEventsQueue(t),this._setAcknowledgeCallback(t.id,r=>B(this,null,function*(){r.ok?(this._acknowledgeCallbacks.delete(t.id),e()):(this._acknowledgeCallbacks.delete(t.id),i(r))})),this._logger.debug(`pushResendClientEventsQueue and setAcknowledgeCallback. clientEvent.id: ${t.id}`),i(new Error("websocket is connecting now"));return}const n=new sx({times:6,interval:500,jitter:100});for(;!n.exceeded;){const r=setTimeout(()=>B(this,null,function*(){if(this._socket===void 0){this._acknowledgeCallbacks.delete(t.id),i(new Error("Socket closed when trying to resend"));return}else this._socket.resendAfterReconnect(t);i(new Error("Timeout to send data"))}),ox*1e3);this._logger.debug(`send clientEvent, ${JSON.stringify(t)}`),this._socket.send(t).catch(o=>{this._acknowledgeCallbacks.delete(t.id),clearTimeout(r),i(o)});const s=yield this._waitForAcknowledge(t.id).catch(o=>o);if(clearTimeout(r),Zh(s))if(s.reason==="unexpected")yield n.wait();else{i(s);return}else{e();return}}i(new Error("unexpected has occurred at server"))}))})}_waitForAcknowledge(t){return B(this,null,function*(){return new Promise((e,i)=>{this._setAcknowledgeCallback(t,n=>B(this,null,function*(){n.ok?(this._acknowledgeCallbacks.delete(t),e()):(this._acknowledgeCallbacks.delete(t),i(n))}))})})}_reconnectWithNewSkyWayAuthToken(){return B(this,null,function*(){this._disconnect(),this._newToken!==void 0?(this._token=this._newToken,this._newToken=void 0,yield this.connect()):this._logger.warn("new token is not set. so not reconnect.")})}_eventReceivedHandler(t){switch(t.type){case"Acknowledge":this._acknowledgeHandler(t.payload);break;case"Open":break;default:t.type,this._logger.warn(`Unknown event: ${t.type}`)}}_acknowledgeHandler(t){if(!Zh(t))throw new Error("Invalid payload");const{eventId:e}=t;if(!this._acknowledgeCallbacks.has(e))throw new Error(`acknowledge event has unknown eventId: ${e}`);const i=this._acknowledgeCallbacks.get(e);i&&(this._acknowledgeCallbacks.delete(e),i(t))}_setAcknowledgeCallback(t,e){this._acknowledgeCallbacks.set(t,e)}_cleanupAnalyticsClientMaps(){this._mediaDeviceVersion.clear(),this._encodingsVersion.clear(),this._preferredEncodingVersion.clear(),this._previousSubscriptionStats.clear()}getIntervalSec(){return this._statsRequest.intervalSec}isConnectionEstablished(){return!(!this._socket||this._socket.connectionState==="connecting"||this._socket.connectionState==="closed")}isClosed(){return this._isClosed}};Q();Q();Q();Q();Q();Q();Q();var lx="rtc-api.skyway.ntt.com",Ks=2e4,dx=8;Q();var bn={timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},connectionDisconnected:{name:"connectionDisconnected",detail:"",solution:""},websocketConnectionFailure:{name:"connectionFailure",detail:"サーバへの接続に失敗しました",solution:"ネットワーク接続状況を確認してください"},rpcResponseError:{name:"rpcResponseError",detail:"",solution:"",error:{}},onClosedWhileRequesting:{name:"onClosedWhileRequesting",detail:"request中にクライアントが終了されました",solution:"リクエストの完了を確認してからクライアントを終了させてください"},failedToConnectRtcAPI:{name:"failedToConnectRtcAPI",detail:"rtc-api serverへの接続に失敗しました",solution:"インターネット接続状況とTokenの内容が正しいかを確かめてください"},failedToUpdateMemberTTL:{name:"failedToUpdateMemberTTL",detail:"updateMemberTTLを再試行しましたが、失敗しました",solution:"インターネット接続状況を確認してください"}};Q();var ux=qn(Nu());Q();function Bn({operationName:t,info:e,error:i,path:n,payload:r,channelId:s,appId:o,memberId:c}){return new rr({error:i,info:e,payload:{payload:r,operationName:t,channelId:s,appId:o,memberId:c},path:n})}function Tr({appId:t,detail:e,channelId:i,operationName:n,payload:r,memberId:s}){return{operationName:n,payload:r,detail:e,appId:t,channelId:i,memberId:s}}var Gi=new mt("packages/rtc-rpc-api-client/src/rpc.ts"),hx=class{constructor(){this._id=Yr(),this.closed=!1,this.negotiated=!1,this._reconnecting=!1,this._pendingRequests=[],this._events=new Zr,this._onMessage=this._events.make(),this.onNotify=this._events.make(),this.onFatalError=this._events.make(),this.onDisconnected=this._events.make(),this.onClosed=this._events.make(),this._send=t=>new Promise((e,i)=>B(this,null,function*(){if(yield new Promise(n=>setTimeout(n,0)),this._ws.readyState!==this._ws.OPEN){i(Bn({operationName:"RPC._send",info:we(ne({},bn.internalError),{detail:"wrong state"}),path:Gi.prefix,payload:{request:t,wsReadyState:Jh[this._ws.readyState]}}));return}this._ws.send(JSON.stringify(t),n=>{if(n)throw i(Bn({operationName:"RPC._send",info:we(ne({},bn.internalError),{detail:"failed to send rpc message"}),path:Gi.prefix,error:n}))}),e()}))}set reconnecting(t){this._reconnecting=t}get reconnecting(){return this._reconnecting}connect(t){return B(this,arguments,function*({domain:e,token:i,secure:n}){const r=i;this._ws=new ux.default(`${n?"wss":"ws"}://${e}/ws`,r),this._ws.onmessage=o=>{this._onMessage.emit(JSON.parse(o.data))},this._ws.onclose=()=>B(this,null,function*(){Gi.debug("websocket closed",{id:this._id}),this.onDisconnected.emit()}),this._onMessage.add(o=>{px(o)&&this.onNotify.emit(o)});const s=yield new Promise((o,c)=>{const h=setTimeout(()=>{c(Bn({operationName:"RPC.connect",info:we(ne({},bn.timeout),{detail:"ws.open"}),path:Gi.prefix}))},5e3);this._ws.onerror=l=>{c(Bn({operationName:"RPC.connect",info:bn.websocketConnectionFailure,path:Gi.prefix,error:l}))},this._ws.onopen=()=>{clearTimeout(h),o()}}).catch(o=>o);if(s)throw s;this.negotiated=!0})}close(){this.closed||(this.closed=!0,Gi.debug("closed"),this._ws.close(),this.onClosed.emit(),this._events.dispose())}resolvePendingRequests(){Gi.debug("resolve pendingRequests",[...this._pendingRequests]),this._pendingRequests.forEach(t=>B(this,null,function*(){yield this._send(t)})),this._pendingRequests=[]}request(t,e){return B(this,null,function*(){if(this.closed)throw Bn({operationName:"RPC.request",info:we(ne({},bn.internalError),{detail:"rpc closed"}),path:Gi.prefix,payload:{method:t,params:e,id:this._id}});let i=!1;try{const n=yd(t,e),r=()=>B(this,null,function*(){return yield this._onMessage.watch(c=>c.id===n.id,Ks).catch(()=>{if(!i)throw Bn({operationName:"RPC.request",info:we(ne({},bn.timeout),{detail:"rpc request timeout"}),path:Gi.prefix,payload:{rpcTimeout:Ks,method:t,params:e,wsReadyState:Jh[this._ws.readyState],id:this._id}})})}),s=()=>B(this,null,function*(){Gi.warn("[start] reconnecting. pending request",Tr({operationName:"RPC.request",detail:"[start] reconnecting. pending request",payload:{request:n,id:this._id}})),this._pendingRequests.push(n);const c=yield Promise.race([r(),this.onFatalError.asPromise(Ks+100).then(h=>{throw i||Gi.error("[failed] reconnecting. pending request",Bn({operationName:"RPC.request",info:we(ne({},bn.internalError),{detail:"onFatalError while request"}),path:Gi.prefix}),h),h})]);return i=!0,Gi.warn("[end] reconnecting. pending request",Tr({operationName:"RPC.request",detail:"[end] reconnecting. pending request",payload:{request:n,id:this._id}})),c});let o;if(this._reconnecting?o=yield s():(this._send(n).catch(c=>{Gi.error("send error",c)}),o=yield Promise.race([r(),B(this,null,function*(){if(yield this.onDisconnected.asPromise(Ks+100),i)return{};try{const c=yield s();return Gi.warn(Tr({operationName:"request.pendingRequest",detail:"success to handle disconnected"})),c}catch(c){throw Bn({operationName:"RPC.request",info:bn.connectionDisconnected,path:Gi.prefix,error:c})}}),this.onFatalError.asPromise(Ks+100).then(c=>{if(i)return{};throw Bn({operationName:"RPC.request",info:we(ne({},bn.internalError),{detail:"onFatalError while requesting"}),path:Gi.prefix,error:c})}),this.onClosed.asPromise(Ks+100).then(()=>{if(i)return{};throw Bn({operationName:"RPC.request",info:bn.onClosedWhileRequesting,path:Gi.prefix,payload:{method:t,params:e}})})]),i=!0),o.error)throw Gi.warn("[failed] request ",{message:o,method:t,params:e}),Bn({operationName:"RPC.request",info:we(ne({},bn.rpcResponseError),{detail:t,error:o.error}),payload:{message:o,method:t,params:e},path:Gi.prefix});return o.result}catch(n){throw i=!0,n}})}notify(t,e){return B(this,null,function*(){const i=yd(t,e,!0);yield this._send(i)})}batch(t){return B(this,null,function*(){const e=t.map(({method:n,params:r})=>yd(n,r));return this._send(e).catch(n=>{throw n}),yield Promise.all(e.map(n=>B(this,[n],function*({id:r}){return yield this._onMessage.watch(o=>o.id===r,Ks)})))})}},yd=(t,e,i)=>{if(i)return{jsonrpc:"2.0",method:t,params:e};const n=Yr();return{jsonrpc:"2.0",method:t,params:e,id:n}},px=t=>{const e=t;return!!(e.method&&e.id==null)},Jh=["CONNECTING","OPEN","CLOSING","CLOSED"],ji=new mt("packages/rtc-rpc-api-client/src/client.ts"),Qh,ep,fx=class{constructor(t){this.config=t,this.closed=!1,this._domain=(Qh=this.config.domain)!=null?Qh:lx,this._secure=(ep=this.config.secure)!=null?ep:!0,this._token=this.config.token,this._rpc=new hx,this._subscribingChannelEvents=new Set,this._subscribingChannelVersions={},this._httpClient=new qu(`http${this.config.secure?"s":""}://${this.config.domain}`),this._reconnectCount=0,this._reconnectLimit=dx,this._events=new Zr,this.onEvent=this._events.make(),this.onFatalError=this._events.make(),this.onClose=this._events.make(),this.onReconnected=this._events.make();var e,i,n,r;mt.level=(i=(e=t.log)==null?void 0:e.level)!=null?i:mt.level,mt.format=(r=(n=t.log)==null?void 0:n.format)!=null?r:mt.format,ji.debug("RtcRpcApiClient spawned",t),this._rpc.onNotify.add(s=>{if(s.method==="channelEventNotification"){const o=s.params;this._subscribingChannelVersions[o.data.channel.id]=o.data.channel.version,this.onEvent.emit({channelId:o.data.channel.id,event:o})}}),this._rpc.onDisconnected.add(()=>B(this,null,function*(){this._rpc.negotiated&&!this._rpc.closed&&!this._rpc.reconnecting&&(yield this._reconnect())})),this._rpc.onFatalError.once(s=>{ji.error("fatal error",s),this.onFatalError.emit(s),this.close()})}get token(){return this._token}_reconnect(){return B(this,null,function*(){if(this._reconnectCount>=this._reconnectLimit){this._rpc.onFatalError.emit(Bn({operationName:"RtcRpcApiClient._reconnect",info:{name:"failed to reconnect",detail:"_reconnectLimit exceeded",solution:""},path:ji.prefix})),this.close();return}this._rpc.reconnecting=!0,ji.warn("[start] reconnect",Tr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect start",payload:{reconnectCount:this._reconnectCount,limit:this._reconnectLimit}})),this._reconnectCount++;const t=Fs(this._reconnectCount,2)*100+Fs(this._reconnectCount,2)*100*Math.random();yield new Promise(e=>setTimeout(e,t));try{yield this.connect().catch(e=>{throw ji.warn("[failed] reconnect rtc api",Tr({operationName:"RtcRpcApiClient._reconnect",detail:"connect rpc failed",payload:{reconnectCount:this._reconnectCount}}),e),e}),this._rpc.reconnecting=!1,this._reconnectCount=0,this._rpc.resolvePendingRequests(),yield Promise.all([...this._subscribingChannelEvents].map(e=>B(this,null,function*(){const[i,n]=e.split(":"),r=this._subscribingChannelVersions[n];yield this.subscribeChannelEvents({appId:i,channelId:n,offset:r})}))).catch(e=>{throw ji.warn("subscribeChannelEvents failed",Tr({operationName:"RtcRpcApiClient._reconnect",detail:"subscribeChannelEvents failed",payload:{reconnectCount:this._reconnectCount}}),e),e}),ji.warn("[end] reconnect",Tr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect finished",payload:{reconnectCount:this._reconnectCount}})),this.onReconnected.emit()}catch(e){ji.warn("[failed] reconnect",Tr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect failed",payload:{reconnectCount:this._reconnectCount}}),e),yield this._reconnect()}})}updateToken(t){return B(this,null,function*(){ji.debug("token update",{token:t}),this._token=t,yield this._updateAuthToken()})}close(){this.closed||(this.closed=!0,ji.debug("closed"),this._rpc.close(),this.onClose.emit(),this._events.dispose())}health(){return B(this,null,function*(){return yield this._httpClient.get("/health")})}connect(){return B(this,null,function*(){ji.debug("connect to rtc api rpc",this._domain),yield this._rpc.connect({domain:this._domain,token:this.token,secure:this._secure}).catch(t=>{throw Bn({operationName:"RtcRpcApiClient.connect",info:bn.failedToConnectRtcAPI,error:t,path:ji.prefix})})})}_channelSubscribed(t,e){this._subscribingChannelEvents.add(t+":"+e),ji.debug("_channelSubscribed",{appId:t,channelId:e,_subscribingChannelEvents:[...this._subscribingChannelEvents]})}_isSubscribingChannel(t,e){return this._subscribingChannelEvents.has(t+":"+e)}createChannel(t){return B(this,arguments,function*({name:e,metadata:i,appId:n}){const{channel:r}=yield this._rpc.request("createChannel",{name:e,metadata:i,appId:n,authToken:this.token});return this._channelSubscribed(n,r.id),r})}findOrCreateChannel(t){return B(this,arguments,function*({name:e,metadata:i,appId:n}){const{channel:r}=yield this._rpc.request("findOrCreateChannel",{name:e,metadata:i,appId:n,authToken:this.token});return this._channelSubscribed(n,r.id),r})}getChannel(t){return B(this,arguments,function*({appId:e,id:i}){const n=yield this._rpc.request("getChannel",{id:i,appId:e,authToken:this.token});return this._isSubscribingChannel(e,i)||(this._channelSubscribed(e,i),yield this.subscribeChannelEvents({appId:e,channelId:i,offset:n.channel.version})),n.channel})}getChannelByName(t){return B(this,arguments,function*({name:e,appId:i}){const n=yield this._rpc.request("getChannelByName",{name:e,appId:i,authToken:this.token}),r=n.channel.id;return this._isSubscribingChannel(i,r)||(this._channelSubscribed(i,r),yield this.subscribeChannelEvents({appId:i,channelId:r,offset:n.channel.version})),n.channel})}deleteChannel(t){return B(this,arguments,function*({id:e,appId:i}){yield this._rpc.request("deleteChannel",{id:e,appId:i,authToken:this.token})})}updateChannelMetadata(t){return B(this,arguments,function*({id:e,metadata:i,appId:n}){yield this._rpc.request("updateChannelMetadata",{id:e,metadata:i,appId:n,authToken:this.token})})}addMember(t){return B(this,arguments,function*({channelId:e,name:i,metadata:n,subscribeChannelEvents:r,appId:s,ttlSec:o,subtype:c,type:h}){return yield this._rpc.request("addMember",{channelId:e,name:i,metadata:n,subscribeChannelEvents:r,appId:s,ttlSec:o&&parseInt(o.toString()),authToken:this.token,subtype:c,type:h})})}updateMemberTtl(t){return B(this,arguments,function*(e,i=new Pr({times:8})){const{appId:n,channelId:r,memberId:s,ttlSec:o}=e;try{yield this._rpc.request("updateMemberTtl",{appId:n,channelId:r,memberId:s,ttlSec:o&&parseInt(o.toString()),authToken:this.token})}catch(c){if(!i.exceeded)ji.warn("retry updateMemberTtl",Tr({operationName:"RtcRpcApiClient.updateMemberTtl",detail:"retry updateMemberTtl",appId:n,channelId:r,memberId:s,payload:{backoff:i.count}}),c),yield i.wait(),yield this.updateMemberTtl(e,i);else throw new rr({path:ji.prefix,info:bn.failedToUpdateMemberTTL,error:c})}})}updateMemberMetadata(t){return B(this,arguments,function*({channelId:e,memberId:i,metadata:n,appId:r}){yield this._rpc.request("updateMemberMetadata",{channelId:e,memberId:i,metadata:n,appId:r,authToken:this.token})})}leaveChannel(t){return B(this,arguments,function*({channelId:e,id:i,appId:n}){yield this._rpc.request("removeMember",{channelId:e,id:i,appId:n,authToken:this.token})})}publishStream(t){return B(this,arguments,function*({appId:e,channelId:i,publisherId:n,contentType:r,metadata:s,origin:o,codecCapabilities:c,encodings:h,isEnabled:l}){return{publicationId:(yield this._rpc.request("publishStream",{channelId:i,publisherId:n,contentType:r[0].toUpperCase()+r.slice(1),metadata:s,origin:o,codecCapabilities:c,encodings:h==null?void 0:h.map(g=>({id:g.id})),isEnabled:l,appId:e,authToken:this.token})).id}})}disablePublication(t){return B(this,arguments,function*({channelId:e,publicationId:i,appId:n}){yield this._rpc.request("disablePublication",{channelId:e,appId:n,publicationId:i,authToken:this.token})})}enablePublication(t){return B(this,arguments,function*({channelId:e,publicationId:i,appId:n}){yield this._rpc.request("enablePublication",{channelId:e,appId:n,publicationId:i,authToken:this.token})})}updatePublicationMetadata(t){return B(this,arguments,function*({channelId:e,publicationId:i,appId:n,metadata:r}){yield this._rpc.request("updatePublicationMetadata",{channelId:e,publicationId:i,metadata:r,appId:n,authToken:this.token})})}unpublishStream(t){return B(this,arguments,function*({channelId:e,publicationId:i,appId:n}){yield this._rpc.request("unpublishStream",{channelId:e,publicationId:i,appId:n,authToken:this.token})})}subscribeStream(t){return B(this,arguments,function*({channelId:e,subscriberId:i,publicationId:n,appId:r}){return{subscriptionId:(yield this._rpc.request("subscribeStream",{channelId:e,subscriberId:i,publicationId:n,appId:r,authToken:this.token})).id}})}unsubscribeStream(t){return B(this,arguments,function*({channelId:e,subscriptionId:i,appId:n}){yield this._rpc.request("unsubscribeStream",{channelId:e,subscriptionId:i,appId:n,authToken:this.token})})}getServerUnixtime(t){return B(this,arguments,function*(e,i=new Pr({times:8})){const{appId:n}=e;try{return(yield this._rpc.request("getServerUnixtime",{appId:n,authToken:this.token})).unixtime}catch(r){if(i.exceeded)throw r;return ji.warn(Tr({operationName:"RtcRpcApiClient.getServerUnixtime",detail:"retry getServerUnixtime",appId:n,payload:{backoff:i.count}}),r),yield i.wait(),this.getServerUnixtime(e,i)}})}_updateAuthToken(){return B(this,null,function*(){yield this._rpc.request("updateAuthToken",{authToken:this.token})})}subscribeChannelEvents(t){return B(this,arguments,function*({appId:e,channelId:i,offset:n}){try{ji.debug("[start] subscribeChannelEvents",{offset:n}),yield this._rpc.request("subscribeChannelEvents",{appId:e,authToken:this.token,channelId:i,offset:n}),ji.debug("[end] subscribeChannelEvents",{offset:n})}catch(r){if(r instanceof rr&&r.info.name===bn.connectionDisconnected.name)ji.warn("reconnect happened while subscribeChannelEvents. retry",Tr({operationName:"RtcRpcApiClient.subscribeChannelEvents",detail:"reconnect happened while subscribeChannelEvents. retry",appId:e,channelId:i,payload:{offset:n}}),r),yield this.subscribeChannelEvents({appId:e,channelId:i,offset:n});else throw ji.error("[failed] subscribeChannelEvents",Bn({operationName:"RtcRpcApiClient.subscribeChannelEvents",info:we(ne({},bn.internalError),{detail:"subscribeChannelEvents failed"}),path:ji.prefix,error:r,payload:{offset:n},appId:e,channelId:i})),r}})}};Q();Q();var mx=qn(qf()),gx=class{constructor(t={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.log={level:"error",format:"object"},Object.assign(this,(0,mx.default)(this,t))}};Q();Q();var Rt=we(ne({},bn),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストのパラメーターが正しくありません",solution:"API仕様を確認し正しい値を入力してください"},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています Token permissions are insufficient",solution:"Tokenに必要な権限を加えてください Add the necessary permissions to the Token"},publicationNestedTooMuch:{name:"publicationNestedTooMuch",detail:"originが設定されているPublicationをPublicationのoriginに指定することは出来ません It is not possible to specify the origin of a publication for which Origin has been set",solution:"仕様上の制約なので解決法はありません There is no solution because it is a specification limitation"},channelNotFound:{name:"channelNotFound",detail:"参照しようとしたchannelは存在しません The channel you tried to reference does not exist.",solution:"channelIdやchannelNameが正しいか確かめてください Make sure that the Channel id and channel name are correct."},memberNotFound:{name:"memberNotFound",detail:"参照しようとしたMemberは存在しません The member you tried to reference does not exist.",solution:"memberIdやmemberNameが正しいか確かめてください Make sure that the member id and member name is correct."},publicationNotFound:{name:"publicationNotFound",detail:"参照しようとしたPublicationは存在しません The Publication you tried to reference does not exist.",solution:"publicationIdが正しいか確かめてください Make sure that the publication id is correct."},subscriptionNotFound:{name:"subscriptionNotFound",detail:"参照しようとしたSubscriptionは存在しません The Subscription you tried to reference does not exist.",solution:"subscriptionIdが正しいか確かめてください Make sure that the subscription id is correct."},operationConflicted:{name:"operationConflicted",detail:"与えられた名前のチャネルは、今までの競合する要求によって、すでに作成されています The channel with the given name has already been created by a conflicting request up to now",solution:"別の名前を使ってchannelを作成してください"},channelNameDuplicated:{name:"channelNameDuplicated",detail:"その名前のChannelはすでに存在します A channel with that name already exists",solution:"別の名前を使ってchannelを作成してください"},memberNameDuplicated:{name:"memberNameDuplicated",detail:"その名前のMemberはすでに存在します A member with that name already exists",solution:"別の名前を使ってmemberを作成してください"},subscriptionAlreadyExists:{name:"subscriptionAlreadyExists",detail:"PublicationはすでにSubscribeされています",solution:"publicationIdが正しいか確かめてください"},rateLimitExceeded:{name:"rateLimitExceeded",detail:"リソースを規定仕様以上に消費しています",solution:"リソースの消費量を減らしてください"},authTokenExpired:{name:"authTokenExpired",detail:"AuthTokenが期限切れです",solution:"適切なExpを設定したAuthTokenを使用してください"},serverBusy:{name:"serverBusy",detail:"サービス側の問題です",solution:"しばらく時間を置いて再試行してください"}});Q();function tp({appId:t,detail:e,channelId:i,operationName:n,payload:r}){return{operationName:n,payload:r,detail:e,appId:t,channelId:i}}function Pt({operationName:t,info:e,error:i,path:n,channelId:r,appId:s,payload:o}){return new rr({error:i,info:e,payload:{payload:o,operationName:t,channelId:r,appId:s},path:n})}var Zt=new mt("packages/rtc-api-client/src/infrastructure/api.ts"),vx=class{constructor(t){this._client=t,this.closed=!1,this.onClose=new yt,this.onFatalError=new yt,this._token=io.Decode(this._client.token),t.onClose.once(()=>{this.close()}),t.onFatalError.add(e=>{this.onFatalError.emit(e)})}connect(){return B(this,null,function*(){yield this._client.connect()})}updateAuthToken(t){return B(this,null,function*(){this._token=io.Decode(t),yield this._client.updateToken(t)})}close(){this.closed||(this.closed=!0,Zt.debug("closed"),this._client.close(),this.onClose.emit(),this.onClose.removeAllListeners())}_commonError(t,e,i){switch(e){case-32602:return Pt({operationName:t,info:Rt.invalidRequestParameter,path:Zt.prefix,error:i});case-32603:return Pt({operationName:t,info:Rt.internalError,path:Zt.prefix,error:i});case 403:case 4030:return Pt({operationName:t,info:Rt.insufficientPermissions,path:Zt.prefix,error:i})}}createChannel(t,e){return B(this,null,function*(){const{id:i}=yield this._client.createChannel({appId:t,name:e.name,metadata:e.metadata}).catch(r=>{var s,o,c;const{info:h}=r,l=this._commonError("RtcApiImpl.createChannel",(o=(s=h==null?void 0:h.error)==null?void 0:s.code)!=null?o:-1,r);if(l)throw l;switch((c=h==null?void 0:h.error)==null?void 0:c.code){case 404:throw Pt({operationName:"RtcApiImpl.createChannel",path:Zt.prefix,info:Rt.channelNotFound,error:r});case 409:throw Pt({operationName:"RtcApiImpl.createChannel",path:Zt.prefix,info:Rt.channelNameDuplicated,error:r});default:throw Pt({operationName:"RtcApiImpl.createChannel",path:Zt.prefix,info:Rt.internalError,error:r})}});return yield this.getChannel(t,{id:i})})}getChannel(t,e){return B(this,arguments,function*(i,{name:n,id:r}){if(r)return yield this._client.getChannel({appId:i,id:r}).catch(s=>{var o,c,h;const{info:l}=s,p=this._commonError("RtcApiImpl.getChannel",(c=(o=l==null?void 0:l.error)==null?void 0:o.code)!=null?c:-1,s);if(p)throw p;switch((h=l==null?void 0:l.error)==null?void 0:h.code){case 404:throw Pt({operationName:"RtcApiImpl.getChannel",path:Zt.prefix,info:Rt.channelNotFound,error:s});default:throw Pt({operationName:"RtcApiImpl.getChannel",path:Zt.prefix,info:Rt.internalError,error:s})}});if(n)return yield this._client.getChannelByName({appId:i,name:n}).catch(s=>{var o,c,h;const{info:l}=s,p=this._commonError("RtcApiImpl.getChannel",(c=(o=l==null?void 0:l.error)==null?void 0:o.code)!=null?c:-1,s);if(p)throw p;switch((h=l==null?void 0:l.error)==null?void 0:h.code){case 404:throw Pt({operationName:"getChannel",path:Zt.prefix,info:Rt.channelNotFound,error:s});default:throw Pt({operationName:"getChannel",path:Zt.prefix,info:Rt.internalError,error:s})}});throw Pt({operationName:"RtcApiImpl.createChannel",path:Zt.prefix,info:Rt.invalidRequestParameter})})}findOrCreateChannel(t,e){return B(this,null,function*(){return this._client.findOrCreateChannel(we(ne({},e),{appId:t})).catch(i=>{var n,r,s,o;const{info:c}=i,h=this._commonError("RtcApiImpl.findOrCreateChannel",(r=(n=c==null?void 0:c.error)==null?void 0:n.code)!=null?r:-1,i);if(h)throw h;if(e.name&&((s=c==null?void 0:c.error)==null?void 0:s.code)===409)return this.getChannel(t,{name:e.name});switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.findOrCreateChannel",path:Zt.prefix,info:Rt.channelNotFound,error:i});case 409:throw Pt({operationName:"RtcApiImpl.findOrCreateChannel",path:Zt.prefix,info:Rt.channelNameDuplicated,error:i});default:throw Pt({operationName:"RtcApiImpl.findOrCreateChannel",path:Zt.prefix,info:Rt.internalError,error:i})}})})}deleteChannel(t,e){return B(this,null,function*(){yield this._client.deleteChannel({appId:t,id:e}).catch(i=>{var n,r,s;const{info:o}=i,c=this._commonError("RtcApiImpl.deleteChannel",(r=(n=o==null?void 0:o.error)==null?void 0:n.code)!=null?r:-1,i);if(c)throw c;switch((s=o==null?void 0:o.error)==null?void 0:s.code){case 404:throw Pt({operationName:"RtcApiImpl.deleteChannel",path:Zt.prefix,info:Rt.channelNotFound,error:i});default:throw Pt({operationName:"RtcApiImpl.deleteChannel",path:Zt.prefix,info:Rt.internalError,error:i})}})})}updateChannelMetadata(t,e,i){return B(this,null,function*(){yield this._client.updateChannelMetadata({appId:t,id:e,metadata:i}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.updateChannelMetadata",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.updateChannelMetadata",path:Zt.prefix,info:Rt.channelNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.updateChannelMetadata",path:Zt.prefix,info:Rt.internalError,error:n})}})})}join(t,e,i){return B(this,null,function*(){const{memberId:n}=yield this._client.addMember({appId:t,channelId:e,name:i.name,metadata:i.metadata,ttlSec:i.ttlSec,type:i.type,subtype:i.subtype}).catch(s=>{var o,c,h;const{info:l}=s,p=this._commonError("RtcApiImpl.addMember",(c=(o=l==null?void 0:l.error)==null?void 0:o.code)!=null?c:-1,s);if(p)throw p;switch((h=l==null?void 0:l.error)==null?void 0:h.code){case 404:throw Pt({operationName:"RtcApiImpl.addMember",path:Zt.prefix,info:Rt.channelNotFound,error:s});case 409:throw Pt({operationName:"RtcApiImpl.addMember",path:Zt.prefix,info:Rt.memberNameDuplicated,error:s});default:throw Pt({operationName:"RtcApiImpl.addMember",path:Zt.prefix,info:Rt.internalError,error:s})}});return{id:n,name:i.name,type:i.type,subtype:i.subtype,metadata:i.metadata}})}updateMemberTtl(t,e,i,n){return B(this,null,function*(){yield this._client.updateMemberTtl({appId:t,channelId:e,memberId:i,ttlSec:n}).catch(r=>{var s,o,c;const{info:h}=r,l=this._commonError("RtcApiImpl.updateMemberTtl",(o=(s=h==null?void 0:h.error)==null?void 0:s.code)!=null?o:-1,r);if(l)throw l;switch((c=h==null?void 0:h.error)==null?void 0:c.code){case 404:throw Pt({operationName:"RtcApiImpl.updateMemberTtl",path:Zt.prefix,info:Rt.memberNotFound,error:r});default:throw Pt({operationName:"RtcApiImpl.updateMemberTtl",path:Zt.prefix,info:Rt.internalError,error:r})}})})}getServerUnixtime(t){return B(this,null,function*(){return yield this._client.getServerUnixtime({appId:t}).catch(e=>{var i,n;const{info:r}=e,s=this._commonError("RtcApiImpl.getServerUnixtime",(n=(i=r==null?void 0:r.error)==null?void 0:i.code)!=null?n:-1,e);throw s||Pt({operationName:"RtcApiImpl.getServerUnixtime",path:Zt.prefix,info:Rt.internalError,error:e})})})}updateMemberMetadata(t,e,i,n){return B(this,null,function*(){yield this._client.updateMemberMetadata({appId:t,channelId:e,memberId:i,metadata:n}).catch(r=>{var s,o,c;const{info:h}=r,l=this._commonError("RtcApiImpl.updateMemberMetadata",(o=(s=h==null?void 0:h.error)==null?void 0:s.code)!=null?o:-1,r);if(l)throw l;switch((c=h==null?void 0:h.error)==null?void 0:c.code){case 404:throw Pt({operationName:"RtcApiImpl.updateMemberMetadata",path:Zt.prefix,info:Rt.memberNotFound,error:r});default:throw Pt({operationName:"RtcApiImpl.updateMemberMetadata",path:Zt.prefix,info:Rt.internalError,error:r})}})})}leave(t,e,i){return B(this,null,function*(){yield this._client.leaveChannel({channelId:e,id:i,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.leaveChannel",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.leaveChannel",path:Zt.prefix,info:Rt.memberNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.leaveChannel",path:Zt.prefix,info:Rt.internalError,error:n})}})})}publish(t,e){return B(this,null,function*(){const{publicationId:i}=yield this._client.publishStream({channelId:e.channel,publisherId:e.publisher,contentType:e.contentType,metadata:e.metadata,origin:e.origin,codecCapabilities:e.codecCapabilities,encodings:e.encodings,isEnabled:e.isEnabled,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.publish",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){default:throw Pt({operationName:"RtcApiImpl.publish",path:Zt.prefix,info:Rt.internalError,error:n})}});return i})}updatePublicationMetadata(t,e,i,n){return B(this,null,function*(){yield this._client.updatePublicationMetadata({channelId:e,publicationId:i,metadata:n,appId:t}).catch(r=>{var s,o,c;const{info:h}=r,l=this._commonError("RtcApiImpl.updatePublicationMetadata",(o=(s=h==null?void 0:h.error)==null?void 0:s.code)!=null?o:-1,r);if(l)throw l;switch((c=h==null?void 0:h.error)==null?void 0:c.code){case 404:throw Pt({operationName:"RtcApiImpl.updatePublicationMetadata",path:Zt.prefix,info:Rt.publicationNotFound,error:r});default:throw Pt({operationName:"RtcApiImpl.updatePublicationMetadata",path:Zt.prefix,info:Rt.internalError,error:r})}})})}disablePublication(t,e,i){return B(this,null,function*(){yield this._client.disablePublication({channelId:e,publicationId:i,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.disablePublication",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.disablePublication",path:Zt.prefix,info:Rt.publicationNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.disablePublication",path:Zt.prefix,info:Rt.internalError,error:n})}})})}enablePublication(t,e,i){return B(this,null,function*(){yield this._client.enablePublication({channelId:e,publicationId:i,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.enablePublication",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.enablePublication",path:Zt.prefix,info:Rt.publicationNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.enablePublication",path:Zt.prefix,info:Rt.internalError,error:n})}})})}unpublish(t,e,i){return B(this,null,function*(){yield this._client.unpublishStream({channelId:e,publicationId:i,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.unpublishStream",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.unpublishStream",path:Zt.prefix,info:Rt.publicationNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.unpublishStream",path:Zt.prefix,info:Rt.internalError,error:n})}})})}subscribe(t,e){return B(this,null,function*(){const{subscriptionId:i}=yield this._client.subscribeStream({channelId:e.channel.id,subscriberId:e.subscriber.id,publicationId:e.publication.id,appId:t}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.subscribeStream",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.subscribeStream",path:Zt.prefix,info:Rt.publicationNotFound,error:n});case 409:throw Pt({operationName:"RtcApiImpl.subscribeStream",path:Zt.prefix,info:Rt.subscriptionAlreadyExists,error:n});default:throw Pt({operationName:"RtcApiImpl.subscribeStream",path:Zt.prefix,info:Rt.internalError,error:n})}});return i})}unsubscribe(t,e,i){return B(this,null,function*(){yield this._client.unsubscribeStream({appId:t,channelId:e,subscriptionId:i}).catch(n=>{var r,s,o;const{info:c}=n,h=this._commonError("RtcApiImpl.unsubscribeStream",(s=(r=c==null?void 0:c.error)==null?void 0:r.code)!=null?s:-1,n);if(h)throw h;switch((o=c==null?void 0:c.error)==null?void 0:o.code){case 404:throw Pt({operationName:"RtcApiImpl.unsubscribeStream",path:Zt.prefix,info:Rt.publicationNotFound,error:n});default:throw Pt({operationName:"RtcApiImpl.unsubscribeStream",path:Zt.prefix,info:Rt.internalError,error:n})}})})}};Q();var ta=new mt("packages/rtc-api-client/src/infrastructure/eventObserver.ts"),_x=class{constructor(t,e,i,n){this.onEvent=new yt,this._disposer=[];const r=new bx(i.version,s=>B(null,null,function*(){yield e.subscribeChannelEvents({appId:t,channelId:i.id,offset:s}),yield new Promise(o=>setTimeout(o,n.eventSubscribeTimeout)),r.packetLostHappened&&ta.error(Pt({operationName:"EventObserverImpl.eventJitterBuffer",info:we(ne({},Rt.internalError),{detail:"failed to resolve event lost"}),channelId:i.id,appId:t,path:ta.prefix}))}));this._disposer=[e.onEvent.add(s=>B(this,[s],function*({channelId:o,event:c}){o===i.id&&r.push({event:c,version:c.data.channel.version})})).removeListener,r.onEvent.add(s=>{this.onEvent.emit(s)}).removeListener]}dispose(){this._disposer.forEach(t=>t()),this.onEvent.removeAllListeners()}},bx=class{constructor(t,e,i=1e3){this.presentVersion=t,this.onPacketLost=e,this.packetLifetime=i,this.onEvent=new yt,this.eventBuffer={},this.packetLostHappened=!1}get expectNextVersion(){return this.presentVersion+1}push(t){const e=t.version;if(e<this.expectNextVersion){ta.debug("duplicate event",we(ne({},t),{presentVersion:this.presentVersion}));return}if(e>this.expectNextVersion){ta.debug("maybe miss order event received",we(ne({},t),{presentVersion:this.presentVersion})),this.eventBuffer[e]=t,this.handlePacketLifetime();return}this.packetLostHappened&&(ta.warn("event packetLost resolved",tp({operationName:"EventJitterBuffer.push",detail:"event packetLost resolved",payload:{eventFrame:t}})),this.packetLostHappened=!1),this.eventBuffer[e]=t,this.resolveEvents()}handlePacketLifetime(){const[t]=Object.keys(this.eventBuffer).sort().map(e=>this.eventBuffer[Number(e)]);this.packetLifeTimer==null&&t&&(ta.debug("set event packetLost timer",we(ne({},t),{presentVersion:this.presentVersion})),this.packetLifeTimer=setTimeout(()=>B(this,null,function*(){if(this.presentVersion<t.version){if(ta.warn("event packetLost",tp({operationName:"EventJitterBuffer.handlePacketLifetime",detail:"eventPacket lost",payload:{oldestBufferedEvent:t,eventBufferLength:Object.keys(this.eventBuffer).length,presentVersion:this.presentVersion}})),this.packetLostHappened)return;this.packetLostHappened=!0,yield this.onPacketLost(this.expectNextVersion)}this.packetLifeTimer=void 0,this.handlePacketLifetime()}),this.packetLifetime))}resolveEvents(){const t=[];for(let e=this.expectNextVersion;;e++){const i=this.eventBuffer[e];if(i)t.push(i),delete this.eventBuffer[e];else break}t.length>0&&(this.presentVersion=t.slice(-1)[0].version,t.forEach(e=>{this.onEvent.emit(e.event)}))}},Sr=new mt("packages/rtc-api-client/src/client.ts"),yx=class Og{constructor(e,i,n,r){this.appId=e,this.config=i,this.apiClient=n,this._eventObserverFactory=r,this.closed=!1,this.onFatalError=new yt,this.apiClient.onFatalError.pipe(this.onFatalError)}static Create(e){return B(this,null,function*(){const i=new gx(e);i.log&&(mt.level=i.log.level,mt.format=i.log.format),Sr.debug("RtcApiClient spawned",i);const n=new fx(we(ne({},i.rtcApi),{token:e.token,log:i.log})),r=new vx(n);yield r.connect();const s=(o,c)=>new _x(o,n,c,i.rtcApi);return new Og(e.appId,i,r,s)})}updateAuthToken(e){return B(this,null,function*(){yield this.apiClient.updateAuthToken(e)})}getServerUnixtimeInMs(){return B(this,null,function*(){return this.apiClient.getServerUnixtime(this.appId)})}getServerUnixtimeInSec(){return B(this,null,function*(){return Math.floor((yield this.getServerUnixtimeInMs())/1e3)})}createChannel(){return B(this,arguments,function*(e={}){Sr.debug("[start] apiClient.createChannel",{init:e});const i=yield this.apiClient.createChannel(this.appId,e).catch(r=>{throw Sr.debug("[failed] apiClient.createChannel",{init:e,e:r}),r});return Sr.debug("[end] apiClient.createChannel",{init:e,channelDto:i}),Sd(this.appId,this._eventObserverFactory(this.appId,i),this.apiClient,i,this.config)})}findChannel(e){return B(this,null,function*(){Sr.debug("[start] apiClient.getChannel",{query:e});const i=yield this.apiClient.getChannel(this.appId,e).catch(r=>{throw Sr.debug("[failed] apiClient.getChannel",{query:e,e:r}),r}),n=Sd(this.appId,this._eventObserverFactory(this.appId,i),this.apiClient,i,this.config);return Sr.debug("[end] apiClient.getChannel",{channelId:n.id}),n})}findOrCreateChannel(e){return B(this,null,function*(){Sr.debug("[start] apiClient.findOrCreateChannel",{query:e});const i=yield this.apiClient.findOrCreateChannel(this.appId,e).catch(r=>{throw Sr.debug("[failed] apiClient.findOrCreateChannel",{query:e,e:r}),r});return Sr.debug("[end] apiClient.findOrCreateChannel",{query:e}),Sd(this.appId,this._eventObserverFactory(this.appId,i),this.apiClient,i,this.config)})}deleteChannel(e){return this.apiClient.deleteChannel(this.appId,e)}close(){this.closed||(this.closed=!0,Sr.debug("closed",{appid:this.appId}),this.apiClient.close())}};Q();Q();var Sx={};Q();var mi=new mt("packages/rtc-api-client/src/domain/channel.ts"),wx=class{constructor(t,{id:e,name:i,members:n,metadata:r,publications:s,subscriptions:o,version:c},h,l,p){this.appId=t,this.eventObserver=h,this.apiClient=l,this.config=p,this.disposed=!1,this._events=new Zr,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.updateChannelMetadata=g=>new Promise((f,y)=>{let x=!1;this.apiClient.updateChannelMetadata(this.appId,this.id,g).catch(S=>{x=!0,y(S)}),this.onMetadataUpdated.watch(S=>S.channel.metadata===g).then(()=>f()).catch(S=>{x||y(Pt({operationName:"ChannelImpl.updateChannelMetadata",info:we(ne({},Rt.timeout),{detail:"onMetadataUpdated"}),path:mi.prefix,error:S,appId:this.appId,channelId:this.id}))})}),this.leave=(g,f)=>new Promise((y,x)=>{let S=!1;this.apiClient.leave(this.appId,g,f).catch(v=>{S=!0,x(v)}),this.onMemberLeft.watch(v=>v.member.id===f,this.config.rtcApi.timeout).then(()=>y()).catch(v=>{S||x(Pt({operationName:"ChannelImpl.leave",info:we(ne({},Rt.timeout),{detail:"onMemberLeft"}),path:mi.prefix,error:v,appId:this.appId,channelId:this.id}))})}),this.updateMemberMetadata=(g,f)=>new Promise((y,x)=>{let S=!1;this.apiClient.updateMemberMetadata(this.appId,this.id,g,f).catch(v=>{S=!0,x(v)}),this.onMemberMetadataUpdated.watch(v=>v.member.id===g&&v.member.metadata===f).then(()=>y()).catch(v=>{S||x(Pt({operationName:"ChannelImpl.updateMemberMetadata",info:we(ne({},Rt.timeout),{detail:"onMemberMetadataUpdated"}),path:mi.prefix,error:v,appId:this.appId,channelId:this.id}))})}),this.unpublish=g=>new Promise((f,y)=>{let x=!1;this.apiClient.unpublish(this.appId,this.id,g).catch(S=>{x=!0,y(S)}),this.onStreamUnpublished.watch(S=>S.publication.id===g).then(()=>f()).catch(S=>{x||y(Pt({operationName:"ChannelImpl.unpublish",info:we(ne({},Rt.timeout),{detail:"onStreamUnpublished"}),path:mi.prefix,error:S,payload:{publicationId:g},appId:this.appId,channelId:this.id}))})}),this.updatePublicationMetadata=(g,f)=>new Promise((y,x)=>{let S=!1;this.apiClient.updatePublicationMetadata(this.appId,this.id,g,f).catch(v=>{S=!0,x(v)}),this.onPublicationMetadataUpdated.watch(v=>v.publication.id===g&&v.publication.metadata===f).then(()=>y()).catch(v=>{S||x(Pt({operationName:"ChannelImpl.updatePublicationMetadata",info:we(ne({},Rt.timeout),{detail:"onPublicationMetadataUpdated"}),path:mi.prefix,error:v,payload:{publicationId:g},appId:this.appId,channelId:this.id}))})}),this.disablePublication=g=>new Promise((f,y)=>{let x=!1;this.apiClient.disablePublication(this.appId,this.id,g).catch(S=>{x=!0,y(S)}),this.onPublicationDisabled.watch(S=>S.publication.id===g).then(()=>f()).catch(S=>{x||y(Pt({operationName:"ChannelImpl.disablePublication",info:we(ne({},Rt.timeout),{detail:"onPublicationDisabled"}),path:mi.prefix,error:S,payload:{publicationId:g},appId:this.appId,channelId:this.id}))})}),this.enablePublication=g=>new Promise((f,y)=>{let x=!1;this.apiClient.enablePublication(this.appId,this.id,g).catch(S=>{x=!0,y(S)}),this.onPublicationEnabled.watch(S=>S.publication.id===g).then(()=>f()).catch(S=>{x||y(Pt({operationName:"ChannelImpl.enablePublication",info:we(ne({},Rt.timeout),{detail:"onPublicationEnabled"}),path:mi.prefix,error:S,payload:{publicationId:g},appId:this.appId,channelId:this.id}))})}),this.unsubscribe=g=>new Promise((f,y)=>{let x=!1;this.apiClient.unsubscribe(this.appId,this.id,g).catch(S=>{x=!0,y(S)}),this.onPublicationUnsubscribed.watch(S=>S.subscription.id===g).then(()=>f()).catch(S=>{x||y(Pt({operationName:"ChannelImpl.unsubscribe",info:we(ne({},Rt.timeout),{detail:"onPublicationUnsubscribed"}),path:mi.prefix,error:S,payload:{subscriptionId:g},appId:this.appId,channelId:this.id}))})}),this.id=e,this.name=i,this.metadata=r,this.members=n,this.publications=s,this.subscriptions=o,this.version=c,h.onEvent.add(g=>{mi.debug("received event: ",g),this.version=g.data.channel.version;try{switch(g.type){case"ChannelDeleted":this._channelClosed();break;case"ChannelMetadataUpdated":this._channelMetadataUpdated(g.data);break;case"MemberAdded":this._memberJoined(g.data);break;case"MemberRemoved":this._memberLeft(g.data);break;case"MemberMetadataUpdated":this._memberMetadataUpdated(g.data);break;case"StreamPublished":this._streamPublished(g.data);break;case"StreamUnpublished":this._streamUnpublished(g.data);break;case"PublicationMetadataUpdated":this._publicationMetadataUpdated(g.data);break;case"PublicationDisabled":this._publicationDisabled(g.data);break;case"PublicationEnabled":this._publicationEnabled(g.data);break;case"StreamSubscribed":this._streamSubscribed(g.data);break;case"StreamUnsubscribed":this._streamUnsubscribed(g.data);break}}catch(f){mi.error(f)}}),l.onClose.once(()=>{this.dispose()})}getMember(t){return this.members.find(e=>e.id===t)}addMember(t){const e=this.getMember(t.id);return e||(this.members.push(t),t)}deleteMember(t){this.members=this.members.filter(e=>e.id!==t)}getPublication(t){return this.publications.find(e=>e.id===t)}addPublication(t){var e,i;const n=this.getPublication(t.id);if(n)return n;const r=we(ne({},t),{channelId:this.id,codecCapabilities:(e=t.codecCapabilities)!=null?e:[],encodings:(i=t.encodings)!=null?i:[]});return this.publications.push(r),r}deletePublication(t){this.publications=this.publications.filter(e=>e.id!==t)}getSubscription(t){return this.subscriptions.find(e=>e.id===t)}addSubscription(t){const e=this.getSubscription(t.id);if(e)return e;const i=this.getPublication(t.publicationId),n=we(ne({},t),{channelId:this.id,publisherId:i.publisherId,contentType:i.contentType});return this.subscriptions.push(n),n}deleteSubscription(t){this.subscriptions=this.subscriptions.filter(e=>e.id!==t)}_channelClosed(){this.onClosed.emit({})}_channelMetadataUpdated(t){this.metadata=t.channel.metadata,this.onMetadataUpdated.emit(t)}_memberJoined(t){this.addMember(t.member),this.onMemberJoined.emit(t),this.onMemberListChanged.emit({})}_memberLeft(t){const e=this.getMember(t.member.id);if(!e)throw Pt({operationName:"ChannelImpl._memberLeft",info:Rt.memberNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deleteMember(e.id),this.onMemberLeft.emit({member:e}),this.onMemberListChanged.emit({})}_memberMetadataUpdated(t){const e=this.getMember(t.member.id);if(!e)throw Pt({operationName:"ChannelImpl._memberMetadataUpdated",info:Rt.memberNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});e.metadata=t.member.metadata,this.onMemberMetadataUpdated.emit(t)}_streamPublished(t){const e=this.addPublication(t.publication),i=we(ne({},t),{publication:e});this.onStreamPublished.emit(i),this.onPublicationListChanged.emit({})}_streamUnpublished(t){const e=this.getPublication(t.publication.id);if(!e)throw Pt({operationName:"ChannelImpl._streamUnpublished",info:Rt.publicationNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deletePublication(e.id);const i=we(ne({},t),{publication:e});this.onStreamUnpublished.emit(i),this.onPublicationListChanged.emit({})}_publicationMetadataUpdated(t){const e=this.getPublication(t.publication.id);if(!e)throw Pt({operationName:"ChannelImpl._publicationMetadataUpdated",info:Rt.publicationNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});e.metadata=t.publication.metadata;const i=we(ne({},t),{publication:e});this.onPublicationMetadataUpdated.emit(i)}_publicationDisabled(t){const e=this.getPublication(t.publication.id);if(!e)throw Pt({operationName:"ChannelImpl._publicationDisabled",info:Rt.publicationNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});e.isEnabled=t.publication.isEnabled;const i={publication:e};this.onPublicationDisabled.emit(i)}_publicationEnabled(t){const e=this.getPublication(t.publication.id);if(!e)throw Pt({operationName:"ChannelImpl._publicationEnabled",info:Rt.publicationNotFound,path:mi.prefix,payload:{event:Sx},appId:this.appId,channelId:this.id});e.isEnabled=t.publication.isEnabled;const i={publication:e};this.onPublicationEnabled.emit(i)}_streamSubscribed(t){const e=this.addSubscription(t.subscription),i=we(ne({},t),{subscription:e});this.onPublicationSubscribed.emit(i),this.onSubscriptionListChanged.emit({})}_streamUnsubscribed(t){const e=this.getSubscription(t.subscription.id);if(!e)throw Pt({operationName:"ChannelImpl._streamUnsubscribed",info:Rt.subscriptionNotFound,path:mi.prefix,payload:{event:t},appId:this.appId,channelId:this.id});this.deleteSubscription(e.id);const i=we(ne({},t),{subscription:e});this.onPublicationUnsubscribed.emit(i),this.onSubscriptionListChanged.emit({})}joinChannel(t){return B(this,null,function*(){var e;t.type&&(t.type=t.type[0].toUpperCase()+t.type.slice(1)),t.subtype&&(t.subtype=t.subtype[0].toUpperCase()+t.subtype.slice(1)),mi.debug("[start] joinChannel",{memberInit:t});const i=yield this.apiClient.join(this.appId,this.id,ne({},t)),n=(e=this.getMember(i.id))!=null?e:(yield this.onMemberJoined.watch(r=>r.member.id===i.id,this.config.rtcApi.timeout).catch(r=>{throw Pt({operationName:"ChannelImpl.joinChannel",info:we(ne({},Rt.timeout),{detail:"onMemberJoined"}),path:mi.prefix,error:r,appId:this.appId,channelId:this.id})})).member;return mi.debug("[end] joinChannel",{member:n}),n})}updateMemberTtl(t,e){return this.apiClient.updateMemberTtl(this.appId,this.id,t,e)}publish(t){return B(this,null,function*(){var e,i,n;const r=mi.debug("[start] apiClient.publish",{init:t}),s=this.id,o=yield this.apiClient.publish(this.appId,we(ne({},t),{channel:s})),c={id:o,channelId:s,publisherId:t.publisher,origin:t.origin,contentType:t.contentType,metadata:t.metadata,codecCapabilities:(e=t.codecCapabilities)!=null?e:[],encodings:(i=t.encodings)!=null?i:[],isEnabled:(n=t.isEnabled)!=null?n:!0};mi.elapsed(r,"[ongoing] apiClient.publish",{publicationDto:c});const h=this.getPublication(o);if(h)return h;const{publication:l}=yield this.onStreamPublished.watch(p=>p.publication.id===o,this.config.rtcApi.timeout).catch(p=>{throw Pt({operationName:"ChannelImpl.publish",info:we(ne({},Rt.timeout),{detail:"onStreamPublished"}),path:mi.prefix,error:p,payload:{publicationDto:c},appId:this.appId,channelId:this.id})});return mi.elapsed(r,"[end] apiClient.publish",{publicationDto:c}),l})}subscribe(t){return B(this,null,function*(){const e=mi.debug("[start] apiClient.subscribe",{init:t}),i=yield this.apiClient.subscribe(this.appId,we(ne({},t),{channel:this})),n={id:i,publicationId:t.publication.id,channelId:this.id,publisherId:t.publication.publisherId,subscriberId:t.subscriber.id,contentType:t.publication.contentType};mi.elapsed(e,"[ongoing] apiClient.subscribe",{subscriptionDto:n});const r=this.getSubscription(i);if(r)return mi.elapsed(e,"[end] apiClient.subscribe",{subscriptionDto:n}),r;const{subscription:s}=yield this.onPublicationSubscribed.watch(o=>o.subscription.id===i,this.config.rtcApi.timeout).catch(o=>{throw mi.elapsed(e,"[fail] apiClient.subscribe",o),Pt({operationName:"ChannelImpl.subscribe",info:we(ne({},Rt.timeout),{detail:"onPublicationSubscribed"}),path:mi.prefix,error:o,payload:{subscriptionDto:n}})});return mi.elapsed(e,"[end] apiClient.subscribe",{subscriptionDto:n}),s})}close(){return this.apiClient.deleteChannel(this.appId,this.id)}dispose(){this.disposed||(this.disposed=!0,mi.debug("disposed",{id:this.id}),this.eventObserver.dispose(),this._events.dispose())}};function Sd(t,e,i,n,r){return new wx(t,n,e,i,r)}Q();var xx=qn(qf()),Ex=class{constructor(t={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.iceParamServer={domain:"ice-params.skyway.ntt.com",version:1,secure:!0},this.signalingService={domain:"signaling.skyway.ntt.com",secure:!0},this.analyticsService={domain:"analytics-logging.skyway.ntt.com",secure:!0},this.rtcConfig={timeout:3e4,turnPolicy:"enable",turnProtocol:"all",encodedInsertableStreams:!1,iceDisconnectBufferTimeout:5e3},this.token={updateReminderSec:30},this.log={level:"error",format:"string"},this.internal={disableDPlane:!1},this.member={keepaliveIntervalGapSec:30,keepaliveIntervalSec:30},Object.assign(this,(0,xx.default)(this,t))}};Q();Q();var Zu=class{constructor(){this._onContextAttached=new yt}_attachContext(t){this._context=t,this._onContextAttached.emit(t)}};Q();var Cx=new mt("packages/core/src/plugin/internal/person/connection/messageBuffer.ts"),Tx=class{constructor(t){this.signaling=t,this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set,this._disposer=new ar,this.signaling.onMessage.add(e=>{const i=e.src.id+e.src.name;this._excludeConnectionIndicateBuffering.has(i)||(this._indicateMessageBuffer[i]||(this._indicateMessageBuffer[i]=[]),this._indicateMessageBuffer[i].push(e))}).disposer(this._disposer)}resolveMessagingBuffer({id:t,name:e}){const i=t+e,n=this._indicateMessageBuffer[i];(n==null?void 0:n.length)>0&&(Cx.debug("resolveMessagingBuffer",{length:n.length}),n.forEach(r=>{this.signaling.onMessage.emit(r)}),delete this._indicateMessageBuffer[i]),this._excludeConnectionIndicateBuffering.add(i)}close(){this._disposer.dispose(),this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set}};Q();Q();Q();var So=qn(hn());Q();Q();Q();Q();var Ug=class{constructor(t,e){this.id=t,this.contentType=e,this.side="remote",this.onConnectionStateChanged=new yt,this._onConnectionStateChanged=new yt,this._connectionState="new",this._getTransport=()=>{},this.getStats=()=>this._getStats(),this._getStats=()=>B(null,null,function*(){return[]}),this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setConnectionState(t){this._connectionState!==t&&(this._connectionState=t,this._onConnectionStateChanged.emit(t))}getRTCPeerConnection(){return this._getRTCPeerConnection()}_getRTCPeerConnection(){var t;return(t=this._getTransport())==null?void 0:t.rtcPeerConnection}getConnectionState(){return this._getConnectionState()}_getConnectionState(){return this._connectionState}toJSON(){return{contentType:this.contentType,id:this.id,codec:this.codec,side:this.side}}},Bg=class extends Ug{constructor(t,e,i){super(t,e),this.id=t,this.contentType=e,this.track=i}get isEnabled(){return this.track.enabled}setIsEnabled(t){this.track.enabled=t}attach(t){this._element=t,lg(t,this.track)}detach(){this._element&&(dg(this._element,this.track),this._element=void 0)}},Rx=class extends Bg{constructor(t,e){super(t,"audio",e),this.track=e,this.contentType="audio"}};Q();var Px=class extends Ug{constructor(t,e){super(t,"data"),this._datachannel=e,this._isEnabled=!0,this.contentType="data",this.onData=new yt,e.onmessage=({data:i})=>{this.isEnabled&&(typeof i=="string"&&i.includes(yu)&&(i=JSON.parse(i.slice(yu.length))),this.onData.emit(i))}}get isEnabled(){return this._isEnabled}setIsEnabled(t){this._isEnabled=t}};Q();var Mx=class extends Bg{constructor(t,e){super(t,"video",e),this.track=e,this.contentType="video"}},Ax=new mt("packages/core/src/media/stream/remote/factory.ts"),wu=(t,e,i)=>{if(e instanceof RTCDataChannel){const n=new Px(t,e);return n.codec=i,n}else if(e.kind==="audio"){const n=new Rx(t,e);return n.codec=i,n}else if(e.kind==="video"){const n=new Mx(t,e);return n.codec=i,n}throw qe({operationName:"createRemoteStream",path:Ax.prefix,info:we(ne({},Qe.invalidArgumentValue),{detail:"invalid stream type"})})};Q();var Dx=new mt("packages/core/src/plugin/internal/person/util.ts"),ko=(t,e)=>B(null,null,function*(){const i=Dx.createBlock({label:"setEncodingParams"}),n=t.getParameters();i.debug("getParameters",{params:n,newEncodings:e}),n.encodings==null&&(n.encodings=[]),n.encodings=e.map((r,s)=>ne(ne({},n.encodings[s]||{}),r)),yield t.setParameters(n)}),Hg=()=>jh()==="Safari12"||jh()==="Safari11";function Ix(t){switch(t){case"closed":case"disconnected":case"failed":return"disconnected";case"connected":return"connected";case"connecting":return"connecting";case"new":return"new";case"reconnecting":return"reconnecting"}}var Lx=t=>{const e=[];return t.forEach(i=>{e.push(JSON.parse(JSON.stringify(i)))}),e};Q();var jg=class Vg{constructor(e,i){this.publicationId=e,this.streamId=i}static fromLabel(e){const{p:i,s:n}=JSON.parse(e);return new Vg(i,n)}toLabel(){return JSON.stringify({p:this.publicationId,s:this.streamId})}};Q();var wr=new mt("packages/core/src/plugin/internal/person/connection/peer.ts"),zg=class{constructor(t,e,i,n,r,s,o){this._context=t,this._iceManager=e,this.signaling=i,this.analytics=n,this.localPerson=r,this.endpoint=s,this.role=o,this._pendingCandidates=[],this.pc=new RTCPeerConnection(we(ne({},this._context.config.rtcConfig),{iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,iceServers:this._iceManager.iceServers})),this.onSignalingStateChanged=new yt,this.onPeerConnectionStateChanged=new yt,this.onDisconnect=new yt,this.connected=!1,this.disconnected=!1,this.rtcPeerConnectionId=lo(),this._onICECandidate=l=>B(this,null,function*(){if(l.candidate==null||l.candidate===""||this.pc.connectionState==="closed")return;const p={kind:"iceCandidateMessage",payload:{candidate:l.candidate,role:this.role}};wr.debug("[start] send candidate",{message:p,localPerson:this.localPerson}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidate",data:{candidate:JSON.stringify(l.candidate)},createdAt:Date.now()});try{yield this.signaling.send(this.endpoint,p),wr.debug("[end] send candidate",{message:p,localPerson:this.localPerson})}catch(g){wr.warn("[failed] send candidate",Wi({operationName:"Peer._onICECandidate",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{message:p}}),g)}}),this._onICECandidateError=l=>B(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidateError",data:{event:JSON.stringify(l)},createdAt:Date.now()})}),this._onIceGatheringStateChange=l=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const p=this.pc.iceGatheringState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceGatheringStateChange",data:{event:p},createdAt:Date.now()})}}),this._onConnectionStateChange=()=>B(this,null,function*(){const l=this.pc.connectionState;switch(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"connectionStateChange",data:{connectionState:l},createdAt:Date.now()}),l){case"connected":this.connected=!0,this._pendingCandidates=[];break}this.onPeerConnectionStateChanged.emit(this.pc.connectionState)}),this._onIceConnectionStateChange=()=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const l=this.pc.iceConnectionState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceConnectionStateChange",data:{iceConnectionState:l},createdAt:Date.now()})}}),this._onSignalingStateChange=()=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const l=this.pc.signalingState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"signalingStateChange",data:{signalingState:l},createdAt:Date.now()})}}),this.waitForSignalingState=(l,p=1e4)=>B(this,null,function*(){this.pc.signalingState!==l&&(yield this.onSignalingStateChanged.watch(()=>this.pc.signalingState===l,p).catch(g=>{throw qe({operationName:"Peer.waitForSignalingState",info:we(ne({},Qe.timeout),{detail:"waitForSignalingState timeout"}),path:wr.prefix,context:this._context,channel:this.localPerson.channel,error:g})}))}),this.waitForConnectionState=(l,p=1e4)=>B(this,null,function*(){l!==this.pc.connectionState&&(yield this.onPeerConnectionStateChanged.watch(()=>l===this.pc.connectionState,p).catch(g=>{throw qe({operationName:"Peer.waitForConnectionState",info:we(ne({},Qe.timeout),{detail:"waitForConnectionState timeout"}),path:wr.prefix,context:this._context,channel:this.localPerson.channel,error:g})}))}),this.waitForStats=l=>B(this,[l],function*({track:p,cb:g,interval:f,timeout:y,logging:x}){f??(f=100),y??(y=1e4);for(let S=0;;S+=f){if(S>=y)throw qe({operationName:"Peer.waitForStats",info:we(ne({},Qe.timeout),{detail:"waitForStats timeout"}),path:wr.prefix,context:this._context,channel:this.localPerson.channel});const v=yield this.pc.getStats(p),m=Lx(v);if(x&&wr.debug("Peer.waitForStats",m),g(m))break;yield new Promise(w=>setTimeout(w,f))}});var c;wr.debug("peerConfig",this.pc.getConfiguration()),this.setPeerConnectionListener();const h=(c=this.pc)==null?void 0:c.peerIdentity;h&&h.catch(l=>{wr.debug("firefox peerIdentity",l)})}setPeerConnectionListener(){this.pc.onicecandidate=this._onICECandidate,this.pc.onicecandidateerror=this._onICECandidateError,this.pc.onicegatheringstatechange=this._onIceGatheringStateChange,this.pc.onconnectionstatechange=this._onConnectionStateChange,this.pc.oniceconnectionstatechange=this._onIceConnectionStateChange,this.pc.onsignalingstatechange=()=>{this._onSignalingStateChange(),this.onSignalingStateChanged.emit(this.pc.signalingState)}}unSetPeerConnectionListener(){this.pc.onicecandidate=null,this.pc.onicecandidateerror=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null}handleCandidate(t){return B(this,null,function*(){this._pendingCandidates.push(t),this.pc.remoteDescription&&(yield this.resolveCandidates())})}resolveCandidates(){return B(this,null,function*(){const t=[...this._pendingCandidates];this._pendingCandidates=[],wr.debug("addIceCandidates",t),yield Promise.all(t.map(e=>{this.pc.signalingState!=="closed"&&this.pc.addIceCandidate(e).catch(i=>{wr.warn("[failed] add ice candidate",Wi({operationName:"Peer.resolveCandidates",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{endpointId:this.endpoint.id}}),i)})}))})}},bs=new mt("packages/core/src/plugin/internal/person/connection/receiver.ts"),Fx=class extends zg{constructor(t,e,i,n,r,s){super(t,e,i,n,r,s,"receiver"),this.id=Yr(),this.onConnectionStateChanged=new yt,this.onStreamAdded=new yt,this.onError=new yt,this._connectionState="new",this._publicationInfo={},this.streams={},this._subscriptions={},this._promiseQueue=new Vs,this._disposer=new ar,this._log=bs.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._log.debug("spawned"),this.signaling.onMessage.add(o=>B(this,[o],function*({src:c,data:h}){if(!(c.id===s.id&&c.name===s.name))return;const l=h;switch(l.kind){case"senderProduceMessage":this._promiseQueue.push(()=>this._handleSenderProduce(l.payload)).catch(p=>this._log.error("handle senderProduceMessage failed",p,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderUnproduceMessage":this._promiseQueue.push(()=>this._handleSenderUnproduce(l.payload)).catch(p=>this._log.error("handle handleSenderUnproduce",p,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderRestartIceMessage":this._promiseQueue.push(()=>this._handleSenderRestartIce(l.payload)).catch(p=>this._log.error("_handleSenderRestartIce",p,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"iceCandidateMessage":{const{role:p,candidate:g}=l.payload;p==="sender"&&(yield this.handleCandidate(g))}break}})).disposer(this._disposer),this.pc.ontrack=o=>B(this,[o],function*({track:c,transceiver:h}){if(!h.mid)throw qe({operationName:"Receiver.pc.ontrack",info:we(ne({},Qe.missingProperty),{detail:"mid missing"}),path:bs.prefix,context:this._context,channel:this.localPerson.channel});const l=Object.values(this._publicationInfo).find(y=>{var x;return y.mid===((x=h.mid)==null?void 0:x.toString())});if(!l){const y=qe({operationName:"Receiver.pc.ontrack",info:we(ne({},Qe.notFound),{detail:"publicationInfo not found"}),path:bs.prefix,context:this._context,channel:r.channel,payload:{endpointId:this.endpoint.id,publicationInfo:this._publicationInfo,mid:h.mid}});this.onError.emit(y),this._log.error(y);return}const p=So.parse(this.pc.remoteDescription.sdp),g=this._getCodecFromSdp(p,h,c.kind),f=wu(l.streamId,c,g);f.codec=g,this._setupTransportAccessForStream(f),this.streams[l.publicationId]=f,this._log.debug("MediaStreamTrack added",l,c,g),this.onStreamAdded.emit({publicationId:l.publicationId,stream:f})}),this.pc.ondatachannel=o=>B(this,[o],function*({channel:c}){const{publicationId:h,streamId:l}=jg.fromLabel(c.label),p={mimeType:"datachannel"},g=wu(l,c,p);this._setupTransportAccessForStream(g),this.streams[h]=g,this._log.debug("DataChannel added",h,c,p),this.onStreamAdded.emit({publicationId:h,stream:g})}),this.onPeerConnectionStateChanged.add(o=>{switch(o){case"connecting":case"connected":this._setConnectionState(o);break;case"failed":case"closed":this._setConnectionState("disconnected");break}}).disposer(this._disposer)}_setConnectionState(t){this._connectionState!==t&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,t),this._connectionState=t,this.onConnectionStateChanged.emit(t))}_setupTransportAccessForStream(t){t._getTransport=()=>({rtcPeerConnection:this.pc,connectionState:Ix(this.pc.connectionState)}),t._getStats=()=>B(this,null,function*(){if(t.contentType==="data"){const n=yield this.pc.getStats();return Ya(n)}const e=yield this.pc.getStats(t.track);return Ya(e)}),this._disposer.push(()=>{t._getTransport=()=>{}}),this.onConnectionStateChanged.add(e=>{t._setConnectionState(e),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:e},createdAt:Date.now()})}).disposer(this._disposer)}_getCodecFromSdp(t,e,i){const n=t.media.find(p=>{var g,f;return((g=p.mid)==null?void 0:g.toString())===((f=e.mid)==null?void 0:f.toString())});if(!n)throw qe({operationName:"Receiver._getCodecFromSdp",info:we(ne({},Qe.notFound),{detail:"m-line not exist"}),path:bs.prefix,context:this._context,channel:this.localPerson.channel});const r=n.payloads.split(" ")[0],s=n.rtp.find(p=>p.payload.toString()===r),o=`${i}/${s.codec}`.toLowerCase();let c={};const h=n.fmtp.find(p=>p.payload.toString()===r);return h!=null&&h.config&&(c=sg(h.config)),{mimeType:o,parameters:c}}get hasMedia(){const t=Object.values(this.streams).length;return this._log.debug("hasMedia",{count:t}),t>0}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}add(t){this._subscriptions[t.id]=t}remove(t){const e=this._subscriptions[t];if(!e)return;delete this._subscriptions[e.id];const i=e.publication.id;this.streams[i]&&delete this.streams[i]}_validateRemoteOffer(t){const e=So.parse(t);this._log.debug("_validateRemoteOffer",{sdpObject:e});for(const i of e.media){if(i.direction==="inactive")continue;if(!Object.values(this._publicationInfo).find(r=>{var s;return((s=i.mid)==null?void 0:s.toString())===r.mid})){const r=qe({operationName:"Receiver._validateRemoteOffer",info:we(ne({},Qe.notFound),{detail:"mismatch between sdp and state"}),path:bs.prefix,context:this._context,channel:this.localPerson.channel,payload:{sdpMedia:e.media,sdpMediaLine:i,info:this._publicationInfo}});throw this.onError.emit(r),r}}}get isWrongSignalingState(){return this.pc.signalingState==="have-local-offer"&&this.pc.remoteDescription||this.pc.signalingState==="have-remote-offer"}_handleSenderProduce(t){return B(this,arguments,function*({sdp:e,publicationId:i,info:n}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("_handleSenderProduce wait for be stable",Wi({operationName:"Receiver._handleSenderProduce",channel:this.localPerson.channel,detail:"_handleSenderProduce wait for be stable",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderProduce({sdp:e,publicationId:i,info:n});return}throw qe({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:we(ne({},Qe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:bs.prefix})}this._log.debug("_handleSenderProduce",{info:n,publicationId:i,publicationInfo:Object.values(this._publicationInfo)}),this._publicationInfo[n.publicationId]=n,this._validateRemoteOffer(e.sdp),yield this.sendAnswer(e),yield this.resolveCandidates()}})}_handleSenderUnproduce(t){return B(this,arguments,function*({sdp:e,publicationId:i}){if(this.pc.signalingState==="closed"){this._log.warn("signalingState closed",Wi({channel:this.localPerson.channel,detail:"signalingState closed",operationName:"Receiver._handleSenderUnproduce"}));return}if(this._log.debug("<handleSenderUnproduce> start",{sdp:e,publicationId:i}),this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",Wi({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderUnproduce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderUnproduce({sdp:e,publicationId:i});return}throw qe({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:we(ne({},Qe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:bs.prefix})}delete this._publicationInfo[i],yield this.sendAnswer(e),yield this.resolveCandidates(),this._log.debug("<handleSenderUnproduce> end",{publicationId:i})})}_handleSenderRestartIce(t){return B(this,arguments,function*({sdp:e}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",Wi({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderRestartIce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderRestartIce({sdp:e});return}throw qe({operationName:"Receiver._handleSenderRestartIce",context:this._context,channel:this.localPerson.channel,info:we(ne({},Qe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:bs.prefix})}this._setConnectionState("reconnecting"),yield this.sendAnswer(e),yield this.resolveCandidates(),this.pc.connectionState==="connected"&&this._setConnectionState("connected")}})}sendAnswer(t){return B(this,null,function*(){this._log.debug("[receiver] start: sendAnswer"),yield this.pc.setRemoteDescription(t);const e=yield this.pc.createAnswer();this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"answer",data:{answer:JSON.stringify(e)},createdAt:Date.now()});const i=So.parse(this.pc.remoteDescription.sdp),n=So.parse(e.sdp);i.media.forEach((o,c)=>{const h=n.media[c];h.fmtp=GS(h.fmtp).map(l=>{const p=o.fmtp.find(g=>g.payload===l.payload);return p||l})});const r=So.write(n);yield this.pc.setLocalDescription({type:"answer",sdp:r});const s={kind:"receiverAnswerMessage",payload:{sdp:this.pc.localDescription}};yield this.signaling.send(this.endpoint,s).catch(o=>this._log.error("failed to send answer",o,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id})),this._log.debug("[receiver] end: sendAnswer")})}get subscriptions(){return this._subscriptions}};Q();var kx=qn(im()),ip=qn(hn()),Tn=new mt("packages/core/src/plugin/internal/person/connection/sender.ts"),Nx=class extends zg{constructor(t,e,i,n,r,s){super(t,e,i,n,r,s,"sender"),this.id=Yr(),this.onConnectionStateChanged=new yt,this.publications={},this.transceivers={},this.datachannels={},this._pendingPublications=[],this._isNegotiating=!1,this.promiseQueue=new Vs,this._disposer=new ar,this._ms=new MediaStream,this._backoffIceRestarted=new Pr({times:8,interval:100,jitter:100}),this._connectionState="new",this._log=Tn.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._unsubscribeStreamEnableChange={},this._cleanupStreamCallbacks={},this.restartIce=()=>B(this,null,function*(){if(this._backoffIceRestarted.exceeded){this._log.error(qe({operationName:"Sender.restartIce",context:this._context,channel:this.localPerson.channel,info:we(ne({},Qe.internal),{detail:"restartIce limit exceeded"}),path:Tn.prefix})),this._setConnectionState("disconnected");return}this._log.warn("[start] restartIce",Wi({operationName:"Sender.restartIce",detail:"start restartIce",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}));const o=()=>{if(this.endpoint.state==="left")return this._log.warn("endpointMemberLeft",Wi({operationName:"restartIce",detail:"endpointMemberLeft",channel:this.localPerson.channel,payload:{endpointId:this.endpoint.id}})),this._setConnectionState("disconnected"),!0;if(this.pc.connectionState==="connected")return this._log.warn("[end] restartIce",Wi({operationName:"restartIce",detail:"reconnected",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),this._backoffIceRestarted.reset(),this._setConnectionState("connected"),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestarted.wait(),o())return;let c=yield this._iceManager.updateIceParams().catch(p=>p);if(c){this._log.warn("[failed] restartIce",Wi({operationName:"restartIce",detail:"update IceParams failed",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),c),yield this.restartIce();return}if(this.pc.setConfiguration&&(this.pc.setConfiguration(we(ne({},this.pc.getConfiguration()),{iceServers:this._iceManager.iceServers})),this._log.debug("<restartIce> setConfiguration",{iceServers:this._iceManager.iceServers})),o())return;if(this.signaling.connectionState!=="connected"){if(this._log.warn("<restartIce> reconnect signaling service",Wi({operationName:"restartIce",detail:"reconnect signaling service",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),c=yield this.signaling.onConnectionStateChanged.watch(p=>p==="connected",1e4).catch(p=>p).then(()=>{}),c instanceof rr){yield this.restartIce();return}if(o())return}const h=yield this.pc.createOffer({iceRestart:!0});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(h)},createdAt:Date.now()}),yield this.pc.setLocalDescription(h);const l={kind:"senderRestartIceMessage",payload:{sdp:this.pc.localDescription}};if(c=yield this.signaling.send(this.endpoint,l,1e4).catch(p=>p),c){this._log.warn("<restartIce> [failed]",Wi({operationName:"restartIce",detail:"timeout send signaling message",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),c),yield this.restartIce();return}c=yield this.waitForConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(p=>p),!(!c&&o())&&(yield this.restartIce())}),this._log.debug("spawned"),this.signaling.onMessage.add(o=>B(this,[o],function*({src:c,data:h}){if(!(c.id===s.id&&c.name===s.name))return;const l=h;switch(l.kind){case"receiverAnswerMessage":this.promiseQueue.push(()=>this._handleReceiverAnswer(l.payload)).catch(p=>this._log.error("handle receiverAnswerMessage",{localPersonId:this.localPerson.id,endpointId:this.endpoint.id,err:p}));break;case"iceCandidateMessage":{const{role:p,candidate:g}=l.payload;p==="receiver"&&(yield this.handleCandidate(g))}break}})).disposer(this._disposer),this.onPeerConnectionStateChanged.add(o=>B(this,null,function*(){try{switch(Tn.debug("onPeerConnectionStateChanged",{state:o}),o){case"disconnected":case"failed":(yield this.waitForConnectionState("connected",t.config.rtcConfig.iceDisconnectBufferTimeout).catch(h=>h))&&this._connectionState!=="reconnecting"&&(yield this.restartIce());break;case"connecting":case"connected":this._setConnectionState(o);break;case"closed":this._setConnectionState("disconnected");break}}catch(c){Tn.error("onPeerConnectionStateChanged",c,this.id)}})).disposer(this._disposer)}_setConnectionState(t){this._connectionState!==t&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,t),this._connectionState=t,this.onConnectionStateChanged.emit(t))}get hasMedia(){const t=Object.keys(this.publications).length;return this._log.debug("hasMedia",{count:t}),t>0}_getMid(t,e){if(t.contentType==="data"){const i=e.media.find(n=>n.type==="application");if((i==null?void 0:i.mid)==null)throw qe({operationName:"Sender._getMid",info:we(ne({},Qe.missingProperty),{detail:"datachannel mid undefined"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel});return i.mid.toString()}else{const n=this.transceivers[t.id].mid;if(n==null)throw qe({operationName:"Sender._getMid",info:we(ne({},Qe.missingProperty),{detail:"media mid undefined"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel});return n.toString()}}_listenStreamEnableChange(t,e){this._unsubscribeStreamEnableChange[e]&&this._unsubscribeStreamEnableChange[e]();const{removeListener:i}=t._onEnableChanged.add(n=>B(this,null,function*(){yield this._replaceTrack(e,n).catch(r=>{Tn.warn(Wi({member:this.localPerson,detail:"_replaceTrack failed",operationName:"Sender._listenStreamEnableChange",payload:r}))})}));this._unsubscribeStreamEnableChange[e]=i}add(t){return B(this,null,function*(){var e,i;if(this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(t),this._log.debug("<add> isNegotiating",{publication:t,isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState,pendingPublications:this._pendingPublications.length});return}this._isNegotiating=!0,this._log.debug("<add> add publication",{publication:t}),this.publications[t.id]=t;const n=t.stream;if(!n)throw qe({operationName:"Sender.add",info:we(ne({},Qe.missingProperty),{detail:"<add> stream not found"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel});if(this._cleanupStreamCallbacks[n.id]=this._setupTransportAccessForStream(n),n.contentType==="data"){const h=this.pc.createDataChannel(new jg(t.id,n.id).toLabel(),n.options);n._onWriteData.add(l=>{h.readyState==="open"&&h.send(l)}).disposer(this._disposer),this.datachannels[t.id]=h}else{t._onReplaceStream.add(l=>B(this,[l],function*({newStream:p,oldStream:g}){p._replacingTrack=!0,this._listenStreamEnableChange(p,t.id),this._cleanupStreamCallbacks[g.id]&&this._cleanupStreamCallbacks[g.id](),this._cleanupStreamCallbacks[p.id]=this._setupTransportAccessForStream(p),yield this._replaceTrack(t.id,p.track),p._replacingTrack=!1,p._onReplacingTrackDone.emit()})).disposer(this._disposer),this._listenStreamEnableChange(n,t.id);const h=this.pc.addTransceiver(n.track,{direction:"sendonly",streams:[this._ms]});t._onEncodingsChanged.add(l=>B(this,null,function*(){yield ko(h.sender,l).catch(p=>{this._log.error("_onEncodingsChanged failed",p)})})).disposer(this._disposer),this.transceivers[t.id]=h}const r=yield this.pc.createOffer().catch(h=>{throw qe({operationName:"Sender.add",info:we(ne({},Qe.internal),{detail:"can't create offer"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel,error:h})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(r)},createdAt:Date.now()}),yield this.pc.setLocalDescription(r);const s=ip.parse(this.pc.localDescription.sdp);this._log.debug("<add> create offer base",s);const o=this._getMid(t,s);if(t.contentType!=="data"){Ox((e=t.codecCapabilities)!=null?e:[],o,s);const h=ip.write(s);if(yield this.pc.setLocalDescription({type:"offer",sdp:h}),this._log.debug("<add> create offer",this.pc.localDescription),((i=t.encodings)==null?void 0:i.length)>0)if(Hg())this._safariSetupEncoding(t);else{const l=this.transceivers[t.id];yield ko(l.sender,[t.encodings[0]])}}const c={kind:"senderProduceMessage",payload:{sdp:this.pc.localDescription,publicationId:t.id,info:{publicationId:t.id,streamId:n.id,mid:o}}};this._log.debug("[start] send message",c),yield this.signaling.send(this.endpoint,c).catch(h=>{throw this._log.error("[failed] send message :",h,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),h}),this._log.debug("[end] send message",c)})}_setupTransportAccessForStream(t){t._getTransportCallbacks[this.endpoint.id]=()=>({rtcPeerConnection:this.pc,connectionState:this._connectionState}),t._getStatsCallbacks[this.endpoint.id]=()=>B(this,null,function*(){if(t.contentType==="data"){const r=yield this.pc.getStats();return Ya(r)}t._replacingTrack&&(yield t._onReplacingTrackDone.asPromise(200));const i=yield this.pc.getStats(t.track);return Ya(i)});const e=()=>{delete t._getTransportCallbacks[this.endpoint.id],delete t._getStatsCallbacks[this.endpoint.id]};return this._disposer.push(()=>{e()}),this.onConnectionStateChanged.add(i=>{t._setConnectionState(this.endpoint,i),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:i},createdAt:Date.now()})}).disposer(this._disposer),e}remove(t){return B(this,null,function*(){const e=this.publications[t];if(!e){this._log.warn("<remove> publication not found",Wi({operationName:"Sender.remove",detail:"publication already removed",channel:this.localPerson.channel,payload:{publicationId:t}}));return}if(delete this.publications[t],this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(t),this._log.debug("<remove> isNegotiating",{publicationId:t,_isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState});return}this._isNegotiating=!0,this._log.debug("<remove> [start]",{publicationId:t});const i=e.stream;if(!i)throw qe({operationName:"Sender.remove",info:we(ne({},Qe.missingProperty),{detail:"<remove> publication not have stream"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel,payload:{publication:e}});i.contentType==="data"?(this.datachannels[t].close(),delete this.datachannels[t]):(this.transceivers[t].stop(),delete this.transceivers[t]);const n=yield this.pc.createOffer().catch(s=>{throw qe({operationName:"Sender.remove",info:we(ne({},Qe.internal),{detail:"<remove> can't create offer"}),path:Tn.prefix,context:this._context,channel:this.localPerson.channel,error:s})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(n)},createdAt:Date.now()}),yield this.pc.setLocalDescription(n);const r={kind:"senderUnproduceMessage",payload:{sdp:this.pc.localDescription,publicationId:t}};this._log.debug("<remove> send message",{message:r}),yield this.signaling.send(this.endpoint,r).catch(s=>{throw this._log.error("<remove> in remote error :",s,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),s}),this._log.debug("<remove> [end]",{publicationId:t})})}_replaceTrack(t,e){return B(this,null,function*(){const i=this.transceivers[t];if(!i){this._log.warn("can't replace track, transceiver not found",Wi({operationName:"Sender._replaceTrack",detail:"transceiver already removed",channel:this.localPerson.channel,payload:{publicationId:t}}));return}yield i.sender.replaceTrack(e).catch(n=>{throw qe({operationName:"Sender._replaceTrack",context:this._context,info:Qe.internal,error:n,path:Tn.prefix,channel:this.localPerson.channel})})})}_handleReceiverAnswer(t){return B(this,arguments,function*({sdp:e}){this.pc.signalingState!=="closed"&&(this._log.debug("<handleReceiverAnswer> [start]"),yield this.pc.setRemoteDescription(new RTCSessionDescription(e)).catch(i=>{const n=qe({operationName:"Sender._handleReceiverAnswer",context:this._context,info:we(ne({},Qe.internal),{detail:"failed to setRemoteDescription"}),path:Tn.prefix,payload:{sdp:e},channel:this.localPerson.channel,error:i});throw this._log.error(n),n}),this._log.debug("<handleReceiverAnswer> sRD"),yield this.resolveCandidates(),this._log.debug("<handleReceiverAnswer> resolveCandidates"),yield this.waitForSignalingState("stable"),this._log.debug("<handleReceiverAnswer> waitForSignalingState"),this._isNegotiating=!1,yield this._resolvePendingSender(),this._log.debug("<handleReceiverAnswer> _resolvePendingSender",this._pendingPublications.length),this._log.debug("<handleReceiverAnswer> [end]"))})}_safariSetupEncoding(t){const e=this.transceivers[t.id],i=t.stream;this.waitForStats({track:i.track,cb:n=>{const r=n.find(s=>s.id.includes("RTCOutboundRTP")||s.type.includes("outbound-rtp"));return(r==null?void 0:r.keyFramesEncoded)>0},interval:10,timeout:this._context.config.rtcConfig.timeout}).then(()=>{Tn.debug("safari wait for stats resolved, setEncodingParams"),ko(e.sender,[t.encodings[0]]).catch(n=>{this._log.error("setEncodingParams failed",n)})}).catch(n=>{this._log.error("waitForStats",n)})}_resolvePendingSender(){return B(this,null,function*(){const t=this._pendingPublications.shift();t&&(this._log.debug("resolve pending sender",{publication:t}),typeof t=="string"?yield this.remove(t):yield this.add(t))})}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),Object.values(this._unsubscribeStreamEnableChange).forEach(t=>t()),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}};function Ox(t,e,i){var n,r;const s=i.media.find(l=>{var p;return((p=l.mid)==null?void 0:p.toString())===e});if(!s)throw qe({operationName:"applyCodecCapabilities",info:we(ne({},Qe.notFound),{detail:"media not found"}),path:Tn.prefix});t.forEach(l=>{var p;if(l.parameters)for(const[g,f]of Object.entries((p=l.parameters)!=null?p:{})){if(f===!1||!l.parameters[g])return;g==="usedtx"&&f&&(l.parameters[g]=1)}});const o=(l,p,g)=>{var f;const y=p.map(v=>we(ne({},v),{parameters:XS(g,v.payload)})),x=np(l.mimeType);return x&&(f=y.find(v=>{var m,w;return v.codec.toLowerCase()!==x.toLowerCase()?!1:Object.keys((m=l.parameters)!=null?m:{}).length===0||Ux(l.mimeType)==="audio"?!0:(0,kx.default)(v.parameters,(w=l.parameters)!=null?w:{})}))!=null?f:void 0},c=t.map(l=>o(l,s.rtp,s.fmtp)).filter(l=>l!=null),h=[...c,...s.rtp.filter(l=>!c.find(p=>p.payload===l.payload))];for(const l of s.fmtp){const p=l.payload,g=h.find(x=>x.payload===p);if(g){const x=t.find(S=>o(S,[g],s.fmtp));x&&x.parameters&&Object.keys(x.parameters).length>0&&(l.config="",Object.entries(x.parameters).forEach(([S,v])=>{v===!1||l.config.includes(S)||(l.config.length>0?l.config+=`;${S}=${v}`:l.config=`${S}=${v}`)}))}const f=h.find(x=>x.codec.toLowerCase()==="opus"),y=(r=(n=t.find(x=>np(x.mimeType).toLowerCase()==="opus"))==null?void 0:n.parameters)==null?void 0:r.usedtx;f&&y!==!1&&l.payload===f.payload&&!l.config.includes("usedtx")&&(l.config.length>0?l.config+=";usedtx=1":l.config="usedtx=1")}s.payloads=h.map(l=>l.payload.toString()).join(" ")}var np=t=>t.split("/")[1],Ux=t=>t.split("/")[0],xc=new mt("packages/core/src/plugin/internal/person/connection/index.ts"),Bx=class{constructor(t,e,i,n,r,s,o){this._iceManager=t,this._signaling=e,this._analytics=i,this._context=n,this.channelId=r,this.localPerson=s,this.remoteMember=o,this.id=Yr(),this.type="p2p",this.onDisconnect=new yt,this.onClose=new yt,this.closed=!1,this.disconnected=!1,this._log=xc.createBlock({id:this.id,localPersonId:this.localPerson.id}),this._pubsubQueue=new Vs,this.sendSubscriptionStatsReportTimers=new Map,this._waitingSendSubscriptionStatsReportsFromPublish=new Map,this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.sender=new Nx(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.receiver=new Fx(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.sender.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this.receiver.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this._analytics&&this._analytics.onConnectionStateChanged.add(c=>{if(c==="connected"){if(this._waitingSendSubscriptionStatsReportsFromPublish.size>0){for(const[h,l]of this._waitingSendSubscriptionStatsReportsFromPublish){const p=this.sender.publications[l];p&&this.startSendSubscriptionStatsReportTimer(p,h)}this._waitingSendSubscriptionStatsReportsFromPublish.clear()}if(this._waitingSendSubscriptionStatsReportsFromSubscribe.length>0){for(const h of this._waitingSendSubscriptionStatsReportsFromSubscribe){const l=this.receiver.subscriptions[h];l&&this.startSendSubscriptionStatsReportTimer(l,h)}this._waitingSendSubscriptionStatsReportsFromSubscribe=[]}}})}startPublishing(t,e){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("startPublishing",{publication:t}),yield this.sender.add(t)})),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:e,role:"sender",rtcPeerConnectionId:this.sender.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(t,e):this._waitingSendSubscriptionStatsReportsFromPublish.set(e,t.id))})}stopPublishing(t){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("<stopPublishing> start",{publication:t}),this.sender.remove(t.id).then(()=>{this._log.debug("<stopPublishing> removed",{publication:t})}).catch(i=>{this._log.error("<stopPublishing> remove failed",i,{publication:t})}),this._closeIfNeeded(),this._log.debug("<stopPublishing> end",{publication:t})}));const e=this.sendSubscriptionStatsReportTimers.get(t.id);e&&(clearInterval(e),this.sendSubscriptionStatsReportTimers.delete(t.id))})}startSubscribing(t){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("startSubscribing",{subscription:t}),this.receiver.add(t);const e=t.publication.id;let i=this.receiver.streams[e];i||(yield this.receiver.onStreamAdded.watch(n=>n.publicationId===e,this._context.config.rtcConfig.timeout).catch(()=>{throw qe({operationName:"P2PConnection.startSubscribing",info:we(ne({},Qe.timeout),{detail:"onStreamAdded"}),path:xc.prefix,context:this._context,channel:this.localPerson.channel,payload:{subscription:t}})}),i=this.receiver.streams[e]),i.setIsEnabled(t.publication.state==="enabled"),t.codec=i.codec,t._setStream(i),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:t.id,role:"receiver",rtcPeerConnectionId:this.receiver.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(t,t.id):this._waitingSendSubscriptionStatsReportsFromSubscribe.push(t.id))}))})}stopSubscribing(t){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("stopSubscribing",{subscription:t}),this.receiver.remove(t.id),this._closeIfNeeded()}));const e=this.sendSubscriptionStatsReportTimers.get(t.id);e&&(clearInterval(e),this.sendSubscriptionStatsReportTimers.delete(t.id))})}_closeIfNeeded(){this.sender.hasMedia||this.receiver.hasMedia||this.close({reason:"no media"})}getStats(t){return B(this,null,function*(){const e=t.stream;if(!e)throw qe({operationName:"P2PConnection.getStats",info:we(ne({},Qe.invalidArgumentValue),{detail:"Subscription or Publication must has stream"}),path:xc.prefix,context:this._context,channel:this.localPerson.channel});return e.side==="local"?e.contentType==="data"?this.sender.pc.getStats():this.sender.pc.getStats(e.track):e.contentType==="data"?this.receiver.pc.getStats():this.receiver.pc.getStats(e.track)})}close({reason:t}={}){if(!this.closed){this.closed=!0,this._log.debug("closed",{endpointId:this.remoteMember.id,reason:t,sender:this.sender.id,receiver:this.receiver.id,id:this.id}),this.sender.close(),this.receiver.close();for(const e of this.sendSubscriptionStatsReportTimers.values())clearInterval(e);this.sendSubscriptionStatsReportTimers.clear(),this._waitingSendSubscriptionStatsReportsFromPublish.clear(),this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.onClose.emit()}}startSendSubscriptionStatsReportTimer(t,e){if(this._analytics){const i=t instanceof kg?"sender":"receiver",n=this._analytics.client.getIntervalSec();this.sendSubscriptionStatsReportTimers.set(t.id,setInterval(()=>B(this,null,function*(){if(!this._analytics)throw qe({operationName:"P2PConnection.sendSubscriptionStatsReportTimer",info:we(ne({},Qe.missingProperty),{detail:"AnalyticsSession not exist"}),path:xc.prefix,context:this._context,channel:this.localPerson.channel});if(this._analytics.isClosed()){const s=this.sendSubscriptionStatsReportTimers.get(t.id);s&&(clearInterval(s),this.sendSubscriptionStatsReportTimers.delete(t.id));return}const r=yield this.getStats(t);r&&this._analytics.client.sendSubscriptionStatsReport(r,{subscriptionId:e,role:i,contentType:t.contentType,createdAt:Date.now()})}),n*1e3))}}},wo=new mt("packages/core/src/plugin/internal/person/member.ts"),tl=class extends Gl{constructor(t){super(t),this.args=t,this.type="person",this.subtype="person",this.side="remote",this._connections={},this._context=this.args.channel._context,this._disposer=new ar,this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.subscribe=e=>new Promise((i,n)=>{let r=!1;this.channel._subscribe(this.id,e).catch(s=>{r=!0,n(s)}),this.onPublicationSubscribed.watch(({subscription:s})=>s.publication.id===e,this._context.config.rtcApi.timeout).then(({subscription:s})=>{i({subscription:s})}).catch(()=>{r||n(qe({operationName:"RemotePersonImpl.subscribe",info:we(ne({},Qe.timeout),{detail:"onPublicationSubscribed"}),path:wo.prefix,context:this._context,channel:this.channel}))})}),this.plugin=t.plugin,this.channel.onPublicationUnsubscribed.add(({subscription:e})=>{e.subscriber.id===this.id&&(this.onPublicationUnsubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onPublicationSubscribed.add(({subscription:e})=>{e.subscriber.id===this.id&&(this.onPublicationSubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onStreamPublished.add(({publication:e})=>{e.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.channel.onStreamUnpublished.add(({publication:e})=>{e.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.onLeft.once(()=>{wo.debug("RemotePerson left: ",this.toJSON()),Object.values(this._connections).forEach(e=>{e.close({reason:"remote person left"})}),this._connections={}})}_getConnection(t){return this._connections[t]}_getOrCreateConnection(t){var e;return(e=this._getConnection(t.id))!=null?e:this._createConnection(this.channel,t,this)}_createConnection(t,e,i){if(e.side!=="local")throw qe({operationName:"RemotePersonImpl._createConnection",info:we(ne({},Qe.invalidArgumentValue),{detail:"wrong localPerson type"}),path:wo.prefix,context:this._context,channel:this.channel});if(!e._signaling)throw qe({operationName:"RemotePersonImpl._createConnection",info:we(ne({},Qe.missingProperty),{detail:"signalingSession not exist"}),path:wo.prefix,context:this._context,channel:this.channel});const n=new Bx(e.iceManager,e._signaling,e._analytics,this._context,t.id,e,i);return this.plugin._messageBuffers[e.id].resolveMessagingBuffer(i),n.onClose.once(()=>{wo.debug("connection closed",this.toJSON(),{connectionId:n.id}),delete this._connections[e.id]}),this._connections[e.id]=n,n}unsubscribe(t){return B(this,null,function*(){yield this.channel._unsubscribe(t)})}_dispose(){this._disposer.dispose()}},Hx=class extends Zu{constructor(){super(...arguments),this.subtype="person",this._messageBuffers={},this._whenCreateLocalPerson=t=>B(this,null,function*(){t._signaling&&(this._messageBuffers[t.id]=new Tx(t._signaling))}),this._whenDisposeLocalPerson=t=>B(this,null,function*(){const e=this._messageBuffers[t.id];e&&(e.close(),delete this._messageBuffers[t.id])}),this._createRemoteMember=(t,e)=>new tl(we(ne({},this._context),{context:this._context,channel:t,metadata:e.metadata,id:e.id,name:e.name,plugin:this}))}},jx=t=>{const e=new Hx;return t.registerPlugin(e),e};Q();var Vx=class extends Zu{constructor(){super(...arguments),this.subtype="unknown",this._createRemoteMember=(t,e)=>new og(we(ne({},this._context),{context:this._context,channel:t,metadata:e.metadata,id:e.id,name:e.name,plugin:this,subtype:e.subtype}))}};Q();var zx="1.12.0",er=new mt("packages/core/src/context.ts"),Gg=class qg{constructor(e,i,n,r){this.config=i,this.authToken=n,this.info=r,this.disposed=!1,this.plugins=[],this._unknownPlugin=new Vx,this._reminderSec=this.config.token.updateReminderSec,this._events=new Zr,this.onTokenUpdateReminder=this._events.make(),this.onTokenExpired=this._events.make(),this.onFatalError=this._events.make(),this._onTokenUpdated=this._events.make(),this._onDisposed=this._events.make(),this._authTokenString=n.tokenString,this.appId=this.authToken.getAppId(),jx(this),this._api=e,this._api.onFatalError.once(s=>{er.error("onFatalError",{appId:this.appId,error:s}),this.onFatalError.emit(qe({operationName:"SkyWayContext._api.onFatalError",context:this,info:Qe.rtcApiFatalError,error:s,path:er.prefix})),this.dispose()})}static Create(e){return B(this,arguments,function*(i,n={}){const r=new Ex(n);mt.level=r.log.level,mt.format=r.log.format;const s=io.Decode(i),{osName:o,osVersion:c,browserName:h,browserVersion:l}=ag(),p={sdkName:"core",sdkVersion:this.version,osName:o,osVersion:c,browserName:h,browserVersion:l},g={rapi:r.rtcApi.domain,signaling:r.signalingService.domain,ice:r.iceParamServer.domain};er.info("core sdk spawned",{operationName:"SkyWayContext.Create",runtime:p,endpoint:g,config:r,token:s});try{const f=s.getAppId(),y=yield yx.Create({appId:f,token:i,log:r.log,rtcApi:r.rtcApi}),x=new qg(y,r,s,{endpoint:g,runtime:p});return yield x._setTokenExpireTimer(),x}catch(f){throw qe({operationName:"SkyWayContext.Create",info:Qe.connectRtcApiFailed,error:f,path:er.prefix})}})}get authTokenString(){return this._authTokenString}_setTokenExpireTimer(){return B(this,null,function*(){const e=yield this._api.getServerUnixtimeInSec(),i=this.authToken.exp-e;if(i<0)throw qe({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Qe.invalidExpireTokenValue,path:er.prefix,payload:{exp:this.authToken.exp,now:e}});this.tokenUpdateReminderTimer&&clearTimeout(this.tokenUpdateReminderTimer);const n=i-this._reminderSec;if(n<0)throw qe({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Qe.invalidRemindExpireTokenValue,path:er.prefix,payload:{expiresInSec:i,reminderSec:this._reminderSec}});er.debug("_setTokenExpireTimer",{expiresInSec:i,tokenExpireReminderTimeSec:n}),this.tokenUpdateReminderTimer=setTimeout(()=>{er.debug("tokenUpdateReminder",{appid:this.appId}),this.onTokenUpdateReminder.emit()},n*1e3),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenExpiredTimer=setTimeout(()=>{er.debug("tokenExpired",{appid:this.appId}),this.onTokenExpired.emit()},i*1e3)})}updateAuthToken(e){return B(this,null,function*(){const i=io.Decode(e),n=i.getAppId();if(er.info({operationName:"SkyWayContext.updateAuthToken"},{oldToken:this.authToken,newToken:i}),n!==this.appId)throw qe({operationName:"SkyWayContext.updateAuthToken",context:this,info:Qe.invalidTokenAppId,path:er.prefix,payload:{invalid:n,expect:this.appId}});this._authTokenString=e,this.authToken=i,this._onTokenUpdated.emit(e),yield this._setTokenExpireTimer(),yield this._api.updateAuthToken(e)})}registerPlugin(e){this.plugins.find(i=>i.subtype===e.subtype)||(e._attachContext(this),this.plugins.push(e))}_createRemoteMember(e,i){const n=e._getMember(i.id);if(n)return n;er.debug("createRemoteMember",{memberDto:i}),i.type=i.type.toLowerCase(),i.subtype=i.subtype.toLowerCase();let r=this.plugins.find(o=>o.subtype===i.subtype);return r||(r=this._unknownPlugin),r._createRemoteMember(e,i)}dispose(){this.disposed||(this.disposed=!0,er.debug("disposed",{appid:this.appId}),clearTimeout(this.tokenUpdateReminderTimer),this._onDisposed.emit(),this._events.dispose(),this._api.close())}};Gg.version=zx;var Wg=Gg,nr=new mt("packages/core/src/external/analytics.ts");function Gx(t,e,i){return B(this,null,function*(){const{analyticsService:n}=t.config,r=new cx({token:t.authTokenString,channelId:e.id,channelName:e.name,memberId:i.id,memberName:i.name,sdkVersion:Wg.version},{logger:{error:(o,c)=>B(null,null,function*(){nr.error(`AnalyticsClient error: ${o}`,qe({operationName:"AnalyticsClient.logger",context:t,info:we(ne({},Qe.internal),{detail:"AnalyticsClient error"}),error:c,path:nr.prefix,channel:e}))}),debug:(o,...c)=>{nr.debug("[analytics]:",o,...c)},warn:(o,...c)=>{nr.warn("[analytics]:",o,...c)}},analyticsLoggingServerDomain:n.domain,secure:n.secure}),s=new qx(r,t);return s.connectWithTimeout().catch(o=>{s.close(),nr.error(`AnalyticsClient error: ${o.message}`,qe({operationName:"AnalyticsClient.logger",context:t,info:we(ne({},Qe.internal),{detail:"AnalyticsClient error"}),error:o,path:nr.prefix,channel:e})),s.onConnectionFailed.emit({})}),s})}var qx=class{constructor(t,e){this.client=t,this.context=e,this.onConnectionFailed=new yt,this.onConnectionStateChanged=new yt,this.onMessage=new yt,this._isClosed=!1,this._listen(),e._onTokenUpdated.add(i=>{this.client.setNewSkyWayAuthToken(i)})}_listen(){this.client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this.client.onConnectionStateChanged.addListener(t=>{t==="closed"&&!this.isClosed()&&this.client.isClosed()&&this.close(),this.onConnectionStateChanged.emit(t)})}get connectionState(){return this.client.connectionState}_connect(){return B(this,null,function*(){nr.debug("[start] connect analyticsService"),yield this.client.connect().then(()=>{nr.debug("[end] connect analyticsService")}).catch(t=>{this.close(),nr.debug("[end] failed connect analyticsService: also unreachable to server"),nr.error(`AnalyticsClient error: ${t.message}`,qe({operationName:"AnalyticsClient.logger",info:we(ne({},Qe.internal),{detail:"AnalyticsClient error"}),error:t,path:nr.prefix})),this.onConnectionFailed.emit({})})})}connectWithTimeout(){return B(this,null,function*(){let t;const e=new Promise((n,r)=>{t=setTimeout(()=>{nr.debug("[end] failed connect analyticsService: no initial response from the server"),r(new Error("failed connect analyticsService"))},3e4)}),i=new Promise((n,r)=>{this.client.onAnalyticsNotEnabledError.addOneTimeListener(s=>{nr.warn(`[end] failed connect analyticsService: ${s.reason}`),n()})});return Promise.race([this._connect(),e,i]).finally(()=>{clearTimeout(t)})})}close(){this._isClosed=!0,this.onConnectionFailed.removeAllListeners(),this.onConnectionStateChanged.removeAllListeners(),this.onMessage.removeAllListeners()}isClosed(){return this._isClosed}};Q();var rp=new mt("packages/core/src/external/ice.ts"),Wx=class{constructor(t){this.args=t,this.domain=this.args.domain,this.version=this.args.version,this.secure=this.args.secure,this.memberId=this.args.memberId,this.channelId=this.args.channelId,this.ttl=this.args.ttl,this.context=this.args.context,this._stunServers=[],this._turnServers=[],this._endpoint=`http${this.secure?"s":""}://${this.domain}/v${this.version}`,this.http=new qu(this._endpoint)}updateIceParams(){return B(this,null,function*(){const t={memberId:this.memberId,channelId:this.channelId,ttl:this.ttl};rp.debug("[start] fetch iceParams");const e=new Pr({times:6,interval:500,jitter:100}),{turn:i,stun:n}=yield this.http.post("/ice-params",t,{headers:{authorization:`Bearer ${this.context.authTokenString}`},retry:()=>e.wait()});i&&(this._turnServers=[{credential:i.credential,urls:`turn:${i.domain}:${i.port}?transport=tcp`,username:i.username},{credential:i.credential,urls:`turn:${i.domain}:${i.port}?transport=udp`,username:i.username},{credential:i.credential,urls:`turns:${i.domain}:${i.port}?transport=tcp`,username:i.username}]),this._stunServers=[{urls:`stun:${n.domain}:${n.port}`}],rp.debug("[end] fetch iceParams",{turn:i,stun:n})})}get iceServers(){let t=[...this._stunServers];const e=this._turnServers.filter(i=>{const n=i.urls;switch(this.context.config.rtcConfig.turnProtocol){case"all":return!0;case"udp":return n.endsWith("udp");case"tcp":return!n.startsWith("turns")&&n.endsWith("tcp");case"tls":return n.startsWith("turns")}});return this.context.config.rtcConfig.turnPolicy!=="disable"&&(t=[...t,...e]),t}};Q();Q();Q();Q();var Kx=20480,Ec=class{constructor(t,e={}){if(this.event=t,this.payload=e,this.eventId=Yr(),this.data=JSON.stringify({event:this.event,eventId:this.eventId,payload:this.payload}),this.data.length>Kx)throw new Error("payload size exceeds the upper limit")}};Q();var Xx=["rateLimitExceeded","targetNotFound","payloadLengthExceeded","invalidPayload","unknown","parameterError","permissionError"];function sp(t){return!(!t||typeof t!="object"||!Kg(t.src)||!t.data||typeof t.data!="object")}function $x(t){return!(!t||typeof t!="object"||typeof t.eventId!="string"||typeof t.ok!="boolean"||typeof t.reason<"u"&&(typeof t.reason!="string"||!Xx.includes(t.reason)))}function Kg(t){return!(t===void 0||Array.isArray(t)||typeof t!="object"||typeof t.id!="string"||typeof t.name<"u"&&typeof t.name!="string")}Q();var ap=qn(Nu());Q();var sa=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=t=>{this._listeners.forEach(e=>e(t))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=t=>{const e=this._listenerIndex;return this._listeners.set(e,t),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(e)}}},this.addOneTimeListener=t=>{const e=this.addListener(i=>{e.removeListener(),t(i)});return e},this.asPromise=t=>new Promise((e,i)=>{let n=()=>{};const r=t&&setTimeout(()=>{i("Event asPromise timeout"),n()},t);n=this.addOneTimeListener(o=>{r&&clearTimeout(r),e(o)}).removeListener})}};Q();var Zx="1.0.4",Yx=["open","sendRequestSignalingMessage","sendResponseSignalingMessage","acknowledge"],Jx=t=>(Fs(2,t)+Math.random())*1e3,Qx=class{constructor({channelId:t,channelName:e,memberId:i,memberName:n,sessionEndpoint:r,token:s,logger:o}){this._isOpen=!1,this._isDestroyed=!1,this._reconnectCount=0,this.connectionState="closed",this.onConnectionStateChanged=new sa,this.onOpened=new sa,this.onEventReceived=new sa,this.onConnectionFailed=new sa,this._sessionEndpoint=r,this._channelId=t,this._channelName=e,this._memberId=i,this._memberName=n,this._token=s,this._logger=o,this._connect()}_setConnectionState(t){this._logger.debug(`connectionState changed : ${t}`),this.connectionState=t,this.onConnectionStateChanged.emit(t)}_connect(){let t;try{const e=`SkyWayAuthToken!${this._token}`,i={channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,platform:"javascript",version:Zx},n=Object.entries(i).filter(([s,o])=>o!==void 0).map(s=>s.join("=")).join("&"),r=`${this._sessionEndpoint}?${n}`;t=new ap.default(r,e),this._logger.debug(`Connecting to signaling-server: ${this._sessionEndpoint}`),t.onerror=s=>{this._logger.error("WebSocket error occurred",s.error),t.close(4202)}}catch(e){const i=e instanceof Error?e:new Error;this._logger.error("Failed to create WebSocket instance",i),this.reconnect();return}t.onopen=()=>{this._logger.debug("Connected to signaling-server")},t.onclose=e=>{const i="Close event fired: "+JSON.stringify({code:e.code,reason:e.reason,type:e.type});if(4100<=e.code&&e.code<=4199?this._logger.error(i,new Error):this._logger.debug(i),e.code!==1e3&&!(4e3<=e.code&&e.code<=4199)){this.reconnect();return}e.code!==4e3&&(this._logger.debug("Closed the connection to signaling-server"),this.onConnectionFailed.emit(),this.destroy())},t.onmessage=e=>{this._messageHandler(e.data)},this._ws=t}updateAuthToken(t){this._token=t}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=8)this.onConnectionFailed.emit(),this.destroy(),this._logger.error("Failed to reconnect for eight times",new Error);else{this._setConnectionState("reconnecting");const t=Jx(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},t)}}destroy(){this._isDestroyed=!0,this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(t){return new Promise((e,i)=>{const n=()=>{this.onOpened.addOneTimeListener(()=>{this.send(t).then(()=>{e()}).catch(r=>{i(r)})}),this.onConnectionFailed.addOneTimeListener(()=>{i(new Error("Connection failed"))})};if(this._isDestroyed){i(new Error("The socket is already destroyed"));return}if(this._ws===void 0||!this._isOpen){this._logger.debug("Retry send the client event when connected because WebSocket is undefined or isOpen = false"),n();return}this._logger.debug(`Send the event: ${t.data}`),this._ws.send(t.data,r=>{if(r){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==ap.default.OPEN){this._logger.debug("Retry send the client event when connected because WebSocket.send failed"),n();return}i(r)}else e()})})}_messageHandler(t){if(typeof t!="string"){this._logger.error("Received invalid message: not string",new Error);return}let e;try{e=JSON.parse(t)}catch(i){const n=i instanceof Error?i:new Error;this._logger.error("Received invalid message: parse error",n);return}if(!eE(e)){this._logger.error(`Received invalid message: ${e}`,new Error);return}e.event==="open"?(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this.onOpened.emit()):(this._logger.debug(`Received the event: ${e.event}, payload: ${JSON.stringify(e.payload)}`),this.onEventReceived.emit(e))}};function eE(t){return!(!t||typeof t!="object"||typeof t.event!="string"||!Yx.includes(t.event)||typeof t.eventId!="string"||t.payload&&typeof t.payload!="object")}var op="signaling.skyway.ntt.com",tE="v1",iE=class{constructor({token:t,channelId:e,channelName:i,memberId:n,memberName:r},s){this.onConnectionStateChanged=new sa,this.onConnectionFailed=new sa,this.onRequested=new sa,this._connectivityCheckTimers=new Map,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._token=t,this._channelId=e,this._channelName=i,this._memberId=n,this._memberName=r;const o={connectivityCheckIntervalSec:30,signalingServerDomain:op,secure:!0,logger:{debug:c=>{console.debug(c)},error:c=>{console.error(c)}}};this._options=Object.assign({},o,s??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var t,e;return(e=(t=this._socket)==null?void 0:t.connectionState)!=null?e:"closed"}connect(){return B(this,null,function*(){const t=this._options.secure?"wss":"ws",e=this._options.signalingServerDomain||op;this._socket=new Qx({sessionEndpoint:`${t}://${e}/${tE}/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger}),this._socket.onEventReceived.addListener(i=>{try{this._eventReceivedHandler(i)}catch(n){this._logger.error("in _eventReceivedHandler",n)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit()}),this._socket.onConnectionStateChanged.addListener(i=>{this.onConnectionStateChanged.emit(i)}),yield this._socket.onOpened.asPromise(15*1e3),this._startConnectivityCheck()})}disconnect(){var t;this._stopConnectivityCheck(),(t=this._socket)==null||t.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}_startConnectivityCheck(){if(this._connectivityCheckInterval){this._logger.debug("connectivity check timer is already set");return}this._connectivityCheckInterval=setInterval(()=>{var t;const e=new Ec("checkConnectivity");(t=this._socket)==null||t.send(e).catch(()=>{this._acknowledgeCallbacks.delete(e.eventId)}),this._connectivityCheckTimers.set(e.eventId,setTimeout(()=>{var i;this._acknowledgeCallbacks.delete(e.eventId),(i=this._socket)==null||i.reconnect(),this._logger.debug("connectivity check timer is expired")},5*1e3)),this._setAcknowledgeCallback(e.eventId,i=>{var n;const r=this._connectivityCheckTimers.get(e.eventId);r&&(clearTimeout(r),this._connectivityCheckTimers.delete(e.eventId)),i.ok||((n=this._socket)==null||n.reconnect(),this._logger.debug("connectivity check response from server was not ok"))})},this._options.connectivityCheckIntervalSec*1e3),this._logger.debug("Started connectivity check timer")}_stopConnectivityCheck(){if(!this._connectivityCheckInterval){this._logger.debug("connectivity check timer is not set");return}clearInterval(this._connectivityCheckInterval),this._connectivityCheckInterval=void 0,this._logger.debug("Stopped connectivity check timer");for(const[t,e]of this._connectivityCheckTimers)clearTimeout(e);this._connectivityCheckTimers.clear()}request(t,e,i=10){return nE(t),cp(e),new Promise((n,r)=>{if(this._socket===void 0){r(new Error("websocket is not connected"));return}const s={dst:t,data:e},o=new Ec("sendRequestSignalingMessage",s),c=setTimeout(()=>{this._acknowledgeCallbacks.delete(o.eventId),r(new Error("request timeout"))},i*1e3);this._setResponseCallback(o.eventId,h=>{clearTimeout(c),n(h)}),this._setAcknowledgeCallback(o.eventId,h=>{h.ok||(clearTimeout(c),r(h))}),this._socket.send(o).catch(h=>{this._acknowledgeCallbacks.delete(o.eventId),clearTimeout(c),r(h)})})}_response(t,e,i,n){return new Promise((r,s)=>{if(cp(i),this._socket===void 0){s(new Error("websocket is not connected"));return}const o={dst:t,requestEventId:e,data:i},c=new Ec("sendResponseSignalingMessage",o),h=setTimeout(()=>{this._acknowledgeCallbacks.delete(c.eventId),s(new Error("response timeout"))},n*1e3);this._setAcknowledgeCallback(c.eventId,l=>{clearTimeout(h),l.ok?r():s(l)}),this._socket.send(c).catch(l=>{this._acknowledgeCallbacks.delete(c.eventId),clearTimeout(h),s(l)})})}updateSkyWayAuthToken(t,e=10){return new Promise((i,n)=>{if(this._socket===void 0){n(new Error("websocket is not connected"));return}const r={token:t},s=new Ec("updateSkyWayAuthToken",r),o=setTimeout(()=>{this._acknowledgeCallbacks.delete(s.eventId),n(new Error("updateSkyWayAuthToken timeout"))},e*1e3);this._setAcknowledgeCallback(s.eventId,c=>{if(clearTimeout(o),c.ok){if(this._socket===void 0){n(new Error("websocket is not connected"));return}this._socket.updateAuthToken(t),i()}else n(c)}),this._socket.send(s).catch(c=>{this._acknowledgeCallbacks.delete(s.eventId),clearTimeout(o),n(c)})})}_eventReceivedHandler(t){switch(t.event){case"acknowledge":this._acknowledgeHandler(t.payload);break;case"sendRequestSignalingMessage":this._eventMessageRequestHandler(t.payload);break;case"sendResponseSignalingMessage":this._eventMessageResponseHandler(t.payload);break;case"open":break;default:t.event,this._logger.debug(`Unknown event: ${t.event}`)}}_acknowledgeHandler(t){if(!$x(t))throw new Error("Invalid payload");const{eventId:e}=t;if(!this._acknowledgeCallbacks.has(e))throw new Error(`acknowledge event has unknown eventId: ${e}`);const i=this._acknowledgeCallbacks.get(e);i&&(this._acknowledgeCallbacks.delete(e),i(t))}_eventMessageRequestHandler(t){if(!sp(t))throw new Error("Invalid payload");if(!t.requestEventId)throw new Error("Invalid payload");const e=t.src,i=t.requestEventId,n=(r,s=10)=>B(this,null,function*(){yield this._response(e,i,r,s)});this.onRequested.emit({data:t.data,reply:n,requestEventId:t.requestEventId,src:t.src})}_eventMessageResponseHandler(t){if(!sp(t))throw new Error("Invalid payload");if(!t.requestEventId||!this._responseCallbacks.has(t.requestEventId))throw new Error(`received response has unknown eventId: ${t.requestEventId}`);const e=this._responseCallbacks.get(t.requestEventId);e&&(this._responseCallbacks.delete(t.requestEventId),e(t.data))}_setResponseCallback(t,e){this._responseCallbacks.set(t,e)}_setAcknowledgeCallback(t,e){this._acknowledgeCallbacks.set(t,e)}};function cp(t){if(!t||typeof t!="object")throw new Error("the type of data must be object")}function nE(t){if(!Kg(t))throw new Error("the type of target must be {id: string, name: string}");if(!ew(t.id))throw new Error("the type of target.id must be uuid format")}Q();var hr=new mt("packages/core/src/external/signaling.ts");function rE(t,e,i){return B(this,null,function*(){const{signalingService:n}=t.config,r=new iE({token:t.authTokenString,channelId:e.id,channelName:e.name,memberId:i.id,memberName:i.name},{logger:{error:o=>B(null,null,function*(){hr.error("SignalingClient error",qe({operationName:"SignalingClient.logger",context:t,info:we(ne({},Qe.internal),{detail:"signalingClient error"}),error:o,path:hr.prefix,channel:e}))}),debug:o=>{}},signalingServerDomain:n.domain,secure:n.secure}),s=new sE(r,t);return yield s.connect(),s})}var sE=class{constructor(t,e){this._client=t,this.context=e,this.onConnectionFailed=new yt,this.onConnectionStateChanged=new yt,this.onMessage=new yt,this.closed=!1,this._chunkedMessageBuffer={},this._backoffUpdateSkyWayAuthToken=new Pr({times:8,interval:100,jitter:100}),this._disposer=new ar,this._listen(),e._onTokenUpdated.add(i=>B(this,null,function*(){yield this._updateSkyWayAuthToken(i)})).disposer(this._disposer)}updateClient(t){this._client=t,this._listen()}_listen(){this._client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this._client.onConnectionStateChanged.addListener(t=>{hr.debug("signalingClient onConnectionStateChanged",t),this.onConnectionStateChanged.emit(t)}),this._client.onRequested.addListener(t=>B(this,[t],function*({data:e,src:i,reply:n}){var r;const s=e,{chunk:o,length:c,offset:h,id:l,type:p}=s;if(p===wd){if(c===0)this.onMessage.emit({src:i,data:JSON.parse(o)});else if(this._chunkedMessageBuffer[l]=[...(r=this._chunkedMessageBuffer[l])!=null?r:[],s.chunk],c===h){const g=this._chunkedMessageBuffer[l].join("");delete this._chunkedMessageBuffer[l],this.onMessage.emit({src:i,data:JSON.parse(g)})}yield n({}).catch(g=>{this.closed||hr.warn("failed to reply",Wi({operationName:"SignalingSession.reply",detail:"SignalingClient failed to reply"}),g)})}}))}_updateSkyWayAuthToken(t){return B(this,null,function*(){if(this._backoffUpdateSkyWayAuthToken.exceeded){hr.error("[failed] updateSkyWayAuthToken");return}yield this._backoffUpdateSkyWayAuthToken.wait(),hr.debug("[start] updateSkyWayAuthToken",{count:this._backoffUpdateSkyWayAuthToken.count});const e=yield this._client.updateSkyWayAuthToken(t).catch(i=>i);if(e){hr.warn("[retry] updateSkyWayAuthToken",Wi({operationName:"SignalingSession._updateSkyWayAuthToken",detail:"[retry] updateSkyWayAuthToken"}),e),yield this._updateSkyWayAuthToken(t);return}hr.debug("[end] updateSkyWayAuthToken"),this._backoffUpdateSkyWayAuthToken.reset()})}get connectionState(){return this._client.connectionState}connect(){return B(this,null,function*(){hr.debug("[start] connect signalingService"),yield this._client.connect().catch(t=>{throw qe({operationName:"signalingSession.connect",path:hr.prefix,info:we(ne({},Qe.internal),{detail:"signalingClient failed to connect Server"}),context:this.context,error:t})}),hr.debug("[end] connect signalingService")})}close(){this.closed=!0,this._disposer.dispose(),this._client.disconnect()}send(t,e,i=1e4){return B(this,null,function*(){var n;try{const r=JSON.stringify(e),s=lo();if(r.length>20480){const o=(n=r.match(/.{1,20480}/g))!=null?n:[];let c=0;for(const h of o){const l={type:wd,length:o.length-1,offset:c++,chunk:h,id:s};yield this._client.request(t,l,i/1e3)}}else{const o={type:wd,length:0,offset:0,chunk:r,id:s};yield this._client.request(t,o,i/1e3)}}catch(r){if(this.closed||t.state!=="joined")return;throw qe({operationName:"SignalingSession.send",context:this.context,info:we(ne({},Qe.internal),{detail:"signalingClient"}),error:r,path:hr.prefix,payload:{target:t,data:e}})}})}},wd="signalingMessage",lp=new mt("packages/core/src/member/person/local/factory.ts");function aE(t,e,i){return B(this,arguments,function*(n,r,s,{keepaliveIntervalSec:o,keepaliveIntervalGapSec:c,disableSignaling:h,disableAnalytics:l}={}){var p;lp.debug("createLocalPerson",{channel:r,memberDto:s,keepaliveIntervalSec:o,keepaliveIntervalGapSec:c});const{iceParamServer:g}=n.config,f=h===!0?void 0:yield rE(n,r,s),x=io.Decode(n.authTokenString).getAnalyticsEnabled(),S=l===!0||!x?void 0:yield Gx(n,r,s),v=new Wx(we(ne({},g),{memberId:s.id,channelId:r.id,ttl:Y1,context:n}));yield v.updateIceParams().catch(w=>{throw qe({operationName:"createLocalPerson",context:n,channel:r,info:we(ne({},Qe.internal),{detail:"updateIceParams failed"}),path:lp.prefix,error:w})});const m=yield oE.Create({iceManager:v,channel:r,signaling:f,analytics:S,metadata:s.metadata,name:s.name,id:s.id,keepaliveIntervalSec:o,keepaliveIntervalGapSec:c,context:n});for(const w of n.plugins)yield(p=w._whenCreateLocalPerson)==null?void 0:p.call(w,m),m._onDisposed.once(()=>B(null,null,function*(){var b;yield(b=w._whenDisposeLocalPerson)==null?void 0:b.call(w,m)}));return m})}var qt=new mt("packages/core/src/member/localPerson/index.ts"),oE=class Xg extends Gl{constructor(e){super(e),this.args=e,this.type="person",this.subtype="person",this.side="local",this.keepaliveIntervalSec=this.args.keepaliveIntervalSec,this.keepaliveIntervalGapSec=this.args.keepaliveIntervalGapSec,this.disableSignaling=this.args.disableSignaling,this.disableAnalytics=this.args.disableAnalytics,this.config=this.context.config,this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this._onStreamSubscribeFailed=this._events.make(),this._onDisposed=this._events.make(),this._disposer=new ar,this._subscribing={},this._requestQueue=new Vs,this.iceManager=this.args.iceManager,this._disposed=!1,this._publishingAgent=new $1(this),this._subscribingAgent=new Z1(this),this._signaling=e.signaling,this._analytics=e.analytics,this._listenChannelEvent(),this._listenBeforeUnload()}static Create(...e){return B(this,null,function*(){const i=new Xg(...e);return yield i._setupTtlTimer(),i})}_listenChannelEvent(){this.channel.onPublicationSubscribed.add(e=>B(this,[e],function*({subscription:i}){yield this._handleOnPublicationSubscribe(i).catch(n=>qt.error("_handleOnStreamSubscribe",n))})).disposer(this._disposer),this.channel.onPublicationUnsubscribed.add(e=>B(this,[e],function*({subscription:i}){yield this._handleOnPublicationUnsubscribe(i).catch(n=>qt.error("_handleOnStreamUnsubscribe",n))})).disposer(this._disposer),this.channel._onDisposed.once(()=>{this.dispose()}),this.onLeft.once(()=>{this.dispose()})}_setupTtlTimer(){return B(this,null,function*(){const{keepaliveIntervalSec:e,keepaliveIntervalGapSec:i}=this;if(e==null||(qt.debug("_setupTtlTimer",this.toJSON(),{keepaliveIntervalSec:e,keepaliveIntervalGapSec:i}),e===-1))return;const n=()=>B(this,null,function*(){if(this._disposed)return;const r=yield this.context._api.getServerUnixtimeInSec();this.ttlSec=Math.floor(r+e+(i??0));try{yield this.channel._updateMemberTtl(this.id,this.ttlSec),qt.debug("updateTtl",this.toJSON(),{now:r,ttlSec:this.ttlSec,keepaliveIntervalSec:e??0,keepaliveIntervalGapSec:i??0,diff:this.ttlSec-r})}catch(s){if(this._disposed)return;throw s}});yield n(),this.ttlInterval=setInterval(()=>B(this,null,function*(){yield n().catch(r=>{this._disposed||(this.onFatalError.emit(qe({operationName:"localPerson._setupTtlTimer",path:qt.prefix,info:we(ne({},Qe.internal),{detail:"updateMemberTtl failed"}),channel:this.channel,context:this.context,error:r})),this.dispose())})}),e*1e3)})}_listenBeforeUnload(){if(window){const e=()=>B(this,null,function*(){window.removeEventListener("beforeunload",e),this.state==="joined"&&(qt.debug("leave by beforeunload",this.toJSON()),yield this.leave())});window.addEventListener("beforeunload",e)}}_handleOnPublicationSubscribe(e){return B(this,null,function*(){var i;if(e.subscriber.id===this.id)try{const n=qt.info("[start] startSubscribing",yield Qt({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:e}),r=(i=this._subscribing[e.publication.id])==null?void 0:i.options;r&&(e.preferredEncoding=r.preferredEncodingId),yield this._subscribingAgent.startSubscribing(e),this.onPublicationSubscribed.emit({subscription:e,stream:e.stream}),this.onSubscriptionListChanged.emit(),qt.elapsed(n,"[end] startSubscribing",yield Qt({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:e})}catch(n){throw this._onStreamSubscribeFailed.emit({error:n,subscription:e}),n}if(e.publication.publisher.id===this.id){if(e.subscriber.id===this.id)throw qe({operationName:"localPerson._handleOnStreamSubscribe",path:qt.prefix,info:we(ne({},Qe.internal),{detail:"can not subscribe own Publication"}),channel:this.channel,context:this.context});const n=qt.info("[start] startPublishing",yield Qt({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:e});yield this._publishingAgent.startPublishing(e).catch(r=>{throw qt.error("[failed] startPublishing",r,{subscription:e}),r}),qt.elapsed(n,"[end] startPublishing",yield Qt({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:e})}})}_handleOnPublicationUnsubscribe(e){return B(this,null,function*(){if(e.publication.publisher.id===this.id){const i=qt.info("[start] stopPublishing",yield Qt({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:e});yield this._publishingAgent.stopPublishing(e.publication,e.subscriber).catch(n=>{throw qt.error("[failed] stopPublishing",n,{subscription:e}),n}),qt.elapsed(i,"[end] stopPublishing",yield Qt({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:e})}if(e.subscriber.id===this.id){const i=qt.info("[start] stopSubscribing",yield Qt({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:e});yield this._subscribingAgent.stopSubscribing(e).catch(n=>{throw qt.error("[failed] stopSubscribing",{subscription:e},n),n}),this.onPublicationUnsubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit(),qt.elapsed(i,"[end] stopSubscribing",yield Qt({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:e})}})}publish(e){return B(this,arguments,function*(i,n={}){var r,s,o,c;const h=qt.info("[start] publish",yield Qt({operationName:"localPerson.publish",channel:this.channel}),{options:n});if(this.state!=="joined")throw qe({operationName:"localPerson.publish",info:Qe.localPersonNotJoinedChannel,path:qt.prefix,channel:this.channel,context:this.context});if(i.published)throw qe({operationName:"localPerson.publish",channel:this.channel,context:this.context,info:Qe.alreadyPublishedStream,path:qt.prefix});i.published=!0,n.codecCapabilities&&(n.codecCapabilities=n.codecCapabilities.filter(f=>f!=null));const l={metadata:n.metadata,publisher:this.id,channel:this.channel.id,contentType:i.contentType,codecCapabilities:(r=n.codecCapabilities)!=null?r:[],isEnabled:n.isEnabled};i.contentType==="video"&&l.codecCapabilities.length===0&&(l.codecCapabilities=[{mimeType:"video/vp8"}]),n.encodings&&n.encodings.length>0&&(l.encodings=Su(Ng(n.encodings)));const p=yield this._requestQueue.push(()=>this.channel._publish(l).catch(f=>{throw qe({operationName:"localPerson.publish",context:this.context,channel:this.channel,info:f.info,path:qt.prefix,error:f})}));i.contentType==="data"?i.setIsEnabled(p.isEnabled):yield i.setEnabled(p.isEnabled);const g=this.channel._addPublication(p);if(g._setStream(i),(s=l.codecCapabilities)!=null&&s.length&&g.setCodecCapabilities(l.codecCapabilities),(o=l.encodings)!=null&&o.length&&g.setEncodings(l.encodings),yield this._handleOnStreamPublish(g),qt.elapsed(h,"[end] publish",yield Qt({operationName:"localPerson.publish",channel:this.channel}),{publication:g}),["video","audio"].includes(g.contentType)&&this._analytics&&!this._analytics.isClosed()){this._analytics.client.sendMediaDeviceReport({publicationId:g.id,mediaDeviceName:g.deviceName,mediaDeviceTrigger:"publish",updatedAt:Date.now()});const f=(c=l.encodings)!=null?c:[];this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:g.id,encodings:f,updatedAt:Date.now()})}return g})}_handleOnStreamPublish(e){return B(this,null,function*(){qt.info("onStreamPublished",yield Qt({operationName:"onStreamPublished",channel:this.channel})),this.onStreamPublished.emit({publication:e}),this.onPublicationListChanged.emit()})}unpublish(e){return B(this,null,function*(){const i=qt.info("[start] unpublish",yield Qt({operationName:"localPerson.unpublish",channel:this.channel})),n=typeof e=="string"?e:e.id;if(this.state!=="joined")throw qe({operationName:"localPerson.unpublish",info:Qe.localPersonNotJoinedChannel,path:qt.prefix,context:this.context,channel:this.channel});const r=this.channel._getPublication(n);if(!r)throw qe({operationName:"localPerson.unpublish",info:Qe.publicationNotExist,path:qt.prefix,context:this.context,channel:this.channel,payload:{publicationId:n}});r.stream&&r.stream._unpublished(),yield this._requestQueue.push(()=>this.channel._unpublish(n)),r.subscriptions.map(s=>s.subscriber).forEach(s=>{X1(s)&&this._publishingAgent.stopPublishing(r,s).catch(o=>{qt.error("[failed] stopPublishing",o,{publication:r})})}),yield this._handleOnStreamUnpublished(r),qt.elapsed(i,"[end] unpublish",yield Qt({operationName:"localPerson.unpublish",channel:this.channel}),{publication:r})})}_handleOnStreamUnpublished(e){return B(this,null,function*(){qt.info("onStreamUnpublished",yield Qt({operationName:"onStreamUnpublished",channel:this.channel})),this.onStreamUnpublished.emit({publication:e}),this.onPublicationListChanged.emit()})}subscribe(e){return B(this,arguments,function*(i,n={}){const r=qt.info("[start] subscribe",yield Qt({operationName:"localPerson.subscribe",channel:this.channel}),{target:i}),s=typeof i=="string"?i:i.id;if(this.state!=="joined")throw qe({operationName:"localPerson.subscribe",info:Qe.localPersonNotJoinedChannel,path:qt.prefix,context:this.context,channel:this.channel,payload:{target:i}});const o=this.channel._getPublication(s);if(o==null)throw qe({operationName:"localPerson.subscribe",info:Qe.publicationNotExist,path:qt.prefix,context:this.context,channel:this.channel,payload:o});this._validatePublicationForSubscribe(o),this._subscribing[o.id]={options:n,processing:!0};const c=this._subscribing[o.id];try{const h=yield this._requestQueue.push(()=>this.channel._subscribe(this.id,s));qt.elapsed(r,"[elapsed] subscribe / subscriptionDto received",{subscriptionDto:h});const l=this.channel._addSubscription(h);return l.stream||(yield Promise.race([new Promise((p,g)=>{this.onPublicationSubscribed.watch(({subscription:f})=>f.publication.id===s,this.context.config.rtcApi.timeout).then(p).catch(f=>B(this,null,function*(){c.processing&&g(qe({operationName:"localPerson.subscribe",info:we(ne({},Qe.timeout),{detail:"failed to subscribe publication. maybe publisher already left room"}),path:qt.prefix,context:this.context,channel:this.channel,payload:{subscription:l,publication:o},error:f}))}))}),new Promise((p,g)=>{this.channel.onMemberLeft.watch(f=>f.member.id===o.publisher.id,this.context.config.rtcApi.timeout+1e3).then(()=>{c.processing&&g(qe({operationName:"localPerson.subscribe",info:we(ne({},Qe.internal),{detail:"failed to subscribe publication. publisher already left room"}),path:qt.prefix,context:this.context,channel:this.channel,payload:{subscription:l,publication:o}}))}).catch(p)}),new Promise((p,g)=>{this._onStreamSubscribeFailed.watch(f=>f.subscription.publication.id===o.id,this.context.config.rtcApi.timeout+1e3).then(f=>{var y,x;if(c.processing){const S=(x=(y=f==null?void 0:f.error)==null?void 0:y.info)!=null?x:we(ne({},Qe.internal),{detail:"subscribe _onStreamSubscribeFailed"});g(qe({operationName:"localPerson.subscribe",info:S,path:qt.prefix,context:this.context,channel:this.channel,error:f.error,payload:{subscription:l,publication:o}}))}}).catch(p)})])),c.processing=!1,qt.elapsed(r,"[end] subscribe",yield Qt({operationName:"localPerson.subscribe",channel:this.channel}),{subscription:l,publication:o}),{subscription:l,stream:l.stream}}catch(h){throw c.processing=!1,qt.warn("[failed] subscribe",h,{publication:o}),h}})}_validatePublicationForSubscribe(e){if(e.publisher.id===this.id)throw qe({operationName:"localPerson._validatePublicationForSubscribe",info:Qe.publicationNotExist,path:qt.prefix,context:this.context,channel:this.channel,payload:{publication:e}});if(e.publisher instanceof og)throw qe({operationName:"localPerson._validatePublicationForSubscribe",info:Qe.unknownMemberType,path:qt.prefix,context:this.context,channel:this.channel,payload:{publication:e}});if(this.subscriptions.find(i=>i.publication.id===e.id))throw qe({operationName:"localPerson._validatePublicationForSubscribe",info:Qe.alreadySubscribedPublication,path:qt.prefix,context:this.context,channel:this.channel,payload:{publication:e}})}unsubscribe(e){return B(this,null,function*(){const i=qt.info("[start] unsubscribe",yield Qt({operationName:"localPerson.unsubscribe",channel:this.channel})),n=typeof e=="string"?e:e.id;if(this.state!=="joined")throw qe({operationName:"localPerson.unsubscribe",info:Qe.localPersonNotJoinedChannel,path:qt.prefix,context:this.context,channel:this.channel});const r=this.subscriptions.find(s=>s.id===n);if(!r)throw qe({operationName:"localPerson.unsubscribe",info:Qe.subscriptionNotExist,path:qt.prefix,context:this.context,channel:this.channel,payload:{subscriptionId:n}});delete this._subscribing[r.publication.id],yield this._requestQueue.push(()=>this.channel._unsubscribe(n)),qt.elapsed(i,"[end] unsubscribe",yield Qt({operationName:"localPerson.unsubscribe",channel:this.channel}),{subscription:r})})}_getConnections(){return this.channel.members.map(n=>n._getConnection(this.id)).filter(n=>(n==null?void 0:n.closed)===!1)}dispose(){this._disposed||(this._disposed=!0,qt.debug("disposed",this.toJSON()),clearInterval(this.ttlInterval),this._signaling&&this._signaling.close(),this._analytics&&this._analytics.close(),this._getConnections().forEach(e=>e.close({reason:"localPerson disposed"})),this._onDisposed.emit(),this._events.dispose(),this._disposer.dispose())}};Q();Q();var Gr=new mt("packages/core/src/subscription/index.ts"),cE=class{constructor(t){this._disposer=new ar,this._state="enabled",this.onCanceled=new yt,this.onStreamAttached=new yt,this.onConnectionStateChanged=new yt,this._onChangeEncoding=new yt,this.cancel=()=>new Promise((e,i)=>{let n=!1;this._channel._unsubscribe(this.id).catch(r=>{n=!0,i(r)}),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>e()).catch(r=>{n||i(r)})}),this._channel=t.channel,this._context=this._channel._context,this.id=t.id,this.contentType=t.contentType,this.subscriber=t.subscriber,this.publication=t.publication,Gr.debug("subscription spawned",this.toJSON()),this._handlePublicationEnabled()}get state(){return this._state}_handlePublicationEnabled(){this.publication.onDisabled.add(()=>{this.stream&&(Gr.debug("disabled",this),this.stream.setIsEnabled(!1))}).disposer(this._disposer),this.publication.onEnabled.add(()=>{this.stream&&(Gr.debug("enabled",this),this.stream.setIsEnabled(!0))}).disposer(this._disposer),this.stream&&this.stream.setIsEnabled(this.publication.state==="enabled")}_setStream(t){this._stream=t,this.onStreamAttached.emit(),t._onConnectionStateChanged.add(e=>{Gr.debug("onConnectionStateChanged",this.id,e),this.onConnectionStateChanged.emit(e)})}get stream(){return this._stream}toJSON(){return{id:this.id,contentType:this.contentType,subscriber:this.subscriber,publication:this.publication,channelId:this._channel.id,state:this.state,stream:this.stream}}_canceled(){this._state="canceled",this.onCanceled.emit(),this._disposer.dispose()}changePreferredEncoding(t){if(!this.stream)throw qe({operationName:"SubscriptionImpl.changePreferredEncoding",info:Qe.streamNotExistInSubscription,path:Gr.prefix,context:this._context,channel:this._channel});if(this.stream.contentType==="data")throw qe({operationName:"SubscriptionImpl.changePreferredEncoding",info:Qe.dataStreamNotSupportEncoding,path:Gr.prefix,context:this._context,channel:this._channel});if(!this.publication.encodings.map(e=>e.id).includes(t))throw qe({operationName:"SubscriptionImpl.changePreferredEncoding",info:Qe.correspondingEncodeNotExistForId,path:Gr.prefix,context:this._context,channel:this._channel});this.preferredEncoding=t,this._onChangeEncoding.emit()}getStats(){if(!this.stream)throw qe({operationName:"SubscriptionImpl.getStats",info:Qe.streamNotExistInSubscription,path:Gr.prefix,context:this._context,channel:this._channel});return this.stream._getStats()}getRTCPeerConnection(){if(!this.stream)throw qe({operationName:"SubscriptionImpl.getRTCPeerConnection",info:Qe.streamNotExistInSubscription,path:Gr.prefix,context:this._context,channel:this._channel});return this.stream._getRTCPeerConnection()}getConnectionState(){if(!this.stream)throw qe({operationName:"SubscriptionImpl.getConnectionState",info:Qe.streamNotExistInSubscription,path:Gr.prefix,context:this._context,channel:this._channel});return this.stream._getConnectionState()}};function lE(t,{subscriberId:e,publicationId:i,id:n}){const r=t._getSubscription(n);if(r)return r;const o=t._getPublication(i).contentType;return new cE({channel:t,id:n,subscriber:t._getMember(e),publication:t._getPublication(i),contentType:o})}var wi=new mt("packages/core/src/channel/index.ts"),xd=class{constructor(t,e){this._context=t,this._channelImpl=e,this.id=this._channelImpl.id,this.name=this._channelImpl.name,this.appId=this._context.appId,this.disposed=!1,this.config=this._context.config,this._state="opened",this._api=this._context._api,this._members={},this._getMember=i=>this._members[i],this._publications={},this._getPublication=i=>this._publications[i],this._subscriptions={},this._getSubscription=i=>this._subscriptions[i],this._events=new Zr,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this._onDisposed=this._events.make(),this.leave=i=>B(this,null,function*(){return this._channelImpl.leave(this.id,i.id)}),this.updateMetadata=i=>this._channelImpl.updateChannelMetadata(i),this.close=()=>new Promise((i,n)=>B(this,null,function*(){if(this.state==="closed"){n(qe({operationName:"SkyWayChannelImpl.close",path:wi.prefix,info:Qe.alreadyChannelClosed,channel:this,context:this._context,payload:this.toJSON()}));return}const r=wi.info("[start] close channel",yield Qt({operationName:"SkyWayChannelImpl.close",channel:this}));try{yield this._channelImpl.close().catch(s=>{throw qe({operationName:"SkyWayChannelImpl.close",context:this._context,info:we(ne({},Qe.internal),{detail:"_api.deleteChannel failed"}),error:s,path:wi.prefix,channel:this})}),this._state!=="closed"&&(yield this.onClosed.asPromise(this._context.config.rtcApi.timeout).catch(s=>{throw qe({operationName:"SkyWayChannelImpl.close",context:this._context,info:we(ne({},Qe.timeout),{detail:"channel.onClosed"}),error:s,path:wi.prefix,channel:this})}))}catch(s){wi.error(s.message,s),n(s)}wi.elapsed(r,"[end] close channel",yield Qt({operationName:"SkyWayChannelImpl.close",channel:this})),i()})),this._updateMemberTtl=(i,n)=>this._channelImpl.updateMemberTtl(i,n),this._updateMemberMetadata=(i,n)=>this._channelImpl.updateMemberMetadata(i,n),this._publish=i=>this._channelImpl.publish(i),this._unpublish=i=>B(this,null,function*(){return this._channelImpl.unpublish(i)}),this._subscribe=(i,n)=>{const r=this._getPublication(n),s=this._getMember(i);if(s==null)throw qe({operationName:"SkyWayChannelImpl._subscribe",path:wi.prefix,info:we(ne({},Qe.internal),{detail:"subscriber not found"}),channel:this,context:this._context,payload:{subscriberId:i,publicationId:n}});return this._channelImpl.subscribe({publication:r.toJSON(),subscriber:s.toJSON()})},this._unsubscribe=i=>B(this,null,function*(){if(!this._getSubscription(i))throw qe({operationName:"SkyWayChannelImpl._unsubscribe",path:wi.prefix,info:we(ne({},Qe.internal),{detail:"can't unsubscribe not exist subscription"}),channel:this,context:this._context,payload:{subscriptionId:i}});yield this._channelImpl.unsubscribe(i)}),this._updatePublicationMetadata=(i,n)=>this._channelImpl.updatePublicationMetadata(i,n),this._disablePublication=i=>this._channelImpl.disablePublication(i),this._enablePublication=i=>this._channelImpl.enablePublication(i),this._setupPropertiesFromChannel(),this._setupListenChannelEvent(),t._onDisposed.once(()=>{this.dispose()}),wi.debug("channel spawned",this.toJSON())}_addMember(t){const e=this._getMember(t.id);if(e)return e;const i=this._context._createRemoteMember(this,t);return this._members[i.id]=i,i}_removeMember(t){delete this._members[t]}_addPublication(t){const e=this._getPublication(t.id);if(e)return e;const i=K1(this,t);return this._publications[t.id]=i,i}_removePublication(t){delete this._publications[t]}_addSubscription(t){const e=this._getSubscription(t.id);if(e)return e;const i=lE(this,t);return this._subscriptions[t.id]=i,i}_removeSubscription(t){delete this._subscriptions[t]}get localPerson(){return this._localPerson}get members(){return Object.values(this._members)}get bots(){return this.members.filter(t=>t.type==="bot")}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}get metadata(){return this._channelImpl.metadata}get state(){return this._state}toJSON(){return{id:this.id,name:this.name,appId:this.appId,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}_setupPropertiesFromChannel(){this._channelImpl.members.forEach(t=>{this._addMember(t)}),this._channelImpl.publications.forEach(t=>{this._addPublication(t)}),this._channelImpl.subscriptions.forEach(t=>{this._addSubscription(t)})}_setupListenChannelEvent(){this._channelImpl.onClosed.add(()=>this._handleOnChannelClose()),this._channelImpl.onMetadataUpdated.add(({channel:t})=>this._handleOnChannelMetadataUpdate(t.metadata)),this._channelImpl.onMemberJoined.add(({member:t})=>{this._handleOnMemberJoin(t)}),this._channelImpl.onMemberLeft.add(({member:t})=>{this._handleOnMemberLeft(t)}),this._channelImpl.onMemberListChanged.pipe(this.onMemberListChanged),this._channelImpl.onMemberMetadataUpdated.add(({member:t})=>{this._handleOnMemberMetadataUpdate(t,t.metadata)}),this._channelImpl.onStreamPublished.add(({publication:t})=>{this._handleOnStreamPublish(t)}),this._channelImpl.onStreamUnpublished.add(({publication:t})=>{this._handleOnStreamUnpublish(t)}),this._channelImpl.onPublicationListChanged.pipe(this.onPublicationListChanged),this._channelImpl.onPublicationMetadataUpdated.add(({publication:t})=>{this._handleOnPublicationMetadataUpdate(t,t.metadata)}),this._channelImpl.onPublicationEnabled.add(t=>B(this,[t],function*({publication:e}){return yield this._handleOnPublicationEnabled(e)})),this._channelImpl.onPublicationDisabled.add(t=>B(this,[t],function*({publication:e}){return yield this._handleOnPublicationDisabled(e)})),this._channelImpl.onPublicationSubscribed.add(({subscription:t})=>{this._handleOnStreamSubscribe(t)}),this._channelImpl.onPublicationUnsubscribed.add(({subscription:t})=>{this._handleOnStreamUnsubscribe(t)}),this._channelImpl.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged)}_handleOnChannelClose(){this._state="closed",this.onClosed.emit({}),this.dispose()}_handleOnChannelMetadataUpdate(t){this.onMetadataUpdated.emit({metadata:t})}_handleOnMemberJoin(t){const e=this._addMember(t);this.onMemberJoined.emit({member:e})}_handleOnMemberLeft(t){var e;const i=this._getMember(t.id);this._removeMember(i.id),i._left(),((e=this.localPerson)==null?void 0:e.id)===t.id&&(this.localPerson._left(),this._localPerson=void 0),this.onMemberLeft.emit({member:i})}_handleOnMemberMetadataUpdate(t,e){var i;const n=this._getMember(t.id);n._metadataUpdated(e),((i=this.localPerson)==null?void 0:i.id)===t.id&&this.localPerson._metadataUpdated(e),this.onMemberMetadataUpdated.emit({member:n,metadata:e})}_handleOnStreamPublish(t){const e=this._addPublication(t);this.onStreamPublished.emit({publication:e})}_handleOnStreamUnpublish(t){const e=this._getPublication(t.id);this._removePublication(e.id),e._unpublished(),this.onStreamUnpublished.emit({publication:e})}_handleOnPublicationMetadataUpdate(t,e){const i=this._getPublication(t.id);i._updateMetadata(e),this.onPublicationMetadataUpdated.emit({publication:i,metadata:e})}_handleOnPublicationEnabled(t){return B(this,null,function*(){const e=this._getPublication(t.id);e._enable(),this.onPublicationEnabled.emit({publication:e})})}_handleOnPublicationDisabled(t){return B(this,null,function*(){const e=this._getPublication(t.id);yield e._disable(),this.onPublicationDisabled.emit({publication:e})})}_handleOnStreamSubscribe(t){const e=this._addSubscription(t);this._getPublication(e.publication.id)._subscribed(e),this.onPublicationSubscribed.emit({subscription:e})}_handleOnStreamUnsubscribe(t){const e=this._getSubscription(t.id);this._removeSubscription(e.id),e._canceled(),this._getPublication(e.publication.id)._unsubscribed(e),this.onPublicationUnsubscribed.emit({subscription:e})}join(){return B(this,arguments,function*(t={}){var e,i;const n=wi.info("[start] join",yield Qt({operationName:"SkyWayChannelImpl.join",channel:this}));if(this._localPerson)throw qe({operationName:"SkyWayChannelImpl.join",path:wi.prefix,info:Qe.alreadyLocalPersonExist,channel:this,context:this._context});if(t.name!=null&&this.members.find(l=>l.name===t.name))throw qe({operationName:"SkyWayChannelImpl.join",path:wi.prefix,info:Qe.alreadySameNameMemberExist,channel:this,context:this._context,payload:t});(e=t.keepaliveIntervalSec)!=null||(t.keepaliveIntervalSec=this.config.member.keepaliveIntervalSec),(i=t.keepaliveIntervalGapSec)!=null||(t.keepaliveIntervalGapSec=this.config.member.keepaliveIntervalGapSec);const r=we(ne({},t),{type:"person",subtype:"person"});t.keepaliveIntervalSec!==null&&(r.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+t.keepaliveIntervalSec);const s=yield this._channelImpl.joinChannel(r).catch(h=>{throw wi.error("[failed] join",h),h});wi.elapsed(n,"[elapsed] join / channelImpl.joinChannel",{member:s});const o=yield this._createLocalPerson(s,t),c=new $h(o);return wi.elapsed(n,"[end] join",{person:o}),c})}moveChannel(t){return B(this,null,function*(){if(this._localPerson)throw qe({operationName:"SkyWayChannelImpl.moveChannel",path:wi.prefix,info:Qe.alreadyLocalPersonExist,channel:this,context:this._context});if(!(t instanceof $h))throw qe({operationName:"SkyWayChannelImpl.moveChannel",path:wi.prefix,info:Qe.invalidArgumentValue,channel:this,context:this._context});const e=t.channel;if(this.id===e.id)throw qe({operationName:"SkyWayChannelImpl.moveChannel",path:wi.prefix,info:Qe.cantMoveSameIdChannel,channel:this,context:this._context});yield e.leave(t);const i={name:t.name,type:t.type,subtype:t.subtype,metadata:t.metadata};t.keepaliveIntervalSec!=null&&(i.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+t.keepaliveIntervalSec);const n=yield this._channelImpl.joinChannel(i),r=yield this._createLocalPerson(n,{keepaliveIntervalSec:t.keepaliveIntervalSec,keepaliveIntervalGapSec:t.keepaliveIntervalGapSec,disableSignaling:t.disableSignaling,disableAnalytics:t.disableAnalytics});t.apply(r)})}_createLocalPerson(t,e){return B(this,null,function*(){const i=yield aE(this._context,this,t,e);return this._localPerson=i,i})}dispose(){this.disposed||(this.disposed=!0,wi.debug("disposed",this.toJSON()),this._channelImpl.dispose(),this._onDisposed.emit(),this._events.dispose())}},Yu=class{static Create(t){return B(this,arguments,function*(e,i={}){const n=wi.info("[start] createChannel",{operationName:"SkyWayChannel.Create"}),r=yield e._api.createChannel(i).catch(o=>{throw wi.error("[failed] createChannel",o),o}),s=new xd(e,r);return wi.elapsed(n,"[end] createChannel"),s})}static Find(t,e){return B(this,null,function*(){const i=wi.info("[start] findChannel",{operationName:"SkyWayChannel.Find"}),n=yield t._api.findChannel(e).catch(s=>{throw wi.error("[failed] findChannel",s),s}),r=new xd(t,n);return wi.elapsed(i,"[end] findChannel"),r})}static FindOrCreate(t,e){return B(this,null,function*(){const i=wi.info("[start] findOrCreateChannel",{operationName:"SkyWayChannel.FindOrCreate"}),n=yield t._api.findOrCreateChannel(e).catch(s=>{throw wi.error("[failed] findOrCreateChannel",s),s}),r=new xd(t,n);return wi.elapsed(i,"[end] findOrCreateChannel"),r})}constructor(){}};Q();Q();Q();var Ed=new mt("packages/core/src/media/factory.ts"),dE=class{constructor(){if(this.onDeviceChange=new yt,this._devices=[],!(navigator!=null&&navigator.mediaDevices))throw qe({operationName:"StreamFactory.constructor",info:Qe.mediaDevicesNotFound,path:Ed.prefix});navigator.mediaDevices.addEventListener("devicechange",()=>B(this,null,function*(){const t=yield this._enumerateDevicesArray(),e=[];this._devices.forEach(n=>{t.map(r=>r.id).includes(n.id)||e.push(n)});const i=[];t.map(n=>n.id).forEach(n=>{this._devices.map(r=>r.id).includes(n)||i.push(t.find(r=>r.id===n))}),Ed.debug("device changed",{added:i,removed:e}),e.forEach(n=>{this.onDeviceChange.emit({state:"removed",device:n})}),i.forEach(n=>{this.onDeviceChange.emit({state:"added",device:n})}),this._devices=t}))}_enumerateDevicesArray(){return B(this,null,function*(){return(yield navigator.mediaDevices.enumerateDevices()).map(e=>new hE(e)).filter(e=>e.id.length>0)})}_enumerateDevicesWithAuth(){return B(this,arguments,function*({video:t,audio:e}={audio:!0,video:!0}){let i=[];return(t||e)&&(i=(yield navigator.mediaDevices.getUserMedia({video:t,audio:e})).getTracks()),this._devices=yield this._enumerateDevicesArray(),i.forEach(n=>n.stop()),this._devices})}enumerateDevices(){return B(this,null,function*(){return yield this._enumerateDevicesWithAuth()})}enumerateInputVideoDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({video:!0})).filter(e=>e.kind==="videoinput")})}enumerateInputAudioDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(e=>e.kind==="audioinput")})}enumerateOutputAudioDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(e=>e.kind==="audiooutput")})}createCameraVideoStream(){return B(this,arguments,function*(t={}){var e;t.stopTrackWhenDisabled=(e=t.stopTrackWhenDisabled)!=null?e:!0;const[i]=(yield navigator.mediaDevices.getUserMedia({video:t})).getTracks(),n=new _d(i,t);return n._setLabel("camera"),n})}createMicrophoneAudioStream(){return B(this,arguments,function*(t={}){var e;t.stopTrackWhenDisabled=(e=t.stopTrackWhenDisabled)!=null?e:!0;const[i]=(yield navigator.mediaDevices.getUserMedia({audio:t})).getTracks(),n=new vd(i,t);return n._setLabel("microphone"),n})}createDisplayStreams(){return B(this,arguments,function*(t={}){var e,i,n;const r=(e=t.video)!=null?e:{};(i=r.stopTrackWhenDisabled)!=null||(r.stopTrackWhenDisabled=!0);let s=t.audio;s&&(s=typeof s=="boolean"?{}:s,(n=s.stopTrackWhenDisabled)!=null||(s.stopTrackWhenDisabled=!0)),t={audio:s,video:r};const o=yield navigator.mediaDevices.getDisplayMedia(t),[c]=o.getVideoTracks(),[h]=o.getAudioTracks();t.audio&&!h&&Ed.warn(Wi({operationName:"StreamFactory.createDisplayStreams",detail:"This client does not support device audio capture"}));const l=new _d(c,we(ne({},r),{isDisplayMedia:!0}));l._setLabel("displayVideo");const p=h?new vd(h,we(ne({},s),{isDisplayMedia:!0})):void 0;return p&&p._setLabel("displayAudio"),{video:l,audio:p}})}createDataStream(){return B(this,arguments,function*(t={}){return new $u(t)})}createMicrophoneAudioAndCameraStream(){return B(this,arguments,function*({audio:t,video:e}={}){var i,n;const r=yield navigator.mediaDevices.getUserMedia({audio:t??!0,video:e??!0}),[s]=r.getAudioTracks(),[o]=r.getVideoTracks();t=t??{},t.stopTrackWhenDisabled=(i=t.stopTrackWhenDisabled)!=null?i:!0;const c=new vd(s,t);c._setLabel("microphone"),e=e??{},e.stopTrackWhenDisabled=(n=e.stopTrackWhenDisabled)!=null?n:!0;const h=new _d(o,e);return h._setLabel("camera"),{audio:c,video:h}})}createCustomVideoStream(t){return B(this,arguments,function*(e,i={}){var n,r;i.stopTrackWhenDisabled=(n=i.stopTrackWhenDisabled)!=null?n:!0;const s=new q1(i),o=yield e.createProcessedStream({constraints:(r=i.constraints)!=null?r:{},stopTrackWhenDisabled:i.stopTrackWhenDisabled,onUpdateTrack:c=>s.updateTrack(c)});return yield s.setStream(o),s})}},uE=new dE,hE=class{constructor(t){this.id=t.deviceId,this.label=t.label,this.kind=t.kind}};Q();Q();Q();Q();Q();Q();Q();Q();Q();Q();var $g={domain:"sfu.skyway.ntt.com",secure:!0,version:4};Q();var Ts={invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストの値が不正です",solution:"正しい値を入力してください"},notFound:{name:"notFound",detail:"対象のリソースが見つかりません",solution:"対象のリソースが存在するか確かめてください"},maxSubscriberExceededError:{name:"maxSubscribersExceededError",detail:"forwardingのmaxSubscribersの制限を超えています。maxSubscribersの値を超えてSubscribeすることはできません",solution:"maxSubscribersの範囲内でご利用ください"},quotaExceededError:{name:"quotaExceededError",detail:"リソースの制限量を超えてリソースを利用することはできません",solution:"リソース制限量の範囲内でご利用ください"},timeout:{name:"timeout",detail:"",solution:""},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています",solution:"tokenに必要な権限を付与してください"},backendError:{name:"backendError:",detail:"",solution:""},notAllowedConsumeError:{name:"notAllowedConsumeError",detail:"ForwardingからのConsume許可がありません",solution:"Forwardingしているmemberによる許可操作が必要です"}};Q();function Xs({operationName:t,info:e,error:i,path:n,payload:r}){return new rr({error:i,info:e,payload:{payload:r,operationName:t},path:n})}function xo({appId:t,detail:e,channelId:i,operationName:n,payload:r,memberId:s,botId:o}){return{operationName:n,payload:r,detail:e,appId:t,channelId:i,memberId:s,botId:o}}var En=new mt("packages/sfu-api-client/src/api.ts"),pE=class{constructor(t,e){this._token=t,this._headers={authorization:`Bearer ${this._token}`},this.options=ne(ne({},$g),e),this.endpoint=`http${this.options.secure?"s":""}://${this.options.domain}/v${this.options.version}`,this.http=new qu(this.endpoint),mt.level=this.options.log.level,mt.format=this.options.log.format,En.debug("SfuRestApiClient spawned",{endpoint:this.endpoint})}updateToken(t){this._token=t}_commonErrorHandler(t,e){switch(t==null?void 0:t.status){case 401:return Xs({operationName:e,info:Ts.invalidRequestParameter,path:En.prefix,payload:t});case 403:return Xs({operationName:e,info:Ts.insufficientPermissions,path:En.prefix,payload:t});case 404:return Xs({operationName:e,info:Ts.notFound,path:En.prefix,payload:t});case 429:return Xs({operationName:e,info:Ts.quotaExceededError,path:En.prefix,payload:t});default:return Xs({operationName:e,info:Ts.backendError,path:En.prefix,payload:t})}}createBot(t){return B(this,arguments,function*({appId:e,channelId:i}){return(yield this.http.post("/bots",{appId:e,channelId:i},{headers:{authorization:`Bearer ${this._token}`}}).catch(r=>{throw this._commonErrorHandler(r,"SfuRestApiClient.createBot")})).id})}deleteBot(t){return B(this,arguments,function*({botId:e}){yield this.http.delete(`/bots/${e}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(i=>{throw this._commonErrorHandler(i,"SfuRestApiClient.deleteBot")})})}startForwarding(t){return B(this,arguments,function*({botId:e,publicationId:i,maxSubscribers:n,contentType:r,publisherId:s}){const o=new Pr,c={publicationId:i,maxSubscribers:n,contentType:r[0].toUpperCase()+r.slice(1),publisherId:s},h=yield this.http.post(`/bots/${e}/forwardings`,c,{headers:{authorization:`Bearer ${this._token}`},retry:l=>B(this,null,function*(){return[400,403,429].includes(l.status)?!1:yield o.wait()})}).catch(l=>{throw this._commonErrorHandler(l,"SfuRestApiClient.startForwarding")});return o.count>0&&En.warn("success to retry startForwarding",xo({operationName:"SfuRestApiClient.startForwarding",detail:"success to retry startForwarding",botId:e,memberId:s,payload:{publicationId:i,count:o.count}})),h})}createProducer(t){return B(this,arguments,function*({botId:e,forwardingId:i,transportId:n,producerOptions:r}){const s=new Pr,o=yield this.http.put(`/bots/${e}/forwardings/${i}/transports/producers`,{transportId:n,producerOptions:r},{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield s.wait()})}).catch(c=>{throw this._commonErrorHandler(c,"SfuRestApiClient.createProducer")});return s.count>0&&En.warn("success to retry createProducer",xo({operationName:"SfuRestApiClient.createProducer",detail:"success to retry createProducer",botId:e,payload:{forwardingId:i,transportId:n,count:s.count}})),o})}createConsumer(t){return B(this,arguments,function*({botId:e,forwardingId:i,rtpCapabilities:n,subscriptionId:r,subscriberId:s,spatialLayer:o,originPublicationId:c}){const h=new Pr({times:5,interval:100}),l={rtpCapabilities:n,subscriptionId:r,subscriberId:s,spatialLayer:o,originPublicationId:c},p=yield this.http.post(`/bots/${e}/forwardings/${i}/transports/consumers`,l,{retry:g=>B(this,null,function*(){return[400,403,429].includes(g.status)?!1:yield h.wait()}),headers:{authorization:`Bearer ${this._token}`}}).catch(g=>{throw g.status===429?Xs({operationName:"SfuRestApiClient.createConsumer",info:Ts.maxSubscriberExceededError,path:En.prefix,payload:g}):g.status===403?Xs({operationName:"SfuRestApiClient.createConsumer",info:Ts.notAllowedConsumeError,path:En.prefix,payload:g}):this._commonErrorHandler(g,"SfuRestApiClient.createConsumer")});return h.count>0&&En.warn("success to retry createConsumer",xo({operationName:"SfuRestApiClient.createConsumer",detail:"success to retry createConsumer",botId:e,payload:{forwardingId:i,count:h.count}})),En.debug("response of createConsumer",p),p})}connect(t){return B(this,arguments,function*({transportId:e,dtlsParameters:i}){const n=new Pr,r={transportId:e,dtlsParameters:i},s=yield this.http.put("/transports/connections",r,{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield n.wait()})}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.connect")});return n.count>0&&En.warn("success to retry connect",xo({operationName:"SfuRestApiClient.connect",detail:"success to retry connect",payload:{transportId:e,count:n.count}})),s})}changeConsumerLayer(t){return B(this,arguments,function*({transportId:e,consumerId:i,spatialLayer:n,publicationId:r}){return yield this.http.put(`transports/consumers/${i}/layers`,{transportId:e,spatialLayer:n,publicationId:r},{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.changeConsumerLayer")})})}stopForwarding({botId:t,forwardingId:e}){let i=!1;return{promise:this.http.delete(`/bots/${t}/forwardings/${e}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(r=>{throw this._commonErrorHandler(r,"SfuRestApiClient.stopForwarding")}).then(r=>{i=r}),fulfilled:i}}iceRestart(t){return B(this,arguments,function*({transportId:e}){return(yield this.http.put("/transports/connections/ice",{transportId:e},{headers:this._headers}).catch(n=>{throw this._commonErrorHandler(n,"SfuRestApiClient.iceRestart")})).iceParameters})}getRtpCapabilities(t){return B(this,arguments,function*({botId:e,forwardingId:i,originPublicationId:n}){const r=new Pr,s=yield this.http.get(`/bots/${e}/forwardings/${i}/transports/rtp-capabilities?originPublicationId=${n}`,{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield r.wait()})}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.getRtpCapabilities")});return r.count>0&&En.warn("getCapabilities to retry connect",xo({operationName:"SfuRestApiClient.getRtpCapabilities",detail:"getCapabilities to retry connect",botId:e,payload:{forwardingId:i,count:r.count}})),s.rtpCapabilities})}confirmSubscription(t){return B(this,arguments,function*({forwardingId:e,subscriptionId:i,identifierKey:n}){const r={forwardingId:e,subscriptionId:i,identifierKey:n},s=yield this.http.post("/confirm-subscription",r,{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.confirmSubscription")});return En.debug("response of confirmSubscription",s),s})}},vi=we(ne({},Ts),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},sfuBotNotInChannel:{name:"sfuBotNotInChannel",detail:"SfuBotがChannelに存在しません",solution:"操作しようとしているSfuBotが正しいか確かめてください"},remotePublisherId:{name:"remotePublisherId",detail:"publisherがremoteのPublicationをForwardingすることはできません",solution:"PublicationがLocalでPublishされたものか確かめてください"},dataStreamNotSupported:{name:"dataStreamNotSupported",detail:"dataStreamはSFUに対応していません",solution:"ありません"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},invalidPreferredEncoding:{name:"invalidPreferredEncoding",detail:"preferredEncodingの値が不正です。エンコード設定切り替え機能が使えません",solution:"正しい文字列を入力してください"},invalidEncodings:{name:"invalidEncodings",detail:"エンコード設定が設定されていません。エンコード設定切り替え機能が使えません",solution:"エンコード設定切り替え機能を利用する場合はエンコード設定をしたPublicationをForwardingしてください"},receiverNotFound:{name:"receiverNotFound",detail:"SFUはRemoteMemberのSubscriptionを操作できません",solution:"SFUでsubscriptionの操作をする際にはLocalPersonがSubscribeしているSubscriptionインスタンスを利用してください"},consumerNotFound:{name:"consumerNotFound",detail:"SFUはLocalPersonがUnsubscribeしたSubscriptionを操出来ません",solution:"操作対象のSubscriptionが正しいか確かめてください"},forwardingNotFound:{name:"forwardingNotFound",detail:"存在しないForwardingを操作しようとしています",solution:"対象のForwardingが正しいか確かめてください"},netWorkError:{name:"netWorkError",detail:"通信環境に問題があります",solution:"ネットワーク接続状況を確認してください"},confirmSubscriptionFailed:{name:"confirmSubscriptionFailed",detail:"Forwardingのconsume許可を出すのに失敗しました",solution:"ありません"}});Q();function xu(t,e){let i=0;for(;i<e.length&&e[i].id!==t;i++);return i}function ia({channel:t,detail:e,operationName:i,payload:n,bot:r}){var s;const o={operationName:i,payload:n,detail:e};return t&&(o.appId=t.appId,o.channelId=t.id,t.localPerson&&(o.memberId=t.localPerson.id)),r&&(o.botId=r.id,o.appId=r.channel.appId,o.channelId=r.channel.id,o.memberId=(s=r.channel.localPerson)==null?void 0:s.id),o}Q();var lr=new mt("packages/sfu-bot/src/connection/receiver.ts"),fE=class{constructor(t,e,i,n,r,s,o){this.subscription=t,this._api=e,this._transportRepository=i,this._localPerson=n,this._bot=r,this._iceManager=s,this._context=o,this._disposer=new ar,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const c=this._localPerson._analytics;c&&c.onConnectionStateChanged.add(h=>{if(h==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const l of this._waitingSendSubscriptionStatsReports)this.consumer&&this.consumer.id===l&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}toJSON(){return{transport:this.transport,subscription:this.subscription}}consume(){return B(this,null,function*(){var t,e;let i=this._transportRepository.rtpCapabilities;i||(lr.debug("[start] getCapabilities"),i=yield this._api.getRtpCapabilities({botId:this._bot.id,forwardingId:this.subscription.publication.id,originPublicationId:this.subscription.publication.origin.id}),lr.debug("[end] getCapabilities"),yield this._transportRepository.loadDevice(i).catch(y=>{throw qe({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:we(ne({},vi.internal),{detail:"sfu loadDevice failed"}),path:lr.prefix,error:y})}));const n=this.subscription.preferredEncoding?xu(this.subscription.preferredEncoding,(e=(t=this.subscription.publication.origin)==null?void 0:t.encodings)!=null?e:[]):void 0;lr.debug("[start] createConsumer",{subscription:this.subscription});const{consumerOptions:r,transportOptions:s,transportId:o,producerId:c}=yield this._api.createConsumer({botId:this._bot.id,forwardingId:this.subscription.publication.id,rtpCapabilities:i,subscriptionId:this.subscription.id,subscriberId:this.subscription.subscriber.id,spatialLayer:n,originPublicationId:this.subscription.publication.origin.id});s&&this._transportRepository.createTransport(this._localPerson.id,this._bot,s,"recv",this._iceManager,this._localPerson._analytics),this.transport=this._transportRepository.getTransport(this._localPerson.id,o),this.transport||(lr.warn("transport is under race condition",{transportId:o}),yield this._transportRepository.onTransportCreated.watch(y=>y===o,this._bot.options.endpointTimeout).catch(y=>{throw qe({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:we(ne({},vi.timeout),{detail:"receiver sfuTransport not found"}),path:lr.prefix,error:y,payload:{transportOptions:s,transportId:o,producerId:c,consumerOptions:r,subscription:this.subscription}})}),this.transport=this._transportRepository.getTransport(this._localPerson.id,o)),this._localPerson._analytics&&!this._localPerson._analytics.isClosed()&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:this.subscription.id,role:"receiver",rtcPeerConnectionId:this.transport.id}),lr.debug("[end] createConsumer"),lr.debug("[start] consume",{consumerOptions:r,subscription:this.subscription});const h=yield this.transport.msTransport.consume(we(ne({},r),{producerId:c})).catch(y=>{throw qe({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:we(ne({},vi.internal),{detail:"consume failed, maybe subscribing unsupported codec"}),path:lr.prefix,error:y})});this.consumer=h,lr.debug("[end] consume",{subscription:this.subscription});const[l]=h.rtpParameters.codecs,p=wu(lo(),h.track,l),g={mimeType:l.mimeType,parameters:l.parameters};this._setupTransportAccessForStream(p,h);const f=this._localPerson._analytics;return f&&!f.isClosed()&&(f.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(h.id)),{stream:p,codec:g}})}_setupTransportAccessForStream(t,e){const i=this.transport,n=this.pc;t._getTransport=()=>({rtcPeerConnection:n,connectionState:i.connectionState,info:this}),t._getStats=()=>B(this,null,function*(){const r=yield e.getStats();let s=Ya(r);return s=s.map(o=>(o.sfuTransportId=i.id,o)),s}),this._disposer.push(()=>{t._getTransport=()=>{}}),i.onConnectionStateChanged.add(r=>{lr.debug("transport connection state changed",i.id,r),t._setConnectionState(r)})}unconsume(){if(!this.consumer){lr.debug("unconsume failed, consumer not exist",{subscription:this.subscription});return}this.consumer.close(),this.consumer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer)}close(){this._disposer.dispose()}get pc(){var t;return(t=this.transport)==null?void 0:t.pc}startSendSubscriptionStatsReportTimer(){const t=this._localPerson._analytics;if(t){const e=t.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>B(this,null,function*(){if(!t||t.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this.consumer){const i=yield this.consumer.getStats();i&&t.client.sendSubscriptionStatsReport(i,{subscriptionId:this.subscription.id,role:"receiver",contentType:this.subscription.contentType,createdAt:Date.now()})}}),e*1e3)}}};Q();var dp=qn(im());Q();var Cc=new mt("packages/sfu-bot/src/connection/sender.ts"),mE=class{constructor(t){this.props=t,this.state="started",this.configure=this.props.configure,this.originPublication=this.props.originPublication,this.relayingPublication=this.props.relayingPublication,this._identifierKey=this.props.identifierKey,this._api=this.props.api,this._context=this.props.context,this.onStopped=new yt,this.relayingPublication.onSubscribed.add(e=>B(this,null,function*(){yield this.confirmSubscription(e.subscription).catch(i=>i)})),this.relayingPublication.subscriptions.forEach(e=>B(this,null,function*(){yield this.confirmSubscription(e).catch(i=>i)}))}get id(){return this.relayingPublication.id}_stop(){this.state="stopped",this.onStopped.emit()}toJSON(){return{id:this.id,configure:this.configure,originPublication:this.originPublication,relayingPublication:this.relayingPublication}}confirmSubscription(t){return B(this,null,function*(){Cc.debug("[start] Forwarding confirmSubscription");const{message:e}=yield this._api.confirmSubscription({forwardingId:this.id,subscriptionId:t.id,identifierKey:this._identifierKey}).catch(i=>{throw Cc.error("Forwarding confirmSubscription failed:",i),qe({operationName:"Forwarding.confirmSubscription",context:this._context,info:vi.confirmSubscriptionFailed,path:Cc.prefix,payload:i})});Cc.debug("[end] Forwarding confirmSubscription",{message:e})})}},Mi=new mt("packages/sfu-bot/src/connection/sender.ts"),gE=class{constructor(t,e,i,n,r,s,o,c){this.publication=t,this.channel=e,this._api=i,this._transportRepository=n,this._localPerson=r,this._bot=s,this._iceManager=o,this._context=c,this._disposer=new ar,this._connectionState="new",this.onConnectionStateChanged=new yt,this.closed=!1,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const h=this._localPerson._analytics;h&&h.onConnectionStateChanged.add(l=>{if(l==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const p of this._waitingSendSubscriptionStatsReports)this._producer&&this._producer.id===p&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}_setConnectionState(t){this._connectionState!==t&&(Mi.debug("_setConnectionState",{state:t,forwardingId:this.forwardingId}),this._connectionState=t,this.onConnectionStateChanged.emit(t))}toJSON(){return{forwarding:this.forwarding,broadcasterTransport:this._broadcasterTransport,_connectionState:this._connectionState}}startForwarding(t){return B(this,null,function*(){if(this.publication.contentType==="data")throw qe({operationName:"Sender.startForwarding",context:this._context,info:vi.dataStreamNotSupported,path:Mi.prefix,channel:this.channel});const e=this.publication.stream;if(!e)throw qe({operationName:"Sender.startForwarding",context:this._context,info:vi.streamNotExistInPublication,path:Mi.prefix,channel:this.channel});this.onConnectionStateChanged.add(y=>{var x;Mi.debug("transport connection state changed",(x=this._broadcasterTransport)==null?void 0:x.id,y),e._setConnectionState(this._bot,y)}).disposer(this._disposer),Mi.debug("[start] Sender startForwarding",{botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:t.maxSubscribers});const{forwardingId:i,broadcasterTransportId:n,broadcasterTransportOptions:r,rtpCapabilities:s,identifierKey:o}=yield this._api.startForwarding({botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:t.maxSubscribers,publisherId:this.publication.publisher.id});if(this.forwardingId=i,r&&(Mi.debug("sender create new transport",{broadcasterTransportOptions:r}),yield this._transportRepository.loadDevice(s),this._broadcasterTransport=this._transportRepository.createTransport(this._localPerson.id,this._bot,r,"send",this._iceManager,this._localPerson._analytics)),this._broadcasterTransport=this._transportRepository.getTransport(this._localPerson.id,n),!this._broadcasterTransport)throw qe({operationName:"Sender.startForwarding",context:this._context,info:we(ne({},vi.internal),{detail:"_broadcasterTransport not found"}),path:Mi.prefix,channel:this.channel,payload:{broadcasterTransportOptions:r}});this._broadcasterTransport.onConnectionStateChanged.add(y=>{this._setConnectionState(y)}).disposer(this._disposer),this._setConnectionState(this._broadcasterTransport.connectionState);const c=yield this._produce(e,this._broadcasterTransport);this._cleanupStreamCallbacks=this._setupTransportAccessForStream(e,this._broadcasterTransport,c);const h=this._localPerson._analytics;h&&!h.isClosed()&&(h.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(c.id)),Mi.debug("[end] Sender startForwarding",{forwardingId:i});let l=this.channel._getPublication(i);l||(l=(yield this.channel.onStreamPublished.watch(y=>y.publication.id===i,this._context.config.rtcApi.timeout).catch(()=>{throw qe({operationName:"Sender.startForwarding",context:this._context,info:we(ne({},vi.timeout),{detail:"SfuBotMember onStreamPublished"}),path:Mi.prefix,channel:this.channel,payload:{forwardingId:i}})})).publication);const p=new mE({configure:t,originPublication:this.publication,relayingPublication:l,api:this._api,context:this._context,identifierKey:o});this.forwarding=p;const g=this.channel.subscriptions.find(y=>y.publication.id===this.publication.id),[f]=c.rtpParameters.codecs;return g.codec=f,this._localPerson._analytics&&this._localPerson._analytics.client.connectionState!=="closed"&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:g.id,role:"sender",rtcPeerConnectionId:this._broadcasterTransport.id}),Hg()&&Hh({stream:e,remoteMember:this._bot.id,end:y=>{const x=y.find(S=>S.id.includes("RTCOutboundRTP")||S.type.includes("outbound-rtp"));return(x==null?void 0:x.keyFramesEncoded)>0},interval:10}).then(()=>B(this,null,function*(){const y=this.publication.encodings;(y==null?void 0:y.length)>0&&(yield ko(c.rtpSender,y).catch(x=>{Mi.error("_onEncodingsChanged failed",x,this)}))})).catch(y=>{Mi.error("setEncodingParams waitForLocalStats failed",y,this)}),Hh({stream:e,remoteMember:this._bot.id,end:y=>!!y.find(x=>x.type.includes("local-candidate"))}).then(()=>B(this,null,function*(){const y=yield Qt({operationName:"startForwarding/waitForLocalStats",channel:this.channel});Mi.debug(y,"forwarding connection connected",{broadcasterTransportId:n})})).catch(()=>{}),p})}_listenStreamEnableChange(t){this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange();const{removeListener:e}=t._onEnableChanged.add(i=>B(this,null,function*(){yield this._replaceTrack(i).catch(n=>{Mi.warn(ia({detail:"replaceTrack failed",operationName:"Sender._listenStreamEnableChange",bot:this._bot,payload:n}))})}));this._unsubscribeStreamEnableChange=e}_produce(t,e){return B(this,null,function*(){var i,n,r,s,o,c,h,l;this.publication._onReplaceStream.add(m=>B(this,[m],function*({newStream:w}){if(!this._broadcasterTransport)throw qe({operationName:"Sender._produce",context:this._context,info:we(ne({},vi.internal),{detail:"_broadcasterTransport not found"}),path:Mi.prefix,channel:this.channel});this._listenStreamEnableChange(w),this._cleanupStreamCallbacks&&this._cleanupStreamCallbacks(),this._cleanupStreamCallbacks=this._setupTransportAccessForStream(w,this._broadcasterTransport,v),yield this._replaceTrack(w.track)})).disposer(this._disposer),this._listenStreamEnableChange(t);const p=lo(),g={track:t.track,stopTracks:!1,appData:{transactionId:p},disableTrackOnPause:!1},f=this.publication.encodings;f&&(g.encodings=f),this.publication._onEncodingsChanged.add(m=>B(this,null,function*(){yield ko(v.rtpSender,m).catch(w=>{Mi.error("_onEncodingsChanged failed",w,this)})})).disposer(this._disposer);const y=this.publication.codecCapabilities,x=(n=(i=this._transportRepository.rtpCapabilities)==null?void 0:i.codecs)!=null?n:[];Mi.debug("select codec",{codecCapabilities:y,deviceCodecs:x});const[S]=y.map(m=>m.mimeType.toLowerCase().includes("video")?x.find(C=>{var A;return!(C.mimeType.toLowerCase()!==m.mimeType.toLowerCase()||Object.keys((A=m.parameters)!=null?A:{}).length>0&&!(0,dp.default)(m.parameters,C.parameters))}):x.find(b=>b.mimeType.toLowerCase()===m.mimeType.toLowerCase()));if(Mi.debug("selected codec",{codec:S}),S){const[m,w]=S.mimeType.split("/");g.codec=we(ne({},S),{mimeType:`${m}/${w.toUpperCase()}`}),t.contentType==="video"&&this._fixVideoCodecWithParametersOrder(S)}else y.length>0&&Mi.warn("preferred codec not supported",ia({channel:this.channel,detail:"preferred codec not supported",operationName:"Sender._produce",bot:this._bot,payload:{codecCapabilities:y,deviceCodecs:x}}));t.contentType==="audio"&&(((s=(r=y.find(C=>C.mimeType.toLowerCase()==="audio/opus"))==null?void 0:r.parameters)==null?void 0:s.usedtx)!==!1&&(g.codecOptions=we(ne({},g.codecOptions),{opusDtx:!0})),(c=(o=y.find(C=>C.mimeType.toLowerCase()==="audio/opus"))==null?void 0:o.parameters)!=null&&c.stereo&&(g.codecOptions=we(ne({},g.codecOptions),{opusStereo:!0})),(l=(h=y.find(C=>C.mimeType.toLowerCase()==="audio/opus"))==null?void 0:h.parameters)!=null&&l.useinbandfec&&(g.codecOptions=we(ne({},g.codecOptions),{opusFec:!0}))),e.onProduce.watch(m=>{var w;return((w=m.producerOptions.appData)==null?void 0:w.transactionId)===p},this._context.config.rtcConfig.timeout).then(m=>B(this,null,function*(){try{const{producerId:w}=yield this._api.createProducer({botId:this._bot.id,transportId:e.id,forwardingId:this.forwardingId,producerOptions:m.producerOptions});m.callback({id:w})}catch(w){m.errback(w)}})).catch(m=>{Mi.error("onProduce failed",m,this)}),Mi.debug("[start] msTransport.produce",this);const v=yield e.msTransport.produce(g).catch(m=>{throw qe({operationName:"Sender._produce",context:this._context,info:we(ne({},vi.internal),{detail:"msTransport.produce failed"}),path:Mi.prefix,channel:this.channel,error:m})});return Mi.debug("[end] msTransport.produce",this),this._producer=v,v})}_fixVideoCodecWithParametersOrder(t){const e=this._broadcasterTransport.msTransport._handler,i=r=>r.mimeType===t.mimeType?t.parameters&&Object.keys(t.parameters).length>0?!!(0,dp.default)(r.parameters,t.parameters):!0:!1,n=(r,s)=>{for(const o of Object.keys(r))o!=="payloadType"&&(r[o]=s[o])};if(e._sendingRtpParametersByKind){const r=e._sendingRtpParametersByKind.video,s=r.codecs.find(i);if(r&&s){const o=JSON.parse(JSON.stringify(r)),[c]=r.codecs,h=JSON.parse(JSON.stringify(c));n(c,s),n(s,h),Mi.debug("sort _sendingRtpParametersByKind",{origin:o,new:r.codecs})}}if(e._sendingRemoteRtpParametersByKind){const r=e._sendingRemoteRtpParametersByKind.video,s=r.codecs.find(i);if(r&&s){const o=JSON.parse(JSON.stringify(r)),[c]=r.codecs,h=JSON.parse(JSON.stringify(c));n(c,s),n(s,h),Mi.debug("sort _sendingRemoteRtpParametersByKind",{origin:o,new:r.codecs})}}}_setupTransportAccessForStream(t,e,i){t._getTransportCallbacks[this._bot.id]=()=>({rtcPeerConnection:e.pc,connectionState:e.connectionState,info:this}),t._getStatsCallbacks[this._bot.id]=()=>B(this,null,function*(){if(i.closed)return delete t._getStatsCallbacks[this._bot.id],[];const r=yield i.getStats();let s=Ya(r);return s=s.map(o=>(o.sfuTransportId=e.id,o)),s});const n=()=>{delete t._getTransportCallbacks[this._bot.id],delete t._getStatsCallbacks[this._bot.id]};return this._disposer.push(()=>{n()}),n}unproduce(){this._producer&&(this._producer.close(),this._producer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer))}_replaceTrack(t){return B(this,null,function*(){var e,i;yield(i=(e=this._producer)==null?void 0:e.replaceTrack)==null?void 0:i.call(e,{track:t}).catch(n=>{throw qe({operationName:"Sender._replaceTrack",context:this._context,info:vi.internal,error:n,path:Mi.prefix,channel:this.channel})})})}close(){this.closed=!0,this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange(),this._setConnectionState("disconnected"),this._disposer.dispose()}get pc(){var t;return(t=this._broadcasterTransport)==null?void 0:t.pc}startSendSubscriptionStatsReportTimer(){const t=this._localPerson._analytics,e=this._bot.subscriptions.find(i=>i.publication.id===this.publication.id);if(e&&t){const i=t.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>B(this,null,function*(){if(!t||t.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this._producer){const n=yield this._producer.getStats();n&&t.client.sendSubscriptionStatsReport(n,{subscriptionId:e.id,role:"sender",contentType:this.publication.contentType,createdAt:Date.now()})}}),i*1e3)}}},dr=new mt("packages/sfu-bot/src/connection/index.ts"),vE=class{constructor(t,e,i,n,r,s){this._api=t,this.channel=e,this.localPerson=i,this.remoteMember=n,this._transportRepository=r,this._context=s,this.type="sfu",this.onDisconnect=new yt,this.onClose=new yt,this.closed=!1,this._receivers={},this._senders={}}addSender(t){const e=new gE(t,this.channel,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);return this._senders[t.id]=e,e}removeSender(t){dr.debug("removeSender",t);const e=this._senders[t];e&&e.unproduce()}startSubscribing(t){return B(this,null,function*(){var e;const i=new fE(t,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);this._receivers[t.id]=i;const n=dr.debug("[start] _startSubscribing consume"),{stream:r,codec:s}=yield i.consume().catch(o=>{throw dr.error("[failed] _startSubscribing consume",qe({operationName:"SFUConnection.startSubscribing",context:this._context,channel:this.channel,info:we(ne({},vi.internal),{detail:"failed to receiver.consume"}),error:o,path:dr.prefix,payload:{subscription:t.toJSON()}})),o});if(dr.elapsed(n,"[end] _startSubscribing consume"),r.setIsEnabled(t.publication.state==="enabled"),t.codec=s,t._setStream(r),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const o=t.preferredEncoding,c=(e=t.publication.origin)==null?void 0:e.encodings;if(!o||!c||c.length===0)return;const h=xu(o,c);this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:t.id,preferredEncodingIndex:h,updatedAt:Date.now()})}})}stopSubscribing(t){return B(this,null,function*(){const e=this._receivers[t.id];e&&e.unconsume()})}stopPublishing(t){return B(this,null,function*(){this.removeSender(t.id)})}close({reason:t}={}){this.closed||(dr.debug("close sfu connection",{remote:this.remoteMember,local:this.localPerson,reason:t}),this.closed=!0,Object.values(this._senders).forEach(e=>{e.close()}),Object.values(this._receivers).forEach(e=>{e.close()}),this._senders={},this._receivers={},this.onClose.emit())}_getReceiver(t){return this._receivers[t]}changePreferredEncoding(t){return B(this,null,function*(){var e;const i=t.preferredEncoding,n=(e=t.publication.origin)==null?void 0:e.encodings;if(dr.debug("changePreferredEncoding",{preferredEncoding:i,encodings:n,subscription:t}),!i)throw qe({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:vi.invalidPreferredEncoding,path:dr.prefix,payload:{subscription:t}});if(!n||n.length===0)throw qe({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:vi.invalidEncodings,path:dr.prefix,payload:{subscription:t}});const r=xu(i,n),s=this._getReceiver(t.id);if(!s)throw qe({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:vi.receiverNotFound,path:dr.prefix,payload:{subscription:t}});const o=s.transport;if(!o)throw qe({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:we(ne({},vi.internal),{detail:"transport not found"}),path:dr.prefix,payload:{subscription:t}});const c=s.consumer;if(!c)throw qe({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:vi.consumerNotFound,path:dr.prefix,payload:{subscription:t}});yield this._api.changeConsumerLayer({transportId:o.id,consumerId:c.id,publicationId:t.publication.id,spatialLayer:r}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:t.id,preferredEncodingIndex:r,updatedAt:Date.now()})})}};Q();Q();var _E=10,Cn=new mt("packages/sfu-bot/src/member.ts"),Zg=class Yg extends Gl{constructor(e){super(e),this.side="remote",this.subtype=Yg.subtype,this.type="bot",this._connections={},this.onForwardingStarted=new yt,this.onForwardingStopped=new yt,this.onForwardingListChanged=new yt,this._startForwardQueue=new Vs,this._forwardings={},this.stopForwarding=i=>new Promise((n,r)=>B(this,null,function*(){const s=Cn.info("[start] stopForwarding",yield Qt({operationName:"SfuBotMember.stopForwarding",channel:this.channel}));if(this.state!=="joined"){r(qe({operationName:"SfuBotMember.stopForwarding",context:this._context,info:vi.sfuBotNotInChannel,path:Cn.prefix,channel:this.channel,payload:{status:this.state}}));return}const o=typeof i=="string"?i:i.id,c=this._forwardings[o];if(!c){r(qe({operationName:"SfuBotMember.stopForwarding",context:this._context,info:vi.forwardingNotFound,path:Cn.prefix,channel:this.channel,payload:{forwardingId:o,_forwardings:Object.keys(this._forwardings)}}));return}delete this._forwardings[c.id];const{promise:h,fulfilled:l}=this._api.stopForwarding({botId:this.id,forwardingId:o});let p=!1;h.catch(g=>{p=!0,r(g)}),this.onForwardingStopped.watch(g=>g.forwarding.id===o,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){Cn.elapsed(s,"[end] stopForwarding",yield Qt({operationName:"SfuBotMember.stopForwarding",channel:this.channel})),n()})).catch(g=>{p||r(qe({operationName:"SfuBotMember.stopForwarding",context:this._context,info:we(ne({},vi.timeout),{detail:"onForwardingStopped"}),path:Cn.prefix,channel:this.channel,payload:{fulfilled:l},error:g}))})})),this._api=e.api,this._context=e.context,this._transportRepository=e.transportRepository,this.options=e.options,this.onLeft.once(()=>{Cn.debug("SfuBotMember left: ",{id:this.id}),Object.values(this._connections).forEach(i=>{i.close({reason:"sfu bot left"})}),this._connections={}})}get forwardings(){return Object.values(this._forwardings)}_getConnection(e){return this._connections[e]}_getOrCreateConnection(e){var i;return(i=this._getConnection(e.id))!=null?i:this._createConnection(this.channel,e,this)}_createConnection(e,i,n){const r=new vE(n._api,e,i,n,this._transportRepository,this._context);return r.onClose.once(()=>{delete this._connections[i.id]}),this._connections[i.id]=r,r}startForwarding(e){return B(this,arguments,function*(i,n={}){const r=Cn.info("[start] startForwarding",yield Qt({operationName:"SfuBotMember.startForwarding",channel:this.channel})),s=yield this._startForwardQueue.push(()=>this._startForwarding(i,n));return Cn.elapsed(r,"[end] startForwarding",yield Qt({operationName:"SfuBotMember.startForwarding",channel:this.channel})),s})}_startForwarding(e,i){return B(this,null,function*(){if(i.maxSubscribers==null&&(i.maxSubscribers=_E),this.state!=="joined")throw qe({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:vi.sfuBotNotInChannel,path:Cn.prefix,payload:{status:this.state}});if(!this.channel._getPublication(e.id))throw qe({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Qe.publicationNotExist,path:Cn.prefix});const n=this.channel.localPerson;if(!n)throw qe({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Qe.localPersonNotJoinedChannel,path:Cn.prefix});if(n.id!==e.publisher.id)throw qe({operationName:"SfuBotMember._startForwarding",context:this._context,info:vi.remotePublisherId,path:Cn.prefix,channel:this.channel});const r=Cn.debug("[start] SfuBotMember startForwarding",{publication:e.toJSON(),configure:i}),c=yield this._getOrCreateConnection(n).addSender(e).startForwarding(i).catch(h=>{throw qe({operationName:"SfuBotMember._startForwarding",context:this._context,info:we(ne({},vi.internal),{detail:"[failed] SfuBotMember startForwarding"}),path:Cn.prefix,channel:this.channel,error:h,payload:{publication:e.toJSON()}})});return this._forwardings[c.id]=c,this.listenStopForwardEvent(c),this.onForwardingStarted.emit({forwarding:c}),this.onForwardingListChanged.emit(),Cn.elapsed(r,"[end] SfuBotMember startForwarding",{forwarding:c.toJSON()}),c})}listenStopForwardEvent(e){const{removeListener:i}=this.channel.onStreamUnpublished.add(n=>{if(n.publication.id===e.id){i(),e._stop();const r=e.originPublication,s=this._getConnection(r.publisher.id);s&&s.removeSender(r.id),this.onForwardingStopped.emit({forwarding:e}),this.onForwardingListChanged.emit()}})}_dispose(){}};Zg.subtype="sfu";var oa=Zg;Q();var bE=we(ne({},$g),{endpointTimeout:3e4,ackTimeout:1e4,disableRestartIce:!1});Q();Q();var up=qn(ny());Q();var on=new mt("packages/sfu-bot/src/connection/transport/transport.ts"),yE=class{constructor(t,e,i,n,r,s){this.msTransport=t,this._bot=e,this._iceManager=i,this._sfuApi=n,this._context=r,this._analyticsSession=s,this._backoffIceRestart=new Pr({times:8,interval:100,jitter:100}),this._connectionState="new",this.onProduce=new yt,this.onProduceData=new yt,this.onMediasoupConnectionStateChanged=new yt,this.onConnectionStateChanged=new yt,this.restartIce=()=>B(this,null,function*(){if(this._backoffIceRestart.exceeded){on.error("_iceRestartedCount exceeded",qe({operationName:"SfuTransport.restartIce",context:this._context,info:vi.netWorkError,path:on.prefix})),this._setConnectionState("disconnected");return}on.warn("[start] restartIce",ia({bot:this._bot,detail:"start restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}}));const p=()=>{if(this._bot.state==="left")return on.debug("bot already left",this),this._setConnectionState("disconnected"),on.warn("[end] restartIce",ia({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),!0;if(this.msTransport.connectionState==="connected")return this._backoffIceRestart.reset(),this._setConnectionState("connected"),on.warn("[end] restartIce",ia({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestart.wait(),p())return;let g=yield this._iceManager.updateIceParams().catch(y=>y);if(g){on.warn("updateIceParams failed",ia({operationName:"SfuTransport.restartIce",detail:"updateIceParams failed",bot:this._bot,payload:{transport:this}}),g),yield this.restartIce();return}if(yield this.msTransport.updateIceServers({iceServers:this._iceManager.iceServers}),p())return;const f=yield this._mediasoupRestartIce();if(g=yield this._waitForMsConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(y=>y),!g&&p())return f;yield this.restartIce()}),this._waitForMsConnectionState=(p,g=1e4)=>B(this,null,function*(){p!==this.msTransport.connectionState&&(yield this.onMediasoupConnectionStateChanged.watch(()=>p===this.msTransport.connectionState,g).catch(f=>{throw qe({operationName:"SfuTransport._waitForMsConnectionState",context:this._context,info:we(ne({},vi.timeout),{detail:"waitForConnectionState timeout"}),error:f,path:on.prefix})}))}),this._onConnect=p=>(g,f,y)=>B(this,[g,f,y],function*({dtlsParameters:x},S,v){try{on.debug("[start] transport connect",{transportId:p}),yield this._sfuApi.connect({transportId:p,dtlsParameters:x}),on.debug("[end] transport connect",{transportId:p}),S()}catch(m){on.error("[failed] transport connect",{error:m,transportId:p}),v(m)}});var o,c,h;const l=r.plugins.find(p=>p.subtype===ql.subtype);this._options=l.options,on.debug("peerConfig",(h=(c=(o=this.pc)==null?void 0:o.getConfiguration)==null?void 0:c.call(o))!=null?h:{}),t.on("connect",(p,g,f)=>this._onConnect(t.id)(p,g,f)),t.on("connectionstatechange",p=>{this.onMediasoupConnectionStateChanged.emit(p),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"connectionStateChange",data:{connectionState:p},createdAt:Date.now()})}),t.on("produce",(p,g,f)=>{this.onProduce.emit({producerOptions:p,callback:g,errback:f})}),t.on("producedata",(p,g,f)=>{this.onProduceData.emit({producerOptions:p,callback:g,errback:f})}),this.onMediasoupConnectionStateChanged.add(p=>B(this,null,function*(){switch(Qt({operationName:"onMediasoupConnectionStateChanged",channel:this._bot.channel}).then(g=>{on.debug(g,{state:p,transportId:this.id,bot:e})}).catch(()=>{}),p){case"disconnected":case"failed":{if(this._connectionState==="reconnecting")return;(yield this._waitForMsConnectionState("connected",r.config.rtcConfig.iceDisconnectBufferTimeout).catch(f=>f))&&this._connectionState!=="reconnecting"&&e.options.disableRestartIce!==!0&&(yield this.restartIce())}break;case"connecting":case"connected":this._setConnectionState(p);break;case"closed":this._setConnectionState("disconnected");break}on.debug("onMediasoupConnectionStateChanged",this)}))}get pc(){var t,e,i;return(i=(e=(t=this.msTransport)==null?void 0:t._handler)==null?void 0:e._pc)!=null?i:{}}get id(){return this.msTransport.id}get connectionState(){return this._connectionState}toJSON(){return{id:this.id,direction:this.msTransport.direction,connectionState:this._connectionState}}close(){var t;on.debug("close",this.id),(t=this.pc)!=null&&t.peerIdentity&&this.pc.peerIdentity.catch(()=>{}),this.msTransport.close(),this._setConnectionState("disconnected")}_setConnectionState(t){this._connectionState!==t&&(on.debug("onConnectionStateChanged",this._connectionState,t,this),this._connectionState=t,this.onConnectionStateChanged.emit(t),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"skywayConnectionStateChange",data:{skywayConnectionState:t},createdAt:Date.now()}))}_mediasoupRestartIce(){return B(this,null,function*(){const t=yield this._sfuApi.iceRestart({transportId:this.id}).catch(e=>e);if(t instanceof Error){on.warn("iceRestart failed",ia({operationName:"SfuTransport._mediasoupRestartIce",detail:"iceRestart failed",bot:this._bot,payload:{transport:this}}),t),yield this.restartIce();return}return yield this.msTransport.restartIce({iceParameters:t}),t})}},Cd=new mt("packages/sfu-bot/src/connection/transport/transportRepository.ts"),SE=class{constructor(t,e){this._context=t,this._api=e,this.onTransportCreated=new yt,this._transports={},this.getTransport=(r,s)=>this._transports[r+s];const{browserName:i,browserVersion:n}=ag();Cd.debug("runtime info",{browserName:i,browserVersion:n}),i==="Safari"&&n==null?this._device=new up.Device({handlerName:"Safari12"}):this._device=new up.Device}get rtpCapabilities(){if(this._device.loaded)return this._device.rtpCapabilities}loadDevice(t){return B(this,null,function*(){this._device.loaded||(yield this._device.load({routerRtpCapabilities:t}).catch(e=>{throw qe({operationName:"TransportRepository.loadDevice",context:this._context,info:we(ne({},vi.internal),{detail:"loadDevice failed"}),path:Cd.prefix,payload:{rtpCapabilities:t},error:e})}),Cd.debug("device loaded",{routerRtpCapabilities:t,rtpCapabilities:this._device.rtpCapabilities}))})}createTransport(t,e,i,n,r,s){const c=(n==="send"?l=>this._device.createSendTransport(l):l=>this._device.createRecvTransport(l))(we(ne({},i),{iceServers:r.iceServers,iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,additionalSettings:this._context.config.rtcConfig})),h=new yE(c,e,r,this._api,this._context,s);return this._transports[t+c.id]=h,this.onTransportCreated.emit(c.id),h}deleteTransports(t){Object.entries(ne({},this._transports)).forEach(([e,i])=>{e.includes(t)&&(i.close(),delete this._transports[e])})}};Q();var wE="1.12.0",$s=new mt("packages/sfu-bot/src/plugin.ts"),Jg=class Qg extends Zu{constructor(e={}){super(),this.subtype=Qg.subtype,this._createRemoteMember=(i,n)=>new oa(we(ne({},this._context),{channel:i,id:n.id,name:n.name,metadata:n.metadata,plugin:this,api:this._api,context:this._context,transportRepository:this._transportRepository,options:this.options})),this.createBot=i=>B(this,null,function*(){var n;const r=$s.info("[start] createBot",yield Qt({operationName:"SfuBotPlugin.createBot",channel:i})),s=this._context.authToken.getAppId(),o=yield this._api.createBot({appId:s,channelId:i.id}),c=(n=i._getMember(o))!=null?n:(yield i.onMemberJoined.watch(h=>h.member.id===o,this._context.config.rtcApi.timeout).catch(h=>{throw qe({operationName:"SfuBotPlugin.createBot",info:we(ne({},vi.timeout),{detail:"onMemberJoined"}),path:$s.prefix,error:h,context:this._context})})).member;return $s.elapsed(r,"[end] createBot",yield Qt({operationName:"SfuBotPlugin.createBot",channel:i})),c}),this.deleteBot=(i,n)=>B(this,null,function*(){return new Promise((r,s)=>B(this,null,function*(){const o=$s.info("[start] deleteBot",yield Qt({operationName:"SfuBotPlugin.deleteBot",channel:i}));let c=!1;this._api.deleteBot({botId:n}).catch(h=>{c=!0,s(h)}),i.onMemberLeft.watch(h=>h.member.id===n,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){$s.elapsed(o,"[end] deleteBot",yield Qt({operationName:"SfuBotPlugin.deleteBot",channel:i})),r()})).catch(h=>{c||s(qe({operationName:"SfuBotPlugin.deleteBot",info:we(ne({},vi.timeout),{detail:"onMemberLeft"}),path:$s.prefix,channel:i,error:h,context:this._context}))})}))}),this.options=ne(ne({},bE),e),this._onContextAttached.once(i=>{mt.level=i.config.log.level,mt.format=i.config.log.format,$s.info("SfuBotPlugin spawned",{operationName:"SfuBotPlugin.constructor",endpoint:{sfu:this.options.domain},options:this.options,sdkName:"sfu-bot",sdkVersion:wE}),this._api=new pE(i.authTokenString,we(ne({},this.options),{log:i.config.log})),this._transportRepository=new SE(i,this._api),i._onTokenUpdated.add(n=>{this._api.updateToken(n)})}),this._whenDisposeLocalPerson=i=>B(this,null,function*(){this._transportRepository.deleteTransports(i.id)})}};Jg.subtype=oa.subtype;var ql=Jg,xE={invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},notImplemented:{name:"notImplemented",detail:"対応していないRoomTypeです",solution:"正しいRoomTypeを指定してください"},roomNotOpened:{name:"roomNotOpened",detail:"RoomがOpenされていません",solution:"Roomの状態を確かめてください"},subscribeOtherMemberType:{name:"subscribeOtherMemberType",detail:"RemoteMemberにSubscribe/Unsubscribeさせる場合、対象のMemberのTypeはPersonである必要があります",solution:"対象のRemoteMemberが正しいか確認してください"},sfuRoomNotSupportDataStream:{name:"sfuRoomNotSupportDataStream",detail:"SFURoomでDataStreamを使うことは出来ません",solution:"ありません"},publicationNotHasOrigin:{name:"publicationNotHasOrigin",detail:"SfuRoomで操作するPublicationはOriginをもつ必要があります",solution:"SfuRoomとP2PRoomを同一のIDで混在させていないか確かめてください"},notFound:{name:"notFound",detail:"参照しようとしていたものが見つかりません",solution:"参照しようとしたものが存在するか確かめてください"}},Dn=ne(ne(ne({},Qe),vi),xE);Q();var ev=class{constructor(t,e){this.member=t,this.room=e,this.onLeft=new yt;const{removeListener:i}=e.onMemberLeft.add(n=>{n.member.id===this.member.id&&(i(),this.onLeft.emit())});this.onMetadataUpdated=t.onMetadataUpdated}get id(){return this.member.id}get name(){return this.member.name}get roomId(){return this.room.id}get roomName(){return this.room.name}get roomType(){return this.room.type}get state(){return this.member.state}get metadata(){return this.member.metadata}get _member(){return this.member}get publications(){return this.room.publications.filter(t=>t.publisher.id===this.id)}get subscriptions(){return this.member.subscriptions.map(t=>this.room._getSubscription(t.id))}updateMetadata(t){return this.member.updateMetadata(t)}leave(){return this.member.leave()}toJSON(){return{id:this.id,name:this.name,metadata:this.metadata}}};Q();var tv=class extends ev{constructor(t,e){super(t,e),this.side="local",this._local=this._member,this.onStreamPublished=new yt,this.onStreamUnpublished=new yt,this.onPublicationListChanged=new yt,this.onPublicationSubscribed=new yt,this.onPublicationUnsubscribed=new yt,this.onSubscriptionListChanged=new yt,this.onFatalError=new yt,this._context=this.room._context,this._local.onPublicationSubscribed.add(i=>B(this,null,function*(){const n=e._addSubscription(i.subscription);this.onPublicationSubscribed.emit({subscription:n,stream:i.stream})})),this._local.onFatalError.pipe(this.onFatalError),this._listenRoomEvent(),this.onStreamPublished.add(()=>this.onPublicationListChanged.emit()),this.onStreamUnpublished.add(()=>this.onPublicationListChanged.emit()),this.onPublicationSubscribed.add(()=>this.onSubscriptionListChanged.emit()),this.onPublicationUnsubscribed.add(()=>this.onSubscriptionListChanged.emit())}get subscriptions(){return this.member.subscriptions.map(t=>this.room._getSubscription(t.id)).filter(t=>t.stream)}_listenRoomEvent(){this.room.onPublicationUnsubscribed.add(t=>{t.subscription.subscriber._member.id===this._local.id&&this.onPublicationUnsubscribed.emit(t)})}};Q();Q();function An({operationName:t,context:e,info:i,error:n,path:r,payload:s,room:o}){const c={operationName:t,payload:s};return o&&(c.appId=o._channel.appId,c.roomId=o.id,o.localRoomMember&&(c.memberId=o.localRoomMember.id)),e&&(c.info=e.info,c.plugins=e.plugins.map(h=>h.subtype)),new rr({error:n,info:i,payload:c,path:r})}var Eo=new mt("packages/room/src/member/local/p2p.ts"),EE=class extends tv{constructor(t,e){super(t,e)}publish(t){return B(this,arguments,function*(e,i={}){const n=yield this._local.publish(e,i),r=this.room._addPublication(n);return this.onStreamPublished.emit({publication:r}),r})}unpublish(t){return B(this,null,function*(){const e=typeof t=="string"?t:t.id;this._local.unpublish(e).catch(n=>{Eo.error("unpublish",n,{target:t},this.toJSON())});const{publication:i}=yield this.room.onStreamUnpublished.watch(n=>n.publication.id===e,this._context.config.rtcApi.timeout).catch(n=>{throw An({operationName:"LocalP2PRoomMemberImpl.unpublish",context:this._context,room:this.room,info:we(ne({},Dn.timeout),{detail:"onStreamUnpublished"}),path:Eo.prefix,error:n})});this.onStreamUnpublished.emit({publication:i})})}subscribe(t){return B(this,null,function*(){const e=typeof t=="string"?t:t.id,{subscription:i,stream:n}=yield this._local.subscribe(e);return{subscription:this.room._addSubscription(i),stream:n}})}unsubscribe(t){return B(this,null,function*(){const e=typeof t=="string"?t:t.id;this._local.unsubscribe(e).catch(i=>{Eo.error("unsubscribe",i,{target:t},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(i=>i.subscription.id===e,this._context.config.rtcApi.timeout).catch(i=>{throw An({operationName:"LocalP2PRoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:we(ne({},Dn.timeout),{detail:"onPublicationUnsubscribed"}),path:Eo.prefix,error:i})})})}_updateRoom(t){Eo.debug("_updateRoom",{memberId:this.id}),this.room=t,this._listenRoomEvent()}};Q();Q();var CE=10,ys=new mt("packages/room/src/member/local/sfu.ts"),TE=class extends tv{constructor(t,e){super(t,e)}publish(t){return B(this,arguments,function*(e,i={}){var n;if(e instanceof $u)throw An({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:Dn.sfuRoomNotSupportDataStream,path:ys.prefix});i.maxSubscribers=(n=i.maxSubscribers)!=null?n:CE;const r=yield this._local.publish(e,i),s=this.room._channel.members.find(l=>l.subtype===oa.subtype);if(!s)throw An({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:vi.sfuBotNotInChannel,path:ys.prefix});const c=(yield s.startForwarding(r,{maxSubscribers:i.maxSubscribers})).relayingPublication,h=this.room._addPublication(c);return this.onStreamPublished.emit({publication:h}),h})}unpublish(t){return B(this,null,function*(){const e=typeof t=="string"?t:t.id,i=this.room._getPublication(e),n=i._publication.origin;if(!n)throw An({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:Dn.publicationNotHasOrigin,path:ys.prefix});this._local.unpublish(n.id).catch(r=>{ys.error("unpublish error",r,{target:t},this.toJSON())}),yield this.room.onStreamUnpublished.watch(r=>r.publication.id===e,this._context.config.rtcApi.timeout).catch(r=>{throw An({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:we(ne({},Dn.timeout),{detail:"onStreamUnpublished"}),path:ys.prefix,error:r})}),this.onStreamUnpublished.emit({publication:i})})}subscribe(t,e){return B(this,null,function*(){const i=typeof t=="string"?t:t.id,{subscription:n,stream:r}=yield this._local.subscribe(i,e);return{subscription:this.room._addSubscription(n),stream:r}})}unsubscribe(t){return B(this,null,function*(){const e=typeof t=="string"?t:t.id;this._local.unsubscribe(e).catch(i=>{ys.error("unsubscribe error",i,{target:t},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(i=>i.subscription.id===e,this._context.config.rtcApi.timeout).catch(i=>{throw An({operationName:"LocalSFURoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:we(ne({},Dn.timeout),{detail:"onPublicationUnsubscribed"}),path:ys.prefix,error:i})})})}_updateRoom(t){ys.debug("_updateRoom",{memberId:this.id}),this.room=t,this._listenRoomEvent()}};Q();var hp=new mt("packages/room/src/member/remote/base.ts"),_l=class extends ev{constructor(t,e){super(t,e),this.side="remote",this.onPublicationSubscribed=new yt,this.onPublicationUnsubscribed=new yt,this.onSubscriptionListChanged=new yt,this.onPublicationListChanged=new yt,this._disposer=new ar,this.subscribe=i=>new Promise((n,r)=>{if(!(this.member instanceof tl)){r(An({operationName:"RemoteRoomMemberImpl.subscribe",context:this.room._context,room:this.room,info:Dn.subscribeOtherMemberType,path:hp.prefix}));return}let s=!1;this.member.subscribe(i).catch(o=>{s=!0,r(o)}),this.onPublicationSubscribed.watch(o=>o.subscription.publication.id===i).then(o=>n(o)).catch(o=>{s||r(o)})}),this.unsubscribe=i=>new Promise((n,r)=>{if(!(this.member instanceof tl)){r(An({operationName:"RemoteRoomMemberImpl.unsubscribe",context:this.room._context,room:this.room,info:Dn.subscribeOtherMemberType,path:hp.prefix}));return}let s=!1;this.member.unsubscribe(i).catch(o=>{s=!0,r(o)}),this.onPublicationUnsubscribed.watch(o=>o.subscription.id===i).then(()=>n()).catch(o=>{s||r(o)})}),e.onPublicationSubscribed.add(i=>{i.subscription.subscriber._member.id===t.id&&(this.onPublicationSubscribed.emit(i),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),e.onPublicationUnsubscribed.add(i=>{i.subscription.subscriber._member.id===t.id&&(this.onPublicationUnsubscribed.emit(i),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),t instanceof tl&&t.onPublicationListChanged.pipe(this.onPublicationListChanged).disposer(this._disposer)}_dispose(){this._disposer.dispose()}};Q();var il="packages/room/src/publication/index.ts",pp=new mt(il),RE=class{constructor(t,e){this._publication=t,this._room=e,this._disposer=new ar,this._events=new Zr,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new yt,this.enable=()=>new Promise((n,r)=>{this._origin?Promise.all([this._origin.enable(),this._publication.onEnabled.asPromise()]).then(()=>n()).catch(r):this._publication.enable().then(n).catch(r)}),this.disable=()=>new Promise((n,r)=>{this._origin?Promise.all([this._origin.disable(),this._publication.onDisabled.asPromise()]).then(()=>n()).catch(r):this._publication.disable().then(n).catch(r)}),this.replaceStream=(n,r={})=>{this._preferredPublication.replaceStream(n,r)};var i;this.id=t.id,this.contentType=t.contentType,this._origin=t.origin;{const n=(i=this._origin)!=null?i:this._publication;this.publisher=this._room._getMember(n.publisher.id)}this._setEvents()}_setEvents(){var t;this._room.onStreamUnpublished.add(e=>{e.publication.id===this.id&&this._dispose()}),this._room.onPublicationSubscribed.add(e=>{e.subscription.publication.id===this.id&&(this.onSubscribed.emit({subscription:e.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._room.onPublicationUnsubscribed.add(e=>{e.subscription.publication.id===this.id&&(this.onUnsubscribed.emit({subscription:e.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._publication.onEnabled.pipe(this.onEnabled),this._publication.onDisabled.pipe(this.onDisabled),this._publication.onStateChanged.pipe(this.onStateChanged),((t=this._origin)!=null?t:this._publication).onMetadataUpdated.pipe(this.onMetadataUpdated),this._origin?this._origin.onConnectionStateChanged.add(e=>{pp.debug("this._origin.onConnectionStateChanged",this.id,e),this.onConnectionStateChanged.emit({state:e.state})}):this._publication.onConnectionStateChanged.add(e=>{pp.debug("this._publication.onConnectionStateChanged",this.id,e),this.onConnectionStateChanged.emit({state:e.state,remoteMember:this._room._getMember(e.remoteMember.id)})})}get subscriptions(){return this._publication.subscriptions.map(t=>this._room._getSubscription(t.id))}get _preferredPublication(){var t;return(t=this._origin)!=null?t:this._publication}get codecCapabilities(){return this._preferredPublication.codecCapabilities}get encodings(){return this._preferredPublication.encodings}get stream(){return this._preferredPublication.stream}get state(){return this._preferredPublication.state}get metadata(){return this._preferredPublication.metadata}cancel(){return B(this,null,function*(){yield Promise.all([this._preferredPublication.cancel(),this.onCanceled.asPromise()])})}updateMetadata(t){return B(this,null,function*(){yield this._preferredPublication.updateMetadata(t)})}updateEncodings(t){this._preferredPublication.updateEncodings(t)}_dispose(){this.onCanceled.emit(),this._events.dispose(),this._disposer.dispose()}getStats(t){var e;if(this._origin){const i=(e=this._origin.subscriptions.find(n=>n.subscriber.subtype===oa.subtype))==null?void 0:e.subscriber;if(!i)throw An({operationName:"RoomPublicationImpl.getStats",room:this._room,path:il,info:we(ne({},Dn.notFound),{detail:"bot not found"})});return this._origin.getStats(i)}else{const i=typeof t=="string"?t:t.id;return this._publication.getStats(i)}}getRTCPeerConnection(t){var e;if(this._origin){const i=(e=this._origin.subscriptions.find(n=>n.subscriber.subtype===oa.subtype))==null?void 0:e.subscriber;if(!i)throw An({operationName:"RoomPublicationImpl.getRTCPeerConnection",room:this._room,path:il,info:we(ne({},Dn.notFound),{detail:"bot not found"})});return this._origin.getRTCPeerConnection(i)}else{const i=typeof t=="string"?t:t.id;return this._publication.getRTCPeerConnection(i)}}getConnectionState(t){var e;if(this._origin){const i=(e=this._origin.subscriptions.find(n=>n.subscriber.subtype===oa.subtype))==null?void 0:e.subscriber;if(!i)throw An({operationName:"RoomPublicationImpl.getConnectionState",room:this._room,path:il,info:we(ne({},Dn.notFound),{detail:"bot not found"})});return this._origin.getConnectionState(i)}else{const i=typeof t=="string"?t:t.id;return this._publication.getConnectionState(i)}}toJSON(){return{id:this.id,contentType:this.contentType,metadata:this.metadata,publisher:this.publisher,subscriptions:this.subscriptions,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state}}};Q();Q();var PE="1.12.0";Q();Q();Q();var Td=new mt("packages/room/src/subscription/index.ts"),ME=class{constructor(t,e){this._subscription=t,this._room=e,this._context=this._room._context,this.onStreamAttached=new yt,this.onCanceled=new yt,this.onConnectionStateChanged=new yt,this.id=t.id,this.contentType=t.contentType,this.publication=this._room._getPublication(t.publication.id),this.subscriber=this._room._getMember(t.subscriber.id),t.onStreamAttached.pipe(this.onStreamAttached),t.onCanceled.pipe(this.onCanceled),t.onConnectionStateChanged.add(i=>{Td.debug("_subscription.onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit(i)})}get stream(){return this._subscription.stream}get state(){return this._subscription.state}get codec(){return this._subscription.codec}get preferredEncoding(){return this._subscription.preferredEncoding}changePreferredEncoding(t){this._subscription.changePreferredEncoding(t)}cancel(){return B(this,null,function*(){this._subscription.cancel().catch(t=>{Td.error("subscription.cancel",t,this.toJSON())}),yield this._room.onPublicationUnsubscribed.watch(t=>t.subscription.id===this.id,this._context.config.rtcApi.timeout).catch(t=>{throw An({operationName:"RoomSubscriptionImpl.cancel",context:this._context,room:this._room,info:we(ne({},Dn.timeout),{detail:"onPublicationUnsubscribed"}),error:t,path:Td.prefix})})})}toJSON(){return{id:this.id,contentType:this.contentType,publication:this.publication,codec:this.codec}}getStats(){return this._subscription.getStats()}getRTCPeerConnection(){return this._subscription.getRTCPeerConnection()}getConnectionState(){return this._subscription.getConnectionState()}},fp=new mt("packages/room/src/room/base.ts"),iv=class{constructor(t,e){this._channel=e,this._members={},this._publications={},this._subscriptions={},this._context=this._channel._context,this._events=new Zr,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.type=t,this._channel.onClosed.pipe(this.onClosed),this._channel.onMetadataUpdated.pipe(this.onMetadataUpdated),this._channel.onMemberMetadataUpdated.add(i=>{this._handleOnMemberMetadataUpdate(i)})}_getMember(t){return this._members[t]}_getPublication(t){return this._publications[t]}_addPublication(t){const e=this._publications[t.id];if(e)return e;const i=new RE(t,this);return this._publications[t.id]=i,i}_getSubscription(t){return this._subscriptions[t]}_addSubscription(t){const e=this._subscriptions[t.id];if(e)return e;const i=new ME(t,this);return this._subscriptions[t.id]=i,i}get id(){return this._channel.id}get name(){return this._channel.name}get metadata(){return this._channel.metadata}get state(){return this._channel.state}get disposed(){return this._channel.disposed}_handleOnMemberMetadataUpdate(t){const e=this._getMember(t.member.id);this.onMemberMetadataUpdated.emit({member:e,metadata:t.metadata})}get members(){return Object.values(this._members)}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}joinChannel(){return B(this,arguments,function*(t={}){var e;if(this.state!=="opened")throw An({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:Dn.roomNotOpened,path:fp.prefix});t.name=(e=t.name)!=null?e:Yr();const i=yield this._channel.join(t);return this._getMember(i.id)||(yield this.onMemberJoined.watch(n=>n.member._member.id===i.id,this._context.config.rtcApi.timeout).catch(n=>{throw An({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:we(ne({},Dn.timeout),{detail:"RoomImpl onMemberJoined"}),path:fp.prefix,error:n})})),i})}leave(t){return B(this,null,function*(){yield this._channel.leave(t._member)})}moveRoom(t){return B(this,null,function*(){return yield this._channel.moveChannel(t._local),t._updateRoom(this),t})}updateMetadata(t){return this._channel.updateMetadata(t)}close(){return B(this,null,function*(){yield this._channel.close()})}dispose(){return B(this,null,function*(){return this._channel.dispose()})}toJSON(){return{type:this.type,id:this.id,name:this.name,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}},AE=new mt("packages/room/src/room/p2p.ts"),DE=class extends iv{constructor(t){super("p2p",t),this.setChannelState(),this.setChannelListener()}setChannelState(){this._channel.members.forEach(t=>{const e=new _l(t,this);this._members[t.id]=e}),this._channel.publications.forEach(t=>{this._addPublication(t)}),this._channel.subscriptions.forEach(t=>{this._addSubscription(t)})}setChannelListener(){this._channel.onMemberJoined.add(t=>this._handleOnMemberJoin(t.member)),this._channel.onMemberLeft.add(t=>this._handleOnMemberLeft(t.member)),this._channel.onStreamPublished.add(t=>this._handleOnStreamPublish(t.publication)),this._channel.onStreamUnpublished.add(t=>this._handleOnStreamUnpublish(t.publication)),this._channel.onPublicationMetadataUpdated.add(t=>{this._handleOnPublicationMetadataUpdate(t.publication)}),this._channel.onPublicationEnabled.add(t=>{this._handleOnPublicationEnabled(t.publication)}),this._channel.onPublicationDisabled.add(t=>{this._handleOnPublicationDisabled(t.publication)}),this._channel.onPublicationSubscribed.add(t=>this._handleOnStreamSubscribe(t.subscription)),this._channel.onPublicationUnsubscribed.add(t=>this._handleOnStreamUnsubscribe(t.subscription))}_handleOnMemberJoin(t){if(this._getMember(t.id))return;const e=new _l(t,this);this._members[t.id]=e,this.onMemberJoined.emit({member:e}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(t){const e=this._getMember(t.id);delete this._members[t.id],e._dispose(),this.onMemberLeft.emit({member:e}),this.onMemberListChanged.emit({})}_handleOnStreamPublish(t){if(this._getPublication(t.id))return;const e=this._addPublication(t);this.onStreamPublished.emit({publication:e}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(t){const e=this._getPublication(t.id);delete this._publications[t.id],this.onStreamUnpublished.emit({publication:e}),this.onPublicationListChanged.emit({})}_handleOnPublicationMetadataUpdate(t){const e=this._getPublication(t.id);this.onPublicationMetadataUpdated.emit({publication:e,metadata:e.metadata})}_handleOnPublicationEnabled(t){const e=this._getPublication(t.id);this.onPublicationEnabled.emit({publication:e})}_handleOnPublicationDisabled(t){const e=this._getPublication(t.id);this.onPublicationDisabled.emit({publication:e})}_handleOnStreamSubscribe(t){if(this._getSubscription(t.id))return;const e=this._addSubscription(t);this.onPublicationSubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(t){const e=this._getSubscription(t.id);delete this._subscriptions[t.id],this.onPublicationUnsubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit({})}join(){return B(this,arguments,function*(t={}){const e=yield this.joinChannel(t),i=new EE(e,this);return AE.debug("member joined",t),this.localRoomMember=i,i.onLeft.once(()=>{this.localRoomMember=void 0}),i})}};Q();var IE=new mt("packages/room/src/room/sfu.ts"),LE=class nv extends iv{constructor(e,i){super("sfu",e),this._plugin=i,this.setChannelState(),this.setChannelListener()}static Create(e,i){return B(this,null,function*(){const n=e.plugins.find(o=>o.subtype==="sfu");return i.members.find(o=>o.subtype===oa.subtype)||(yield n.createBot(i)),new nv(i,n)})}setChannelState(){this._channel.members.forEach(e=>{if(e.type==="bot")return;const i=new _l(e,this);this._members[e.id]=i}),this._channel.publications.forEach(e=>{e.origin&&this._addPublication(e)}),this._channel.subscriptions.forEach(e=>{e.subscriber.type!=="bot"&&this._addSubscription(e)})}setChannelListener(){this._channel.onMemberJoined.add(e=>this._handleOnMemberJoin(e.member)),this._channel.onMemberLeft.add(e=>this._handleOnMemberLeft(e.member)),this._channel.onStreamPublished.add(e=>{this._handleOnStreamPublish(e.publication)}),this._channel.onStreamUnpublished.add(e=>this._handleOnStreamUnpublish(e.publication)),this._channel.onPublicationMetadataUpdated.add(e=>{this._handleOnPublicationMetadataUpdate(e.publication)}),this._channel.onPublicationEnabled.add(e=>{this._handleOnPublicationEnabled(e.publication)}),this._channel.onPublicationDisabled.add(e=>{this._handleOnPublicationDisabled(e.publication)}),this._channel.onPublicationSubscribed.add(e=>{this._handleOnStreamSubscribe(e.subscription)}),this._channel.onPublicationUnsubscribed.add(e=>this._handleOnStreamUnsubscribe(e.subscription))}_handleOnMemberJoin(e){if(e.type==="bot")return;const i=new _l(e,this);this._members[e.id]=i,this.onMemberJoined.emit({member:i}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(e){const i=this._getMember(e.id);i&&(delete this._members[e.id],i._dispose(),this.onMemberLeft.emit({member:i}),this.onMemberListChanged.emit({}))}_handleOnStreamPublish(e){var i;if(!((i=e.origin)!=null&&i.id))return;const n=this._addPublication(e);this.onStreamPublished.emit({publication:n}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(e){var i;if(!((i=e.origin)!=null&&i.id))return;const n=this._getPublication(e.id);delete this._publications[e.id],this.onStreamUnpublished.emit({publication:n}),this.onPublicationListChanged.emit({})}_getRelayedPublication(e){return this.publications.find(n=>{var r;return((r=n._publication.origin)==null?void 0:r.id)===e})}_handleOnPublicationMetadataUpdate(e){const i=this._getRelayedPublication(e.id);i&&this.onPublicationMetadataUpdated.emit({publication:i,metadata:i.metadata})}_handleOnPublicationEnabled(e){const i=this._getRelayedPublication(e.id);i&&this.onPublicationEnabled.emit({publication:i})}_handleOnPublicationDisabled(e){const i=this._getRelayedPublication(e.id);i&&this.onPublicationDisabled.emit({publication:i})}_handleOnStreamSubscribe(e){if(e.subscriber.type==="bot")return;const i=this._addSubscription(e);this.onPublicationSubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(e){if(e.subscriber.type==="bot")return;const i=this._getSubscription(e.id);delete this._subscriptions[e.id],this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit({})}join(){return B(this,arguments,function*(e={}){const i=yield this.joinChannel(we(ne({},e),{disableSignaling:!0})),n=new TE(i,this);return this.localRoomMember=n,n.onLeft.once(()=>{this.localRoomMember=void 0}),IE.debug("member joined",e),n})}},rv=new mt("packages/room/src/room/index.ts"),Os=class{constructor(){}};Os.Create=(t,e)=>B(null,null,function*(){var i,n;rv.info("room created",{operationName:"SkyWayRoom._Factory",sdkName:"room",sdkVersion:PE,init:e});const r=new ql((i=e==null?void 0:e.options)==null?void 0:i.sfu);t.registerPlugin(r);const s=yield Yu.Create(t,{name:(n=e.name)!=null?n:Yr(),metadata:e.metadata});return yield Os._Factory(t,e.type,s)});Os.Find=(t,e,i,n)=>B(null,null,function*(){const r=new ql(n==null?void 0:n.sfu);t.registerPlugin(r);const s=yield Yu.Find(t,e);return yield Os._Factory(t,i,s)});Os.FindOrCreate=(t,e)=>B(null,null,function*(){var i;const n=new ql((i=e==null?void 0:e.options)==null?void 0:i.sfu);t.registerPlugin(n);const r=yield Yu.FindOrCreate(t,ne({},e));return yield Os._Factory(t,e.type,r)});Os._Factory=(t,e,i)=>B(null,null,function*(){switch(e){case"p2p":return new DE(i);case"sfu":return yield LE.Create(t,i);default:throw qe({operationName:"SkyWayRoom._Factory",context:t,channel:i,info:Dn.notImplemented,path:rv.prefix})}});var FE=Os;Q();/*! Bundled license information:

jsrsasign/lib/jsrsasign.js:
  (*! CryptoJS v3.1.2 core-fix.js
   * code.google.com/p/crypto-js
   * (c) 2009-2013 by Jeff Mott. All rights reserved.
   * code.google.com/p/crypto-js/wiki/License
   * THIS IS FIX of 'core.js' to fix Hmac issue.
   * https://code.google.com/p/crypto-js/issues/detail?id=84
   * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
   *)
  (*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
   *)
  (*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
   *)
*//**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ju="157",wa={ROTATE:0,DOLLY:1,PAN:2},xa={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},kE=0,mp=1,NE=2,sv=1,OE=2,cs=3,Us=0,Vn=1,ds=2,Ds=0,Ka=1,gp=2,vp=3,_p=4,UE=5,Va=100,BE=101,HE=102,bp=103,yp=104,jE=200,VE=201,zE=202,GE=203,av=204,ov=205,qE=206,WE=207,KE=208,XE=209,$E=210,ZE=0,YE=1,JE=2,Eu=3,QE=4,eC=5,tC=6,iC=7,cv=0,nC=1,rC=2,Is=0,sC=1,aC=2,oC=3,cC=4,lC=5,lv=300,no=301,ro=302,Cu=303,Tu=304,Wl=306,Ru=1e3,Mr=1001,Pu=1002,Pn=1003,Sp=1004,Rd=1005,Hn=1006,dC=1007,Qo=1008,Ls=1009,uC=1010,hC=1011,Qu=1012,dv=1013,Ms=1014,As=1015,ec=1016,uv=1017,hv=1018,ca=1020,pC=1021,Ar=1023,fC=1024,mC=1025,la=1026,so=1027,gC=1028,pv=1029,vC=1030,fv=1031,mv=1033,Pd=33776,Md=33777,Ad=33778,Dd=33779,wp=35840,xp=35841,Ep=35842,Cp=35843,_C=36196,Tp=37492,Rp=37496,Pp=37808,Mp=37809,Ap=37810,Dp=37811,Ip=37812,Lp=37813,Fp=37814,kp=37815,Np=37816,Op=37817,Up=37818,Bp=37819,Hp=37820,jp=37821,Id=36492,Vp=36494,zp=36495,bC=36283,Gp=36284,qp=36285,Wp=36286,gv=3e3,da=3001,yC=3200,SC=3201,wC=0,xC=1,fr="",ln="srgb",fs="srgb-linear",eh="display-p3",Kl="display-p3-linear",bl="linear",Ai="srgb",yl="rec709",Sl="p3",Ld=7680,EC=519,CC=512,TC=513,RC=514,PC=515,MC=516,AC=517,DC=518,IC=519,Kp=35044,Xp="300 es",Mu=1035,us=2e3,wl=2001;class _a{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(i)===-1&&n[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const vn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],nl=Math.PI/180,Au=180/Math.PI;function sc(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(vn[t&255]+vn[t>>8&255]+vn[t>>16&255]+vn[t>>24&255]+"-"+vn[e&255]+vn[e>>8&255]+"-"+vn[e>>16&15|64]+vn[e>>24&255]+"-"+vn[i&63|128]+vn[i>>8&255]+"-"+vn[i>>16&255]+vn[i>>24&255]+vn[n&255]+vn[n>>8&255]+vn[n>>16&255]+vn[n>>24&255]).toLowerCase()}function Mn(t,e,i){return Math.max(e,Math.min(i,t))}function LC(t,e){return(t%e+e)%e}function Fd(t,e,i){return(1-i)*t+i*e}function $p(t){return(t&t-1)===0&&t!==0}function Du(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Co(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Un(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const FC={DEG2RAD:nl};class si{constructor(e=0,i=0){si.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,r=e.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Mn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),r=Math.sin(i),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ri{constructor(e,i,n,r,s,o,c,h,l){ri.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,r,s,o,c,h,l)}set(e,i,n,r,s,o,c,h,l){const p=this.elements;return p[0]=e,p[1]=r,p[2]=c,p[3]=i,p[4]=s,p[5]=h,p[6]=n,p[7]=o,p[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,r=i.elements,s=this.elements,o=n[0],c=n[3],h=n[6],l=n[1],p=n[4],g=n[7],f=n[2],y=n[5],x=n[8],S=r[0],v=r[3],m=r[6],w=r[1],b=r[4],C=r[7],A=r[2],M=r[5],F=r[8];return s[0]=o*S+c*w+h*A,s[3]=o*v+c*b+h*M,s[6]=o*m+c*C+h*F,s[1]=l*S+p*w+g*A,s[4]=l*v+p*b+g*M,s[7]=l*m+p*C+g*F,s[2]=f*S+y*w+x*A,s[5]=f*v+y*b+x*M,s[8]=f*m+y*C+x*F,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],c=e[5],h=e[6],l=e[7],p=e[8];return i*o*p-i*c*l-n*s*p+n*c*h+r*s*l-r*o*h}invert(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],c=e[5],h=e[6],l=e[7],p=e[8],g=p*o-c*l,f=c*h-p*s,y=l*s-o*h,x=i*g+n*f+r*y;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/x;return e[0]=g*S,e[1]=(r*l-p*n)*S,e[2]=(c*n-r*o)*S,e[3]=f*S,e[4]=(p*i-r*h)*S,e[5]=(r*s-c*i)*S,e[6]=y*S,e[7]=(n*h-l*i)*S,e[8]=(o*i-n*s)*S,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,r,s,o,c){const h=Math.cos(s),l=Math.sin(s);return this.set(n*h,n*l,-n*(h*o+l*c)+o+e,-r*l,r*h,-r*(-l*o+h*c)+c+i,0,0,1),this}scale(e,i){return this.premultiply(kd.makeScale(e,i)),this}rotate(e){return this.premultiply(kd.makeRotation(-e)),this}translate(e,i){return this.premultiply(kd.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let r=0;r<9;r++)if(i[r]!==n[r])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const kd=new ri;function vv(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function xl(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function kC(){const t=xl("canvas");return t.style.display="block",t}const Zp={};function No(t){t in Zp||(Zp[t]=!0,console.warn(t))}const Yp=new ri().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Jp=new ri().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Tc={[fs]:{transfer:bl,primaries:yl,toReference:t=>t,fromReference:t=>t},[ln]:{transfer:Ai,primaries:yl,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Kl]:{transfer:bl,primaries:Sl,toReference:t=>t.applyMatrix3(Jp),fromReference:t=>t.applyMatrix3(Yp)},[eh]:{transfer:Ai,primaries:Sl,toReference:t=>t.convertSRGBToLinear().applyMatrix3(Jp),fromReference:t=>t.applyMatrix3(Yp).convertLinearToSRGB()}},NC=new Set([fs,Kl]),xi={enabled:!0,_workingColorSpace:fs,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!NC.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,i){if(this.enabled===!1||e===i||!e||!i)return t;const n=Tc[e].toReference,r=Tc[i].fromReference;return r(n(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Tc[t].primaries},getTransfer:function(t){return t===fr?bl:Tc[t].transfer}};function Xa(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Nd(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let Ea;class _v{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Ea===void 0&&(Ea=xl("canvas")),Ea.width=e.width,Ea.height=e.height;const n=Ea.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),i=Ea}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=xl("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Xa(s[o]/255)*255;return n.putImageData(r,0,0),i}else if(e.data){const i=e.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Xa(i[n]/255)*255):i[n]=Xa(i[n]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let OC=0;class bv{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:OC++}),this.uuid=sc(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,c=r.length;o<c;o++)r[o].isDataTexture?s.push(Od(r[o].image)):s.push(Od(r[o]))}else s=Od(r);n.url=s}return i||(e.images[this.uuid]=n),n}}function Od(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?_v.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let UC=0;class zn extends _a{constructor(e=zn.DEFAULT_IMAGE,i=zn.DEFAULT_MAPPING,n=Mr,r=Mr,s=Hn,o=Qo,c=Ar,h=Ls,l=zn.DEFAULT_ANISOTROPY,p=fr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:UC++}),this.uuid=sc(),this.name="",this.source=new bv(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=c,this.internalFormat=null,this.type=h,this.offset=new si(0,0),this.repeat=new si(1,1),this.center=new si(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ri,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof p=="string"?this.colorSpace=p:(No("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=p===da?ln:fr),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lv)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ru:e.x=e.x-Math.floor(e.x);break;case Mr:e.x=e.x<0?0:1;break;case Pu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ru:e.y=e.y-Math.floor(e.y);break;case Mr:e.y=e.y<0?0:1;break;case Pu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return No("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ln?da:gv}set encoding(e){No("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===da?ln:fr}}zn.DEFAULT_IMAGE=null;zn.DEFAULT_MAPPING=lv;zn.DEFAULT_ANISOTROPY=1;class dn{constructor(e=0,i=0,n=0,r=1){dn.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*i+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*i+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*i+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,r,s;const h=e.elements,l=h[0],p=h[4],g=h[8],f=h[1],y=h[5],x=h[9],S=h[2],v=h[6],m=h[10];if(Math.abs(p-f)<.01&&Math.abs(g-S)<.01&&Math.abs(x-v)<.01){if(Math.abs(p+f)<.1&&Math.abs(g+S)<.1&&Math.abs(x+v)<.1&&Math.abs(l+y+m-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,C=(y+1)/2,A=(m+1)/2,M=(p+f)/4,F=(g+S)/4,N=(x+v)/4;return b>C&&b>A?b<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(b),r=M/n,s=F/n):C>A?C<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(C),n=M/r,s=N/r):A<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),n=F/s,r=N/s),this.set(n,r,s,i),this}let w=Math.sqrt((v-x)*(v-x)+(g-S)*(g-S)+(f-p)*(f-p));return Math.abs(w)<.001&&(w=1),this.x=(v-x)/w,this.y=(g-S)/w,this.z=(f-p)/w,this.w=Math.acos((l+y+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class BC extends _a{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new dn(0,0,e,i),this.scissorTest=!1,this.viewport=new dn(0,0,e,i);const r={width:e,height:i,depth:1};n.encoding!==void 0&&(No("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===da?ln:fr),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Hn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new zn(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,i,n=1){(this.width!==e||this.height!==i||this.depth!==n)&&(this.width=e,this.height=i,this.depth=n,this.texture.image.width=e,this.texture.image.height=i,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new bv(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fa extends BC{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class yv extends zn{constructor(e=null,i=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=Mr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class HC extends zn{constructor(e=null,i=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=Mr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ma{constructor(e=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=r}static slerpFlat(e,i,n,r,s,o,c){let h=n[r+0],l=n[r+1],p=n[r+2],g=n[r+3];const f=s[o+0],y=s[o+1],x=s[o+2],S=s[o+3];if(c===0){e[i+0]=h,e[i+1]=l,e[i+2]=p,e[i+3]=g;return}if(c===1){e[i+0]=f,e[i+1]=y,e[i+2]=x,e[i+3]=S;return}if(g!==S||h!==f||l!==y||p!==x){let v=1-c;const m=h*f+l*y+p*x+g*S,w=m>=0?1:-1,b=1-m*m;if(b>Number.EPSILON){const A=Math.sqrt(b),M=Math.atan2(A,m*w);v=Math.sin(v*M)/A,c=Math.sin(c*M)/A}const C=c*w;if(h=h*v+f*C,l=l*v+y*C,p=p*v+x*C,g=g*v+S*C,v===1-c){const A=1/Math.sqrt(h*h+l*l+p*p+g*g);h*=A,l*=A,p*=A,g*=A}}e[i]=h,e[i+1]=l,e[i+2]=p,e[i+3]=g}static multiplyQuaternionsFlat(e,i,n,r,s,o){const c=n[r],h=n[r+1],l=n[r+2],p=n[r+3],g=s[o],f=s[o+1],y=s[o+2],x=s[o+3];return e[i]=c*x+p*g+h*y-l*f,e[i+1]=h*x+p*f+l*g-c*y,e[i+2]=l*x+p*y+c*f-h*g,e[i+3]=p*x-c*g-h*f-l*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,r){return this._x=e,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){const n=e._x,r=e._y,s=e._z,o=e._order,c=Math.cos,h=Math.sin,l=c(n/2),p=c(r/2),g=c(s/2),f=h(n/2),y=h(r/2),x=h(s/2);switch(o){case"XYZ":this._x=f*p*g+l*y*x,this._y=l*y*g-f*p*x,this._z=l*p*x+f*y*g,this._w=l*p*g-f*y*x;break;case"YXZ":this._x=f*p*g+l*y*x,this._y=l*y*g-f*p*x,this._z=l*p*x-f*y*g,this._w=l*p*g+f*y*x;break;case"ZXY":this._x=f*p*g-l*y*x,this._y=l*y*g+f*p*x,this._z=l*p*x+f*y*g,this._w=l*p*g-f*y*x;break;case"ZYX":this._x=f*p*g-l*y*x,this._y=l*y*g+f*p*x,this._z=l*p*x-f*y*g,this._w=l*p*g+f*y*x;break;case"YZX":this._x=f*p*g+l*y*x,this._y=l*y*g+f*p*x,this._z=l*p*x-f*y*g,this._w=l*p*g-f*y*x;break;case"XZY":this._x=f*p*g-l*y*x,this._y=l*y*g-f*p*x,this._z=l*p*x+f*y*g,this._w=l*p*g+f*y*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const n=i/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,n=i[0],r=i[4],s=i[8],o=i[1],c=i[5],h=i[9],l=i[2],p=i[6],g=i[10],f=n+c+g;if(f>0){const y=.5/Math.sqrt(f+1);this._w=.25/y,this._x=(p-h)*y,this._y=(s-l)*y,this._z=(o-r)*y}else if(n>c&&n>g){const y=2*Math.sqrt(1+n-c-g);this._w=(p-h)/y,this._x=.25*y,this._y=(r+o)/y,this._z=(s+l)/y}else if(c>g){const y=2*Math.sqrt(1+c-n-g);this._w=(s-l)/y,this._x=(r+o)/y,this._y=.25*y,this._z=(h+p)/y}else{const y=2*Math.sqrt(1+g-n-c);this._w=(o-r)/y,this._x=(s+l)/y,this._y=(h+p)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Mn(this.dot(e),-1,1)))}rotateTowards(e,i){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,i/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const n=e._x,r=e._y,s=e._z,o=e._w,c=i._x,h=i._y,l=i._z,p=i._w;return this._x=n*p+o*c+r*l-s*h,this._y=r*p+o*h+s*c-n*l,this._z=s*p+o*l+n*h-r*c,this._w=o*p-n*c-r*h-s*l,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let c=o*e._w+n*e._x+r*e._y+s*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const h=1-c*c;if(h<=Number.EPSILON){const y=1-i;return this._w=y*o+i*this._w,this._x=y*n+i*this._x,this._y=y*r+i*this._y,this._z=y*s+i*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),p=Math.atan2(l,c),g=Math.sin((1-i)*p)/l,f=Math.sin(i*p)/l;return this._w=o*g+this._w*f,this._x=n*g+this._x*f,this._y=r*g+this._y*f,this._z=s*g+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){const e=Math.random(),i=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(r),n*Math.sin(s),n*Math.cos(s),i*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ie{constructor(e=0,i=0,n=0){Ie.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(Qp.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(Qp.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const i=this.x,n=this.y,r=this.z,s=e.x,o=e.y,c=e.z,h=e.w,l=h*i+o*r-c*n,p=h*n+c*i-s*r,g=h*r+s*n-o*i,f=-s*i-o*n-c*r;return this.x=l*h+f*-s+p*-c-g*-o,this.y=p*h+f*-o+g*-s-l*-c,this.z=g*h+f*-c+l*-o-p*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(i,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,r=e.y,s=e.z,o=i.x,c=i.y,h=i.z;return this.x=r*h-s*c,this.y=s*o-n*h,this.z=n*c-r*o,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ud.copy(this).projectOnVector(e),this.sub(Ud)}reflect(e){return this.sub(Ud.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Mn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return i*i+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const r=Math.sin(i)*e;return this.x=r*Math.sin(n),this.y=Math.cos(i)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(i),this.y=n*Math.sin(i),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ud=new Ie,Qp=new ma;class ac{constructor(e=new Ie(1/0,1/0,1/0),i=new Ie(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(is.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(is.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=is.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Ca.copy(e.boundingBox),Ca.applyMatrix4(e.matrixWorld),this.union(Ca);else{const r=e.geometry;if(r!==void 0)if(i&&r.attributes!==void 0&&r.attributes.position!==void 0){const s=r.attributes.position;for(let o=0,c=s.count;o<c;o++)is.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(is)}else r.boundingBox===null&&r.computeBoundingBox(),Ca.copy(r.boundingBox),Ca.applyMatrix4(e.matrixWorld),this.union(Ca)}const n=e.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,is),is.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(To),Rc.subVectors(this.max,To),Ta.subVectors(e.a,To),Ra.subVectors(e.b,To),Pa.subVectors(e.c,To),Ss.subVectors(Ra,Ta),ws.subVectors(Pa,Ra),Zs.subVectors(Ta,Pa);let i=[0,-Ss.z,Ss.y,0,-ws.z,ws.y,0,-Zs.z,Zs.y,Ss.z,0,-Ss.x,ws.z,0,-ws.x,Zs.z,0,-Zs.x,-Ss.y,Ss.x,0,-ws.y,ws.x,0,-Zs.y,Zs.x,0];return!Bd(i,Ta,Ra,Pa,Rc)||(i=[1,0,0,0,1,0,0,0,1],!Bd(i,Ta,Ra,Pa,Rc))?!1:(Pc.crossVectors(Ss,ws),i=[Pc.x,Pc.y,Pc.z],Bd(i,Ta,Ra,Pa,Rc))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,is).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(is).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ts[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ts[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ts[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ts[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ts[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ts[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ts[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ts[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ts),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ts=[new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie],is=new Ie,Ca=new ac,Ta=new Ie,Ra=new Ie,Pa=new Ie,Ss=new Ie,ws=new Ie,Zs=new Ie,To=new Ie,Rc=new Ie,Pc=new Ie,Ys=new Ie;function Bd(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){Ys.fromArray(t,s);const c=r.x*Math.abs(Ys.x)+r.y*Math.abs(Ys.y)+r.z*Math.abs(Ys.z),h=e.dot(Ys),l=i.dot(Ys),p=n.dot(Ys);if(Math.max(-Math.max(h,l,p),Math.min(h,l,p))>c)return!1}return!0}const jC=new ac,Ro=new Ie,Hd=new Ie;class th{constructor(e=new Ie,i=-1){this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const n=this.center;i!==void 0?n.copy(i):jC.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ro.subVectors(e,this.center);const i=Ro.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),r=(n-this.radius)*.5;this.center.addScaledVector(Ro,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Hd.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ro.copy(e.center).add(Hd)),this.expandByPoint(Ro.copy(e.center).sub(Hd))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ns=new Ie,jd=new Ie,Mc=new Ie,xs=new Ie,Vd=new Ie,Ac=new Ie,zd=new Ie;class Sv{constructor(e=new Ie,i=new Ie(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ns)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=ns.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ns.copy(this.origin).addScaledVector(this.direction,i),ns.distanceToSquared(e))}distanceSqToSegment(e,i,n,r){jd.copy(e).add(i).multiplyScalar(.5),Mc.copy(i).sub(e).normalize(),xs.copy(this.origin).sub(jd);const s=e.distanceTo(i)*.5,o=-this.direction.dot(Mc),c=xs.dot(this.direction),h=-xs.dot(Mc),l=xs.lengthSq(),p=Math.abs(1-o*o);let g,f,y,x;if(p>0)if(g=o*h-c,f=o*c-h,x=s*p,g>=0)if(f>=-x)if(f<=x){const S=1/p;g*=S,f*=S,y=g*(g+o*f+2*c)+f*(o*g+f+2*h)+l}else f=s,g=Math.max(0,-(o*f+c)),y=-g*g+f*(f+2*h)+l;else f=-s,g=Math.max(0,-(o*f+c)),y=-g*g+f*(f+2*h)+l;else f<=-x?(g=Math.max(0,-(-o*s+c)),f=g>0?-s:Math.min(Math.max(-s,-h),s),y=-g*g+f*(f+2*h)+l):f<=x?(g=0,f=Math.min(Math.max(-s,-h),s),y=f*(f+2*h)+l):(g=Math.max(0,-(o*s+c)),f=g>0?s:Math.min(Math.max(-s,-h),s),y=-g*g+f*(f+2*h)+l);else f=o>0?-s:s,g=Math.max(0,-(o*f+c)),y=-g*g+f*(f+2*h)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,g),r&&r.copy(jd).addScaledVector(Mc,f),y}intersectSphere(e,i){ns.subVectors(e.center,this.origin);const n=ns.dot(this.direction),r=ns.dot(ns)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),c=n-o,h=n+o;return h<0?null:c<0?this.at(h,i):this.at(c,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){const n=this.distanceToPlane(e);return n===null?null:this.at(n,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let n,r,s,o,c,h;const l=1/this.direction.x,p=1/this.direction.y,g=1/this.direction.z,f=this.origin;return l>=0?(n=(e.min.x-f.x)*l,r=(e.max.x-f.x)*l):(n=(e.max.x-f.x)*l,r=(e.min.x-f.x)*l),p>=0?(s=(e.min.y-f.y)*p,o=(e.max.y-f.y)*p):(s=(e.max.y-f.y)*p,o=(e.min.y-f.y)*p),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),g>=0?(c=(e.min.z-f.z)*g,h=(e.max.z-f.z)*g):(c=(e.max.z-f.z)*g,h=(e.min.z-f.z)*g),n>h||c>r)||((c>n||n!==n)&&(n=c),(h<r||r!==r)&&(r=h),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(e){return this.intersectBox(e,ns)!==null}intersectTriangle(e,i,n,r,s){Vd.subVectors(i,e),Ac.subVectors(n,e),zd.crossVectors(Vd,Ac);let o=this.direction.dot(zd),c;if(o>0){if(r)return null;c=1}else if(o<0)c=-1,o=-o;else return null;xs.subVectors(this.origin,e);const h=c*this.direction.dot(Ac.crossVectors(xs,Ac));if(h<0)return null;const l=c*this.direction.dot(Vd.cross(xs));if(l<0||h+l>o)return null;const p=-c*xs.dot(zd);return p<0?null:this.at(p/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class un{constructor(e,i,n,r,s,o,c,h,l,p,g,f,y,x,S,v){un.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,r,s,o,c,h,l,p,g,f,y,x,S,v)}set(e,i,n,r,s,o,c,h,l,p,g,f,y,x,S,v){const m=this.elements;return m[0]=e,m[4]=i,m[8]=n,m[12]=r,m[1]=s,m[5]=o,m[9]=c,m[13]=h,m[2]=l,m[6]=p,m[10]=g,m[14]=f,m[3]=y,m[7]=x,m[11]=S,m[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new un().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,r=1/Ma.setFromMatrixColumn(e,0).length(),s=1/Ma.setFromMatrixColumn(e,1).length(),o=1/Ma.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*o,i[9]=n[9]*o,i[10]=n[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),c=Math.sin(n),h=Math.cos(r),l=Math.sin(r),p=Math.cos(s),g=Math.sin(s);if(e.order==="XYZ"){const f=o*p,y=o*g,x=c*p,S=c*g;i[0]=h*p,i[4]=-h*g,i[8]=l,i[1]=y+x*l,i[5]=f-S*l,i[9]=-c*h,i[2]=S-f*l,i[6]=x+y*l,i[10]=o*h}else if(e.order==="YXZ"){const f=h*p,y=h*g,x=l*p,S=l*g;i[0]=f+S*c,i[4]=x*c-y,i[8]=o*l,i[1]=o*g,i[5]=o*p,i[9]=-c,i[2]=y*c-x,i[6]=S+f*c,i[10]=o*h}else if(e.order==="ZXY"){const f=h*p,y=h*g,x=l*p,S=l*g;i[0]=f-S*c,i[4]=-o*g,i[8]=x+y*c,i[1]=y+x*c,i[5]=o*p,i[9]=S-f*c,i[2]=-o*l,i[6]=c,i[10]=o*h}else if(e.order==="ZYX"){const f=o*p,y=o*g,x=c*p,S=c*g;i[0]=h*p,i[4]=x*l-y,i[8]=f*l+S,i[1]=h*g,i[5]=S*l+f,i[9]=y*l-x,i[2]=-l,i[6]=c*h,i[10]=o*h}else if(e.order==="YZX"){const f=o*h,y=o*l,x=c*h,S=c*l;i[0]=h*p,i[4]=S-f*g,i[8]=x*g+y,i[1]=g,i[5]=o*p,i[9]=-c*p,i[2]=-l*p,i[6]=y*g+x,i[10]=f-S*g}else if(e.order==="XZY"){const f=o*h,y=o*l,x=c*h,S=c*l;i[0]=h*p,i[4]=-g,i[8]=l*p,i[1]=f*g+S,i[5]=o*p,i[9]=y*g-x,i[2]=x*g-y,i[6]=c*p,i[10]=S*g+f}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(VC,e,zC)}lookAt(e,i,n){const r=this.elements;return tr.subVectors(e,i),tr.lengthSq()===0&&(tr.z=1),tr.normalize(),Es.crossVectors(n,tr),Es.lengthSq()===0&&(Math.abs(n.z)===1?tr.x+=1e-4:tr.z+=1e-4,tr.normalize(),Es.crossVectors(n,tr)),Es.normalize(),Dc.crossVectors(tr,Es),r[0]=Es.x,r[4]=Dc.x,r[8]=tr.x,r[1]=Es.y,r[5]=Dc.y,r[9]=tr.y,r[2]=Es.z,r[6]=Dc.z,r[10]=tr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,r=i.elements,s=this.elements,o=n[0],c=n[4],h=n[8],l=n[12],p=n[1],g=n[5],f=n[9],y=n[13],x=n[2],S=n[6],v=n[10],m=n[14],w=n[3],b=n[7],C=n[11],A=n[15],M=r[0],F=r[4],N=r[8],P=r[12],j=r[1],K=r[5],X=r[9],ie=r[13],q=r[2],ae=r[6],pe=r[10],ue=r[14],xe=r[3],Ee=r[7],ye=r[11],ge=r[15];return s[0]=o*M+c*j+h*q+l*xe,s[4]=o*F+c*K+h*ae+l*Ee,s[8]=o*N+c*X+h*pe+l*ye,s[12]=o*P+c*ie+h*ue+l*ge,s[1]=p*M+g*j+f*q+y*xe,s[5]=p*F+g*K+f*ae+y*Ee,s[9]=p*N+g*X+f*pe+y*ye,s[13]=p*P+g*ie+f*ue+y*ge,s[2]=x*M+S*j+v*q+m*xe,s[6]=x*F+S*K+v*ae+m*Ee,s[10]=x*N+S*X+v*pe+m*ye,s[14]=x*P+S*ie+v*ue+m*ge,s[3]=w*M+b*j+C*q+A*xe,s[7]=w*F+b*K+C*ae+A*Ee,s[11]=w*N+b*X+C*pe+A*ye,s[15]=w*P+b*ie+C*ue+A*ge,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],r=e[8],s=e[12],o=e[1],c=e[5],h=e[9],l=e[13],p=e[2],g=e[6],f=e[10],y=e[14],x=e[3],S=e[7],v=e[11],m=e[15];return x*(+s*h*g-r*l*g-s*c*f+n*l*f+r*c*y-n*h*y)+S*(+i*h*y-i*l*f+s*o*f-r*o*y+r*l*p-s*h*p)+v*(+i*l*g-i*c*y-s*o*g+n*o*y+s*c*p-n*l*p)+m*(-r*c*p-i*h*g+i*c*f+r*o*g-n*o*f+n*h*p)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],c=e[5],h=e[6],l=e[7],p=e[8],g=e[9],f=e[10],y=e[11],x=e[12],S=e[13],v=e[14],m=e[15],w=g*v*l-S*f*l+S*h*y-c*v*y-g*h*m+c*f*m,b=x*f*l-p*v*l-x*h*y+o*v*y+p*h*m-o*f*m,C=p*S*l-x*g*l+x*c*y-o*S*y-p*c*m+o*g*m,A=x*g*h-p*S*h-x*c*f+o*S*f+p*c*v-o*g*v,M=i*w+n*b+r*C+s*A;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/M;return e[0]=w*F,e[1]=(S*f*s-g*v*s-S*r*y+n*v*y+g*r*m-n*f*m)*F,e[2]=(c*v*s-S*h*s+S*r*l-n*v*l-c*r*m+n*h*m)*F,e[3]=(g*h*s-c*f*s-g*r*l+n*f*l+c*r*y-n*h*y)*F,e[4]=b*F,e[5]=(p*v*s-x*f*s+x*r*y-i*v*y-p*r*m+i*f*m)*F,e[6]=(x*h*s-o*v*s-x*r*l+i*v*l+o*r*m-i*h*m)*F,e[7]=(o*f*s-p*h*s+p*r*l-i*f*l-o*r*y+i*h*y)*F,e[8]=C*F,e[9]=(x*g*s-p*S*s-x*n*y+i*S*y+p*n*m-i*g*m)*F,e[10]=(o*S*s-x*c*s+x*n*l-i*S*l-o*n*m+i*c*m)*F,e[11]=(p*c*s-o*g*s-p*n*l+i*g*l+o*n*y-i*c*y)*F,e[12]=A*F,e[13]=(p*S*r-x*g*r+x*n*f-i*S*f-p*n*v+i*g*v)*F,e[14]=(x*c*r-o*S*r-x*n*h+i*S*h+o*n*v-i*c*v)*F,e[15]=(o*g*r-p*c*r+p*n*h-i*g*h-o*n*f+i*c*f)*F,this}scale(e){const i=this.elements,n=e.x,r=e.y,s=e.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,r))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),r=Math.sin(i),s=1-n,o=e.x,c=e.y,h=e.z,l=s*o,p=s*c;return this.set(l*o+n,l*c-r*h,l*h+r*c,0,l*c+r*h,p*c+n,p*h-r*o,0,l*h-r*c,p*h+r*o,s*h*h+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,i,r,1,0,0,0,0,1),this}compose(e,i,n){const r=this.elements,s=i._x,o=i._y,c=i._z,h=i._w,l=s+s,p=o+o,g=c+c,f=s*l,y=s*p,x=s*g,S=o*p,v=o*g,m=c*g,w=h*l,b=h*p,C=h*g,A=n.x,M=n.y,F=n.z;return r[0]=(1-(S+m))*A,r[1]=(y+C)*A,r[2]=(x-b)*A,r[3]=0,r[4]=(y-C)*M,r[5]=(1-(f+m))*M,r[6]=(v+w)*M,r[7]=0,r[8]=(x+b)*F,r[9]=(v-w)*F,r[10]=(1-(f+S))*F,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,n){const r=this.elements;let s=Ma.set(r[0],r[1],r[2]).length();const o=Ma.set(r[4],r[5],r[6]).length(),c=Ma.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],xr.copy(this);const l=1/s,p=1/o,g=1/c;return xr.elements[0]*=l,xr.elements[1]*=l,xr.elements[2]*=l,xr.elements[4]*=p,xr.elements[5]*=p,xr.elements[6]*=p,xr.elements[8]*=g,xr.elements[9]*=g,xr.elements[10]*=g,i.setFromRotationMatrix(xr),n.x=s,n.y=o,n.z=c,this}makePerspective(e,i,n,r,s,o,c=us){const h=this.elements,l=2*s/(i-e),p=2*s/(n-r),g=(i+e)/(i-e),f=(n+r)/(n-r);let y,x;if(c===us)y=-(o+s)/(o-s),x=-2*o*s/(o-s);else if(c===wl)y=-o/(o-s),x=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return h[0]=l,h[4]=0,h[8]=g,h[12]=0,h[1]=0,h[5]=p,h[9]=f,h[13]=0,h[2]=0,h[6]=0,h[10]=y,h[14]=x,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,i,n,r,s,o,c=us){const h=this.elements,l=1/(i-e),p=1/(n-r),g=1/(o-s),f=(i+e)*l,y=(n+r)*p;let x,S;if(c===us)x=(o+s)*g,S=-2*g;else if(c===wl)x=s*g,S=-1*g;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return h[0]=2*l,h[4]=0,h[8]=0,h[12]=-f,h[1]=0,h[5]=2*p,h[9]=0,h[13]=-y,h[2]=0,h[6]=0,h[10]=S,h[14]=-x,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let r=0;r<16;r++)if(i[r]!==n[r])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}const Ma=new Ie,xr=new un,VC=new Ie(0,0,0),zC=new Ie(1,1,1),Es=new Ie,Dc=new Ie,tr=new Ie,ef=new un,tf=new ma;class Xl{constructor(e=0,i=0,n=0,r=Xl.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,r=this._order){return this._x=e,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],c=r[8],h=r[1],l=r[5],p=r[9],g=r[2],f=r[6],y=r[10];switch(i){case"XYZ":this._y=Math.asin(Mn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,y),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Mn(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(c,y),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-g,s),this._z=0);break;case"ZXY":this._x=Math.asin(Mn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-g,y),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(h,s));break;case"ZYX":this._y=Math.asin(-Mn(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(f,y),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Mn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-p,l),this._y=Math.atan2(-g,s)):(this._x=0,this._y=Math.atan2(c,y));break;case"XZY":this._z=Math.asin(-Mn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(c,s)):(this._x=Math.atan2(-p,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return ef.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ef,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return tf.setFromEuler(this),this.setFromQuaternion(tf,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Xl.DEFAULT_ORDER="XYZ";class wv{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let GC=0;const nf=new Ie,Aa=new ma,rs=new un,Ic=new Ie,Po=new Ie,qC=new Ie,WC=new ma,rf=new Ie(1,0,0),sf=new Ie(0,1,0),af=new Ie(0,0,1),KC={type:"added"},XC={type:"removed"};class sr extends _a{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:GC++}),this.uuid=sc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=sr.DEFAULT_UP.clone();const e=new Ie,i=new Xl,n=new ma,r=new Ie(1,1,1);function s(){n.setFromEuler(i,!1)}function o(){i.setFromQuaternion(n,void 0,!1)}i._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new un},normalMatrix:{value:new ri}}),this.matrix=new un,this.matrixWorld=new un,this.matrixAutoUpdate=sr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=sr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new wv,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Aa.setFromAxisAngle(e,i),this.quaternion.multiply(Aa),this}rotateOnWorldAxis(e,i){return Aa.setFromAxisAngle(e,i),this.quaternion.premultiply(Aa),this}rotateX(e){return this.rotateOnAxis(rf,e)}rotateY(e){return this.rotateOnAxis(sf,e)}rotateZ(e){return this.rotateOnAxis(af,e)}translateOnAxis(e,i){return nf.copy(e).applyQuaternion(this.quaternion),this.position.add(nf.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(rf,e)}translateY(e){return this.translateOnAxis(sf,e)}translateZ(e){return this.translateOnAxis(af,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(rs.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?Ic.copy(e):Ic.set(e,i,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Po.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rs.lookAt(Po,Ic,this.up):rs.lookAt(Ic,Po,this.up),this.quaternion.setFromRotationMatrix(rs),r&&(rs.extractRotation(r.matrixWorld),Aa.setFromRotationMatrix(rs),this.quaternion.premultiply(Aa.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(KC)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(XC)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),rs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),rs.multiply(e.parent.matrixWorld)),e.applyMatrix4(rs),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i){let n=[];this[e]===i&&n.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,i);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Po,e,qC),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Po,WC,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,r=i.length;n<r;n++){const s=i[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const c=r[s];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(c,h){return c[h.uuid]===void 0&&(c[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const h=c.shapes;if(Array.isArray(h))for(let l=0,p=h.length;l<p;l++){const g=h[l];s(e.shapes,g)}else s(e.shapes,h)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let h=0,l=this.material.length;h<l;h++)c.push(s(e.materials,this.material[h]));r.material=c}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let c=0;c<this.children.length;c++)r.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let c=0;c<this.animations.length;c++){const h=this.animations[c];r.animations.push(s(e.animations,h))}}if(i){const c=o(e.geometries),h=o(e.materials),l=o(e.textures),p=o(e.images),g=o(e.shapes),f=o(e.skeletons),y=o(e.animations),x=o(e.nodes);c.length>0&&(n.geometries=c),h.length>0&&(n.materials=h),l.length>0&&(n.textures=l),p.length>0&&(n.images=p),g.length>0&&(n.shapes=g),f.length>0&&(n.skeletons=f),y.length>0&&(n.animations=y),x.length>0&&(n.nodes=x)}return n.object=r,n;function o(c){const h=[];for(const l in c){const p=c[l];delete p.metadata,h.push(p)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}sr.DEFAULT_UP=new Ie(0,1,0);sr.DEFAULT_MATRIX_AUTO_UPDATE=!0;sr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Er=new Ie,ss=new Ie,Gd=new Ie,as=new Ie,Da=new Ie,Ia=new Ie,of=new Ie,qd=new Ie,Wd=new Ie,Kd=new Ie;let Lc=!1;class Rr{constructor(e=new Ie,i=new Ie,n=new Ie){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,r){r.subVectors(n,i),Er.subVectors(e,i),r.cross(Er);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,i,n,r,s){Er.subVectors(r,i),ss.subVectors(n,i),Gd.subVectors(e,i);const o=Er.dot(Er),c=Er.dot(ss),h=Er.dot(Gd),l=ss.dot(ss),p=ss.dot(Gd),g=o*l-c*c;if(g===0)return s.set(-2,-1,-1);const f=1/g,y=(l*h-c*p)*f,x=(o*p-c*h)*f;return s.set(1-y-x,x,y)}static containsPoint(e,i,n,r){return this.getBarycoord(e,i,n,r,as),as.x>=0&&as.y>=0&&as.x+as.y<=1}static getUV(e,i,n,r,s,o,c,h){return Lc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Lc=!0),this.getInterpolation(e,i,n,r,s,o,c,h)}static getInterpolation(e,i,n,r,s,o,c,h){return this.getBarycoord(e,i,n,r,as),h.setScalar(0),h.addScaledVector(s,as.x),h.addScaledVector(o,as.y),h.addScaledVector(c,as.z),h}static isFrontFacing(e,i,n,r){return Er.subVectors(n,i),ss.subVectors(e,i),Er.cross(ss).dot(r)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,r){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,n,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Er.subVectors(this.c,this.b),ss.subVectors(this.a,this.b),Er.cross(ss).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Rr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Rr.getBarycoord(e,this.a,this.b,this.c,i)}getUV(e,i,n,r,s){return Lc===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Lc=!0),Rr.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}getInterpolation(e,i,n,r,s){return Rr.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}containsPoint(e){return Rr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Rr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,r=this.b,s=this.c;let o,c;Da.subVectors(r,n),Ia.subVectors(s,n),qd.subVectors(e,n);const h=Da.dot(qd),l=Ia.dot(qd);if(h<=0&&l<=0)return i.copy(n);Wd.subVectors(e,r);const p=Da.dot(Wd),g=Ia.dot(Wd);if(p>=0&&g<=p)return i.copy(r);const f=h*g-p*l;if(f<=0&&h>=0&&p<=0)return o=h/(h-p),i.copy(n).addScaledVector(Da,o);Kd.subVectors(e,s);const y=Da.dot(Kd),x=Ia.dot(Kd);if(x>=0&&y<=x)return i.copy(s);const S=y*l-h*x;if(S<=0&&l>=0&&x<=0)return c=l/(l-x),i.copy(n).addScaledVector(Ia,c);const v=p*x-y*g;if(v<=0&&g-p>=0&&y-x>=0)return of.subVectors(s,r),c=(g-p)/(g-p+(y-x)),i.copy(r).addScaledVector(of,c);const m=1/(v+S+f);return o=S*m,c=f*m,i.copy(n).addScaledVector(Da,o).addScaledVector(Ia,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let $C=0;class $l extends _a{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$C++}),this.uuid=sc(),this.name="",this.type="Material",this.blending=Ka,this.side=Us,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=av,this.blendDst=ov,this.blendEquation=Va,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Eu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=EC,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ld,this.stencilZFail=Ld,this.stencilZPass=Ld,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const n=e[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ka&&(n.blending=this.blending),this.side!==Us&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const c in s){const h=s[c];delete h.metadata,o.push(h)}return o}if(i){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let n=null;if(i!==null){const r=i.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=i[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const xv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cs={h:0,s:0,l:0},Fc={h:0,s:0,l:0};function Xd(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}class Di{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){if(i===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,i,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=ln){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,xi.toWorkingColorSpace(this,i),this}setRGB(e,i,n,r=xi.workingColorSpace){return this.r=e,this.g=i,this.b=n,xi.toWorkingColorSpace(this,r),this}setHSL(e,i,n,r=xi.workingColorSpace){if(e=LC(e,1),i=Mn(i,0,1),n=Mn(n,0,1),i===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+i):n+i-n*i,o=2*n-s;this.r=Xd(o,s,e+1/3),this.g=Xd(o,s,e),this.b=Xd(o,s,e-1/3)}return xi.toWorkingColorSpace(this,r),this}setStyle(e,i=ln){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],c=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(o===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=ln){const n=xv[e.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Xa(e.r),this.g=Xa(e.g),this.b=Xa(e.b),this}copyLinearToSRGB(e){return this.r=Nd(e.r),this.g=Nd(e.g),this.b=Nd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ln){return xi.fromWorkingColorSpace(_n.copy(this),e),Math.round(Mn(_n.r*255,0,255))*65536+Math.round(Mn(_n.g*255,0,255))*256+Math.round(Mn(_n.b*255,0,255))}getHexString(e=ln){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=xi.workingColorSpace){xi.fromWorkingColorSpace(_n.copy(this),i);const n=_n.r,r=_n.g,s=_n.b,o=Math.max(n,r,s),c=Math.min(n,r,s);let h,l;const p=(c+o)/2;if(c===o)h=0,l=0;else{const g=o-c;switch(l=p<=.5?g/(o+c):g/(2-o-c),o){case n:h=(r-s)/g+(r<s?6:0);break;case r:h=(s-n)/g+2;break;case s:h=(n-r)/g+4;break}h/=6}return e.h=h,e.s=l,e.l=p,e}getRGB(e,i=xi.workingColorSpace){return xi.fromWorkingColorSpace(_n.copy(this),i),e.r=_n.r,e.g=_n.g,e.b=_n.b,e}getStyle(e=ln){xi.fromWorkingColorSpace(_n.copy(this),e);const i=_n.r,n=_n.g,r=_n.b;return e!==ln?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,i,n){return this.getHSL(Cs),this.setHSL(Cs.h+e,Cs.s+i,Cs.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(Cs),e.getHSL(Fc);const n=Fd(Cs.h,Fc.h,i),r=Fd(Cs.s,Fc.s,i),s=Fd(Cs.l,Fc.l,i);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _n=new Di;Di.NAMES=xv;class ih extends $l{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const qi=new Ie,kc=new si;class Kr{constructor(e,i,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=n,this.usage=Kp,this.updateRange={offset:0,count:-1},this.gpuType=As,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=i.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)kc.fromBufferAttribute(this,i),kc.applyMatrix3(e),this.setXY(i,kc.x,kc.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)qi.fromBufferAttribute(this,i),qi.applyMatrix3(e),this.setXYZ(i,qi.x,qi.y,qi.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)qi.fromBufferAttribute(this,i),qi.applyMatrix4(e),this.setXYZ(i,qi.x,qi.y,qi.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)qi.fromBufferAttribute(this,i),qi.applyNormalMatrix(e),this.setXYZ(i,qi.x,qi.y,qi.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)qi.fromBufferAttribute(this,i),qi.transformDirection(e),this.setXYZ(i,qi.x,qi.y,qi.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=Co(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=Un(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Co(i,this.array)),i}setX(e,i){return this.normalized&&(i=Un(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Co(i,this.array)),i}setY(e,i){return this.normalized&&(i=Un(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Co(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Un(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Co(i,this.array)),i}setW(e,i){return this.normalized&&(i=Un(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=Un(i,this.array),n=Un(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=Un(i,this.array),n=Un(n,this.array),r=Un(r,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=Un(i,this.array),n=Un(n,this.array),r=Un(r,this.array),s=Un(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Kp&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class Ev extends Kr{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class Cv extends Kr{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class Xr extends Kr{constructor(e,i,n){super(new Float32Array(e),i,n)}}let ZC=0;const ur=new un,$d=new sr,La=new Ie,ir=new ac,Mo=new ac,rn=new Ie;class zs extends _a{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ZC++}),this.uuid=sc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vv(e)?Cv:Ev)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new ri().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ur.makeRotationFromQuaternion(e),this.applyMatrix4(ur),this}rotateX(e){return ur.makeRotationX(e),this.applyMatrix4(ur),this}rotateY(e){return ur.makeRotationY(e),this.applyMatrix4(ur),this}rotateZ(e){return ur.makeRotationZ(e),this.applyMatrix4(ur),this}translate(e,i,n){return ur.makeTranslation(e,i,n),this.applyMatrix4(ur),this}scale(e,i,n){return ur.makeScale(e,i,n),this.applyMatrix4(ur),this}lookAt(e){return $d.lookAt(e),$d.updateMatrix(),this.applyMatrix4($d.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(La).negate(),this.translate(La.x,La.y,La.z),this}setFromPoints(e){const i=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Xr(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ac);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Ie(-1/0,-1/0,-1/0),new Ie(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,r=i.length;n<r;n++){const s=i[n];ir.setFromBufferAttribute(s),this.morphTargetsRelative?(rn.addVectors(this.boundingBox.min,ir.min),this.boundingBox.expandByPoint(rn),rn.addVectors(this.boundingBox.max,ir.max),this.boundingBox.expandByPoint(rn)):(this.boundingBox.expandByPoint(ir.min),this.boundingBox.expandByPoint(ir.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new th);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Ie,1/0);return}if(e){const n=this.boundingSphere.center;if(ir.setFromBufferAttribute(e),i)for(let s=0,o=i.length;s<o;s++){const c=i[s];Mo.setFromBufferAttribute(c),this.morphTargetsRelative?(rn.addVectors(ir.min,Mo.min),ir.expandByPoint(rn),rn.addVectors(ir.max,Mo.max),ir.expandByPoint(rn)):(ir.expandByPoint(Mo.min),ir.expandByPoint(Mo.max))}ir.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)rn.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(rn));if(i)for(let s=0,o=i.length;s<o;s++){const c=i[s],h=this.morphTargetsRelative;for(let l=0,p=c.count;l<p;l++)rn.fromBufferAttribute(c,l),h&&(La.fromBufferAttribute(e,l),rn.add(La)),r=Math.max(r,n.distanceToSquared(rn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=i.position.array,s=i.normal.array,o=i.uv.array,c=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Kr(new Float32Array(4*c),4));const h=this.getAttribute("tangent").array,l=[],p=[];for(let j=0;j<c;j++)l[j]=new Ie,p[j]=new Ie;const g=new Ie,f=new Ie,y=new Ie,x=new si,S=new si,v=new si,m=new Ie,w=new Ie;function b(j,K,X){g.fromArray(r,j*3),f.fromArray(r,K*3),y.fromArray(r,X*3),x.fromArray(o,j*2),S.fromArray(o,K*2),v.fromArray(o,X*2),f.sub(g),y.sub(g),S.sub(x),v.sub(x);const ie=1/(S.x*v.y-v.x*S.y);isFinite(ie)&&(m.copy(f).multiplyScalar(v.y).addScaledVector(y,-S.y).multiplyScalar(ie),w.copy(y).multiplyScalar(S.x).addScaledVector(f,-v.x).multiplyScalar(ie),l[j].add(m),l[K].add(m),l[X].add(m),p[j].add(w),p[K].add(w),p[X].add(w))}let C=this.groups;C.length===0&&(C=[{start:0,count:n.length}]);for(let j=0,K=C.length;j<K;++j){const X=C[j],ie=X.start,q=X.count;for(let ae=ie,pe=ie+q;ae<pe;ae+=3)b(n[ae+0],n[ae+1],n[ae+2])}const A=new Ie,M=new Ie,F=new Ie,N=new Ie;function P(j){F.fromArray(s,j*3),N.copy(F);const K=l[j];A.copy(K),A.sub(F.multiplyScalar(F.dot(K))).normalize(),M.crossVectors(N,K);const ie=M.dot(p[j])<0?-1:1;h[j*4]=A.x,h[j*4+1]=A.y,h[j*4+2]=A.z,h[j*4+3]=ie}for(let j=0,K=C.length;j<K;++j){const X=C[j],ie=X.start,q=X.count;for(let ae=ie,pe=ie+q;ae<pe;ae+=3)P(n[ae+0]),P(n[ae+1]),P(n[ae+2])}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Kr(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let f=0,y=n.count;f<y;f++)n.setXYZ(f,0,0,0);const r=new Ie,s=new Ie,o=new Ie,c=new Ie,h=new Ie,l=new Ie,p=new Ie,g=new Ie;if(e)for(let f=0,y=e.count;f<y;f+=3){const x=e.getX(f+0),S=e.getX(f+1),v=e.getX(f+2);r.fromBufferAttribute(i,x),s.fromBufferAttribute(i,S),o.fromBufferAttribute(i,v),p.subVectors(o,s),g.subVectors(r,s),p.cross(g),c.fromBufferAttribute(n,x),h.fromBufferAttribute(n,S),l.fromBufferAttribute(n,v),c.add(p),h.add(p),l.add(p),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(S,h.x,h.y,h.z),n.setXYZ(v,l.x,l.y,l.z)}else for(let f=0,y=i.count;f<y;f+=3)r.fromBufferAttribute(i,f+0),s.fromBufferAttribute(i,f+1),o.fromBufferAttribute(i,f+2),p.subVectors(o,s),g.subVectors(r,s),p.cross(g),n.setXYZ(f+0,p.x,p.y,p.z),n.setXYZ(f+1,p.x,p.y,p.z),n.setXYZ(f+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)rn.fromBufferAttribute(e,i),rn.normalize(),e.setXYZ(i,rn.x,rn.y,rn.z)}toNonIndexed(){function e(c,h){const l=c.array,p=c.itemSize,g=c.normalized,f=new l.constructor(h.length*p);let y=0,x=0;for(let S=0,v=h.length;S<v;S++){c.isInterleavedBufferAttribute?y=h[S]*c.data.stride+c.offset:y=h[S]*p;for(let m=0;m<p;m++)f[x++]=l[y++]}return new Kr(f,p,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new zs,n=this.index.array,r=this.attributes;for(const c in r){const h=r[c],l=e(h,n);i.setAttribute(c,l)}const s=this.morphAttributes;for(const c in s){const h=[],l=s[c];for(let p=0,g=l.length;p<g;p++){const f=l[p],y=e(f,n);h.push(y)}i.morphAttributes[c]=h}i.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let c=0,h=o.length;c<h;c++){const l=o[c];i.addGroup(l.start,l.count,l.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(e[l]=h[l]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const h in n){const l=n[h];e.data.attributes[h]=l.toJSON(e.data)}const r={};let s=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],p=[];for(let g=0,f=l.length;g<f;g++){const y=l[g];p.push(y.toJSON(e.data))}p.length>0&&(r[h]=p,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(i));const r=e.attributes;for(const l in r){const p=r[l];this.setAttribute(l,p.clone(i))}const s=e.morphAttributes;for(const l in s){const p=[],g=s[l];for(let f=0,y=g.length;f<y;f++)p.push(g[f].clone(i));this.morphAttributes[l]=p}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,p=o.length;l<p;l++){const g=o[l];this.addGroup(g.start,g.count,g.materialIndex)}const c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cf=new un,Js=new Sv,Nc=new th,lf=new Ie,Fa=new Ie,ka=new Ie,Na=new Ie,Zd=new Ie,Oc=new Ie,Uc=new si,Bc=new si,Hc=new si,df=new Ie,uf=new Ie,hf=new Ie,jc=new Ie,Vc=new Ie;class hs extends sr{constructor(e=new zs,i=new ih){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const c=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=s}}}}getVertexPosition(e,i){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;i.fromBufferAttribute(r,e);const c=this.morphTargetInfluences;if(s&&c){Oc.set(0,0,0);for(let h=0,l=s.length;h<l;h++){const p=c[h],g=s[h];p!==0&&(Zd.fromBufferAttribute(g,e),o?Oc.addScaledVector(Zd,p):Oc.addScaledVector(Zd.sub(i),p))}i.add(Oc)}return i}raycast(e,i){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Nc.copy(n.boundingSphere),Nc.applyMatrix4(s),Js.copy(e.ray).recast(e.near),!(Nc.containsPoint(Js.origin)===!1&&(Js.intersectSphere(Nc,lf)===null||Js.origin.distanceToSquared(lf)>(e.far-e.near)**2))&&(cf.copy(s).invert(),Js.copy(e.ray).applyMatrix4(cf),!(n.boundingBox!==null&&Js.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,i,Js)))}_computeIntersections(e,i,n){let r;const s=this.geometry,o=this.material,c=s.index,h=s.attributes.position,l=s.attributes.uv,p=s.attributes.uv1,g=s.attributes.normal,f=s.groups,y=s.drawRange;if(c!==null)if(Array.isArray(o))for(let x=0,S=f.length;x<S;x++){const v=f[x],m=o[v.materialIndex],w=Math.max(v.start,y.start),b=Math.min(c.count,Math.min(v.start+v.count,y.start+y.count));for(let C=w,A=b;C<A;C+=3){const M=c.getX(C),F=c.getX(C+1),N=c.getX(C+2);r=zc(this,m,e,n,l,p,g,M,F,N),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=v.materialIndex,i.push(r))}}else{const x=Math.max(0,y.start),S=Math.min(c.count,y.start+y.count);for(let v=x,m=S;v<m;v+=3){const w=c.getX(v),b=c.getX(v+1),C=c.getX(v+2);r=zc(this,o,e,n,l,p,g,w,b,C),r&&(r.faceIndex=Math.floor(v/3),i.push(r))}}else if(h!==void 0)if(Array.isArray(o))for(let x=0,S=f.length;x<S;x++){const v=f[x],m=o[v.materialIndex],w=Math.max(v.start,y.start),b=Math.min(h.count,Math.min(v.start+v.count,y.start+y.count));for(let C=w,A=b;C<A;C+=3){const M=C,F=C+1,N=C+2;r=zc(this,m,e,n,l,p,g,M,F,N),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=v.materialIndex,i.push(r))}}else{const x=Math.max(0,y.start),S=Math.min(h.count,y.start+y.count);for(let v=x,m=S;v<m;v+=3){const w=v,b=v+1,C=v+2;r=zc(this,o,e,n,l,p,g,w,b,C),r&&(r.faceIndex=Math.floor(v/3),i.push(r))}}}}function YC(t,e,i,n,r,s,o,c){let h;if(e.side===Vn?h=n.intersectTriangle(o,s,r,!0,c):h=n.intersectTriangle(r,s,o,e.side===Us,c),h===null)return null;Vc.copy(c),Vc.applyMatrix4(t.matrixWorld);const l=i.ray.origin.distanceTo(Vc);return l<i.near||l>i.far?null:{distance:l,point:Vc.clone(),object:t}}function zc(t,e,i,n,r,s,o,c,h,l){t.getVertexPosition(c,Fa),t.getVertexPosition(h,ka),t.getVertexPosition(l,Na);const p=YC(t,e,i,n,Fa,ka,Na,jc);if(p){r&&(Uc.fromBufferAttribute(r,c),Bc.fromBufferAttribute(r,h),Hc.fromBufferAttribute(r,l),p.uv=Rr.getInterpolation(jc,Fa,ka,Na,Uc,Bc,Hc,new si)),s&&(Uc.fromBufferAttribute(s,c),Bc.fromBufferAttribute(s,h),Hc.fromBufferAttribute(s,l),p.uv1=Rr.getInterpolation(jc,Fa,ka,Na,Uc,Bc,Hc,new si),p.uv2=p.uv1),o&&(df.fromBufferAttribute(o,c),uf.fromBufferAttribute(o,h),hf.fromBufferAttribute(o,l),p.normal=Rr.getInterpolation(jc,Fa,ka,Na,df,uf,hf,new Ie),p.normal.dot(n.direction)>0&&p.normal.multiplyScalar(-1));const g={a:c,b:h,c:l,normal:new Ie,materialIndex:0};Rr.getNormal(Fa,ka,Na,g.normal),p.face=g}return p}class oc extends zs{constructor(e=1,i=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const c=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const h=[],l=[],p=[],g=[];let f=0,y=0;x("z","y","x",-1,-1,n,i,e,o,s,0),x("z","y","x",1,-1,n,i,-e,o,s,1),x("x","z","y",1,1,e,n,i,r,o,2),x("x","z","y",1,-1,e,n,-i,r,o,3),x("x","y","z",1,-1,e,i,n,r,s,4),x("x","y","z",-1,-1,e,i,-n,r,s,5),this.setIndex(h),this.setAttribute("position",new Xr(l,3)),this.setAttribute("normal",new Xr(p,3)),this.setAttribute("uv",new Xr(g,2));function x(S,v,m,w,b,C,A,M,F,N,P){const j=C/F,K=A/N,X=C/2,ie=A/2,q=M/2,ae=F+1,pe=N+1;let ue=0,xe=0;const Ee=new Ie;for(let ye=0;ye<pe;ye++){const ge=ye*K-ie;for(let Te=0;Te<ae;Te++){const rt=Te*j-X;Ee[S]=rt*w,Ee[v]=ge*b,Ee[m]=q,l.push(Ee.x,Ee.y,Ee.z),Ee[S]=0,Ee[v]=0,Ee[m]=M>0?1:-1,p.push(Ee.x,Ee.y,Ee.z),g.push(Te/F),g.push(1-ye/N),ue+=1}}for(let ye=0;ye<N;ye++)for(let ge=0;ge<F;ge++){const Te=f+ge+ae*ye,rt=f+ge+ae*(ye+1),et=f+(ge+1)+ae*(ye+1),tt=f+(ge+1)+ae*ye;h.push(Te,rt,tt),h.push(rt,et,tt),xe+=6}c.addGroup(y,xe,P),y+=xe,f+=ue}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ao(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Rn(t){const e={};for(let i=0;i<t.length;i++){const n=ao(t[i]);for(const r in n)e[r]=n[r]}return e}function JC(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function Tv(t){return t.getRenderTarget()===null?t.outputColorSpace:xi.workingColorSpace}const QC={clone:ao,merge:Rn};var eT=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,tT=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ga extends $l{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=eT,this.fragmentShader=tT,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ao(e.uniforms),this.uniformsGroups=JC(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?i.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[r]={type:"m4",value:o.toArray()}:i.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class Rv extends sr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new un,this.projectionMatrix=new un,this.projectionMatrixInverse=new un,this.coordinateSystem=us}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class pr extends Rv{constructor(e=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=Au*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(nl*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Au*2*Math.atan(Math.tan(nl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,i,n,r,s,o){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(nl*.5*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const h=o.fullWidth,l=o.fullHeight;s+=o.offsetX*r/h,i-=o.offsetY*n/l,r*=o.width/h,n*=o.height/l}const c=this.filmOffset;c!==0&&(s+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Oa=-90,Ua=1;class iT extends sr{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new pr(Oa,Ua,e,i);r.layers=this.layers,this.add(r);const s=new pr(Oa,Ua,e,i);s.layers=this.layers,this.add(s);const o=new pr(Oa,Ua,e,i);o.layers=this.layers,this.add(o);const c=new pr(Oa,Ua,e,i);c.layers=this.layers,this.add(c);const h=new pr(Oa,Ua,e,i);h.layers=this.layers,this.add(h);const l=new pr(Oa,Ua,e,i);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[n,r,s,o,c,h]=i;for(const l of i)this.remove(l);if(e===us)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(e===wl)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of i)this.add(l),l.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,c,h,l,p]=this.children,g=e.getRenderTarget(),f=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),x=e.xr.enabled;e.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(i,s),e.setRenderTarget(n,1,r),e.render(i,o),e.setRenderTarget(n,2,r),e.render(i,c),e.setRenderTarget(n,3,r),e.render(i,h),e.setRenderTarget(n,4,r),e.render(i,l),n.texture.generateMipmaps=S,e.setRenderTarget(n,5,r),e.render(i,p),e.setRenderTarget(g,f,y),e.xr.enabled=x,n.texture.needsPMREMUpdate=!0}}class Pv extends zn{constructor(e,i,n,r,s,o,c,h,l,p){e=e!==void 0?e:[],i=i!==void 0?i:no,super(e,i,n,r,s,o,c,h,l,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class nT extends fa{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];i.encoding!==void 0&&(No("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===da?ln:fr),this.texture=new Pv(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Hn}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new oc(5,5,5),s=new ga({name:"CubemapFromEquirect",uniforms:ao(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Vn,blending:Ds});s.uniforms.tEquirect.value=i;const o=new hs(r,s),c=i.minFilter;return i.minFilter===Qo&&(i.minFilter=Hn),new iT(1,10,this).update(e,o),i.minFilter=c,o.geometry.dispose(),o.material.dispose(),this}clear(e,i,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(i,n,r);e.setRenderTarget(s)}}const Yd=new Ie,rT=new Ie,sT=new ri;class Rs{constructor(e=new Ie(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,r){return this.normal.set(e,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){const r=Yd.subVectors(n,i).cross(rT.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const n=e.delta(Yd),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const n=i||sT.getNormalMatrix(e),r=this.coplanarPoint(Yd).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Qs=new th,Gc=new Ie;class Mv{constructor(e=new Rs,i=new Rs,n=new Rs,r=new Rs,s=new Rs,o=new Rs){this.planes=[e,i,n,r,s,o]}set(e,i,n,r,s,o){const c=this.planes;return c[0].copy(e),c[1].copy(i),c[2].copy(n),c[3].copy(r),c[4].copy(s),c[5].copy(o),this}copy(e){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=us){const n=this.planes,r=e.elements,s=r[0],o=r[1],c=r[2],h=r[3],l=r[4],p=r[5],g=r[6],f=r[7],y=r[8],x=r[9],S=r[10],v=r[11],m=r[12],w=r[13],b=r[14],C=r[15];if(n[0].setComponents(h-s,f-l,v-y,C-m).normalize(),n[1].setComponents(h+s,f+l,v+y,C+m).normalize(),n[2].setComponents(h+o,f+p,v+x,C+w).normalize(),n[3].setComponents(h-o,f-p,v-x,C-w).normalize(),n[4].setComponents(h-c,f-g,v-S,C-b).normalize(),i===us)n[5].setComponents(h+c,f+g,v+S,C+b).normalize();else if(i===wl)n[5].setComponents(c,g,S,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Qs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Qs.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Qs)}intersectsSprite(e){return Qs.center.set(0,0,0),Qs.radius=.7071067811865476,Qs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qs)}intersectsSphere(e){const i=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const i=this.planes;for(let n=0;n<6;n++){const r=i[n];if(Gc.x=r.normal.x>0?e.max.x:e.min.x,Gc.y=r.normal.y>0?e.max.y:e.min.y,Gc.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Gc)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Av(){let t=null,e=!1,i=null,n=null;function r(s,o){i(s,o),n=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&i!==null&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function aT(t,e){const i=e.isWebGL2,n=new WeakMap;function r(l,p){const g=l.array,f=l.usage,y=t.createBuffer();t.bindBuffer(p,y),t.bufferData(p,g,f),l.onUploadCallback();let x;if(g instanceof Float32Array)x=t.FLOAT;else if(g instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(i)x=t.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else x=t.UNSIGNED_SHORT;else if(g instanceof Int16Array)x=t.SHORT;else if(g instanceof Uint32Array)x=t.UNSIGNED_INT;else if(g instanceof Int32Array)x=t.INT;else if(g instanceof Int8Array)x=t.BYTE;else if(g instanceof Uint8Array)x=t.UNSIGNED_BYTE;else if(g instanceof Uint8ClampedArray)x=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:y,type:x,bytesPerElement:g.BYTES_PER_ELEMENT,version:l.version}}function s(l,p,g){const f=p.array,y=p.updateRange;t.bindBuffer(g,l),y.count===-1?t.bufferSubData(g,0,f):(i?t.bufferSubData(g,y.offset*f.BYTES_PER_ELEMENT,f,y.offset,y.count):t.bufferSubData(g,y.offset*f.BYTES_PER_ELEMENT,f.subarray(y.offset,y.offset+y.count)),y.count=-1),p.onUploadCallback()}function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function c(l){l.isInterleavedBufferAttribute&&(l=l.data);const p=n.get(l);p&&(t.deleteBuffer(p.buffer),n.delete(l))}function h(l,p){if(l.isGLBufferAttribute){const f=n.get(l);(!f||f.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const g=n.get(l);g===void 0?n.set(l,r(l,p)):g.version<l.version&&(s(g.buffer,l,p),g.version=l.version)}return{get:o,remove:c,update:h}}class nh extends zs{constructor(e=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:r};const s=e/2,o=i/2,c=Math.floor(n),h=Math.floor(r),l=c+1,p=h+1,g=e/c,f=i/h,y=[],x=[],S=[],v=[];for(let m=0;m<p;m++){const w=m*f-o;for(let b=0;b<l;b++){const C=b*g-s;x.push(C,-w,0),S.push(0,0,1),v.push(b/c),v.push(1-m/h)}}for(let m=0;m<h;m++)for(let w=0;w<c;w++){const b=w+l*m,C=w+l*(m+1),A=w+1+l*(m+1),M=w+1+l*m;y.push(b,C,M),y.push(C,A,M)}this.setIndex(y),this.setAttribute("position",new Xr(x,3)),this.setAttribute("normal",new Xr(S,3)),this.setAttribute("uv",new Xr(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nh(e.width,e.height,e.widthSegments,e.heightSegments)}}var oT=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,cT=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,lT=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,dT=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uT=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,hT=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,pT=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,fT=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,mT=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,gT=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,vT=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,_T=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bT=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,yT=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,ST=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,wT=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,xT=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,ET=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,CT=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,TT=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,RT=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,PT=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,MT=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,AT=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,DT=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,IT=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,LT=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,FT=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kT="gl_FragColor = linearToOutputTexel( gl_FragColor );",NT=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,OT=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,UT=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,BT=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,HT=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,jT=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,VT=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,zT=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,GT=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,qT=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,WT=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,KT=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,XT=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$T=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ZT=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,YT=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,JT=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,QT=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,eR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,tR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,iR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,nR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,rR=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,sR=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal;
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,aR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,oR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,cR=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,lR=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dR=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,uR=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,hR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,pR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,mR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,_R=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,bR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,yR=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,SR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,wR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,xR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ER=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,CR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,TR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,RR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,PR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,MR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,AR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,DR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,IR=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,LR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,FR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,kR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,NR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,OR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,UR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,BR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,HR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,jR=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,VR=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,zR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,GR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,qR=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,WR=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,KR=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,XR=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,$R=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,ZR=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,YR=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,JR=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,QR=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,eP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,iP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,nP=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const rP=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,sP=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oP=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,lP=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dP=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,uP=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,hP=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,pP=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,fP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,mP=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gP=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,vP=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,_P=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,bP=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yP=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SP=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wP=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,xP=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EP=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,CP=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,TP=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RP=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PP=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,MP=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AP=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DP=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IP=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,LP=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,FP=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kP=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,NP=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,OP=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ti={alphahash_fragment:oT,alphahash_pars_fragment:cT,alphamap_fragment:lT,alphamap_pars_fragment:dT,alphatest_fragment:uT,alphatest_pars_fragment:hT,aomap_fragment:pT,aomap_pars_fragment:fT,begin_vertex:mT,beginnormal_vertex:gT,bsdfs:vT,iridescence_fragment:_T,bumpmap_pars_fragment:bT,clipping_planes_fragment:yT,clipping_planes_pars_fragment:ST,clipping_planes_pars_vertex:wT,clipping_planes_vertex:xT,color_fragment:ET,color_pars_fragment:CT,color_pars_vertex:TT,color_vertex:RT,common:PT,cube_uv_reflection_fragment:MT,defaultnormal_vertex:AT,displacementmap_pars_vertex:DT,displacementmap_vertex:IT,emissivemap_fragment:LT,emissivemap_pars_fragment:FT,colorspace_fragment:kT,colorspace_pars_fragment:NT,envmap_fragment:OT,envmap_common_pars_fragment:UT,envmap_pars_fragment:BT,envmap_pars_vertex:HT,envmap_physical_pars_fragment:JT,envmap_vertex:jT,fog_vertex:VT,fog_pars_vertex:zT,fog_fragment:GT,fog_pars_fragment:qT,gradientmap_pars_fragment:WT,lightmap_fragment:KT,lightmap_pars_fragment:XT,lights_lambert_fragment:$T,lights_lambert_pars_fragment:ZT,lights_pars_begin:YT,lights_toon_fragment:QT,lights_toon_pars_fragment:eR,lights_phong_fragment:tR,lights_phong_pars_fragment:iR,lights_physical_fragment:nR,lights_physical_pars_fragment:rR,lights_fragment_begin:sR,lights_fragment_maps:aR,lights_fragment_end:oR,logdepthbuf_fragment:cR,logdepthbuf_pars_fragment:lR,logdepthbuf_pars_vertex:dR,logdepthbuf_vertex:uR,map_fragment:hR,map_pars_fragment:pR,map_particle_fragment:fR,map_particle_pars_fragment:mR,metalnessmap_fragment:gR,metalnessmap_pars_fragment:vR,morphcolor_vertex:_R,morphnormal_vertex:bR,morphtarget_pars_vertex:yR,morphtarget_vertex:SR,normal_fragment_begin:wR,normal_fragment_maps:xR,normal_pars_fragment:ER,normal_pars_vertex:CR,normal_vertex:TR,normalmap_pars_fragment:RR,clearcoat_normal_fragment_begin:PR,clearcoat_normal_fragment_maps:MR,clearcoat_pars_fragment:AR,iridescence_pars_fragment:DR,opaque_fragment:IR,packing:LR,premultiplied_alpha_fragment:FR,project_vertex:kR,dithering_fragment:NR,dithering_pars_fragment:OR,roughnessmap_fragment:UR,roughnessmap_pars_fragment:BR,shadowmap_pars_fragment:HR,shadowmap_pars_vertex:jR,shadowmap_vertex:VR,shadowmask_pars_fragment:zR,skinbase_vertex:GR,skinning_pars_vertex:qR,skinning_vertex:WR,skinnormal_vertex:KR,specularmap_fragment:XR,specularmap_pars_fragment:$R,tonemapping_fragment:ZR,tonemapping_pars_fragment:YR,transmission_fragment:JR,transmission_pars_fragment:QR,uv_pars_fragment:eP,uv_pars_vertex:tP,uv_vertex:iP,worldpos_vertex:nP,background_vert:rP,background_frag:sP,backgroundCube_vert:aP,backgroundCube_frag:oP,cube_vert:cP,cube_frag:lP,depth_vert:dP,depth_frag:uP,distanceRGBA_vert:hP,distanceRGBA_frag:pP,equirect_vert:fP,equirect_frag:mP,linedashed_vert:gP,linedashed_frag:vP,meshbasic_vert:_P,meshbasic_frag:bP,meshlambert_vert:yP,meshlambert_frag:SP,meshmatcap_vert:wP,meshmatcap_frag:xP,meshnormal_vert:EP,meshnormal_frag:CP,meshphong_vert:TP,meshphong_frag:RP,meshphysical_vert:PP,meshphysical_frag:MP,meshtoon_vert:AP,meshtoon_frag:DP,points_vert:IP,points_frag:LP,shadow_vert:FP,shadow_frag:kP,sprite_vert:NP,sprite_frag:OP},dt={common:{diffuse:{value:new Di(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ri},alphaMap:{value:null},alphaMapTransform:{value:new ri},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ri}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ri}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ri}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ri},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ri},normalScale:{value:new si(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ri},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ri}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ri}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ri}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Di(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Di(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ri},alphaTest:{value:0},uvTransform:{value:new ri}},sprite:{diffuse:{value:new Di(16777215)},opacity:{value:1},center:{value:new si(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ri},alphaMap:{value:null},alphaMapTransform:{value:new ri},alphaTest:{value:0}}},qr={basic:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.fog]),vertexShader:ti.meshbasic_vert,fragmentShader:ti.meshbasic_frag},lambert:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,dt.lights,{emissive:{value:new Di(0)}}]),vertexShader:ti.meshlambert_vert,fragmentShader:ti.meshlambert_frag},phong:{uniforms:Rn([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,dt.lights,{emissive:{value:new Di(0)},specular:{value:new Di(1118481)},shininess:{value:30}}]),vertexShader:ti.meshphong_vert,fragmentShader:ti.meshphong_frag},standard:{uniforms:Rn([dt.common,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.roughnessmap,dt.metalnessmap,dt.fog,dt.lights,{emissive:{value:new Di(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ti.meshphysical_vert,fragmentShader:ti.meshphysical_frag},toon:{uniforms:Rn([dt.common,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.gradientmap,dt.fog,dt.lights,{emissive:{value:new Di(0)}}]),vertexShader:ti.meshtoon_vert,fragmentShader:ti.meshtoon_frag},matcap:{uniforms:Rn([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,{matcap:{value:null}}]),vertexShader:ti.meshmatcap_vert,fragmentShader:ti.meshmatcap_frag},points:{uniforms:Rn([dt.points,dt.fog]),vertexShader:ti.points_vert,fragmentShader:ti.points_frag},dashed:{uniforms:Rn([dt.common,dt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ti.linedashed_vert,fragmentShader:ti.linedashed_frag},depth:{uniforms:Rn([dt.common,dt.displacementmap]),vertexShader:ti.depth_vert,fragmentShader:ti.depth_frag},normal:{uniforms:Rn([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,{opacity:{value:1}}]),vertexShader:ti.meshnormal_vert,fragmentShader:ti.meshnormal_frag},sprite:{uniforms:Rn([dt.sprite,dt.fog]),vertexShader:ti.sprite_vert,fragmentShader:ti.sprite_frag},background:{uniforms:{uvTransform:{value:new ri},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ti.background_vert,fragmentShader:ti.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ti.backgroundCube_vert,fragmentShader:ti.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ti.cube_vert,fragmentShader:ti.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ti.equirect_vert,fragmentShader:ti.equirect_frag},distanceRGBA:{uniforms:Rn([dt.common,dt.displacementmap,{referencePosition:{value:new Ie},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ti.distanceRGBA_vert,fragmentShader:ti.distanceRGBA_frag},shadow:{uniforms:Rn([dt.lights,dt.fog,{color:{value:new Di(0)},opacity:{value:1}}]),vertexShader:ti.shadow_vert,fragmentShader:ti.shadow_frag}};qr.physical={uniforms:Rn([qr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ri},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ri},clearcoatNormalScale:{value:new si(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ri},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ri},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ri},sheen:{value:0},sheenColor:{value:new Di(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ri},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ri},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ri},transmissionSamplerSize:{value:new si},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ri},attenuationDistance:{value:0},attenuationColor:{value:new Di(0)},specularColor:{value:new Di(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ri},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ri},anisotropyVector:{value:new si},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ri}}]),vertexShader:ti.meshphysical_vert,fragmentShader:ti.meshphysical_frag};const qc={r:0,b:0,g:0};function UP(t,e,i,n,r,s,o){const c=new Di(0);let h=s===!0?0:1,l,p,g=null,f=0,y=null;function x(v,m){let w=!1,b=m.isScene===!0?m.background:null;b&&b.isTexture&&(b=(m.backgroundBlurriness>0?i:e).get(b)),b===null?S(c,h):b&&b.isColor&&(S(b,1),w=!0);const C=t.xr.getEnvironmentBlendMode();C==="additive"?n.buffers.color.setClear(0,0,0,1,o):C==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(t.autoClear||w)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),b&&(b.isCubeTexture||b.mapping===Wl)?(p===void 0&&(p=new hs(new oc(1,1,1),new ga({name:"BackgroundCubeMaterial",uniforms:ao(qr.backgroundCube.uniforms),vertexShader:qr.backgroundCube.vertexShader,fragmentShader:qr.backgroundCube.fragmentShader,side:Vn,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(A,M,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(p)),p.material.uniforms.envMap.value=b,p.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,p.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,p.material.toneMapped=xi.getTransfer(b.colorSpace)!==Ai,(g!==b||f!==b.version||y!==t.toneMapping)&&(p.material.needsUpdate=!0,g=b,f=b.version,y=t.toneMapping),p.layers.enableAll(),v.unshift(p,p.geometry,p.material,0,0,null)):b&&b.isTexture&&(l===void 0&&(l=new hs(new nh(2,2),new ga({name:"BackgroundMaterial",uniforms:ao(qr.background.uniforms),vertexShader:qr.background.vertexShader,fragmentShader:qr.background.fragmentShader,side:Us,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=b,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=xi.getTransfer(b.colorSpace)!==Ai,b.matrixAutoUpdate===!0&&b.updateMatrix(),l.material.uniforms.uvTransform.value.copy(b.matrix),(g!==b||f!==b.version||y!==t.toneMapping)&&(l.material.needsUpdate=!0,g=b,f=b.version,y=t.toneMapping),l.layers.enableAll(),v.unshift(l,l.geometry,l.material,0,0,null))}function S(v,m){v.getRGB(qc,Tv(t)),n.buffers.color.setClear(qc.r,qc.g,qc.b,m,o)}return{getClearColor:function(){return c},setClearColor:function(v,m=1){c.set(v),h=m,S(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(v){h=v,S(c,h)},render:x}}function BP(t,e,i,n){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,c={},h=v(null);let l=h,p=!1;function g(q,ae,pe,ue,xe){let Ee=!1;if(o){const ye=S(ue,pe,ae);l!==ye&&(l=ye,y(l.object)),Ee=m(q,ue,pe,xe),Ee&&w(q,ue,pe,xe)}else{const ye=ae.wireframe===!0;(l.geometry!==ue.id||l.program!==pe.id||l.wireframe!==ye)&&(l.geometry=ue.id,l.program=pe.id,l.wireframe=ye,Ee=!0)}xe!==null&&i.update(xe,t.ELEMENT_ARRAY_BUFFER),(Ee||p)&&(p=!1,N(q,ae,pe,ue),xe!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(xe).buffer))}function f(){return n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function y(q){return n.isWebGL2?t.bindVertexArray(q):s.bindVertexArrayOES(q)}function x(q){return n.isWebGL2?t.deleteVertexArray(q):s.deleteVertexArrayOES(q)}function S(q,ae,pe){const ue=pe.wireframe===!0;let xe=c[q.id];xe===void 0&&(xe={},c[q.id]=xe);let Ee=xe[ae.id];Ee===void 0&&(Ee={},xe[ae.id]=Ee);let ye=Ee[ue];return ye===void 0&&(ye=v(f()),Ee[ue]=ye),ye}function v(q){const ae=[],pe=[],ue=[];for(let xe=0;xe<r;xe++)ae[xe]=0,pe[xe]=0,ue[xe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ae,enabledAttributes:pe,attributeDivisors:ue,object:q,attributes:{},index:null}}function m(q,ae,pe,ue){const xe=l.attributes,Ee=ae.attributes;let ye=0;const ge=pe.getAttributes();for(const Te in ge)if(ge[Te].location>=0){const et=xe[Te];let tt=Ee[Te];if(tt===void 0&&(Te==="instanceMatrix"&&q.instanceMatrix&&(tt=q.instanceMatrix),Te==="instanceColor"&&q.instanceColor&&(tt=q.instanceColor)),et===void 0||et.attribute!==tt||tt&&et.data!==tt.data)return!0;ye++}return l.attributesNum!==ye||l.index!==ue}function w(q,ae,pe,ue){const xe={},Ee=ae.attributes;let ye=0;const ge=pe.getAttributes();for(const Te in ge)if(ge[Te].location>=0){let et=Ee[Te];et===void 0&&(Te==="instanceMatrix"&&q.instanceMatrix&&(et=q.instanceMatrix),Te==="instanceColor"&&q.instanceColor&&(et=q.instanceColor));const tt={};tt.attribute=et,et&&et.data&&(tt.data=et.data),xe[Te]=tt,ye++}l.attributes=xe,l.attributesNum=ye,l.index=ue}function b(){const q=l.newAttributes;for(let ae=0,pe=q.length;ae<pe;ae++)q[ae]=0}function C(q){A(q,0)}function A(q,ae){const pe=l.newAttributes,ue=l.enabledAttributes,xe=l.attributeDivisors;pe[q]=1,ue[q]===0&&(t.enableVertexAttribArray(q),ue[q]=1),xe[q]!==ae&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](q,ae),xe[q]=ae)}function M(){const q=l.newAttributes,ae=l.enabledAttributes;for(let pe=0,ue=ae.length;pe<ue;pe++)ae[pe]!==q[pe]&&(t.disableVertexAttribArray(pe),ae[pe]=0)}function F(q,ae,pe,ue,xe,Ee,ye){ye===!0?t.vertexAttribIPointer(q,ae,pe,xe,Ee):t.vertexAttribPointer(q,ae,pe,ue,xe,Ee)}function N(q,ae,pe,ue){if(n.isWebGL2===!1&&(q.isInstancedMesh||ue.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;b();const xe=ue.attributes,Ee=pe.getAttributes(),ye=ae.defaultAttributeValues;for(const ge in Ee){const Te=Ee[ge];if(Te.location>=0){let rt=xe[ge];if(rt===void 0&&(ge==="instanceMatrix"&&q.instanceMatrix&&(rt=q.instanceMatrix),ge==="instanceColor"&&q.instanceColor&&(rt=q.instanceColor)),rt!==void 0){const et=rt.normalized,tt=rt.itemSize,gt=i.get(rt);if(gt===void 0)continue;const Lt=gt.buffer,St=gt.type,Kt=gt.bytesPerElement,Ei=n.isWebGL2===!0&&(St===t.INT||St===t.UNSIGNED_INT||rt.gpuType===dv);if(rt.isInterleavedBufferAttribute){const Ut=rt.data,Pe=Ut.stride,_i=rt.offset;if(Ut.isInstancedInterleavedBuffer){for(let Mt=0;Mt<Te.locationSize;Mt++)A(Te.location+Mt,Ut.meshPerAttribute);q.isInstancedMesh!==!0&&ue._maxInstanceCount===void 0&&(ue._maxInstanceCount=Ut.meshPerAttribute*Ut.count)}else for(let Mt=0;Mt<Te.locationSize;Mt++)C(Te.location+Mt);t.bindBuffer(t.ARRAY_BUFFER,Lt);for(let Mt=0;Mt<Te.locationSize;Mt++)F(Te.location+Mt,tt/Te.locationSize,St,et,Pe*Kt,(_i+tt/Te.locationSize*Mt)*Kt,Ei)}else{if(rt.isInstancedBufferAttribute){for(let Ut=0;Ut<Te.locationSize;Ut++)A(Te.location+Ut,rt.meshPerAttribute);q.isInstancedMesh!==!0&&ue._maxInstanceCount===void 0&&(ue._maxInstanceCount=rt.meshPerAttribute*rt.count)}else for(let Ut=0;Ut<Te.locationSize;Ut++)C(Te.location+Ut);t.bindBuffer(t.ARRAY_BUFFER,Lt);for(let Ut=0;Ut<Te.locationSize;Ut++)F(Te.location+Ut,tt/Te.locationSize,St,et,tt*Kt,tt/Te.locationSize*Ut*Kt,Ei)}}else if(ye!==void 0){const et=ye[ge];if(et!==void 0)switch(et.length){case 2:t.vertexAttrib2fv(Te.location,et);break;case 3:t.vertexAttrib3fv(Te.location,et);break;case 4:t.vertexAttrib4fv(Te.location,et);break;default:t.vertexAttrib1fv(Te.location,et)}}}}M()}function P(){X();for(const q in c){const ae=c[q];for(const pe in ae){const ue=ae[pe];for(const xe in ue)x(ue[xe].object),delete ue[xe];delete ae[pe]}delete c[q]}}function j(q){if(c[q.id]===void 0)return;const ae=c[q.id];for(const pe in ae){const ue=ae[pe];for(const xe in ue)x(ue[xe].object),delete ue[xe];delete ae[pe]}delete c[q.id]}function K(q){for(const ae in c){const pe=c[ae];if(pe[q.id]===void 0)continue;const ue=pe[q.id];for(const xe in ue)x(ue[xe].object),delete ue[xe];delete pe[q.id]}}function X(){ie(),p=!0,l!==h&&(l=h,y(l.object))}function ie(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:g,reset:X,resetDefaultState:ie,dispose:P,releaseStatesOfGeometry:j,releaseStatesOfProgram:K,initAttributes:b,enableAttribute:C,disableUnusedAttributes:M}}function HP(t,e,i,n){const r=n.isWebGL2;let s;function o(l){s=l}function c(l,p){t.drawArrays(s,l,p),i.update(p,s,1)}function h(l,p,g){if(g===0)return;let f,y;if(r)f=t,y="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[y](s,l,p,g),i.update(p,s,g)}this.setMode=o,this.render=c,this.renderInstances=h}function jP(t,e,i){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(F){if(F==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";F="mediump"}return F==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&t.constructor.name==="WebGL2RenderingContext";let c=i.precision!==void 0?i.precision:"highp";const h=s(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const l=o||e.has("WEBGL_draw_buffers"),p=i.logarithmicDepthBuffer===!0,g=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),f=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=t.getParameter(t.MAX_TEXTURE_SIZE),x=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),S=t.getParameter(t.MAX_VERTEX_ATTRIBS),v=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),m=t.getParameter(t.MAX_VARYING_VECTORS),w=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),b=f>0,C=o||e.has("OES_texture_float"),A=b&&C,M=o?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:r,getMaxPrecision:s,precision:c,logarithmicDepthBuffer:p,maxTextures:g,maxVertexTextures:f,maxTextureSize:y,maxCubemapSize:x,maxAttributes:S,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:w,vertexTextures:b,floatFragmentTextures:C,floatVertexTextures:A,maxSamples:M}}function VP(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new Rs,c=new ri,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(g,f){const y=g.length!==0||f||n!==0||r;return r=f,n=g.length,y},this.beginShadows=function(){s=!0,p(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(g,f){i=p(g,f,0)},this.setState=function(g,f,y){const x=g.clippingPlanes,S=g.clipIntersection,v=g.clipShadows,m=t.get(g);if(!r||x===null||x.length===0||s&&!v)s?p(null):l();else{const w=s?0:n,b=w*4;let C=m.clippingState||null;h.value=C,C=p(x,f,b,y);for(let A=0;A!==b;++A)C[A]=i[A];m.clippingState=C,this.numIntersection=S?this.numPlanes:0,this.numPlanes+=w}};function l(){h.value!==i&&(h.value=i,h.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function p(g,f,y,x){const S=g!==null?g.length:0;let v=null;if(S!==0){if(v=h.value,x!==!0||v===null){const m=y+S*4,w=f.matrixWorldInverse;c.getNormalMatrix(w),(v===null||v.length<m)&&(v=new Float32Array(m));for(let b=0,C=y;b!==S;++b,C+=4)o.copy(g[b]).applyMatrix4(w,c),o.normal.toArray(v,C),v[C+3]=o.constant}h.value=v,h.needsUpdate=!0}return e.numPlanes=S,e.numIntersection=0,v}}function zP(t){let e=new WeakMap;function i(o,c){return c===Cu?o.mapping=no:c===Tu&&(o.mapping=ro),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const c=o.mapping;if(c===Cu||c===Tu)if(e.has(o)){const h=e.get(o).texture;return i(h,o.mapping)}else{const h=o.image;if(h&&h.height>0){const l=new nT(h.height/2);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",r),i(l.texture,o.mapping)}else return null}}return o}function r(o){const c=o.target;c.removeEventListener("dispose",r);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class GP extends Rv{constructor(e=-1,i=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,c=r+i,h=r-i;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,c-=p*this.view.offsetY,h=c-p*this.view.height}this.projectionMatrix.makeOrthographic(s,o,c,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const Ga=4,pf=[.125,.215,.35,.446,.526,.582],na=20,Jd=new GP,ff=new Di;let Qd=null;const ea=(1+Math.sqrt(5))/2,Ba=1/ea,mf=[new Ie(1,1,1),new Ie(-1,1,1),new Ie(1,1,-1),new Ie(-1,1,-1),new Ie(0,ea,Ba),new Ie(0,ea,-Ba),new Ie(Ba,0,ea),new Ie(-Ba,0,ea),new Ie(ea,Ba,0),new Ie(-ea,Ba,0)];class gf{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,n=.1,r=100){Qd=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=bf(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_f(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Qd),e.scissorTest=!1,Wc(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===no||e.mapping===ro?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Qd=this._renderer.getRenderTarget();const n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:Hn,minFilter:Hn,generateMipmaps:!1,type:ec,format:Ar,colorSpace:fs,depthBuffer:!1},r=vf(e,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=vf(e,i,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=qP(s)),this._blurMaterial=WP(s,e,i)}return r}_compileMaterial(e){const i=new hs(this._lodPlanes[0],e);this._renderer.compile(i,Jd)}_sceneToCubeUV(e,i,n,r){const c=new pr(90,1,i,n),h=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],p=this._renderer,g=p.autoClear,f=p.toneMapping;p.getClearColor(ff),p.toneMapping=Is,p.autoClear=!1;const y=new ih({name:"PMREM.Background",side:Vn,depthWrite:!1,depthTest:!1}),x=new hs(new oc,y);let S=!1;const v=e.background;v?v.isColor&&(y.color.copy(v),e.background=null,S=!0):(y.color.copy(ff),S=!0);for(let m=0;m<6;m++){const w=m%3;w===0?(c.up.set(0,h[m],0),c.lookAt(l[m],0,0)):w===1?(c.up.set(0,0,h[m]),c.lookAt(0,l[m],0)):(c.up.set(0,h[m],0),c.lookAt(0,0,l[m]));const b=this._cubeSize;Wc(r,w*b,m>2?b:0,b,b),p.setRenderTarget(r),S&&p.render(x,c),p.render(e,c)}x.geometry.dispose(),x.material.dispose(),p.toneMapping=f,p.autoClear=g,e.background=v}_textureToCubeUV(e,i){const n=this._renderer,r=e.mapping===no||e.mapping===ro;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=bf()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_f());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new hs(this._lodPlanes[0],s),c=s.uniforms;c.envMap.value=e;const h=this._cubeSize;Wc(i,0,0,3*h,2*h),n.setRenderTarget(i),n.render(o,Jd)}_applyPMREM(e){const i=this._renderer,n=i.autoClear;i.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=mf[(r-1)%mf.length];this._blur(e,r-1,r,s,o)}i.autoClear=n}_blur(e,i,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,i,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,i,n,r,s,o,c){const h=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const p=3,g=new hs(this._lodPlanes[r],l),f=l.uniforms,y=this._sizeLods[n]-1,x=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*na-1),S=s/x,v=isFinite(s)?1+Math.floor(p*S):na;v>na&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${na}`);const m=[];let w=0;for(let F=0;F<na;++F){const N=F/S,P=Math.exp(-N*N/2);m.push(P),F===0?w+=P:F<v&&(w+=2*P)}for(let F=0;F<m.length;F++)m[F]=m[F]/w;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=m,f.latitudinal.value=o==="latitudinal",c&&(f.poleAxis.value=c);const{_lodMax:b}=this;f.dTheta.value=x,f.mipInt.value=b-n;const C=this._sizeLods[r],A=3*C*(r>b-Ga?r-b+Ga:0),M=4*(this._cubeSize-C);Wc(i,A,M,3*C,2*C),h.setRenderTarget(i),h.render(g,Jd)}}function qP(t){const e=[],i=[],n=[];let r=t;const s=t-Ga+1+pf.length;for(let o=0;o<s;o++){const c=Math.pow(2,r);i.push(c);let h=1/c;o>t-Ga?h=pf[o-t+Ga-1]:o===0&&(h=0),n.push(h);const l=1/(c-2),p=-l,g=1+l,f=[p,p,g,p,g,g,p,p,g,g,p,g],y=6,x=6,S=3,v=2,m=1,w=new Float32Array(S*x*y),b=new Float32Array(v*x*y),C=new Float32Array(m*x*y);for(let M=0;M<y;M++){const F=M%3*2/3-1,N=M>2?0:-1,P=[F,N,0,F+2/3,N,0,F+2/3,N+1,0,F,N,0,F+2/3,N+1,0,F,N+1,0];w.set(P,S*x*M),b.set(f,v*x*M);const j=[M,M,M,M,M,M];C.set(j,m*x*M)}const A=new zs;A.setAttribute("position",new Kr(w,S)),A.setAttribute("uv",new Kr(b,v)),A.setAttribute("faceIndex",new Kr(C,m)),e.push(A),r>Ga&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}function vf(t,e,i){const n=new fa(t,e,i);return n.texture.mapping=Wl,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Wc(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function WP(t,e,i){const n=new Float32Array(na),r=new Ie(0,1,0);return new ga({name:"SphericalGaussianBlur",defines:{n:na,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:rh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ds,depthTest:!1,depthWrite:!1})}function _f(){return new ga({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:rh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ds,depthTest:!1,depthWrite:!1})}function bf(){return new ga({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:rh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ds,depthTest:!1,depthWrite:!1})}function rh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function KP(t){let e=new WeakMap,i=null;function n(c){if(c&&c.isTexture){const h=c.mapping,l=h===Cu||h===Tu,p=h===no||h===ro;if(l||p)if(c.isRenderTargetTexture&&c.needsPMREMUpdate===!0){c.needsPMREMUpdate=!1;let g=e.get(c);return i===null&&(i=new gf(t)),g=l?i.fromEquirectangular(c,g):i.fromCubemap(c,g),e.set(c,g),g.texture}else{if(e.has(c))return e.get(c).texture;{const g=c.image;if(l&&g&&g.height>0||p&&g&&r(g)){i===null&&(i=new gf(t));const f=l?i.fromEquirectangular(c):i.fromCubemap(c);return e.set(c,f),c.addEventListener("dispose",s),f.texture}else return null}}}return c}function r(c){let h=0;const l=6;for(let p=0;p<l;p++)c[p]!==void 0&&h++;return h===l}function s(c){const h=c.target;h.removeEventListener("dispose",s);const l=e.get(h);l!==void 0&&(e.delete(h),l.dispose())}function o(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:o}}function XP(t){const e={};function i(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(n){return i(n)!==null},init:function(n){n.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(n){const r=i(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function $P(t,e,i,n){const r={},s=new WeakMap;function o(g){const f=g.target;f.index!==null&&e.remove(f.index);for(const x in f.attributes)e.remove(f.attributes[x]);for(const x in f.morphAttributes){const S=f.morphAttributes[x];for(let v=0,m=S.length;v<m;v++)e.remove(S[v])}f.removeEventListener("dispose",o),delete r[f.id];const y=s.get(f);y&&(e.remove(y),s.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,i.memory.geometries--}function c(g,f){return r[f.id]===!0||(f.addEventListener("dispose",o),r[f.id]=!0,i.memory.geometries++),f}function h(g){const f=g.attributes;for(const x in f)e.update(f[x],t.ARRAY_BUFFER);const y=g.morphAttributes;for(const x in y){const S=y[x];for(let v=0,m=S.length;v<m;v++)e.update(S[v],t.ARRAY_BUFFER)}}function l(g){const f=[],y=g.index,x=g.attributes.position;let S=0;if(y!==null){const w=y.array;S=y.version;for(let b=0,C=w.length;b<C;b+=3){const A=w[b+0],M=w[b+1],F=w[b+2];f.push(A,M,M,F,F,A)}}else if(x!==void 0){const w=x.array;S=x.version;for(let b=0,C=w.length/3-1;b<C;b+=3){const A=b+0,M=b+1,F=b+2;f.push(A,M,M,F,F,A)}}else return;const v=new(vv(f)?Cv:Ev)(f,1);v.version=S;const m=s.get(g);m&&e.remove(m),s.set(g,v)}function p(g){const f=s.get(g);if(f){const y=g.index;y!==null&&f.version<y.version&&l(g)}else l(g);return s.get(g)}return{get:c,update:h,getWireframeAttribute:p}}function ZP(t,e,i,n){const r=n.isWebGL2;let s;function o(f){s=f}let c,h;function l(f){c=f.type,h=f.bytesPerElement}function p(f,y){t.drawElements(s,y,c,f*h),i.update(y,s,1)}function g(f,y,x){if(x===0)return;let S,v;if(r)S=t,v="drawElementsInstanced";else if(S=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",S===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}S[v](s,y,c,f*h,x),i.update(y,s,x)}this.setMode=o,this.setIndex=l,this.render=p,this.renderInstances=g}function YP(t){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,c){switch(i.calls++,o){case t.TRIANGLES:i.triangles+=c*(s/3);break;case t.LINES:i.lines+=c*(s/2);break;case t.LINE_STRIP:i.lines+=c*(s-1);break;case t.LINE_LOOP:i.lines+=c*s;break;case t.POINTS:i.points+=c*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:r,update:n}}function JP(t,e){return t[0]-e[0]}function QP(t,e){return Math.abs(e[1])-Math.abs(t[1])}function e2(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new dn,c=[];for(let l=0;l<8;l++)c[l]=[l,0];function h(l,p,g){const f=l.morphTargetInfluences;if(e.isWebGL2===!0){const x=p.morphAttributes.position||p.morphAttributes.normal||p.morphAttributes.color,S=x!==void 0?x.length:0;let v=s.get(p);if(v===void 0||v.count!==S){let ae=function(){ie.dispose(),s.delete(p),p.removeEventListener("dispose",ae)};var y=ae;v!==void 0&&v.texture.dispose();const b=p.morphAttributes.position!==void 0,C=p.morphAttributes.normal!==void 0,A=p.morphAttributes.color!==void 0,M=p.morphAttributes.position||[],F=p.morphAttributes.normal||[],N=p.morphAttributes.color||[];let P=0;b===!0&&(P=1),C===!0&&(P=2),A===!0&&(P=3);let j=p.attributes.position.count*P,K=1;j>e.maxTextureSize&&(K=Math.ceil(j/e.maxTextureSize),j=e.maxTextureSize);const X=new Float32Array(j*K*4*S),ie=new yv(X,j,K,S);ie.type=As,ie.needsUpdate=!0;const q=P*4;for(let pe=0;pe<S;pe++){const ue=M[pe],xe=F[pe],Ee=N[pe],ye=j*K*4*pe;for(let ge=0;ge<ue.count;ge++){const Te=ge*q;b===!0&&(o.fromBufferAttribute(ue,ge),X[ye+Te+0]=o.x,X[ye+Te+1]=o.y,X[ye+Te+2]=o.z,X[ye+Te+3]=0),C===!0&&(o.fromBufferAttribute(xe,ge),X[ye+Te+4]=o.x,X[ye+Te+5]=o.y,X[ye+Te+6]=o.z,X[ye+Te+7]=0),A===!0&&(o.fromBufferAttribute(Ee,ge),X[ye+Te+8]=o.x,X[ye+Te+9]=o.y,X[ye+Te+10]=o.z,X[ye+Te+11]=Ee.itemSize===4?o.w:1)}}v={count:S,texture:ie,size:new si(j,K)},s.set(p,v),p.addEventListener("dispose",ae)}let m=0;for(let b=0;b<f.length;b++)m+=f[b];const w=p.morphTargetsRelative?1:1-m;g.getUniforms().setValue(t,"morphTargetBaseInfluence",w),g.getUniforms().setValue(t,"morphTargetInfluences",f),g.getUniforms().setValue(t,"morphTargetsTexture",v.texture,i),g.getUniforms().setValue(t,"morphTargetsTextureSize",v.size)}else{const x=f===void 0?0:f.length;let S=n[p.id];if(S===void 0||S.length!==x){S=[];for(let C=0;C<x;C++)S[C]=[C,0];n[p.id]=S}for(let C=0;C<x;C++){const A=S[C];A[0]=C,A[1]=f[C]}S.sort(QP);for(let C=0;C<8;C++)C<x&&S[C][1]?(c[C][0]=S[C][0],c[C][1]=S[C][1]):(c[C][0]=Number.MAX_SAFE_INTEGER,c[C][1]=0);c.sort(JP);const v=p.morphAttributes.position,m=p.morphAttributes.normal;let w=0;for(let C=0;C<8;C++){const A=c[C],M=A[0],F=A[1];M!==Number.MAX_SAFE_INTEGER&&F?(v&&p.getAttribute("morphTarget"+C)!==v[M]&&p.setAttribute("morphTarget"+C,v[M]),m&&p.getAttribute("morphNormal"+C)!==m[M]&&p.setAttribute("morphNormal"+C,m[M]),r[C]=F,w+=F):(v&&p.hasAttribute("morphTarget"+C)===!0&&p.deleteAttribute("morphTarget"+C),m&&p.hasAttribute("morphNormal"+C)===!0&&p.deleteAttribute("morphNormal"+C),r[C]=0)}const b=p.morphTargetsRelative?1:1-w;g.getUniforms().setValue(t,"morphTargetBaseInfluence",b),g.getUniforms().setValue(t,"morphTargetInfluences",r)}}return{update:h}}function t2(t,e,i,n){let r=new WeakMap;function s(h){const l=n.render.frame,p=h.geometry,g=e.get(h,p);if(r.get(g)!==l&&(e.update(g),r.set(g,l)),h.isInstancedMesh&&(h.hasEventListener("dispose",c)===!1&&h.addEventListener("dispose",c),r.get(h)!==l&&(i.update(h.instanceMatrix,t.ARRAY_BUFFER),h.instanceColor!==null&&i.update(h.instanceColor,t.ARRAY_BUFFER),r.set(h,l))),h.isSkinnedMesh){const f=h.skeleton;r.get(f)!==l&&(f.update(),r.set(f,l))}return g}function o(){r=new WeakMap}function c(h){const l=h.target;l.removeEventListener("dispose",c),i.remove(l.instanceMatrix),l.instanceColor!==null&&i.remove(l.instanceColor)}return{update:s,dispose:o}}const Dv=new zn,Iv=new yv,Lv=new HC,Fv=new Pv,yf=[],Sf=[],wf=new Float32Array(16),xf=new Float32Array(9),Ef=new Float32Array(4);function uo(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=yf[r];if(s===void 0&&(s=new Float32Array(r),yf[r]=s),e!==0){n.toArray(s,0);for(let o=1,c=0;o!==e;++o)c+=i,t[o].toArray(s,c)}return s}function Yi(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Ji(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Zl(t,e){let i=Sf[e];i===void 0&&(i=new Int32Array(e),Sf[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function i2(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function n2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Yi(i,e))return;t.uniform2fv(this.addr,e),Ji(i,e)}}function r2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Yi(i,e))return;t.uniform3fv(this.addr,e),Ji(i,e)}}function s2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Yi(i,e))return;t.uniform4fv(this.addr,e),Ji(i,e)}}function a2(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(Yi(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ji(i,e)}else{if(Yi(i,n))return;Ef.set(n),t.uniformMatrix2fv(this.addr,!1,Ef),Ji(i,n)}}function o2(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(Yi(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ji(i,e)}else{if(Yi(i,n))return;xf.set(n),t.uniformMatrix3fv(this.addr,!1,xf),Ji(i,n)}}function c2(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(Yi(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ji(i,e)}else{if(Yi(i,n))return;wf.set(n),t.uniformMatrix4fv(this.addr,!1,wf),Ji(i,n)}}function l2(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function d2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Yi(i,e))return;t.uniform2iv(this.addr,e),Ji(i,e)}}function u2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Yi(i,e))return;t.uniform3iv(this.addr,e),Ji(i,e)}}function h2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Yi(i,e))return;t.uniform4iv(this.addr,e),Ji(i,e)}}function p2(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function f2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Yi(i,e))return;t.uniform2uiv(this.addr,e),Ji(i,e)}}function m2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Yi(i,e))return;t.uniform3uiv(this.addr,e),Ji(i,e)}}function g2(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Yi(i,e))return;t.uniform4uiv(this.addr,e),Ji(i,e)}}function v2(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||Dv,r)}function _2(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||Lv,r)}function b2(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||Fv,r)}function y2(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||Iv,r)}function S2(t){switch(t){case 5126:return i2;case 35664:return n2;case 35665:return r2;case 35666:return s2;case 35674:return a2;case 35675:return o2;case 35676:return c2;case 5124:case 35670:return l2;case 35667:case 35671:return d2;case 35668:case 35672:return u2;case 35669:case 35673:return h2;case 5125:return p2;case 36294:return f2;case 36295:return m2;case 36296:return g2;case 35678:case 36198:case 36298:case 36306:case 35682:return v2;case 35679:case 36299:case 36307:return _2;case 35680:case 36300:case 36308:case 36293:return b2;case 36289:case 36303:case 36311:case 36292:return y2}}function w2(t,e){t.uniform1fv(this.addr,e)}function x2(t,e){const i=uo(e,this.size,2);t.uniform2fv(this.addr,i)}function E2(t,e){const i=uo(e,this.size,3);t.uniform3fv(this.addr,i)}function C2(t,e){const i=uo(e,this.size,4);t.uniform4fv(this.addr,i)}function T2(t,e){const i=uo(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function R2(t,e){const i=uo(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function P2(t,e){const i=uo(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function M2(t,e){t.uniform1iv(this.addr,e)}function A2(t,e){t.uniform2iv(this.addr,e)}function D2(t,e){t.uniform3iv(this.addr,e)}function I2(t,e){t.uniform4iv(this.addr,e)}function L2(t,e){t.uniform1uiv(this.addr,e)}function F2(t,e){t.uniform2uiv(this.addr,e)}function k2(t,e){t.uniform3uiv(this.addr,e)}function N2(t,e){t.uniform4uiv(this.addr,e)}function O2(t,e,i){const n=this.cache,r=e.length,s=Zl(i,r);Yi(n,s)||(t.uniform1iv(this.addr,s),Ji(n,s));for(let o=0;o!==r;++o)i.setTexture2D(e[o]||Dv,s[o])}function U2(t,e,i){const n=this.cache,r=e.length,s=Zl(i,r);Yi(n,s)||(t.uniform1iv(this.addr,s),Ji(n,s));for(let o=0;o!==r;++o)i.setTexture3D(e[o]||Lv,s[o])}function B2(t,e,i){const n=this.cache,r=e.length,s=Zl(i,r);Yi(n,s)||(t.uniform1iv(this.addr,s),Ji(n,s));for(let o=0;o!==r;++o)i.setTextureCube(e[o]||Fv,s[o])}function H2(t,e,i){const n=this.cache,r=e.length,s=Zl(i,r);Yi(n,s)||(t.uniform1iv(this.addr,s),Ji(n,s));for(let o=0;o!==r;++o)i.setTexture2DArray(e[o]||Iv,s[o])}function j2(t){switch(t){case 5126:return w2;case 35664:return x2;case 35665:return E2;case 35666:return C2;case 35674:return T2;case 35675:return R2;case 35676:return P2;case 5124:case 35670:return M2;case 35667:case 35671:return A2;case 35668:case 35672:return D2;case 35669:case 35673:return I2;case 5125:return L2;case 36294:return F2;case 36295:return k2;case 36296:return N2;case 35678:case 36198:case 36298:case 36306:case 35682:return O2;case 35679:case 36299:case 36307:return U2;case 35680:case 36300:case 36308:case 36293:return B2;case 36289:case 36303:case 36311:case 36292:return H2}}class V2{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.setValue=S2(i.type)}}class z2{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.size=i.size,this.setValue=j2(i.type)}}class G2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const c=r[s];c.setValue(e,i[c.id],n)}}}const eu=/(\w+)(\])?(\[|\.)?/g;function Cf(t,e){t.seq.push(e),t.map[e.id]=e}function q2(t,e,i){const n=t.name,r=n.length;for(eu.lastIndex=0;;){const s=eu.exec(n),o=eu.lastIndex;let c=s[1];const h=s[2]==="]",l=s[3];if(h&&(c=c|0),l===void 0||l==="["&&o+2===r){Cf(i,l===void 0?new V2(c,t,e):new z2(c,t,e));break}else{let g=i.map[c];g===void 0&&(g=new G2(c),Cf(i,g)),i=g}}}class rl{constructor(e,i){this.seq=[],this.map={};const n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(i,r),o=e.getUniformLocation(i,s.name);q2(s,o,this)}}setValue(e,i,n,r){const s=this.map[i];s!==void 0&&s.setValue(e,n,r)}setOptional(e,i,n){const r=i[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,i,n,r){for(let s=0,o=i.length;s!==o;++s){const c=i[s],h=n[c.id];h.needsUpdate!==!1&&c.setValue(e,h.value,r)}}static seqWithValue(e,i){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in i&&n.push(o)}return n}}function Tf(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}let W2=0;function K2(t,e){const i=t.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let o=r;o<s;o++){const c=o+1;n.push(`${c===e?">":" "} ${c}: ${i[o]}`)}return n.join(`
`)}function X2(t){const e=xi.getPrimaries(xi.workingColorSpace),i=xi.getPrimaries(t);let n;switch(e===i?n="":e===Sl&&i===yl?n="LinearDisplayP3ToLinearSRGB":e===yl&&i===Sl&&(n="LinearSRGBToLinearDisplayP3"),t){case fs:case Kl:return[n,"LinearTransferOETF"];case ln:case eh:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[n,"LinearTransferOETF"]}}function Rf(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return i.toUpperCase()+`

`+r+`

`+K2(t.getShaderSource(e),o)}else return r}function $2(t,e){const i=X2(e);return`vec4 ${t}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function Z2(t,e){let i;switch(e){case sC:i="Linear";break;case aC:i="Reinhard";break;case oC:i="OptimizedCineon";break;case cC:i="ACESFilmic";break;case lC:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Y2(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fo).join(`
`)}function J2(t){const e=[];for(const i in t){const n=t[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function Q2(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=t.getActiveAttrib(e,r),o=s.name;let c=1;s.type===t.FLOAT_MAT2&&(c=2),s.type===t.FLOAT_MAT3&&(c=3),s.type===t.FLOAT_MAT4&&(c=4),i[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:c}}return i}function Fo(t){return t!==""}function Pf(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Mf(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const eM=/^[ \t]*#include +<([\w\d./]+)>/gm;function Iu(t){return t.replace(eM,iM)}const tM=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function iM(t,e){let i=ti[e];if(i===void 0){const n=tM.get(e);if(n!==void 0)i=ti[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Iu(i)}const nM=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Af(t){return t.replace(nM,rM)}function rM(t,e,i,n){let r="";for(let s=parseInt(e);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Df(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function sM(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===sv?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===OE?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===cs&&(e="SHADOWMAP_TYPE_VSM"),e}function aM(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case no:case ro:e="ENVMAP_TYPE_CUBE";break;case Wl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function oM(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case ro:e="ENVMAP_MODE_REFRACTION";break}return e}function cM(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case cv:e="ENVMAP_BLENDING_MULTIPLY";break;case nC:e="ENVMAP_BLENDING_MIX";break;case rC:e="ENVMAP_BLENDING_ADD";break}return e}function lM(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function dM(t,e,i,n){const r=t.getContext(),s=i.defines;let o=i.vertexShader,c=i.fragmentShader;const h=sM(i),l=aM(i),p=oM(i),g=cM(i),f=lM(i),y=i.isWebGL2?"":Y2(i),x=J2(s),S=r.createProgram();let v,m,w=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,x].filter(Fo).join(`
`),v.length>0&&(v+=`
`),m=[y,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,x].filter(Fo).join(`
`),m.length>0&&(m+=`
`)):(v=[Df(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,x,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Fo).join(`
`),m=[y,Df(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,x,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+p:"",i.envMap?"#define "+g:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Is?"#define TONE_MAPPING":"",i.toneMapping!==Is?ti.tonemapping_pars_fragment:"",i.toneMapping!==Is?Z2("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ti.colorspace_pars_fragment,$2("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Fo).join(`
`)),o=Iu(o),o=Pf(o,i),o=Mf(o,i),c=Iu(c),c=Pf(c,i),c=Mf(c,i),o=Af(o),c=Af(c),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,m=["#define varying in",i.glslVersion===Xp?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Xp?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const b=w+v+o,C=w+m+c,A=Tf(r,r.VERTEX_SHADER,b),M=Tf(r,r.FRAGMENT_SHADER,C);if(r.attachShader(S,A),r.attachShader(S,M),i.index0AttributeName!==void 0?r.bindAttribLocation(S,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(S,0,"position"),r.linkProgram(S),t.debug.checkShaderErrors){const P=r.getProgramInfoLog(S).trim(),j=r.getShaderInfoLog(A).trim(),K=r.getShaderInfoLog(M).trim();let X=!0,ie=!0;if(r.getProgramParameter(S,r.LINK_STATUS)===!1)if(X=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,S,A,M);else{const q=Rf(r,A,"vertex"),ae=Rf(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(S,r.VALIDATE_STATUS)+`

Program Info Log: `+P+`
`+q+`
`+ae)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(j===""||K==="")&&(ie=!1);ie&&(this.diagnostics={runnable:X,programLog:P,vertexShader:{log:j,prefix:v},fragmentShader:{log:K,prefix:m}})}r.deleteShader(A),r.deleteShader(M);let F;this.getUniforms=function(){return F===void 0&&(F=new rl(r,S)),F};let N;return this.getAttributes=function(){return N===void 0&&(N=Q2(r,S)),N},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(S),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=W2++,this.cacheKey=e,this.usedTimes=1,this.program=S,this.vertexShader=A,this.fragmentShader=M,this}let uM=0;class hM{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(i),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let n=i.get(e);return n===void 0&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){const i=this.shaderCache;let n=i.get(e);return n===void 0&&(n=new pM(e),i.set(e,n)),n}}class pM{constructor(e){this.id=uM++,this.code=e,this.usedTimes=0}}function fM(t,e,i,n,r,s,o){const c=new wv,h=new hM,l=[],p=r.isWebGL2,g=r.logarithmicDepthBuffer,f=r.vertexTextures;let y=r.precision;const x={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function S(P){return P===0?"uv":`uv${P}`}function v(P,j,K,X,ie){const q=X.fog,ae=ie.geometry,pe=P.isMeshStandardMaterial?X.environment:null,ue=(P.isMeshStandardMaterial?i:e).get(P.envMap||pe),xe=ue&&ue.mapping===Wl?ue.image.height:null,Ee=x[P.type];P.precision!==null&&(y=r.getMaxPrecision(P.precision),y!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",y,"instead."));const ye=ae.morphAttributes.position||ae.morphAttributes.normal||ae.morphAttributes.color,ge=ye!==void 0?ye.length:0;let Te=0;ae.morphAttributes.position!==void 0&&(Te=1),ae.morphAttributes.normal!==void 0&&(Te=2),ae.morphAttributes.color!==void 0&&(Te=3);let rt,et,tt,gt;if(Ee){const hi=qr[Ee];rt=hi.vertexShader,et=hi.fragmentShader}else rt=P.vertexShader,et=P.fragmentShader,h.update(P),tt=h.getVertexShaderID(P),gt=h.getFragmentShaderID(P);const Lt=t.getRenderTarget(),St=ie.isInstancedMesh===!0,Kt=!!P.map,Ei=!!P.matcap,Ut=!!ue,Pe=!!P.aoMap,_i=!!P.lightMap,Mt=!!P.bumpMap,xt=!!P.normalMap,Bt=!!P.displacementMap,li=!!P.emissiveMap,Ot=!!P.metalnessMap,Ht=!!P.roughnessMap,ei=P.anisotropy>0,Ci=P.clearcoat>0,yi=P.iridescence>0,ce=P.sheen>0,te=P.transmission>0,De=ei&&!!P.anisotropyMap,He=Ci&&!!P.clearcoatMap,Oe=Ci&&!!P.clearcoatNormalMap,Fe=Ci&&!!P.clearcoatRoughnessMap,it=yi&&!!P.iridescenceMap,$e=yi&&!!P.iridescenceThicknessMap,st=ce&&!!P.sheenColorMap,de=ce&&!!P.sheenRoughnessMap,ke=!!P.specularMap,Ve=!!P.specularColorMap,Ct=!!P.specularIntensityMap,Tt=te&&!!P.transmissionMap,At=te&&!!P.thicknessMap,wt=!!P.gradientMap,he=!!P.alphaMap,nt=P.alphaTest>0,Je=!!P.alphaHash,ct=!!P.extensions,ot=!!ae.attributes.uv1,Ke=!!ae.attributes.uv2,lt=!!ae.attributes.uv3;let It=Is;return P.toneMapped&&(Lt===null||Lt.isXRRenderTarget===!0)&&(It=t.toneMapping),{isWebGL2:p,shaderID:Ee,shaderType:P.type,shaderName:P.name,vertexShader:rt,fragmentShader:et,defines:P.defines,customVertexShaderID:tt,customFragmentShaderID:gt,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:y,instancing:St,instancingColor:St&&ie.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:Lt===null?t.outputColorSpace:Lt.isXRRenderTarget===!0?Lt.texture.colorSpace:fs,map:Kt,matcap:Ei,envMap:Ut,envMapMode:Ut&&ue.mapping,envMapCubeUVHeight:xe,aoMap:Pe,lightMap:_i,bumpMap:Mt,normalMap:xt,displacementMap:f&&Bt,emissiveMap:li,normalMapObjectSpace:xt&&P.normalMapType===xC,normalMapTangentSpace:xt&&P.normalMapType===wC,metalnessMap:Ot,roughnessMap:Ht,anisotropy:ei,anisotropyMap:De,clearcoat:Ci,clearcoatMap:He,clearcoatNormalMap:Oe,clearcoatRoughnessMap:Fe,iridescence:yi,iridescenceMap:it,iridescenceThicknessMap:$e,sheen:ce,sheenColorMap:st,sheenRoughnessMap:de,specularMap:ke,specularColorMap:Ve,specularIntensityMap:Ct,transmission:te,transmissionMap:Tt,thicknessMap:At,gradientMap:wt,opaque:P.transparent===!1&&P.blending===Ka,alphaMap:he,alphaTest:nt,alphaHash:Je,combine:P.combine,mapUv:Kt&&S(P.map.channel),aoMapUv:Pe&&S(P.aoMap.channel),lightMapUv:_i&&S(P.lightMap.channel),bumpMapUv:Mt&&S(P.bumpMap.channel),normalMapUv:xt&&S(P.normalMap.channel),displacementMapUv:Bt&&S(P.displacementMap.channel),emissiveMapUv:li&&S(P.emissiveMap.channel),metalnessMapUv:Ot&&S(P.metalnessMap.channel),roughnessMapUv:Ht&&S(P.roughnessMap.channel),anisotropyMapUv:De&&S(P.anisotropyMap.channel),clearcoatMapUv:He&&S(P.clearcoatMap.channel),clearcoatNormalMapUv:Oe&&S(P.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Fe&&S(P.clearcoatRoughnessMap.channel),iridescenceMapUv:it&&S(P.iridescenceMap.channel),iridescenceThicknessMapUv:$e&&S(P.iridescenceThicknessMap.channel),sheenColorMapUv:st&&S(P.sheenColorMap.channel),sheenRoughnessMapUv:de&&S(P.sheenRoughnessMap.channel),specularMapUv:ke&&S(P.specularMap.channel),specularColorMapUv:Ve&&S(P.specularColorMap.channel),specularIntensityMapUv:Ct&&S(P.specularIntensityMap.channel),transmissionMapUv:Tt&&S(P.transmissionMap.channel),thicknessMapUv:At&&S(P.thicknessMap.channel),alphaMapUv:he&&S(P.alphaMap.channel),vertexTangents:!!ae.attributes.tangent&&(xt||ei),vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!ae.attributes.color&&ae.attributes.color.itemSize===4,vertexUv1s:ot,vertexUv2s:Ke,vertexUv3s:lt,pointsUvs:ie.isPoints===!0&&!!ae.attributes.uv&&(Kt||he),fog:!!q,useFog:P.fog===!0,fogExp2:q&&q.isFogExp2,flatShading:P.flatShading===!0,sizeAttenuation:P.sizeAttenuation===!0,logarithmicDepthBuffer:g,skinning:ie.isSkinnedMesh===!0,morphTargets:ae.morphAttributes.position!==void 0,morphNormals:ae.morphAttributes.normal!==void 0,morphColors:ae.morphAttributes.color!==void 0,morphTargetsCount:ge,morphTextureStride:Te,numDirLights:j.directional.length,numPointLights:j.point.length,numSpotLights:j.spot.length,numSpotLightMaps:j.spotLightMap.length,numRectAreaLights:j.rectArea.length,numHemiLights:j.hemi.length,numDirLightShadows:j.directionalShadowMap.length,numPointLightShadows:j.pointShadowMap.length,numSpotLightShadows:j.spotShadowMap.length,numSpotLightShadowsWithMaps:j.numSpotLightShadowsWithMaps,numLightProbes:j.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:P.dithering,shadowMapEnabled:t.shadowMap.enabled&&K.length>0,shadowMapType:t.shadowMap.type,toneMapping:It,useLegacyLights:t._useLegacyLights,decodeVideoTexture:Kt&&P.map.isVideoTexture===!0&&xi.getTransfer(P.map.colorSpace)===Ai,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===ds,flipSided:P.side===Vn,useDepthPacking:P.depthPacking>=0,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionDerivatives:ct&&P.extensions.derivatives===!0,extensionFragDepth:ct&&P.extensions.fragDepth===!0,extensionDrawBuffers:ct&&P.extensions.drawBuffers===!0,extensionShaderTextureLOD:ct&&P.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:p||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||n.has("EXT_shader_texture_lod"),customProgramCacheKey:P.customProgramCacheKey()}}function m(P){const j=[];if(P.shaderID?j.push(P.shaderID):(j.push(P.customVertexShaderID),j.push(P.customFragmentShaderID)),P.defines!==void 0)for(const K in P.defines)j.push(K),j.push(P.defines[K]);return P.isRawShaderMaterial===!1&&(w(j,P),b(j,P),j.push(t.outputColorSpace)),j.push(P.customProgramCacheKey),j.join()}function w(P,j){P.push(j.precision),P.push(j.outputColorSpace),P.push(j.envMapMode),P.push(j.envMapCubeUVHeight),P.push(j.mapUv),P.push(j.alphaMapUv),P.push(j.lightMapUv),P.push(j.aoMapUv),P.push(j.bumpMapUv),P.push(j.normalMapUv),P.push(j.displacementMapUv),P.push(j.emissiveMapUv),P.push(j.metalnessMapUv),P.push(j.roughnessMapUv),P.push(j.anisotropyMapUv),P.push(j.clearcoatMapUv),P.push(j.clearcoatNormalMapUv),P.push(j.clearcoatRoughnessMapUv),P.push(j.iridescenceMapUv),P.push(j.iridescenceThicknessMapUv),P.push(j.sheenColorMapUv),P.push(j.sheenRoughnessMapUv),P.push(j.specularMapUv),P.push(j.specularColorMapUv),P.push(j.specularIntensityMapUv),P.push(j.transmissionMapUv),P.push(j.thicknessMapUv),P.push(j.combine),P.push(j.fogExp2),P.push(j.sizeAttenuation),P.push(j.morphTargetsCount),P.push(j.morphAttributeCount),P.push(j.numDirLights),P.push(j.numPointLights),P.push(j.numSpotLights),P.push(j.numSpotLightMaps),P.push(j.numHemiLights),P.push(j.numRectAreaLights),P.push(j.numDirLightShadows),P.push(j.numPointLightShadows),P.push(j.numSpotLightShadows),P.push(j.numSpotLightShadowsWithMaps),P.push(j.numLightProbes),P.push(j.shadowMapType),P.push(j.toneMapping),P.push(j.numClippingPlanes),P.push(j.numClipIntersection),P.push(j.depthPacking)}function b(P,j){c.disableAll(),j.isWebGL2&&c.enable(0),j.supportsVertexTextures&&c.enable(1),j.instancing&&c.enable(2),j.instancingColor&&c.enable(3),j.matcap&&c.enable(4),j.envMap&&c.enable(5),j.normalMapObjectSpace&&c.enable(6),j.normalMapTangentSpace&&c.enable(7),j.clearcoat&&c.enable(8),j.iridescence&&c.enable(9),j.alphaTest&&c.enable(10),j.vertexColors&&c.enable(11),j.vertexAlphas&&c.enable(12),j.vertexUv1s&&c.enable(13),j.vertexUv2s&&c.enable(14),j.vertexUv3s&&c.enable(15),j.vertexTangents&&c.enable(16),j.anisotropy&&c.enable(17),P.push(c.mask),c.disableAll(),j.fog&&c.enable(0),j.useFog&&c.enable(1),j.flatShading&&c.enable(2),j.logarithmicDepthBuffer&&c.enable(3),j.skinning&&c.enable(4),j.morphTargets&&c.enable(5),j.morphNormals&&c.enable(6),j.morphColors&&c.enable(7),j.premultipliedAlpha&&c.enable(8),j.shadowMapEnabled&&c.enable(9),j.useLegacyLights&&c.enable(10),j.doubleSided&&c.enable(11),j.flipSided&&c.enable(12),j.useDepthPacking&&c.enable(13),j.dithering&&c.enable(14),j.transmission&&c.enable(15),j.sheen&&c.enable(16),j.opaque&&c.enable(17),j.pointsUvs&&c.enable(18),j.decodeVideoTexture&&c.enable(19),P.push(c.mask)}function C(P){const j=x[P.type];let K;if(j){const X=qr[j];K=QC.clone(X.uniforms)}else K=P.uniforms;return K}function A(P,j){let K;for(let X=0,ie=l.length;X<ie;X++){const q=l[X];if(q.cacheKey===j){K=q,++K.usedTimes;break}}return K===void 0&&(K=new dM(t,j,P,s),l.push(K)),K}function M(P){if(--P.usedTimes===0){const j=l.indexOf(P);l[j]=l[l.length-1],l.pop(),P.destroy()}}function F(P){h.remove(P)}function N(){h.dispose()}return{getParameters:v,getProgramCacheKey:m,getUniforms:C,acquireProgram:A,releaseProgram:M,releaseShaderCache:F,programs:l,dispose:N}}function mM(){let t=new WeakMap;function e(s){let o=t.get(s);return o===void 0&&(o={},t.set(s,o)),o}function i(s){t.delete(s)}function n(s,o,c){t.get(s)[o]=c}function r(){t=new WeakMap}return{get:e,remove:i,update:n,dispose:r}}function gM(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function If(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Lf(){const t=[];let e=0;const i=[],n=[],r=[];function s(){e=0,i.length=0,n.length=0,r.length=0}function o(g,f,y,x,S,v){let m=t[e];return m===void 0?(m={id:g.id,object:g,geometry:f,material:y,groupOrder:x,renderOrder:g.renderOrder,z:S,group:v},t[e]=m):(m.id=g.id,m.object=g,m.geometry=f,m.material=y,m.groupOrder=x,m.renderOrder=g.renderOrder,m.z=S,m.group=v),e++,m}function c(g,f,y,x,S,v){const m=o(g,f,y,x,S,v);y.transmission>0?n.push(m):y.transparent===!0?r.push(m):i.push(m)}function h(g,f,y,x,S,v){const m=o(g,f,y,x,S,v);y.transmission>0?n.unshift(m):y.transparent===!0?r.unshift(m):i.unshift(m)}function l(g,f){i.length>1&&i.sort(g||gM),n.length>1&&n.sort(f||If),r.length>1&&r.sort(f||If)}function p(){for(let g=e,f=t.length;g<f;g++){const y=t[g];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:i,transmissive:n,transparent:r,init:s,push:c,unshift:h,finish:p,sort:l}}function vM(){let t=new WeakMap;function e(n,r){const s=t.get(n);let o;return s===void 0?(o=new Lf,t.set(n,[o])):r>=s.length?(o=new Lf,s.push(o)):o=s[r],o}function i(){t=new WeakMap}return{get:e,dispose:i}}function _M(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Ie,color:new Di};break;case"SpotLight":i={position:new Ie,direction:new Ie,color:new Di,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Ie,color:new Di,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Ie,skyColor:new Di,groundColor:new Di};break;case"RectAreaLight":i={color:new Di,position:new Ie,halfWidth:new Ie,halfHeight:new Ie};break}return t[e.id]=i,i}}}function bM(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new si,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}let yM=0;function SM(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function wM(t,e){const i=new _M,n=bM(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let p=0;p<9;p++)r.probe.push(new Ie);const s=new Ie,o=new un,c=new un;function h(p,g){let f=0,y=0,x=0;for(let X=0;X<9;X++)r.probe[X].set(0,0,0);let S=0,v=0,m=0,w=0,b=0,C=0,A=0,M=0,F=0,N=0,P=0;p.sort(SM);const j=g===!0?Math.PI:1;for(let X=0,ie=p.length;X<ie;X++){const q=p[X],ae=q.color,pe=q.intensity,ue=q.distance,xe=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)f+=ae.r*pe*j,y+=ae.g*pe*j,x+=ae.b*pe*j;else if(q.isLightProbe){for(let Ee=0;Ee<9;Ee++)r.probe[Ee].addScaledVector(q.sh.coefficients[Ee],pe);P++}else if(q.isDirectionalLight){const Ee=i.get(q);if(Ee.color.copy(q.color).multiplyScalar(q.intensity*j),q.castShadow){const ye=q.shadow,ge=n.get(q);ge.shadowBias=ye.bias,ge.shadowNormalBias=ye.normalBias,ge.shadowRadius=ye.radius,ge.shadowMapSize=ye.mapSize,r.directionalShadow[S]=ge,r.directionalShadowMap[S]=xe,r.directionalShadowMatrix[S]=q.shadow.matrix,C++}r.directional[S]=Ee,S++}else if(q.isSpotLight){const Ee=i.get(q);Ee.position.setFromMatrixPosition(q.matrixWorld),Ee.color.copy(ae).multiplyScalar(pe*j),Ee.distance=ue,Ee.coneCos=Math.cos(q.angle),Ee.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),Ee.decay=q.decay,r.spot[m]=Ee;const ye=q.shadow;if(q.map&&(r.spotLightMap[F]=q.map,F++,ye.updateMatrices(q),q.castShadow&&N++),r.spotLightMatrix[m]=ye.matrix,q.castShadow){const ge=n.get(q);ge.shadowBias=ye.bias,ge.shadowNormalBias=ye.normalBias,ge.shadowRadius=ye.radius,ge.shadowMapSize=ye.mapSize,r.spotShadow[m]=ge,r.spotShadowMap[m]=xe,M++}m++}else if(q.isRectAreaLight){const Ee=i.get(q);Ee.color.copy(ae).multiplyScalar(pe),Ee.halfWidth.set(q.width*.5,0,0),Ee.halfHeight.set(0,q.height*.5,0),r.rectArea[w]=Ee,w++}else if(q.isPointLight){const Ee=i.get(q);if(Ee.color.copy(q.color).multiplyScalar(q.intensity*j),Ee.distance=q.distance,Ee.decay=q.decay,q.castShadow){const ye=q.shadow,ge=n.get(q);ge.shadowBias=ye.bias,ge.shadowNormalBias=ye.normalBias,ge.shadowRadius=ye.radius,ge.shadowMapSize=ye.mapSize,ge.shadowCameraNear=ye.camera.near,ge.shadowCameraFar=ye.camera.far,r.pointShadow[v]=ge,r.pointShadowMap[v]=xe,r.pointShadowMatrix[v]=q.shadow.matrix,A++}r.point[v]=Ee,v++}else if(q.isHemisphereLight){const Ee=i.get(q);Ee.skyColor.copy(q.color).multiplyScalar(pe*j),Ee.groundColor.copy(q.groundColor).multiplyScalar(pe*j),r.hemi[b]=Ee,b++}}w>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=dt.LTC_FLOAT_1,r.rectAreaLTC2=dt.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=dt.LTC_HALF_1,r.rectAreaLTC2=dt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=f,r.ambient[1]=y,r.ambient[2]=x;const K=r.hash;(K.directionalLength!==S||K.pointLength!==v||K.spotLength!==m||K.rectAreaLength!==w||K.hemiLength!==b||K.numDirectionalShadows!==C||K.numPointShadows!==A||K.numSpotShadows!==M||K.numSpotMaps!==F||K.numLightProbes!==P)&&(r.directional.length=S,r.spot.length=m,r.rectArea.length=w,r.point.length=v,r.hemi.length=b,r.directionalShadow.length=C,r.directionalShadowMap.length=C,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=C,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=M+F-N,r.spotLightMap.length=F,r.numSpotLightShadowsWithMaps=N,r.numLightProbes=P,K.directionalLength=S,K.pointLength=v,K.spotLength=m,K.rectAreaLength=w,K.hemiLength=b,K.numDirectionalShadows=C,K.numPointShadows=A,K.numSpotShadows=M,K.numSpotMaps=F,K.numLightProbes=P,r.version=yM++)}function l(p,g){let f=0,y=0,x=0,S=0,v=0;const m=g.matrixWorldInverse;for(let w=0,b=p.length;w<b;w++){const C=p[w];if(C.isDirectionalLight){const A=r.directional[f];A.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(m),f++}else if(C.isSpotLight){const A=r.spot[x];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(m),A.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(m),x++}else if(C.isRectAreaLight){const A=r.rectArea[S];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(m),c.identity(),o.copy(C.matrixWorld),o.premultiply(m),c.extractRotation(o),A.halfWidth.set(C.width*.5,0,0),A.halfHeight.set(0,C.height*.5,0),A.halfWidth.applyMatrix4(c),A.halfHeight.applyMatrix4(c),S++}else if(C.isPointLight){const A=r.point[y];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(m),y++}else if(C.isHemisphereLight){const A=r.hemi[v];A.direction.setFromMatrixPosition(C.matrixWorld),A.direction.transformDirection(m),v++}}}return{setup:h,setupView:l,state:r}}function Ff(t,e){const i=new wM(t,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(g){n.push(g)}function c(g){r.push(g)}function h(g){i.setup(n,g)}function l(g){i.setupView(n,g)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:h,setupLightsView:l,pushLight:o,pushShadow:c}}function xM(t,e){let i=new WeakMap;function n(s,o=0){const c=i.get(s);let h;return c===void 0?(h=new Ff(t,e),i.set(s,[h])):o>=c.length?(h=new Ff(t,e),c.push(h)):h=c[o],h}function r(){i=new WeakMap}return{get:n,dispose:r}}class EM extends $l{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=yC,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class CM extends $l{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const TM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,RM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function PM(t,e,i){let n=new Mv;const r=new si,s=new si,o=new dn,c=new EM({depthPacking:SC}),h=new CM,l={},p=i.maxTextureSize,g={[Us]:Vn,[Vn]:Us,[ds]:ds},f=new ga({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new si},radius:{value:4}},vertexShader:TM,fragmentShader:RM}),y=f.clone();y.defines.HORIZONTAL_PASS=1;const x=new zs;x.setAttribute("position",new Kr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const S=new hs(x,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sv;let m=this.type;this.render=function(A,M,F){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||A.length===0)return;const N=t.getRenderTarget(),P=t.getActiveCubeFace(),j=t.getActiveMipmapLevel(),K=t.state;K.setBlending(Ds),K.buffers.color.setClear(1,1,1,1),K.buffers.depth.setTest(!0),K.setScissorTest(!1);const X=m!==cs&&this.type===cs,ie=m===cs&&this.type!==cs;for(let q=0,ae=A.length;q<ae;q++){const pe=A[q],ue=pe.shadow;if(ue===void 0){console.warn("THREE.WebGLShadowMap:",pe,"has no shadow.");continue}if(ue.autoUpdate===!1&&ue.needsUpdate===!1)continue;r.copy(ue.mapSize);const xe=ue.getFrameExtents();if(r.multiply(xe),s.copy(ue.mapSize),(r.x>p||r.y>p)&&(r.x>p&&(s.x=Math.floor(p/xe.x),r.x=s.x*xe.x,ue.mapSize.x=s.x),r.y>p&&(s.y=Math.floor(p/xe.y),r.y=s.y*xe.y,ue.mapSize.y=s.y)),ue.map===null||X===!0||ie===!0){const ye=this.type!==cs?{minFilter:Pn,magFilter:Pn}:{};ue.map!==null&&ue.map.dispose(),ue.map=new fa(r.x,r.y,ye),ue.map.texture.name=pe.name+".shadowMap",ue.camera.updateProjectionMatrix()}t.setRenderTarget(ue.map),t.clear();const Ee=ue.getViewportCount();for(let ye=0;ye<Ee;ye++){const ge=ue.getViewport(ye);o.set(s.x*ge.x,s.y*ge.y,s.x*ge.z,s.y*ge.w),K.viewport(o),ue.updateMatrices(pe,ye),n=ue.getFrustum(),C(M,F,ue.camera,pe,this.type)}ue.isPointLightShadow!==!0&&this.type===cs&&w(ue,F),ue.needsUpdate=!1}m=this.type,v.needsUpdate=!1,t.setRenderTarget(N,P,j)};function w(A,M){const F=e.update(S);f.defines.VSM_SAMPLES!==A.blurSamples&&(f.defines.VSM_SAMPLES=A.blurSamples,y.defines.VSM_SAMPLES=A.blurSamples,f.needsUpdate=!0,y.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new fa(r.x,r.y)),f.uniforms.shadow_pass.value=A.map.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,t.setRenderTarget(A.mapPass),t.clear(),t.renderBufferDirect(M,null,F,f,S,null),y.uniforms.shadow_pass.value=A.mapPass.texture,y.uniforms.resolution.value=A.mapSize,y.uniforms.radius.value=A.radius,t.setRenderTarget(A.map),t.clear(),t.renderBufferDirect(M,null,F,y,S,null)}function b(A,M,F,N){let P=null;const j=F.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(j!==void 0)P=j;else if(P=F.isPointLight===!0?h:c,t.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const K=P.uuid,X=M.uuid;let ie=l[K];ie===void 0&&(ie={},l[K]=ie);let q=ie[X];q===void 0&&(q=P.clone(),ie[X]=q),P=q}if(P.visible=M.visible,P.wireframe=M.wireframe,N===cs?P.side=M.shadowSide!==null?M.shadowSide:M.side:P.side=M.shadowSide!==null?M.shadowSide:g[M.side],P.alphaMap=M.alphaMap,P.alphaTest=M.alphaTest,P.map=M.map,P.clipShadows=M.clipShadows,P.clippingPlanes=M.clippingPlanes,P.clipIntersection=M.clipIntersection,P.displacementMap=M.displacementMap,P.displacementScale=M.displacementScale,P.displacementBias=M.displacementBias,P.wireframeLinewidth=M.wireframeLinewidth,P.linewidth=M.linewidth,F.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const K=t.properties.get(P);K.light=F}return P}function C(A,M,F,N,P){if(A.visible===!1)return;if(A.layers.test(M.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&P===cs)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,A.matrixWorld);const X=e.update(A),ie=A.material;if(Array.isArray(ie)){const q=X.groups;for(let ae=0,pe=q.length;ae<pe;ae++){const ue=q[ae],xe=ie[ue.materialIndex];if(xe&&xe.visible){const Ee=b(A,xe,N,P);t.renderBufferDirect(F,null,X,Ee,A,ue)}}}else if(ie.visible){const q=b(A,ie,N,P);t.renderBufferDirect(F,null,X,q,A,null)}}const K=A.children;for(let X=0,ie=K.length;X<ie;X++)C(K[X],M,F,N,P)}}function MM(t,e,i){const n=i.isWebGL2;function r(){let he=!1;const nt=new dn;let Je=null;const ct=new dn(0,0,0,0);return{setMask:function(ot){Je!==ot&&!he&&(t.colorMask(ot,ot,ot,ot),Je=ot)},setLocked:function(ot){he=ot},setClear:function(ot,Ke,lt,It,Ii){Ii===!0&&(ot*=It,Ke*=It,lt*=It),nt.set(ot,Ke,lt,It),ct.equals(nt)===!1&&(t.clearColor(ot,Ke,lt,It),ct.copy(nt))},reset:function(){he=!1,Je=null,ct.set(-1,0,0,0)}}}function s(){let he=!1,nt=null,Je=null,ct=null;return{setTest:function(ot){ot?Lt(t.DEPTH_TEST):St(t.DEPTH_TEST)},setMask:function(ot){nt!==ot&&!he&&(t.depthMask(ot),nt=ot)},setFunc:function(ot){if(Je!==ot){switch(ot){case ZE:t.depthFunc(t.NEVER);break;case YE:t.depthFunc(t.ALWAYS);break;case JE:t.depthFunc(t.LESS);break;case Eu:t.depthFunc(t.LEQUAL);break;case QE:t.depthFunc(t.EQUAL);break;case eC:t.depthFunc(t.GEQUAL);break;case tC:t.depthFunc(t.GREATER);break;case iC:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Je=ot}},setLocked:function(ot){he=ot},setClear:function(ot){ct!==ot&&(t.clearDepth(ot),ct=ot)},reset:function(){he=!1,nt=null,Je=null,ct=null}}}function o(){let he=!1,nt=null,Je=null,ct=null,ot=null,Ke=null,lt=null,It=null,Ii=null;return{setTest:function(hi){he||(hi?Lt(t.STENCIL_TEST):St(t.STENCIL_TEST))},setMask:function(hi){nt!==hi&&!he&&(t.stencilMask(hi),nt=hi)},setFunc:function(hi,pn,Ui){(Je!==hi||ct!==pn||ot!==Ui)&&(t.stencilFunc(hi,pn,Ui),Je=hi,ct=pn,ot=Ui)},setOp:function(hi,pn,Ui){(Ke!==hi||lt!==pn||It!==Ui)&&(t.stencilOp(hi,pn,Ui),Ke=hi,lt=pn,It=Ui)},setLocked:function(hi){he=hi},setClear:function(hi){Ii!==hi&&(t.clearStencil(hi),Ii=hi)},reset:function(){he=!1,nt=null,Je=null,ct=null,ot=null,Ke=null,lt=null,It=null,Ii=null}}}const c=new r,h=new s,l=new o,p=new WeakMap,g=new WeakMap;let f={},y={},x=new WeakMap,S=[],v=null,m=!1,w=null,b=null,C=null,A=null,M=null,F=null,N=null,P=!1,j=null,K=null,X=null,ie=null,q=null;const ae=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let pe=!1,ue=0;const xe=t.getParameter(t.VERSION);xe.indexOf("WebGL")!==-1?(ue=parseFloat(/^WebGL (\d)/.exec(xe)[1]),pe=ue>=1):xe.indexOf("OpenGL ES")!==-1&&(ue=parseFloat(/^OpenGL ES (\d)/.exec(xe)[1]),pe=ue>=2);let Ee=null,ye={};const ge=t.getParameter(t.SCISSOR_BOX),Te=t.getParameter(t.VIEWPORT),rt=new dn().fromArray(ge),et=new dn().fromArray(Te);function tt(he,nt,Je,ct){const ot=new Uint8Array(4),Ke=t.createTexture();t.bindTexture(he,Ke),t.texParameteri(he,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(he,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let lt=0;lt<Je;lt++)n&&(he===t.TEXTURE_3D||he===t.TEXTURE_2D_ARRAY)?t.texImage3D(nt,0,t.RGBA,1,1,ct,0,t.RGBA,t.UNSIGNED_BYTE,ot):t.texImage2D(nt+lt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ot);return Ke}const gt={};gt[t.TEXTURE_2D]=tt(t.TEXTURE_2D,t.TEXTURE_2D,1),gt[t.TEXTURE_CUBE_MAP]=tt(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(gt[t.TEXTURE_2D_ARRAY]=tt(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),gt[t.TEXTURE_3D]=tt(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),c.setClear(0,0,0,1),h.setClear(1),l.setClear(0),Lt(t.DEPTH_TEST),h.setFunc(Eu),Bt(!1),li(mp),Lt(t.CULL_FACE),Mt(Ds);function Lt(he){f[he]!==!0&&(t.enable(he),f[he]=!0)}function St(he){f[he]!==!1&&(t.disable(he),f[he]=!1)}function Kt(he,nt){return y[he]!==nt?(t.bindFramebuffer(he,nt),y[he]=nt,n&&(he===t.DRAW_FRAMEBUFFER&&(y[t.FRAMEBUFFER]=nt),he===t.FRAMEBUFFER&&(y[t.DRAW_FRAMEBUFFER]=nt)),!0):!1}function Ei(he,nt){let Je=S,ct=!1;if(he)if(Je=x.get(nt),Je===void 0&&(Je=[],x.set(nt,Je)),he.isWebGLMultipleRenderTargets){const ot=he.texture;if(Je.length!==ot.length||Je[0]!==t.COLOR_ATTACHMENT0){for(let Ke=0,lt=ot.length;Ke<lt;Ke++)Je[Ke]=t.COLOR_ATTACHMENT0+Ke;Je.length=ot.length,ct=!0}}else Je[0]!==t.COLOR_ATTACHMENT0&&(Je[0]=t.COLOR_ATTACHMENT0,ct=!0);else Je[0]!==t.BACK&&(Je[0]=t.BACK,ct=!0);ct&&(i.isWebGL2?t.drawBuffers(Je):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Je))}function Ut(he){return v!==he?(t.useProgram(he),v=he,!0):!1}const Pe={[Va]:t.FUNC_ADD,[BE]:t.FUNC_SUBTRACT,[HE]:t.FUNC_REVERSE_SUBTRACT};if(n)Pe[bp]=t.MIN,Pe[yp]=t.MAX;else{const he=e.get("EXT_blend_minmax");he!==null&&(Pe[bp]=he.MIN_EXT,Pe[yp]=he.MAX_EXT)}const _i={[jE]:t.ZERO,[VE]:t.ONE,[zE]:t.SRC_COLOR,[av]:t.SRC_ALPHA,[$E]:t.SRC_ALPHA_SATURATE,[KE]:t.DST_COLOR,[qE]:t.DST_ALPHA,[GE]:t.ONE_MINUS_SRC_COLOR,[ov]:t.ONE_MINUS_SRC_ALPHA,[XE]:t.ONE_MINUS_DST_COLOR,[WE]:t.ONE_MINUS_DST_ALPHA};function Mt(he,nt,Je,ct,ot,Ke,lt,It){if(he===Ds){m===!0&&(St(t.BLEND),m=!1);return}if(m===!1&&(Lt(t.BLEND),m=!0),he!==UE){if(he!==w||It!==P){if((b!==Va||M!==Va)&&(t.blendEquation(t.FUNC_ADD),b=Va,M=Va),It)switch(he){case Ka:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case gp:t.blendFunc(t.ONE,t.ONE);break;case vp:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case _p:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",he);break}else switch(he){case Ka:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case gp:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case vp:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case _p:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",he);break}C=null,A=null,F=null,N=null,w=he,P=It}return}ot=ot||nt,Ke=Ke||Je,lt=lt||ct,(nt!==b||ot!==M)&&(t.blendEquationSeparate(Pe[nt],Pe[ot]),b=nt,M=ot),(Je!==C||ct!==A||Ke!==F||lt!==N)&&(t.blendFuncSeparate(_i[Je],_i[ct],_i[Ke],_i[lt]),C=Je,A=ct,F=Ke,N=lt),w=he,P=!1}function xt(he,nt){he.side===ds?St(t.CULL_FACE):Lt(t.CULL_FACE);let Je=he.side===Vn;nt&&(Je=!Je),Bt(Je),he.blending===Ka&&he.transparent===!1?Mt(Ds):Mt(he.blending,he.blendEquation,he.blendSrc,he.blendDst,he.blendEquationAlpha,he.blendSrcAlpha,he.blendDstAlpha,he.premultipliedAlpha),h.setFunc(he.depthFunc),h.setTest(he.depthTest),h.setMask(he.depthWrite),c.setMask(he.colorWrite);const ct=he.stencilWrite;l.setTest(ct),ct&&(l.setMask(he.stencilWriteMask),l.setFunc(he.stencilFunc,he.stencilRef,he.stencilFuncMask),l.setOp(he.stencilFail,he.stencilZFail,he.stencilZPass)),Ht(he.polygonOffset,he.polygonOffsetFactor,he.polygonOffsetUnits),he.alphaToCoverage===!0?Lt(t.SAMPLE_ALPHA_TO_COVERAGE):St(t.SAMPLE_ALPHA_TO_COVERAGE)}function Bt(he){j!==he&&(he?t.frontFace(t.CW):t.frontFace(t.CCW),j=he)}function li(he){he!==kE?(Lt(t.CULL_FACE),he!==K&&(he===mp?t.cullFace(t.BACK):he===NE?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):St(t.CULL_FACE),K=he}function Ot(he){he!==X&&(pe&&t.lineWidth(he),X=he)}function Ht(he,nt,Je){he?(Lt(t.POLYGON_OFFSET_FILL),(ie!==nt||q!==Je)&&(t.polygonOffset(nt,Je),ie=nt,q=Je)):St(t.POLYGON_OFFSET_FILL)}function ei(he){he?Lt(t.SCISSOR_TEST):St(t.SCISSOR_TEST)}function Ci(he){he===void 0&&(he=t.TEXTURE0+ae-1),Ee!==he&&(t.activeTexture(he),Ee=he)}function yi(he,nt,Je){Je===void 0&&(Ee===null?Je=t.TEXTURE0+ae-1:Je=Ee);let ct=ye[Je];ct===void 0&&(ct={type:void 0,texture:void 0},ye[Je]=ct),(ct.type!==he||ct.texture!==nt)&&(Ee!==Je&&(t.activeTexture(Je),Ee=Je),t.bindTexture(he,nt||gt[he]),ct.type=he,ct.texture=nt)}function ce(){const he=ye[Ee];he!==void 0&&he.type!==void 0&&(t.bindTexture(he.type,null),he.type=void 0,he.texture=void 0)}function te(){try{t.compressedTexImage2D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function De(){try{t.compressedTexImage3D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function He(){try{t.texSubImage2D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function Oe(){try{t.texSubImage3D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function Fe(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function it(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function $e(){try{t.texStorage2D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function st(){try{t.texStorage3D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function de(){try{t.texImage2D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function ke(){try{t.texImage3D.apply(t,arguments)}catch(he){console.error("THREE.WebGLState:",he)}}function Ve(he){rt.equals(he)===!1&&(t.scissor(he.x,he.y,he.z,he.w),rt.copy(he))}function Ct(he){et.equals(he)===!1&&(t.viewport(he.x,he.y,he.z,he.w),et.copy(he))}function Tt(he,nt){let Je=g.get(nt);Je===void 0&&(Je=new WeakMap,g.set(nt,Je));let ct=Je.get(he);ct===void 0&&(ct=t.getUniformBlockIndex(nt,he.name),Je.set(he,ct))}function At(he,nt){const ct=g.get(nt).get(he);p.get(nt)!==ct&&(t.uniformBlockBinding(nt,ct,he.__bindingPointIndex),p.set(nt,ct))}function wt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),n===!0&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),f={},Ee=null,ye={},y={},x=new WeakMap,S=[],v=null,m=!1,w=null,b=null,C=null,A=null,M=null,F=null,N=null,P=!1,j=null,K=null,X=null,ie=null,q=null,rt.set(0,0,t.canvas.width,t.canvas.height),et.set(0,0,t.canvas.width,t.canvas.height),c.reset(),h.reset(),l.reset()}return{buffers:{color:c,depth:h,stencil:l},enable:Lt,disable:St,bindFramebuffer:Kt,drawBuffers:Ei,useProgram:Ut,setBlending:Mt,setMaterial:xt,setFlipSided:Bt,setCullFace:li,setLineWidth:Ot,setPolygonOffset:Ht,setScissorTest:ei,activeTexture:Ci,bindTexture:yi,unbindTexture:ce,compressedTexImage2D:te,compressedTexImage3D:De,texImage2D:de,texImage3D:ke,updateUBOMapping:Tt,uniformBlockBinding:At,texStorage2D:$e,texStorage3D:st,texSubImage2D:He,texSubImage3D:Oe,compressedTexSubImage2D:Fe,compressedTexSubImage3D:it,scissor:Ve,viewport:Ct,reset:wt}}function AM(t,e,i,n,r,s,o){const c=r.isWebGL2,h=r.maxTextures,l=r.maxCubemapSize,p=r.maxTextureSize,g=r.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,y=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),x=new WeakMap;let S;const v=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(ce,te){return m?new OffscreenCanvas(ce,te):xl("canvas")}function b(ce,te,De,He){let Oe=1;if((ce.width>He||ce.height>He)&&(Oe=He/Math.max(ce.width,ce.height)),Oe<1||te===!0)if(typeof HTMLImageElement<"u"&&ce instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ce instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ce instanceof ImageBitmap){const Fe=te?Du:Math.floor,it=Fe(Oe*ce.width),$e=Fe(Oe*ce.height);S===void 0&&(S=w(it,$e));const st=De?w(it,$e):S;return st.width=it,st.height=$e,st.getContext("2d").drawImage(ce,0,0,it,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ce.width+"x"+ce.height+") to ("+it+"x"+$e+")."),st}else return"data"in ce&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ce.width+"x"+ce.height+")."),ce;return ce}function C(ce){return $p(ce.width)&&$p(ce.height)}function A(ce){return c?!1:ce.wrapS!==Mr||ce.wrapT!==Mr||ce.minFilter!==Pn&&ce.minFilter!==Hn}function M(ce,te){return ce.generateMipmaps&&te&&ce.minFilter!==Pn&&ce.minFilter!==Hn}function F(ce){t.generateMipmap(ce)}function N(ce,te,De,He,Oe=!1){if(c===!1)return te;if(ce!==null){if(t[ce]!==void 0)return t[ce];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ce+"'")}let Fe=te;if(te===t.RED&&(De===t.FLOAT&&(Fe=t.R32F),De===t.HALF_FLOAT&&(Fe=t.R16F),De===t.UNSIGNED_BYTE&&(Fe=t.R8)),te===t.RED_INTEGER&&(De===t.UNSIGNED_BYTE&&(Fe=t.R8UI),De===t.UNSIGNED_SHORT&&(Fe=t.R16UI),De===t.UNSIGNED_INT&&(Fe=t.R32UI),De===t.BYTE&&(Fe=t.R8I),De===t.SHORT&&(Fe=t.R16I),De===t.INT&&(Fe=t.R32I)),te===t.RG&&(De===t.FLOAT&&(Fe=t.RG32F),De===t.HALF_FLOAT&&(Fe=t.RG16F),De===t.UNSIGNED_BYTE&&(Fe=t.RG8)),te===t.RGBA){const it=Oe?bl:xi.getTransfer(He);De===t.FLOAT&&(Fe=t.RGBA32F),De===t.HALF_FLOAT&&(Fe=t.RGBA16F),De===t.UNSIGNED_BYTE&&(Fe=it===Ai?t.SRGB8_ALPHA8:t.RGBA8),De===t.UNSIGNED_SHORT_4_4_4_4&&(Fe=t.RGBA4),De===t.UNSIGNED_SHORT_5_5_5_1&&(Fe=t.RGB5_A1)}return(Fe===t.R16F||Fe===t.R32F||Fe===t.RG16F||Fe===t.RG32F||Fe===t.RGBA16F||Fe===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function P(ce,te,De){return M(ce,De)===!0||ce.isFramebufferTexture&&ce.minFilter!==Pn&&ce.minFilter!==Hn?Math.log2(Math.max(te.width,te.height))+1:ce.mipmaps!==void 0&&ce.mipmaps.length>0?ce.mipmaps.length:ce.isCompressedTexture&&Array.isArray(ce.image)?te.mipmaps.length:1}function j(ce){return ce===Pn||ce===Sp||ce===Rd?t.NEAREST:t.LINEAR}function K(ce){const te=ce.target;te.removeEventListener("dispose",K),ie(te),te.isVideoTexture&&x.delete(te)}function X(ce){const te=ce.target;te.removeEventListener("dispose",X),ae(te)}function ie(ce){const te=n.get(ce);if(te.__webglInit===void 0)return;const De=ce.source,He=v.get(De);if(He){const Oe=He[te.__cacheKey];Oe.usedTimes--,Oe.usedTimes===0&&q(ce),Object.keys(He).length===0&&v.delete(De)}n.remove(ce)}function q(ce){const te=n.get(ce);t.deleteTexture(te.__webglTexture);const De=ce.source,He=v.get(De);delete He[te.__cacheKey],o.memory.textures--}function ae(ce){const te=ce.texture,De=n.get(ce),He=n.get(te);if(He.__webglTexture!==void 0&&(t.deleteTexture(He.__webglTexture),o.memory.textures--),ce.depthTexture&&ce.depthTexture.dispose(),ce.isWebGLCubeRenderTarget)for(let Oe=0;Oe<6;Oe++){if(Array.isArray(De.__webglFramebuffer[Oe]))for(let Fe=0;Fe<De.__webglFramebuffer[Oe].length;Fe++)t.deleteFramebuffer(De.__webglFramebuffer[Oe][Fe]);else t.deleteFramebuffer(De.__webglFramebuffer[Oe]);De.__webglDepthbuffer&&t.deleteRenderbuffer(De.__webglDepthbuffer[Oe])}else{if(Array.isArray(De.__webglFramebuffer))for(let Oe=0;Oe<De.__webglFramebuffer.length;Oe++)t.deleteFramebuffer(De.__webglFramebuffer[Oe]);else t.deleteFramebuffer(De.__webglFramebuffer);if(De.__webglDepthbuffer&&t.deleteRenderbuffer(De.__webglDepthbuffer),De.__webglMultisampledFramebuffer&&t.deleteFramebuffer(De.__webglMultisampledFramebuffer),De.__webglColorRenderbuffer)for(let Oe=0;Oe<De.__webglColorRenderbuffer.length;Oe++)De.__webglColorRenderbuffer[Oe]&&t.deleteRenderbuffer(De.__webglColorRenderbuffer[Oe]);De.__webglDepthRenderbuffer&&t.deleteRenderbuffer(De.__webglDepthRenderbuffer)}if(ce.isWebGLMultipleRenderTargets)for(let Oe=0,Fe=te.length;Oe<Fe;Oe++){const it=n.get(te[Oe]);it.__webglTexture&&(t.deleteTexture(it.__webglTexture),o.memory.textures--),n.remove(te[Oe])}n.remove(te),n.remove(ce)}let pe=0;function ue(){pe=0}function xe(){const ce=pe;return ce>=h&&console.warn("THREE.WebGLTextures: Trying to use "+ce+" texture units while this GPU supports only "+h),pe+=1,ce}function Ee(ce){const te=[];return te.push(ce.wrapS),te.push(ce.wrapT),te.push(ce.wrapR||0),te.push(ce.magFilter),te.push(ce.minFilter),te.push(ce.anisotropy),te.push(ce.internalFormat),te.push(ce.format),te.push(ce.type),te.push(ce.generateMipmaps),te.push(ce.premultiplyAlpha),te.push(ce.flipY),te.push(ce.unpackAlignment),te.push(ce.colorSpace),te.join()}function ye(ce,te){const De=n.get(ce);if(ce.isVideoTexture&&Ci(ce),ce.isRenderTargetTexture===!1&&ce.version>0&&De.__version!==ce.version){const He=ce.image;if(He===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(He.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Kt(De,ce,te);return}}i.bindTexture(t.TEXTURE_2D,De.__webglTexture,t.TEXTURE0+te)}function ge(ce,te){const De=n.get(ce);if(ce.version>0&&De.__version!==ce.version){Kt(De,ce,te);return}i.bindTexture(t.TEXTURE_2D_ARRAY,De.__webglTexture,t.TEXTURE0+te)}function Te(ce,te){const De=n.get(ce);if(ce.version>0&&De.__version!==ce.version){Kt(De,ce,te);return}i.bindTexture(t.TEXTURE_3D,De.__webglTexture,t.TEXTURE0+te)}function rt(ce,te){const De=n.get(ce);if(ce.version>0&&De.__version!==ce.version){Ei(De,ce,te);return}i.bindTexture(t.TEXTURE_CUBE_MAP,De.__webglTexture,t.TEXTURE0+te)}const et={[Ru]:t.REPEAT,[Mr]:t.CLAMP_TO_EDGE,[Pu]:t.MIRRORED_REPEAT},tt={[Pn]:t.NEAREST,[Sp]:t.NEAREST_MIPMAP_NEAREST,[Rd]:t.NEAREST_MIPMAP_LINEAR,[Hn]:t.LINEAR,[dC]:t.LINEAR_MIPMAP_NEAREST,[Qo]:t.LINEAR_MIPMAP_LINEAR},gt={[CC]:t.NEVER,[IC]:t.ALWAYS,[TC]:t.LESS,[PC]:t.LEQUAL,[RC]:t.EQUAL,[DC]:t.GEQUAL,[MC]:t.GREATER,[AC]:t.NOTEQUAL};function Lt(ce,te,De){if(De?(t.texParameteri(ce,t.TEXTURE_WRAP_S,et[te.wrapS]),t.texParameteri(ce,t.TEXTURE_WRAP_T,et[te.wrapT]),(ce===t.TEXTURE_3D||ce===t.TEXTURE_2D_ARRAY)&&t.texParameteri(ce,t.TEXTURE_WRAP_R,et[te.wrapR]),t.texParameteri(ce,t.TEXTURE_MAG_FILTER,tt[te.magFilter]),t.texParameteri(ce,t.TEXTURE_MIN_FILTER,tt[te.minFilter])):(t.texParameteri(ce,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(ce,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(ce===t.TEXTURE_3D||ce===t.TEXTURE_2D_ARRAY)&&t.texParameteri(ce,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),(te.wrapS!==Mr||te.wrapT!==Mr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(ce,t.TEXTURE_MAG_FILTER,j(te.magFilter)),t.texParameteri(ce,t.TEXTURE_MIN_FILTER,j(te.minFilter)),te.minFilter!==Pn&&te.minFilter!==Hn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),te.compareFunction&&(t.texParameteri(ce,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(ce,t.TEXTURE_COMPARE_FUNC,gt[te.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const He=e.get("EXT_texture_filter_anisotropic");if(te.magFilter===Pn||te.minFilter!==Rd&&te.minFilter!==Qo||te.type===As&&e.has("OES_texture_float_linear")===!1||c===!1&&te.type===ec&&e.has("OES_texture_half_float_linear")===!1)return;(te.anisotropy>1||n.get(te).__currentAnisotropy)&&(t.texParameterf(ce,He.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(te.anisotropy,r.getMaxAnisotropy())),n.get(te).__currentAnisotropy=te.anisotropy)}}function St(ce,te){let De=!1;ce.__webglInit===void 0&&(ce.__webglInit=!0,te.addEventListener("dispose",K));const He=te.source;let Oe=v.get(He);Oe===void 0&&(Oe={},v.set(He,Oe));const Fe=Ee(te);if(Fe!==ce.__cacheKey){Oe[Fe]===void 0&&(Oe[Fe]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,De=!0),Oe[Fe].usedTimes++;const it=Oe[ce.__cacheKey];it!==void 0&&(Oe[ce.__cacheKey].usedTimes--,it.usedTimes===0&&q(te)),ce.__cacheKey=Fe,ce.__webglTexture=Oe[Fe].texture}return De}function Kt(ce,te,De){let He=t.TEXTURE_2D;(te.isDataArrayTexture||te.isCompressedArrayTexture)&&(He=t.TEXTURE_2D_ARRAY),te.isData3DTexture&&(He=t.TEXTURE_3D);const Oe=St(ce,te),Fe=te.source;i.bindTexture(He,ce.__webglTexture,t.TEXTURE0+De);const it=n.get(Fe);if(Fe.version!==it.__version||Oe===!0){i.activeTexture(t.TEXTURE0+De);const $e=xi.getPrimaries(xi.workingColorSpace),st=te.colorSpace===fr?null:xi.getPrimaries(te.colorSpace),de=te.colorSpace===fr||$e===st?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,te.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,te.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,de);const ke=A(te)&&C(te.image)===!1;let Ve=b(te.image,ke,!1,p);Ve=yi(te,Ve);const Ct=C(Ve)||c,Tt=s.convert(te.format,te.colorSpace);let At=s.convert(te.type),wt=N(te.internalFormat,Tt,At,te.colorSpace,te.isVideoTexture);Lt(He,te,Ct);let he;const nt=te.mipmaps,Je=c&&te.isVideoTexture!==!0,ct=it.__version===void 0||Oe===!0,ot=P(te,Ve,Ct);if(te.isDepthTexture)wt=t.DEPTH_COMPONENT,c?te.type===As?wt=t.DEPTH_COMPONENT32F:te.type===Ms?wt=t.DEPTH_COMPONENT24:te.type===ca?wt=t.DEPTH24_STENCIL8:wt=t.DEPTH_COMPONENT16:te.type===As&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),te.format===la&&wt===t.DEPTH_COMPONENT&&te.type!==Qu&&te.type!==Ms&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),te.type=Ms,At=s.convert(te.type)),te.format===so&&wt===t.DEPTH_COMPONENT&&(wt=t.DEPTH_STENCIL,te.type!==ca&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),te.type=ca,At=s.convert(te.type))),ct&&(Je?i.texStorage2D(t.TEXTURE_2D,1,wt,Ve.width,Ve.height):i.texImage2D(t.TEXTURE_2D,0,wt,Ve.width,Ve.height,0,Tt,At,null));else if(te.isDataTexture)if(nt.length>0&&Ct){Je&&ct&&i.texStorage2D(t.TEXTURE_2D,ot,wt,nt[0].width,nt[0].height);for(let Ke=0,lt=nt.length;Ke<lt;Ke++)he=nt[Ke],Je?i.texSubImage2D(t.TEXTURE_2D,Ke,0,0,he.width,he.height,Tt,At,he.data):i.texImage2D(t.TEXTURE_2D,Ke,wt,he.width,he.height,0,Tt,At,he.data);te.generateMipmaps=!1}else Je?(ct&&i.texStorage2D(t.TEXTURE_2D,ot,wt,Ve.width,Ve.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,Ve.width,Ve.height,Tt,At,Ve.data)):i.texImage2D(t.TEXTURE_2D,0,wt,Ve.width,Ve.height,0,Tt,At,Ve.data);else if(te.isCompressedTexture)if(te.isCompressedArrayTexture){Je&&ct&&i.texStorage3D(t.TEXTURE_2D_ARRAY,ot,wt,nt[0].width,nt[0].height,Ve.depth);for(let Ke=0,lt=nt.length;Ke<lt;Ke++)he=nt[Ke],te.format!==Ar?Tt!==null?Je?i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ke,0,0,0,he.width,he.height,Ve.depth,Tt,he.data,0,0):i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Ke,wt,he.width,he.height,Ve.depth,0,he.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Je?i.texSubImage3D(t.TEXTURE_2D_ARRAY,Ke,0,0,0,he.width,he.height,Ve.depth,Tt,At,he.data):i.texImage3D(t.TEXTURE_2D_ARRAY,Ke,wt,he.width,he.height,Ve.depth,0,Tt,At,he.data)}else{Je&&ct&&i.texStorage2D(t.TEXTURE_2D,ot,wt,nt[0].width,nt[0].height);for(let Ke=0,lt=nt.length;Ke<lt;Ke++)he=nt[Ke],te.format!==Ar?Tt!==null?Je?i.compressedTexSubImage2D(t.TEXTURE_2D,Ke,0,0,he.width,he.height,Tt,he.data):i.compressedTexImage2D(t.TEXTURE_2D,Ke,wt,he.width,he.height,0,he.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Je?i.texSubImage2D(t.TEXTURE_2D,Ke,0,0,he.width,he.height,Tt,At,he.data):i.texImage2D(t.TEXTURE_2D,Ke,wt,he.width,he.height,0,Tt,At,he.data)}else if(te.isDataArrayTexture)Je?(ct&&i.texStorage3D(t.TEXTURE_2D_ARRAY,ot,wt,Ve.width,Ve.height,Ve.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Ve.width,Ve.height,Ve.depth,Tt,At,Ve.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,wt,Ve.width,Ve.height,Ve.depth,0,Tt,At,Ve.data);else if(te.isData3DTexture)Je?(ct&&i.texStorage3D(t.TEXTURE_3D,ot,wt,Ve.width,Ve.height,Ve.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Ve.width,Ve.height,Ve.depth,Tt,At,Ve.data)):i.texImage3D(t.TEXTURE_3D,0,wt,Ve.width,Ve.height,Ve.depth,0,Tt,At,Ve.data);else if(te.isFramebufferTexture){if(ct)if(Je)i.texStorage2D(t.TEXTURE_2D,ot,wt,Ve.width,Ve.height);else{let Ke=Ve.width,lt=Ve.height;for(let It=0;It<ot;It++)i.texImage2D(t.TEXTURE_2D,It,wt,Ke,lt,0,Tt,At,null),Ke>>=1,lt>>=1}}else if(nt.length>0&&Ct){Je&&ct&&i.texStorage2D(t.TEXTURE_2D,ot,wt,nt[0].width,nt[0].height);for(let Ke=0,lt=nt.length;Ke<lt;Ke++)he=nt[Ke],Je?i.texSubImage2D(t.TEXTURE_2D,Ke,0,0,Tt,At,he):i.texImage2D(t.TEXTURE_2D,Ke,wt,Tt,At,he);te.generateMipmaps=!1}else Je?(ct&&i.texStorage2D(t.TEXTURE_2D,ot,wt,Ve.width,Ve.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,Tt,At,Ve)):i.texImage2D(t.TEXTURE_2D,0,wt,Tt,At,Ve);M(te,Ct)&&F(He),it.__version=Fe.version,te.onUpdate&&te.onUpdate(te)}ce.__version=te.version}function Ei(ce,te,De){if(te.image.length!==6)return;const He=St(ce,te),Oe=te.source;i.bindTexture(t.TEXTURE_CUBE_MAP,ce.__webglTexture,t.TEXTURE0+De);const Fe=n.get(Oe);if(Oe.version!==Fe.__version||He===!0){i.activeTexture(t.TEXTURE0+De);const it=xi.getPrimaries(xi.workingColorSpace),$e=te.colorSpace===fr?null:xi.getPrimaries(te.colorSpace),st=te.colorSpace===fr||it===$e?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,te.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,te.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,te.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,st);const de=te.isCompressedTexture||te.image[0].isCompressedTexture,ke=te.image[0]&&te.image[0].isDataTexture,Ve=[];for(let Ke=0;Ke<6;Ke++)!de&&!ke?Ve[Ke]=b(te.image[Ke],!1,!0,l):Ve[Ke]=ke?te.image[Ke].image:te.image[Ke],Ve[Ke]=yi(te,Ve[Ke]);const Ct=Ve[0],Tt=C(Ct)||c,At=s.convert(te.format,te.colorSpace),wt=s.convert(te.type),he=N(te.internalFormat,At,wt,te.colorSpace),nt=c&&te.isVideoTexture!==!0,Je=Fe.__version===void 0||He===!0;let ct=P(te,Ct,Tt);Lt(t.TEXTURE_CUBE_MAP,te,Tt);let ot;if(de){nt&&Je&&i.texStorage2D(t.TEXTURE_CUBE_MAP,ct,he,Ct.width,Ct.height);for(let Ke=0;Ke<6;Ke++){ot=Ve[Ke].mipmaps;for(let lt=0;lt<ot.length;lt++){const It=ot[lt];te.format!==Ar?At!==null?nt?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt,0,0,It.width,It.height,At,It.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt,he,It.width,It.height,0,It.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):nt?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt,0,0,It.width,It.height,At,wt,It.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt,he,It.width,It.height,0,At,wt,It.data)}}}else{ot=te.mipmaps,nt&&Je&&(ot.length>0&&ct++,i.texStorage2D(t.TEXTURE_CUBE_MAP,ct,he,Ve[0].width,Ve[0].height));for(let Ke=0;Ke<6;Ke++)if(ke){nt?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,Ve[Ke].width,Ve[Ke].height,At,wt,Ve[Ke].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,he,Ve[Ke].width,Ve[Ke].height,0,At,wt,Ve[Ke].data);for(let lt=0;lt<ot.length;lt++){const Ii=ot[lt].image[Ke].image;nt?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt+1,0,0,Ii.width,Ii.height,At,wt,Ii.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt+1,he,Ii.width,Ii.height,0,At,wt,Ii.data)}}else{nt?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,At,wt,Ve[Ke]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,he,At,wt,Ve[Ke]);for(let lt=0;lt<ot.length;lt++){const It=ot[lt];nt?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt+1,0,0,At,wt,It.image[Ke]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,lt+1,he,At,wt,It.image[Ke])}}}M(te,Tt)&&F(t.TEXTURE_CUBE_MAP),Fe.__version=Oe.version,te.onUpdate&&te.onUpdate(te)}ce.__version=te.version}function Ut(ce,te,De,He,Oe,Fe){const it=s.convert(De.format,De.colorSpace),$e=s.convert(De.type),st=N(De.internalFormat,it,$e,De.colorSpace);if(!n.get(te).__hasExternalTextures){const ke=Math.max(1,te.width>>Fe),Ve=Math.max(1,te.height>>Fe);Oe===t.TEXTURE_3D||Oe===t.TEXTURE_2D_ARRAY?i.texImage3D(Oe,Fe,st,ke,Ve,te.depth,0,it,$e,null):i.texImage2D(Oe,Fe,st,ke,Ve,0,it,$e,null)}i.bindFramebuffer(t.FRAMEBUFFER,ce),ei(te)?f.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,He,Oe,n.get(De).__webglTexture,0,Ht(te)):(Oe===t.TEXTURE_2D||Oe>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Oe<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,He,Oe,n.get(De).__webglTexture,Fe),i.bindFramebuffer(t.FRAMEBUFFER,null)}function Pe(ce,te,De){if(t.bindRenderbuffer(t.RENDERBUFFER,ce),te.depthBuffer&&!te.stencilBuffer){let He=c===!0?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT16;if(De||ei(te)){const Oe=te.depthTexture;Oe&&Oe.isDepthTexture&&(Oe.type===As?He=t.DEPTH_COMPONENT32F:Oe.type===Ms&&(He=t.DEPTH_COMPONENT24));const Fe=Ht(te);ei(te)?f.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Fe,He,te.width,te.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,Fe,He,te.width,te.height)}else t.renderbufferStorage(t.RENDERBUFFER,He,te.width,te.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,ce)}else if(te.depthBuffer&&te.stencilBuffer){const He=Ht(te);De&&ei(te)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,He,t.DEPTH24_STENCIL8,te.width,te.height):ei(te)?f.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,He,t.DEPTH24_STENCIL8,te.width,te.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,te.width,te.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,ce)}else{const He=te.isWebGLMultipleRenderTargets===!0?te.texture:[te.texture];for(let Oe=0;Oe<He.length;Oe++){const Fe=He[Oe],it=s.convert(Fe.format,Fe.colorSpace),$e=s.convert(Fe.type),st=N(Fe.internalFormat,it,$e,Fe.colorSpace),de=Ht(te);De&&ei(te)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,de,st,te.width,te.height):ei(te)?f.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,de,st,te.width,te.height):t.renderbufferStorage(t.RENDERBUFFER,st,te.width,te.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function _i(ce,te){if(te&&te.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,ce),!(te.depthTexture&&te.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(te.depthTexture).__webglTexture||te.depthTexture.image.width!==te.width||te.depthTexture.image.height!==te.height)&&(te.depthTexture.image.width=te.width,te.depthTexture.image.height=te.height,te.depthTexture.needsUpdate=!0),ye(te.depthTexture,0);const He=n.get(te.depthTexture).__webglTexture,Oe=Ht(te);if(te.depthTexture.format===la)ei(te)?f.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,He,0,Oe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,He,0);else if(te.depthTexture.format===so)ei(te)?f.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,He,0,Oe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,He,0);else throw new Error("Unknown depthTexture format")}function Mt(ce){const te=n.get(ce),De=ce.isWebGLCubeRenderTarget===!0;if(ce.depthTexture&&!te.__autoAllocateDepthBuffer){if(De)throw new Error("target.depthTexture not supported in Cube render targets");_i(te.__webglFramebuffer,ce)}else if(De){te.__webglDepthbuffer=[];for(let He=0;He<6;He++)i.bindFramebuffer(t.FRAMEBUFFER,te.__webglFramebuffer[He]),te.__webglDepthbuffer[He]=t.createRenderbuffer(),Pe(te.__webglDepthbuffer[He],ce,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,te.__webglFramebuffer),te.__webglDepthbuffer=t.createRenderbuffer(),Pe(te.__webglDepthbuffer,ce,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function xt(ce,te,De){const He=n.get(ce);te!==void 0&&Ut(He.__webglFramebuffer,ce,ce.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),De!==void 0&&Mt(ce)}function Bt(ce){const te=ce.texture,De=n.get(ce),He=n.get(te);ce.addEventListener("dispose",X),ce.isWebGLMultipleRenderTargets!==!0&&(He.__webglTexture===void 0&&(He.__webglTexture=t.createTexture()),He.__version=te.version,o.memory.textures++);const Oe=ce.isWebGLCubeRenderTarget===!0,Fe=ce.isWebGLMultipleRenderTargets===!0,it=C(ce)||c;if(Oe){De.__webglFramebuffer=[];for(let $e=0;$e<6;$e++)if(c&&te.mipmaps&&te.mipmaps.length>0){De.__webglFramebuffer[$e]=[];for(let st=0;st<te.mipmaps.length;st++)De.__webglFramebuffer[$e][st]=t.createFramebuffer()}else De.__webglFramebuffer[$e]=t.createFramebuffer()}else{if(c&&te.mipmaps&&te.mipmaps.length>0){De.__webglFramebuffer=[];for(let $e=0;$e<te.mipmaps.length;$e++)De.__webglFramebuffer[$e]=t.createFramebuffer()}else De.__webglFramebuffer=t.createFramebuffer();if(Fe)if(r.drawBuffers){const $e=ce.texture;for(let st=0,de=$e.length;st<de;st++){const ke=n.get($e[st]);ke.__webglTexture===void 0&&(ke.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&ce.samples>0&&ei(ce)===!1){const $e=Fe?te:[te];De.__webglMultisampledFramebuffer=t.createFramebuffer(),De.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,De.__webglMultisampledFramebuffer);for(let st=0;st<$e.length;st++){const de=$e[st];De.__webglColorRenderbuffer[st]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,De.__webglColorRenderbuffer[st]);const ke=s.convert(de.format,de.colorSpace),Ve=s.convert(de.type),Ct=N(de.internalFormat,ke,Ve,de.colorSpace,ce.isXRRenderTarget===!0),Tt=Ht(ce);t.renderbufferStorageMultisample(t.RENDERBUFFER,Tt,Ct,ce.width,ce.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+st,t.RENDERBUFFER,De.__webglColorRenderbuffer[st])}t.bindRenderbuffer(t.RENDERBUFFER,null),ce.depthBuffer&&(De.__webglDepthRenderbuffer=t.createRenderbuffer(),Pe(De.__webglDepthRenderbuffer,ce,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Oe){i.bindTexture(t.TEXTURE_CUBE_MAP,He.__webglTexture),Lt(t.TEXTURE_CUBE_MAP,te,it);for(let $e=0;$e<6;$e++)if(c&&te.mipmaps&&te.mipmaps.length>0)for(let st=0;st<te.mipmaps.length;st++)Ut(De.__webglFramebuffer[$e][st],ce,te,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+$e,st);else Ut(De.__webglFramebuffer[$e],ce,te,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+$e,0);M(te,it)&&F(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Fe){const $e=ce.texture;for(let st=0,de=$e.length;st<de;st++){const ke=$e[st],Ve=n.get(ke);i.bindTexture(t.TEXTURE_2D,Ve.__webglTexture),Lt(t.TEXTURE_2D,ke,it),Ut(De.__webglFramebuffer,ce,ke,t.COLOR_ATTACHMENT0+st,t.TEXTURE_2D,0),M(ke,it)&&F(t.TEXTURE_2D)}i.unbindTexture()}else{let $e=t.TEXTURE_2D;if((ce.isWebGL3DRenderTarget||ce.isWebGLArrayRenderTarget)&&(c?$e=ce.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture($e,He.__webglTexture),Lt($e,te,it),c&&te.mipmaps&&te.mipmaps.length>0)for(let st=0;st<te.mipmaps.length;st++)Ut(De.__webglFramebuffer[st],ce,te,t.COLOR_ATTACHMENT0,$e,st);else Ut(De.__webglFramebuffer,ce,te,t.COLOR_ATTACHMENT0,$e,0);M(te,it)&&F($e),i.unbindTexture()}ce.depthBuffer&&Mt(ce)}function li(ce){const te=C(ce)||c,De=ce.isWebGLMultipleRenderTargets===!0?ce.texture:[ce.texture];for(let He=0,Oe=De.length;He<Oe;He++){const Fe=De[He];if(M(Fe,te)){const it=ce.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,$e=n.get(Fe).__webglTexture;i.bindTexture(it,$e),F(it),i.unbindTexture()}}}function Ot(ce){if(c&&ce.samples>0&&ei(ce)===!1){const te=ce.isWebGLMultipleRenderTargets?ce.texture:[ce.texture],De=ce.width,He=ce.height;let Oe=t.COLOR_BUFFER_BIT;const Fe=[],it=ce.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,$e=n.get(ce),st=ce.isWebGLMultipleRenderTargets===!0;if(st)for(let de=0;de<te.length;de++)i.bindFramebuffer(t.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+de,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,$e.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+de,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,$e.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,$e.__webglFramebuffer);for(let de=0;de<te.length;de++){Fe.push(t.COLOR_ATTACHMENT0+de),ce.depthBuffer&&Fe.push(it);const ke=$e.__ignoreDepthValues!==void 0?$e.__ignoreDepthValues:!1;if(ke===!1&&(ce.depthBuffer&&(Oe|=t.DEPTH_BUFFER_BIT),ce.stencilBuffer&&(Oe|=t.STENCIL_BUFFER_BIT)),st&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,$e.__webglColorRenderbuffer[de]),ke===!0&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[it]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[it])),st){const Ve=n.get(te[de]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Ve,0)}t.blitFramebuffer(0,0,De,He,0,0,De,He,Oe,t.NEAREST),y&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Fe)}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),st)for(let de=0;de<te.length;de++){i.bindFramebuffer(t.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+de,t.RENDERBUFFER,$e.__webglColorRenderbuffer[de]);const ke=n.get(te[de]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,$e.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+de,t.TEXTURE_2D,ke,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,$e.__webglMultisampledFramebuffer)}}function Ht(ce){return Math.min(g,ce.samples)}function ei(ce){const te=n.get(ce);return c&&ce.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&te.__useRenderToTexture!==!1}function Ci(ce){const te=o.render.frame;x.get(ce)!==te&&(x.set(ce,te),ce.update())}function yi(ce,te){const De=ce.colorSpace,He=ce.format,Oe=ce.type;return ce.isCompressedTexture===!0||ce.isVideoTexture===!0||ce.format===Mu||De!==fs&&De!==fr&&(xi.getTransfer(De)===Ai?c===!1?e.has("EXT_sRGB")===!0&&He===Ar?(ce.format=Mu,ce.minFilter=Hn,ce.generateMipmaps=!1):te=_v.sRGBToLinear(te):(He!==Ar||Oe!==Ls)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",De)),te}this.allocateTextureUnit=xe,this.resetTextureUnits=ue,this.setTexture2D=ye,this.setTexture2DArray=ge,this.setTexture3D=Te,this.setTextureCube=rt,this.rebindTextures=xt,this.setupRenderTarget=Bt,this.updateRenderTargetMipmap=li,this.updateMultisampleRenderTarget=Ot,this.setupDepthRenderbuffer=Mt,this.setupFrameBufferTexture=Ut,this.useMultisampledRTT=ei}function DM(t,e,i){const n=i.isWebGL2;function r(s,o=fr){let c;const h=xi.getTransfer(o);if(s===Ls)return t.UNSIGNED_BYTE;if(s===uv)return t.UNSIGNED_SHORT_4_4_4_4;if(s===hv)return t.UNSIGNED_SHORT_5_5_5_1;if(s===uC)return t.BYTE;if(s===hC)return t.SHORT;if(s===Qu)return t.UNSIGNED_SHORT;if(s===dv)return t.INT;if(s===Ms)return t.UNSIGNED_INT;if(s===As)return t.FLOAT;if(s===ec)return n?t.HALF_FLOAT:(c=e.get("OES_texture_half_float"),c!==null?c.HALF_FLOAT_OES:null);if(s===pC)return t.ALPHA;if(s===Ar)return t.RGBA;if(s===fC)return t.LUMINANCE;if(s===mC)return t.LUMINANCE_ALPHA;if(s===la)return t.DEPTH_COMPONENT;if(s===so)return t.DEPTH_STENCIL;if(s===Mu)return c=e.get("EXT_sRGB"),c!==null?c.SRGB_ALPHA_EXT:null;if(s===gC)return t.RED;if(s===pv)return t.RED_INTEGER;if(s===vC)return t.RG;if(s===fv)return t.RG_INTEGER;if(s===mv)return t.RGBA_INTEGER;if(s===Pd||s===Md||s===Ad||s===Dd)if(h===Ai)if(c=e.get("WEBGL_compressed_texture_s3tc_srgb"),c!==null){if(s===Pd)return c.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Md)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Ad)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===Dd)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(c=e.get("WEBGL_compressed_texture_s3tc"),c!==null){if(s===Pd)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Md)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Ad)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Dd)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===wp||s===xp||s===Ep||s===Cp)if(c=e.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(s===wp)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===xp)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Ep)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Cp)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===_C)return c=e.get("WEBGL_compressed_texture_etc1"),c!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Tp||s===Rp)if(c=e.get("WEBGL_compressed_texture_etc"),c!==null){if(s===Tp)return h===Ai?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(s===Rp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===Pp||s===Mp||s===Ap||s===Dp||s===Ip||s===Lp||s===Fp||s===kp||s===Np||s===Op||s===Up||s===Bp||s===Hp||s===jp)if(c=e.get("WEBGL_compressed_texture_astc"),c!==null){if(s===Pp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===Mp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===Ap)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Dp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Ip)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===Lp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===Fp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===kp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===Np)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Op)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===Up)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===Bp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===Hp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===jp)return h===Ai?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Id||s===Vp||s===zp)if(c=e.get("EXT_texture_compression_bptc"),c!==null){if(s===Id)return h===Ai?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===Vp)return c.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===zp)return c.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===bC||s===Gp||s===qp||s===Wp)if(c=e.get("EXT_texture_compression_rgtc"),c!==null){if(s===Id)return c.COMPRESSED_RED_RGTC1_EXT;if(s===Gp)return c.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===qp)return c.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===Wp)return c.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===ca?n?t.UNSIGNED_INT_24_8:(c=e.get("WEBGL_depth_texture"),c!==null?c.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:r}}class IM extends pr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Kc extends sr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const LM={type:"move"};class tu{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Kc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Kc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ie,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ie),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Kc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ie,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ie),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,n){let r=null,s=null,o=null;const c=this._targetRay,h=this._grip,l=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const S of e.hand.values()){const v=i.getJointPose(S,n),m=this._getHandJoint(l,S);v!==null&&(m.matrix.fromArray(v.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=v.radius),m.visible=v!==null}const p=l.joints["index-finger-tip"],g=l.joints["thumb-tip"],f=p.position.distanceTo(g.position),y=.02,x=.005;l.inputState.pinching&&f>y+x?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=y-x&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(s=i.getPose(e.gripSpace,n),s!==null&&(h.matrix.fromArray(s.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,s.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(s.linearVelocity)):h.hasLinearVelocity=!1,s.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(s.angularVelocity)):h.hasAngularVelocity=!1));c!==null&&(r=i.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(LM)))}return c!==null&&(c.visible=r!==null),h!==null&&(h.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const n=new Kc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}class FM extends zn{constructor(e,i,n,r,s,o,c,h,l,p){if(p=p!==void 0?p:la,p!==la&&p!==so)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&p===la&&(n=Ms),n===void 0&&p===so&&(n=ca),super(null,r,s,o,c,h,p,n,l),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=c!==void 0?c:Pn,this.minFilter=h!==void 0?h:Pn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class kM extends _a{constructor(e,i){super();const n=this;let r=null,s=1,o=null,c="local-floor",h=1,l=null,p=null,g=null,f=null,y=null,x=null;const S=i.getContextAttributes();let v=null,m=null;const w=[],b=[],C=new pr;C.layers.enable(1),C.viewport=new dn;const A=new pr;A.layers.enable(2),A.viewport=new dn;const M=[C,A],F=new IM;F.layers.enable(1),F.layers.enable(2);let N=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ge){let Te=w[ge];return Te===void 0&&(Te=new tu,w[ge]=Te),Te.getTargetRaySpace()},this.getControllerGrip=function(ge){let Te=w[ge];return Te===void 0&&(Te=new tu,w[ge]=Te),Te.getGripSpace()},this.getHand=function(ge){let Te=w[ge];return Te===void 0&&(Te=new tu,w[ge]=Te),Te.getHandSpace()};function j(ge){const Te=b.indexOf(ge.inputSource);if(Te===-1)return;const rt=w[Te];rt!==void 0&&(rt.update(ge.inputSource,ge.frame,l||o),rt.dispatchEvent({type:ge.type,data:ge.inputSource}))}function K(){r.removeEventListener("select",j),r.removeEventListener("selectstart",j),r.removeEventListener("selectend",j),r.removeEventListener("squeeze",j),r.removeEventListener("squeezestart",j),r.removeEventListener("squeezeend",j),r.removeEventListener("end",K),r.removeEventListener("inputsourceschange",X);for(let ge=0;ge<w.length;ge++){const Te=b[ge];Te!==null&&(b[ge]=null,w[ge].disconnect(Te))}N=null,P=null,e.setRenderTarget(v),y=null,f=null,g=null,r=null,m=null,ye.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ge){s=ge,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ge){c=ge,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(ge){l=ge},this.getBaseLayer=function(){return f!==null?f:y},this.getBinding=function(){return g},this.getFrame=function(){return x},this.getSession=function(){return r},this.setSession=async function(ge){if(r=ge,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",j),r.addEventListener("selectstart",j),r.addEventListener("selectend",j),r.addEventListener("squeeze",j),r.addEventListener("squeezestart",j),r.addEventListener("squeezeend",j),r.addEventListener("end",K),r.addEventListener("inputsourceschange",X),S.xrCompatible!==!0&&await i.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Te={antialias:r.renderState.layers===void 0?S.antialias:!0,alpha:!0,depth:S.depth,stencil:S.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(r,i,Te),r.updateRenderState({baseLayer:y}),m=new fa(y.framebufferWidth,y.framebufferHeight,{format:Ar,type:Ls,colorSpace:e.outputColorSpace,stencilBuffer:S.stencil})}else{let Te=null,rt=null,et=null;S.depth&&(et=S.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,Te=S.stencil?so:la,rt=S.stencil?ca:Ms);const tt={colorFormat:i.RGBA8,depthFormat:et,scaleFactor:s};g=new XRWebGLBinding(r,i),f=g.createProjectionLayer(tt),r.updateRenderState({layers:[f]}),m=new fa(f.textureWidth,f.textureHeight,{format:Ar,type:Ls,depthTexture:new FM(f.textureWidth,f.textureHeight,rt,void 0,void 0,void 0,void 0,void 0,void 0,Te),stencilBuffer:S.stencil,colorSpace:e.outputColorSpace,samples:S.antialias?4:0});const gt=e.properties.get(m);gt.__ignoreDepthValues=f.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(h),l=null,o=await r.requestReferenceSpace(c),ye.setContext(r),ye.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function X(ge){for(let Te=0;Te<ge.removed.length;Te++){const rt=ge.removed[Te],et=b.indexOf(rt);et>=0&&(b[et]=null,w[et].disconnect(rt))}for(let Te=0;Te<ge.added.length;Te++){const rt=ge.added[Te];let et=b.indexOf(rt);if(et===-1){for(let gt=0;gt<w.length;gt++)if(gt>=b.length){b.push(rt),et=gt;break}else if(b[gt]===null){b[gt]=rt,et=gt;break}if(et===-1)break}const tt=w[et];tt&&tt.connect(rt)}}const ie=new Ie,q=new Ie;function ae(ge,Te,rt){ie.setFromMatrixPosition(Te.matrixWorld),q.setFromMatrixPosition(rt.matrixWorld);const et=ie.distanceTo(q),tt=Te.projectionMatrix.elements,gt=rt.projectionMatrix.elements,Lt=tt[14]/(tt[10]-1),St=tt[14]/(tt[10]+1),Kt=(tt[9]+1)/tt[5],Ei=(tt[9]-1)/tt[5],Ut=(tt[8]-1)/tt[0],Pe=(gt[8]+1)/gt[0],_i=Lt*Ut,Mt=Lt*Pe,xt=et/(-Ut+Pe),Bt=xt*-Ut;Te.matrixWorld.decompose(ge.position,ge.quaternion,ge.scale),ge.translateX(Bt),ge.translateZ(xt),ge.matrixWorld.compose(ge.position,ge.quaternion,ge.scale),ge.matrixWorldInverse.copy(ge.matrixWorld).invert();const li=Lt+xt,Ot=St+xt,Ht=_i-Bt,ei=Mt+(et-Bt),Ci=Kt*St/Ot*li,yi=Ei*St/Ot*li;ge.projectionMatrix.makePerspective(Ht,ei,Ci,yi,li,Ot),ge.projectionMatrixInverse.copy(ge.projectionMatrix).invert()}function pe(ge,Te){Te===null?ge.matrixWorld.copy(ge.matrix):ge.matrixWorld.multiplyMatrices(Te.matrixWorld,ge.matrix),ge.matrixWorldInverse.copy(ge.matrixWorld).invert()}this.updateCamera=function(ge){if(r===null)return;F.near=A.near=C.near=ge.near,F.far=A.far=C.far=ge.far,(N!==F.near||P!==F.far)&&(r.updateRenderState({depthNear:F.near,depthFar:F.far}),N=F.near,P=F.far);const Te=ge.parent,rt=F.cameras;pe(F,Te);for(let et=0;et<rt.length;et++)pe(rt[et],Te);rt.length===2?ae(F,C,A):F.projectionMatrix.copy(C.projectionMatrix),ue(ge,F,Te)};function ue(ge,Te,rt){rt===null?ge.matrix.copy(Te.matrixWorld):(ge.matrix.copy(rt.matrixWorld),ge.matrix.invert(),ge.matrix.multiply(Te.matrixWorld)),ge.matrix.decompose(ge.position,ge.quaternion,ge.scale),ge.updateMatrixWorld(!0),ge.projectionMatrix.copy(Te.projectionMatrix),ge.projectionMatrixInverse.copy(Te.projectionMatrixInverse),ge.isPerspectiveCamera&&(ge.fov=Au*2*Math.atan(1/ge.projectionMatrix.elements[5]),ge.zoom=1)}this.getCamera=function(){return F},this.getFoveation=function(){if(!(f===null&&y===null))return h},this.setFoveation=function(ge){h=ge,f!==null&&(f.fixedFoveation=ge),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=ge)};let xe=null;function Ee(ge,Te){if(p=Te.getViewerPose(l||o),x=Te,p!==null){const rt=p.views;y!==null&&(e.setRenderTargetFramebuffer(m,y.framebuffer),e.setRenderTarget(m));let et=!1;rt.length!==F.cameras.length&&(F.cameras.length=0,et=!0);for(let tt=0;tt<rt.length;tt++){const gt=rt[tt];let Lt=null;if(y!==null)Lt=y.getViewport(gt);else{const Kt=g.getViewSubImage(f,gt);Lt=Kt.viewport,tt===0&&(e.setRenderTargetTextures(m,Kt.colorTexture,f.ignoreDepthValues?void 0:Kt.depthStencilTexture),e.setRenderTarget(m))}let St=M[tt];St===void 0&&(St=new pr,St.layers.enable(tt),St.viewport=new dn,M[tt]=St),St.matrix.fromArray(gt.transform.matrix),St.matrix.decompose(St.position,St.quaternion,St.scale),St.projectionMatrix.fromArray(gt.projectionMatrix),St.projectionMatrixInverse.copy(St.projectionMatrix).invert(),St.viewport.set(Lt.x,Lt.y,Lt.width,Lt.height),tt===0&&(F.matrix.copy(St.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale)),et===!0&&F.cameras.push(St)}}for(let rt=0;rt<w.length;rt++){const et=b[rt],tt=w[rt];et!==null&&tt!==void 0&&tt.update(et,Te,l||o)}xe&&xe(ge,Te),Te.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Te}),x=null}const ye=new Av;ye.setAnimationLoop(Ee),this.setAnimationLoop=function(ge){xe=ge},this.dispose=function(){}}}function NM(t,e){function i(v,m){v.matrixAutoUpdate===!0&&v.updateMatrix(),m.value.copy(v.matrix)}function n(v,m){m.color.getRGB(v.fogColor.value,Tv(t)),m.isFog?(v.fogNear.value=m.near,v.fogFar.value=m.far):m.isFogExp2&&(v.fogDensity.value=m.density)}function r(v,m,w,b,C){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(v,m):m.isMeshToonMaterial?(s(v,m),g(v,m)):m.isMeshPhongMaterial?(s(v,m),p(v,m)):m.isMeshStandardMaterial?(s(v,m),f(v,m),m.isMeshPhysicalMaterial&&y(v,m,C)):m.isMeshMatcapMaterial?(s(v,m),x(v,m)):m.isMeshDepthMaterial?s(v,m):m.isMeshDistanceMaterial?(s(v,m),S(v,m)):m.isMeshNormalMaterial?s(v,m):m.isLineBasicMaterial?(o(v,m),m.isLineDashedMaterial&&c(v,m)):m.isPointsMaterial?h(v,m,w,b):m.isSpriteMaterial?l(v,m):m.isShadowMaterial?(v.color.value.copy(m.color),v.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(v,m){v.opacity.value=m.opacity,m.color&&v.diffuse.value.copy(m.color),m.emissive&&v.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(v.map.value=m.map,i(m.map,v.mapTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,i(m.alphaMap,v.alphaMapTransform)),m.bumpMap&&(v.bumpMap.value=m.bumpMap,i(m.bumpMap,v.bumpMapTransform),v.bumpScale.value=m.bumpScale,m.side===Vn&&(v.bumpScale.value*=-1)),m.normalMap&&(v.normalMap.value=m.normalMap,i(m.normalMap,v.normalMapTransform),v.normalScale.value.copy(m.normalScale),m.side===Vn&&v.normalScale.value.negate()),m.displacementMap&&(v.displacementMap.value=m.displacementMap,i(m.displacementMap,v.displacementMapTransform),v.displacementScale.value=m.displacementScale,v.displacementBias.value=m.displacementBias),m.emissiveMap&&(v.emissiveMap.value=m.emissiveMap,i(m.emissiveMap,v.emissiveMapTransform)),m.specularMap&&(v.specularMap.value=m.specularMap,i(m.specularMap,v.specularMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);const w=e.get(m).envMap;if(w&&(v.envMap.value=w,v.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=m.reflectivity,v.ior.value=m.ior,v.refractionRatio.value=m.refractionRatio),m.lightMap){v.lightMap.value=m.lightMap;const b=t._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=m.lightMapIntensity*b,i(m.lightMap,v.lightMapTransform)}m.aoMap&&(v.aoMap.value=m.aoMap,v.aoMapIntensity.value=m.aoMapIntensity,i(m.aoMap,v.aoMapTransform))}function o(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,m.map&&(v.map.value=m.map,i(m.map,v.mapTransform))}function c(v,m){v.dashSize.value=m.dashSize,v.totalSize.value=m.dashSize+m.gapSize,v.scale.value=m.scale}function h(v,m,w,b){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.size.value=m.size*w,v.scale.value=b*.5,m.map&&(v.map.value=m.map,i(m.map,v.uvTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,i(m.alphaMap,v.alphaMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest)}function l(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.rotation.value=m.rotation,m.map&&(v.map.value=m.map,i(m.map,v.mapTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,i(m.alphaMap,v.alphaMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest)}function p(v,m){v.specular.value.copy(m.specular),v.shininess.value=Math.max(m.shininess,1e-4)}function g(v,m){m.gradientMap&&(v.gradientMap.value=m.gradientMap)}function f(v,m){v.metalness.value=m.metalness,m.metalnessMap&&(v.metalnessMap.value=m.metalnessMap,i(m.metalnessMap,v.metalnessMapTransform)),v.roughness.value=m.roughness,m.roughnessMap&&(v.roughnessMap.value=m.roughnessMap,i(m.roughnessMap,v.roughnessMapTransform)),e.get(m).envMap&&(v.envMapIntensity.value=m.envMapIntensity)}function y(v,m,w){v.ior.value=m.ior,m.sheen>0&&(v.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),v.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(v.sheenColorMap.value=m.sheenColorMap,i(m.sheenColorMap,v.sheenColorMapTransform)),m.sheenRoughnessMap&&(v.sheenRoughnessMap.value=m.sheenRoughnessMap,i(m.sheenRoughnessMap,v.sheenRoughnessMapTransform))),m.clearcoat>0&&(v.clearcoat.value=m.clearcoat,v.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(v.clearcoatMap.value=m.clearcoatMap,i(m.clearcoatMap,v.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,i(m.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(v.clearcoatNormalMap.value=m.clearcoatNormalMap,i(m.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===Vn&&v.clearcoatNormalScale.value.negate())),m.iridescence>0&&(v.iridescence.value=m.iridescence,v.iridescenceIOR.value=m.iridescenceIOR,v.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(v.iridescenceMap.value=m.iridescenceMap,i(m.iridescenceMap,v.iridescenceMapTransform)),m.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=m.iridescenceThicknessMap,i(m.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),m.transmission>0&&(v.transmission.value=m.transmission,v.transmissionSamplerMap.value=w.texture,v.transmissionSamplerSize.value.set(w.width,w.height),m.transmissionMap&&(v.transmissionMap.value=m.transmissionMap,i(m.transmissionMap,v.transmissionMapTransform)),v.thickness.value=m.thickness,m.thicknessMap&&(v.thicknessMap.value=m.thicknessMap,i(m.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=m.attenuationDistance,v.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(v.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(v.anisotropyMap.value=m.anisotropyMap,i(m.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=m.specularIntensity,v.specularColor.value.copy(m.specularColor),m.specularColorMap&&(v.specularColorMap.value=m.specularColorMap,i(m.specularColorMap,v.specularColorMapTransform)),m.specularIntensityMap&&(v.specularIntensityMap.value=m.specularIntensityMap,i(m.specularIntensityMap,v.specularIntensityMapTransform))}function x(v,m){m.matcap&&(v.matcap.value=m.matcap)}function S(v,m){const w=e.get(m).light;v.referencePosition.value.setFromMatrixPosition(w.matrixWorld),v.nearDistance.value=w.shadow.camera.near,v.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function OM(t,e,i,n){let r={},s={},o=[];const c=i.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function h(w,b){const C=b.program;n.uniformBlockBinding(w,C)}function l(w,b){let C=r[w.id];C===void 0&&(x(w),C=p(w),r[w.id]=C,w.addEventListener("dispose",v));const A=b.program;n.updateUBOMapping(w,A);const M=e.render.frame;s[w.id]!==M&&(f(w),s[w.id]=M)}function p(w){const b=g();w.__bindingPointIndex=b;const C=t.createBuffer(),A=w.__size,M=w.usage;return t.bindBuffer(t.UNIFORM_BUFFER,C),t.bufferData(t.UNIFORM_BUFFER,A,M),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,b,C),C}function g(){for(let w=0;w<c;w++)if(o.indexOf(w)===-1)return o.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(w){const b=r[w.id],C=w.uniforms,A=w.__cache;t.bindBuffer(t.UNIFORM_BUFFER,b);for(let M=0,F=C.length;M<F;M++){const N=C[M];if(y(N,M,A)===!0){const P=N.__offset,j=Array.isArray(N.value)?N.value:[N.value];let K=0;for(let X=0;X<j.length;X++){const ie=j[X],q=S(ie);typeof ie=="number"?(N.__data[0]=ie,t.bufferSubData(t.UNIFORM_BUFFER,P+K,N.__data)):ie.isMatrix3?(N.__data[0]=ie.elements[0],N.__data[1]=ie.elements[1],N.__data[2]=ie.elements[2],N.__data[3]=ie.elements[0],N.__data[4]=ie.elements[3],N.__data[5]=ie.elements[4],N.__data[6]=ie.elements[5],N.__data[7]=ie.elements[0],N.__data[8]=ie.elements[6],N.__data[9]=ie.elements[7],N.__data[10]=ie.elements[8],N.__data[11]=ie.elements[0]):(ie.toArray(N.__data,K),K+=q.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,P,N.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function y(w,b,C){const A=w.value;if(C[b]===void 0){if(typeof A=="number")C[b]=A;else{const M=Array.isArray(A)?A:[A],F=[];for(let N=0;N<M.length;N++)F.push(M[N].clone());C[b]=F}return!0}else if(typeof A=="number"){if(C[b]!==A)return C[b]=A,!0}else{const M=Array.isArray(C[b])?C[b]:[C[b]],F=Array.isArray(A)?A:[A];for(let N=0;N<M.length;N++){const P=M[N];if(P.equals(F[N])===!1)return P.copy(F[N]),!0}}return!1}function x(w){const b=w.uniforms;let C=0;const A=16;let M=0;for(let F=0,N=b.length;F<N;F++){const P=b[F],j={boundary:0,storage:0},K=Array.isArray(P.value)?P.value:[P.value];for(let X=0,ie=K.length;X<ie;X++){const q=K[X],ae=S(q);j.boundary+=ae.boundary,j.storage+=ae.storage}if(P.__data=new Float32Array(j.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=C,F>0){M=C%A;const X=A-M;M!==0&&X-j.boundary<0&&(C+=A-M,P.__offset=C)}C+=j.storage}return M=C%A,M>0&&(C+=A-M),w.__size=C,w.__cache={},this}function S(w){const b={boundary:0,storage:0};return typeof w=="number"?(b.boundary=4,b.storage=4):w.isVector2?(b.boundary=8,b.storage=8):w.isVector3||w.isColor?(b.boundary=16,b.storage=12):w.isVector4?(b.boundary=16,b.storage=16):w.isMatrix3?(b.boundary=48,b.storage=48):w.isMatrix4?(b.boundary=64,b.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),b}function v(w){const b=w.target;b.removeEventListener("dispose",v);const C=o.indexOf(b.__bindingPointIndex);o.splice(C,1),t.deleteBuffer(r[b.id]),delete r[b.id],delete s[b.id]}function m(){for(const w in r)t.deleteBuffer(r[w]);o=[],r={},s={}}return{bind:h,update:l,dispose:m}}class kv{constructor(e={}){const{canvas:i=kC(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:c=!1,premultipliedAlpha:h=!0,preserveDrawingBuffer:l=!1,powerPreference:p="default",failIfMajorPerformanceCaveat:g=!1}=e;this.isWebGLRenderer=!0;let f;n!==null?f=n.getContextAttributes().alpha:f=o;const y=new Uint32Array(4),x=new Int32Array(4);let S=null,v=null;const m=[],w=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ln,this._useLegacyLights=!1,this.toneMapping=Is,this.toneMappingExposure=1;const b=this;let C=!1,A=0,M=0,F=null,N=-1,P=null;const j=new dn,K=new dn;let X=null;const ie=new Di(0);let q=0,ae=i.width,pe=i.height,ue=1,xe=null,Ee=null;const ye=new dn(0,0,ae,pe),ge=new dn(0,0,ae,pe);let Te=!1;const rt=new Mv;let et=!1,tt=!1,gt=null;const Lt=new un,St=new si,Kt=new Ie,Ei={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ut(){return F===null?ue:1}let Pe=n;function _i(oe,Me){for(let Ue=0;Ue<oe.length;Ue++){const Ae=oe[Ue],Be=i.getContext(Ae,Me);if(Be!==null)return Be}return null}try{const oe={alpha:!0,depth:r,stencil:s,antialias:c,premultipliedAlpha:h,preserveDrawingBuffer:l,powerPreference:p,failIfMajorPerformanceCaveat:g};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${Ju}`),i.addEventListener("webglcontextlost",nt,!1),i.addEventListener("webglcontextrestored",Je,!1),i.addEventListener("webglcontextcreationerror",ct,!1),Pe===null){const Me=["webgl2","webgl","experimental-webgl"];if(b.isWebGL1Renderer===!0&&Me.shift(),Pe=_i(Me,oe),Pe===null)throw _i(Me)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Pe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Pe.getShaderPrecisionFormat===void 0&&(Pe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(oe){throw console.error("THREE.WebGLRenderer: "+oe.message),oe}let Mt,xt,Bt,li,Ot,Ht,ei,Ci,yi,ce,te,De,He,Oe,Fe,it,$e,st,de,ke,Ve,Ct,Tt,At;function wt(){Mt=new XP(Pe),xt=new jP(Pe,Mt,e),Mt.init(xt),Ct=new DM(Pe,Mt,xt),Bt=new MM(Pe,Mt,xt),li=new YP(Pe),Ot=new mM,Ht=new AM(Pe,Mt,Bt,Ot,xt,Ct,li),ei=new zP(b),Ci=new KP(b),yi=new aT(Pe,xt),Tt=new BP(Pe,Mt,yi,xt),ce=new $P(Pe,yi,li,Tt),te=new t2(Pe,ce,yi,li),de=new e2(Pe,xt,Ht),it=new VP(Ot),De=new fM(b,ei,Ci,Mt,xt,Tt,it),He=new NM(b,Ot),Oe=new vM,Fe=new xM(Mt,xt),st=new UP(b,ei,Ci,Bt,te,f,h),$e=new PM(b,te,xt),At=new OM(Pe,li,xt,Bt),ke=new HP(Pe,Mt,li,xt),Ve=new ZP(Pe,Mt,li,xt),li.programs=De.programs,b.capabilities=xt,b.extensions=Mt,b.properties=Ot,b.renderLists=Oe,b.shadowMap=$e,b.state=Bt,b.info=li}wt();const he=new kM(b,Pe);this.xr=he,this.getContext=function(){return Pe},this.getContextAttributes=function(){return Pe.getContextAttributes()},this.forceContextLoss=function(){const oe=Mt.get("WEBGL_lose_context");oe&&oe.loseContext()},this.forceContextRestore=function(){const oe=Mt.get("WEBGL_lose_context");oe&&oe.restoreContext()},this.getPixelRatio=function(){return ue},this.setPixelRatio=function(oe){oe!==void 0&&(ue=oe,this.setSize(ae,pe,!1))},this.getSize=function(oe){return oe.set(ae,pe)},this.setSize=function(oe,Me,Ue=!0){if(he.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ae=oe,pe=Me,i.width=Math.floor(oe*ue),i.height=Math.floor(Me*ue),Ue===!0&&(i.style.width=oe+"px",i.style.height=Me+"px"),this.setViewport(0,0,oe,Me)},this.getDrawingBufferSize=function(oe){return oe.set(ae*ue,pe*ue).floor()},this.setDrawingBufferSize=function(oe,Me,Ue){ae=oe,pe=Me,ue=Ue,i.width=Math.floor(oe*Ue),i.height=Math.floor(Me*Ue),this.setViewport(0,0,oe,Me)},this.getCurrentViewport=function(oe){return oe.copy(j)},this.getViewport=function(oe){return oe.copy(ye)},this.setViewport=function(oe,Me,Ue,Ae){oe.isVector4?ye.set(oe.x,oe.y,oe.z,oe.w):ye.set(oe,Me,Ue,Ae),Bt.viewport(j.copy(ye).multiplyScalar(ue).floor())},this.getScissor=function(oe){return oe.copy(ge)},this.setScissor=function(oe,Me,Ue,Ae){oe.isVector4?ge.set(oe.x,oe.y,oe.z,oe.w):ge.set(oe,Me,Ue,Ae),Bt.scissor(K.copy(ge).multiplyScalar(ue).floor())},this.getScissorTest=function(){return Te},this.setScissorTest=function(oe){Bt.setScissorTest(Te=oe)},this.setOpaqueSort=function(oe){xe=oe},this.setTransparentSort=function(oe){Ee=oe},this.getClearColor=function(oe){return oe.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(oe=!0,Me=!0,Ue=!0){let Ae=0;if(oe){let Be=!1;if(F!==null){const vt=F.texture.format;Be=vt===mv||vt===fv||vt===pv}if(Be){const vt=F.texture.type,Ft=vt===Ls||vt===Ms||vt===Qu||vt===ca||vt===uv||vt===hv,Et=st.getClearColor(),kt=st.getClearAlpha(),Xt=Et.r,Le=Et.g,Xe=Et.b;Ft?(y[0]=Xt,y[1]=Le,y[2]=Xe,y[3]=kt,Pe.clearBufferuiv(Pe.COLOR,0,y)):(x[0]=Xt,x[1]=Le,x[2]=Xe,x[3]=kt,Pe.clearBufferiv(Pe.COLOR,0,x))}else Ae|=Pe.COLOR_BUFFER_BIT}Me&&(Ae|=Pe.DEPTH_BUFFER_BIT),Ue&&(Ae|=Pe.STENCIL_BUFFER_BIT),Pe.clear(Ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",nt,!1),i.removeEventListener("webglcontextrestored",Je,!1),i.removeEventListener("webglcontextcreationerror",ct,!1),Oe.dispose(),Fe.dispose(),Ot.dispose(),ei.dispose(),Ci.dispose(),te.dispose(),Tt.dispose(),At.dispose(),De.dispose(),he.dispose(),he.removeEventListener("sessionstart",hi),he.removeEventListener("sessionend",pn),gt&&(gt.dispose(),gt=null),Ui.stop()};function nt(oe){oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Je(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const oe=li.autoReset,Me=$e.enabled,Ue=$e.autoUpdate,Ae=$e.needsUpdate,Be=$e.type;wt(),li.autoReset=oe,$e.enabled=Me,$e.autoUpdate=Ue,$e.needsUpdate=Ae,$e.type=Be}function ct(oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",oe.statusMessage)}function ot(oe){const Me=oe.target;Me.removeEventListener("dispose",ot),Ke(Me)}function Ke(oe){lt(oe),Ot.remove(oe)}function lt(oe){const Me=Ot.get(oe).programs;Me!==void 0&&(Me.forEach(function(Ue){De.releaseProgram(Ue)}),oe.isShaderMaterial&&De.releaseShaderCache(oe))}this.renderBufferDirect=function(oe,Me,Ue,Ae,Be,vt){Me===null&&(Me=Ei);const Ft=Be.isMesh&&Be.matrixWorld.determinant()<0,Et=Jr(oe,Me,Ue,Ae,Be);Bt.setMaterial(Ae,Ft);let kt=Ue.index,Xt=1;if(Ae.wireframe===!0){if(kt=ce.getWireframeAttribute(Ue),kt===void 0)return;Xt=2}const Le=Ue.drawRange,Xe=Ue.attributes.position;let at=Le.start*Xt,Nt=(Le.start+Le.count)*Xt;vt!==null&&(at=Math.max(at,vt.start*Xt),Nt=Math.min(Nt,(vt.start+vt.count)*Xt)),kt!==null?(at=Math.max(at,0),Nt=Math.min(Nt,kt.count)):Xe!=null&&(at=Math.max(at,0),Nt=Math.min(Nt,Xe.count));const _t=Nt-at;if(_t<0||_t===1/0)return;Tt.setup(Be,Ae,Et,Ue,kt);let ni,ut=ke;if(kt!==null&&(ni=yi.get(kt),ut=Ve,ut.setIndex(ni)),Be.isMesh)Ae.wireframe===!0?(Bt.setLineWidth(Ae.wireframeLinewidth*Ut()),ut.setMode(Pe.LINES)):ut.setMode(Pe.TRIANGLES);else if(Be.isLine){let bt=Ae.linewidth;bt===void 0&&(bt=1),Bt.setLineWidth(bt*Ut()),Be.isLineSegments?ut.setMode(Pe.LINES):Be.isLineLoop?ut.setMode(Pe.LINE_LOOP):ut.setMode(Pe.LINE_STRIP)}else Be.isPoints?ut.setMode(Pe.POINTS):Be.isSprite&&ut.setMode(Pe.TRIANGLES);if(Be.isInstancedMesh)ut.renderInstances(at,_t,Be.count);else if(Ue.isInstancedBufferGeometry){const bt=Ue._maxInstanceCount!==void 0?Ue._maxInstanceCount:1/0,Wt=Math.min(Ue.instanceCount,bt);ut.renderInstances(at,_t,Wt)}else ut.render(at,_t)},this.compile=function(oe,Me){function Ue(Ae,Be,vt){Ae.transparent===!0&&Ae.side===ds&&Ae.forceSinglePass===!1?(Ae.side=Vn,Ae.needsUpdate=!0,Xn(Ae,Be,vt),Ae.side=Us,Ae.needsUpdate=!0,Xn(Ae,Be,vt),Ae.side=ds):Xn(Ae,Be,vt)}v=Fe.get(oe),v.init(),w.push(v),oe.traverseVisible(function(Ae){Ae.isLight&&Ae.layers.test(Me.layers)&&(v.pushLight(Ae),Ae.castShadow&&v.pushShadow(Ae))}),v.setupLights(b._useLegacyLights),oe.traverse(function(Ae){const Be=Ae.material;if(Be)if(Array.isArray(Be))for(let vt=0;vt<Be.length;vt++){const Ft=Be[vt];Ue(Ft,oe,Ae)}else Ue(Be,oe,Ae)}),w.pop(),v=null};let It=null;function Ii(oe){It&&It(oe)}function hi(){Ui.stop()}function pn(){Ui.start()}const Ui=new Av;Ui.setAnimationLoop(Ii),typeof self<"u"&&Ui.setContext(self),this.setAnimationLoop=function(oe){It=oe,he.setAnimationLoop(oe),oe===null?Ui.stop():Ui.start()},he.addEventListener("sessionstart",hi),he.addEventListener("sessionend",pn),this.render=function(oe,Me){if(Me!==void 0&&Me.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),Me.parent===null&&Me.matrixWorldAutoUpdate===!0&&Me.updateMatrixWorld(),he.enabled===!0&&he.isPresenting===!0&&(he.cameraAutoUpdate===!0&&he.updateCamera(Me),Me=he.getCamera()),oe.isScene===!0&&oe.onBeforeRender(b,oe,Me,F),v=Fe.get(oe,w.length),v.init(),w.push(v),Lt.multiplyMatrices(Me.projectionMatrix,Me.matrixWorldInverse),rt.setFromProjectionMatrix(Lt),tt=this.localClippingEnabled,et=it.init(this.clippingPlanes,tt),S=Oe.get(oe,m.length),S.init(),m.push(S),gr(oe,Me,0,b.sortObjects),S.finish(),b.sortObjects===!0&&S.sort(xe,Ee),this.info.render.frame++,et===!0&&it.beginShadows();const Ue=v.state.shadowsArray;if($e.render(Ue,oe,Me),et===!0&&it.endShadows(),this.info.autoReset===!0&&this.info.reset(),st.render(S,oe),v.setupLights(b._useLegacyLights),Me.isArrayCamera){const Ae=Me.cameras;for(let Be=0,vt=Ae.length;Be<vt;Be++){const Ft=Ae[Be];gs(S,oe,Ft,Ft.viewport)}}else gs(S,oe,Me);F!==null&&(Ht.updateMultisampleRenderTarget(F),Ht.updateRenderTargetMipmap(F)),oe.isScene===!0&&oe.onAfterRender(b,oe,Me),Tt.resetDefaultState(),N=-1,P=null,w.pop(),w.length>0?v=w[w.length-1]:v=null,m.pop(),m.length>0?S=m[m.length-1]:S=null};function gr(oe,Me,Ue,Ae){if(oe.visible===!1)return;if(oe.layers.test(Me.layers)){if(oe.isGroup)Ue=oe.renderOrder;else if(oe.isLOD)oe.autoUpdate===!0&&oe.update(Me);else if(oe.isLight)v.pushLight(oe),oe.castShadow&&v.pushShadow(oe);else if(oe.isSprite){if(!oe.frustumCulled||rt.intersectsSprite(oe)){Ae&&Kt.setFromMatrixPosition(oe.matrixWorld).applyMatrix4(Lt);const Ft=te.update(oe),Et=oe.material;Et.visible&&S.push(oe,Ft,Et,Ue,Kt.z,null)}}else if((oe.isMesh||oe.isLine||oe.isPoints)&&(!oe.frustumCulled||rt.intersectsObject(oe))){const Ft=te.update(oe),Et=oe.material;if(Ae&&(oe.boundingSphere!==void 0?(oe.boundingSphere===null&&oe.computeBoundingSphere(),Kt.copy(oe.boundingSphere.center)):(Ft.boundingSphere===null&&Ft.computeBoundingSphere(),Kt.copy(Ft.boundingSphere.center)),Kt.applyMatrix4(oe.matrixWorld).applyMatrix4(Lt)),Array.isArray(Et)){const kt=Ft.groups;for(let Xt=0,Le=kt.length;Xt<Le;Xt++){const Xe=kt[Xt],at=Et[Xe.materialIndex];at&&at.visible&&S.push(oe,Ft,at,Ue,Kt.z,Xe)}}else Et.visible&&S.push(oe,Ft,Et,Ue,Kt.z,null)}}const vt=oe.children;for(let Ft=0,Et=vt.length;Ft<Et;Ft++)gr(vt[Ft],Me,Ue,Ae)}function gs(oe,Me,Ue,Ae){const Be=oe.opaque,vt=oe.transmissive,Ft=oe.transparent;v.setupLightsView(Ue),et===!0&&it.setGlobalState(b.clippingPlanes,Ue),vt.length>0&&Kn(Be,vt,Me,Ue),Ae&&Bt.viewport(j.copy(Ae)),Be.length>0&&Or(Be,Me,Ue),vt.length>0&&Or(vt,Me,Ue),Ft.length>0&&Or(Ft,Me,Ue),Bt.buffers.depth.setTest(!0),Bt.buffers.depth.setMask(!0),Bt.buffers.color.setMask(!0),Bt.setPolygonOffset(!1)}function Kn(oe,Me,Ue,Ae){const Be=xt.isWebGL2;gt===null&&(gt=new fa(1,1,{generateMipmaps:!0,type:Mt.has("EXT_color_buffer_half_float")?ec:Ls,minFilter:Qo,samples:Be?4:0})),b.getDrawingBufferSize(St),Be?gt.setSize(St.x,St.y):gt.setSize(Du(St.x),Du(St.y));const vt=b.getRenderTarget();b.setRenderTarget(gt),b.getClearColor(ie),q=b.getClearAlpha(),q<1&&b.setClearColor(16777215,.5),b.clear();const Ft=b.toneMapping;b.toneMapping=Is,Or(oe,Ue,Ae),Ht.updateMultisampleRenderTarget(gt),Ht.updateRenderTargetMipmap(gt);let Et=!1;for(let kt=0,Xt=Me.length;kt<Xt;kt++){const Le=Me[kt],Xe=Le.object,at=Le.geometry,Nt=Le.material,_t=Le.group;if(Nt.side===ds&&Xe.layers.test(Ae.layers)){const ni=Nt.side;Nt.side=Vn,Nt.needsUpdate=!0,Ln(Xe,Ue,Ae,at,Nt,_t),Nt.side=ni,Nt.needsUpdate=!0,Et=!0}}Et===!0&&(Ht.updateMultisampleRenderTarget(gt),Ht.updateRenderTargetMipmap(gt)),b.setRenderTarget(vt),b.setClearColor(ie,q),b.toneMapping=Ft}function Or(oe,Me,Ue){const Ae=Me.isScene===!0?Me.overrideMaterial:null;for(let Be=0,vt=oe.length;Be<vt;Be++){const Ft=oe[Be],Et=Ft.object,kt=Ft.geometry,Xt=Ae===null?Ft.material:Ae,Le=Ft.group;Et.layers.test(Ue.layers)&&Ln(Et,Me,Ue,kt,Xt,Le)}}function Ln(oe,Me,Ue,Ae,Be,vt){oe.onBeforeRender(b,Me,Ue,Ae,Be,vt),oe.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,oe.matrixWorld),oe.normalMatrix.getNormalMatrix(oe.modelViewMatrix),Be.onBeforeRender(b,Me,Ue,Ae,oe,vt),Be.transparent===!0&&Be.side===ds&&Be.forceSinglePass===!1?(Be.side=Vn,Be.needsUpdate=!0,b.renderBufferDirect(Ue,Me,Ae,Be,oe,vt),Be.side=Us,Be.needsUpdate=!0,b.renderBufferDirect(Ue,Me,Ae,Be,oe,vt),Be.side=ds):b.renderBufferDirect(Ue,Me,Ae,Be,oe,vt),oe.onAfterRender(b,Me,Ue,Ae,Be,vt)}function Xn(oe,Me,Ue){Me.isScene!==!0&&(Me=Ei);const Ae=Ot.get(oe),Be=v.state.lights,vt=v.state.shadowsArray,Ft=Be.state.version,Et=De.getParameters(oe,Be.state,vt,Me,Ue),kt=De.getProgramCacheKey(Et);let Xt=Ae.programs;Ae.environment=oe.isMeshStandardMaterial?Me.environment:null,Ae.fog=Me.fog,Ae.envMap=(oe.isMeshStandardMaterial?Ci:ei).get(oe.envMap||Ae.environment),Xt===void 0&&(oe.addEventListener("dispose",ot),Xt=new Map,Ae.programs=Xt);let Le=Xt.get(kt);if(Le!==void 0){if(Ae.currentProgram===Le&&Ae.lightsStateVersion===Ft)return Ur(oe,Et),Le}else Et.uniforms=De.getUniforms(oe),oe.onBuild(Ue,Et,b),oe.onBeforeCompile(Et,b),Le=De.acquireProgram(Et,kt),Xt.set(kt,Le),Ae.uniforms=Et.uniforms;const Xe=Ae.uniforms;(!oe.isShaderMaterial&&!oe.isRawShaderMaterial||oe.clipping===!0)&&(Xe.clippingPlanes=it.uniform),Ur(oe,Et),Ae.needsLights=or(oe),Ae.lightsStateVersion=Ft,Ae.needsLights&&(Xe.ambientLightColor.value=Be.state.ambient,Xe.lightProbe.value=Be.state.probe,Xe.directionalLights.value=Be.state.directional,Xe.directionalLightShadows.value=Be.state.directionalShadow,Xe.spotLights.value=Be.state.spot,Xe.spotLightShadows.value=Be.state.spotShadow,Xe.rectAreaLights.value=Be.state.rectArea,Xe.ltc_1.value=Be.state.rectAreaLTC1,Xe.ltc_2.value=Be.state.rectAreaLTC2,Xe.pointLights.value=Be.state.point,Xe.pointLightShadows.value=Be.state.pointShadow,Xe.hemisphereLights.value=Be.state.hemi,Xe.directionalShadowMap.value=Be.state.directionalShadowMap,Xe.directionalShadowMatrix.value=Be.state.directionalShadowMatrix,Xe.spotShadowMap.value=Be.state.spotShadowMap,Xe.spotLightMatrix.value=Be.state.spotLightMatrix,Xe.spotLightMap.value=Be.state.spotLightMap,Xe.pointShadowMap.value=Be.state.pointShadowMap,Xe.pointShadowMatrix.value=Be.state.pointShadowMatrix);const at=Le.getUniforms(),Nt=rl.seqWithValue(at.seq,Xe);return Ae.currentProgram=Le,Ae.uniformsList=Nt,Le}function Ur(oe,Me){const Ue=Ot.get(oe);Ue.outputColorSpace=Me.outputColorSpace,Ue.instancing=Me.instancing,Ue.instancingColor=Me.instancingColor,Ue.skinning=Me.skinning,Ue.morphTargets=Me.morphTargets,Ue.morphNormals=Me.morphNormals,Ue.morphColors=Me.morphColors,Ue.morphTargetsCount=Me.morphTargetsCount,Ue.numClippingPlanes=Me.numClippingPlanes,Ue.numIntersection=Me.numClipIntersection,Ue.vertexAlphas=Me.vertexAlphas,Ue.vertexTangents=Me.vertexTangents,Ue.toneMapping=Me.toneMapping}function Jr(oe,Me,Ue,Ae,Be){Me.isScene!==!0&&(Me=Ei),Ht.resetTextureUnits();const vt=Me.fog,Ft=Ae.isMeshStandardMaterial?Me.environment:null,Et=F===null?b.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:fs,kt=(Ae.isMeshStandardMaterial?Ci:ei).get(Ae.envMap||Ft),Xt=Ae.vertexColors===!0&&!!Ue.attributes.color&&Ue.attributes.color.itemSize===4,Le=!!Ue.attributes.tangent&&(!!Ae.normalMap||Ae.anisotropy>0),Xe=!!Ue.morphAttributes.position,at=!!Ue.morphAttributes.normal,Nt=!!Ue.morphAttributes.color;let _t=Is;Ae.toneMapped&&(F===null||F.isXRRenderTarget===!0)&&(_t=b.toneMapping);const ni=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,ut=ni!==void 0?ni.length:0,bt=Ot.get(Ae),Wt=v.state.lights;if(et===!0&&(tt===!0||oe!==P)){const sn=oe===P&&Ae.id===N;it.setState(Ae,oe,sn)}let $t=!1;Ae.version===bt.__version?(bt.needsLights&&bt.lightsStateVersion!==Wt.state.version||bt.outputColorSpace!==Et||Be.isInstancedMesh&&bt.instancing===!1||!Be.isInstancedMesh&&bt.instancing===!0||Be.isSkinnedMesh&&bt.skinning===!1||!Be.isSkinnedMesh&&bt.skinning===!0||Be.isInstancedMesh&&bt.instancingColor===!0&&Be.instanceColor===null||Be.isInstancedMesh&&bt.instancingColor===!1&&Be.instanceColor!==null||bt.envMap!==kt||Ae.fog===!0&&bt.fog!==vt||bt.numClippingPlanes!==void 0&&(bt.numClippingPlanes!==it.numPlanes||bt.numIntersection!==it.numIntersection)||bt.vertexAlphas!==Xt||bt.vertexTangents!==Le||bt.morphTargets!==Xe||bt.morphNormals!==at||bt.morphColors!==Nt||bt.toneMapping!==_t||xt.isWebGL2===!0&&bt.morphTargetsCount!==ut)&&($t=!0):($t=!0,bt.__version=Ae.version);let Xi=bt.currentProgram;$t===!0&&(Xi=Xn(Ae,Me,Be));let $n=!1,Zn=!1,Br=!1;const di=Xi.getUniforms(),Yn=bt.uniforms;if(Bt.useProgram(Xi.program)&&($n=!0,Zn=!0,Br=!0),Ae.id!==N&&(N=Ae.id,Zn=!0),$n||P!==oe){di.setValue(Pe,"projectionMatrix",oe.projectionMatrix),di.setValue(Pe,"viewMatrix",oe.matrixWorldInverse);const sn=di.map.cameraPosition;sn!==void 0&&sn.setValue(Pe,Kt.setFromMatrixPosition(oe.matrixWorld)),xt.logarithmicDepthBuffer&&di.setValue(Pe,"logDepthBufFC",2/(Math.log(oe.far+1)/Math.LN2)),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&di.setValue(Pe,"isOrthographic",oe.isOrthographicCamera===!0),P!==oe&&(P=oe,Zn=!0,Br=!0)}if(Be.isSkinnedMesh){di.setOptional(Pe,Be,"bindMatrix"),di.setOptional(Pe,Be,"bindMatrixInverse");const sn=Be.skeleton;sn&&(xt.floatVertexTextures?(sn.boneTexture===null&&sn.computeBoneTexture(),di.setValue(Pe,"boneTexture",sn.boneTexture,Ht),di.setValue(Pe,"boneTextureSize",sn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Qr=Ue.morphAttributes;if((Qr.position!==void 0||Qr.normal!==void 0||Qr.color!==void 0&&xt.isWebGL2===!0)&&de.update(Be,Ue,Xi),(Zn||bt.receiveShadow!==Be.receiveShadow)&&(bt.receiveShadow=Be.receiveShadow,di.setValue(Pe,"receiveShadow",Be.receiveShadow)),Ae.isMeshGouraudMaterial&&Ae.envMap!==null&&(Yn.envMap.value=kt,Yn.flipEnvMap.value=kt.isCubeTexture&&kt.isRenderTargetTexture===!1?-1:1),Zn&&(di.setValue(Pe,"toneMappingExposure",b.toneMappingExposure),bt.needsLights&&Gs(Yn,Br),vt&&Ae.fog===!0&&He.refreshFogUniforms(Yn,vt),He.refreshMaterialUniforms(Yn,Ae,ue,pe,gt),rl.upload(Pe,bt.uniformsList,Yn,Ht)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(rl.upload(Pe,bt.uniformsList,Yn,Ht),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&di.setValue(Pe,"center",Be.center),di.setValue(Pe,"modelViewMatrix",Be.modelViewMatrix),di.setValue(Pe,"normalMatrix",Be.normalMatrix),di.setValue(Pe,"modelMatrix",Be.matrixWorld),Ae.isShaderMaterial||Ae.isRawShaderMaterial){const sn=Ae.uniformsGroups;for(let Jn=0,ho=sn.length;Jn<ho;Jn++)if(xt.isWebGL2){const cc=sn[Jn];At.update(cc,Xi),At.bind(cc,Xi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Xi}function Gs(oe,Me){oe.ambientLightColor.needsUpdate=Me,oe.lightProbe.needsUpdate=Me,oe.directionalLights.needsUpdate=Me,oe.directionalLightShadows.needsUpdate=Me,oe.pointLights.needsUpdate=Me,oe.pointLightShadows.needsUpdate=Me,oe.spotLights.needsUpdate=Me,oe.spotLightShadows.needsUpdate=Me,oe.rectAreaLights.needsUpdate=Me,oe.hemisphereLights.needsUpdate=Me}function or(oe){return oe.isMeshLambertMaterial||oe.isMeshToonMaterial||oe.isMeshPhongMaterial||oe.isMeshStandardMaterial||oe.isShadowMaterial||oe.isShaderMaterial&&oe.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(oe,Me,Ue){Ot.get(oe.texture).__webglTexture=Me,Ot.get(oe.depthTexture).__webglTexture=Ue;const Ae=Ot.get(oe);Ae.__hasExternalTextures=!0,Ae.__hasExternalTextures&&(Ae.__autoAllocateDepthBuffer=Ue===void 0,Ae.__autoAllocateDepthBuffer||Mt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ae.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(oe,Me){const Ue=Ot.get(oe);Ue.__webglFramebuffer=Me,Ue.__useDefaultFramebuffer=Me===void 0},this.setRenderTarget=function(oe,Me=0,Ue=0){F=oe,A=Me,M=Ue;let Ae=!0,Be=null,vt=!1,Ft=!1;if(oe){const kt=Ot.get(oe);kt.__useDefaultFramebuffer!==void 0?(Bt.bindFramebuffer(Pe.FRAMEBUFFER,null),Ae=!1):kt.__webglFramebuffer===void 0?Ht.setupRenderTarget(oe):kt.__hasExternalTextures&&Ht.rebindTextures(oe,Ot.get(oe.texture).__webglTexture,Ot.get(oe.depthTexture).__webglTexture);const Xt=oe.texture;(Xt.isData3DTexture||Xt.isDataArrayTexture||Xt.isCompressedArrayTexture)&&(Ft=!0);const Le=Ot.get(oe).__webglFramebuffer;oe.isWebGLCubeRenderTarget?(Array.isArray(Le[Me])?Be=Le[Me][Ue]:Be=Le[Me],vt=!0):xt.isWebGL2&&oe.samples>0&&Ht.useMultisampledRTT(oe)===!1?Be=Ot.get(oe).__webglMultisampledFramebuffer:Array.isArray(Le)?Be=Le[Ue]:Be=Le,j.copy(oe.viewport),K.copy(oe.scissor),X=oe.scissorTest}else j.copy(ye).multiplyScalar(ue).floor(),K.copy(ge).multiplyScalar(ue).floor(),X=Te;if(Bt.bindFramebuffer(Pe.FRAMEBUFFER,Be)&&xt.drawBuffers&&Ae&&Bt.drawBuffers(oe,Be),Bt.viewport(j),Bt.scissor(K),Bt.setScissorTest(X),vt){const kt=Ot.get(oe.texture);Pe.framebufferTexture2D(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_CUBE_MAP_POSITIVE_X+Me,kt.__webglTexture,Ue)}else if(Ft){const kt=Ot.get(oe.texture),Xt=Me||0;Pe.framebufferTextureLayer(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,kt.__webglTexture,Ue||0,Xt)}N=-1},this.readRenderTargetPixels=function(oe,Me,Ue,Ae,Be,vt,Ft){if(!(oe&&oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Et=Ot.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&Ft!==void 0&&(Et=Et[Ft]),Et){Bt.bindFramebuffer(Pe.FRAMEBUFFER,Et);try{const kt=oe.texture,Xt=kt.format,Le=kt.type;if(Xt!==Ar&&Ct.convert(Xt)!==Pe.getParameter(Pe.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Xe=Le===ec&&(Mt.has("EXT_color_buffer_half_float")||xt.isWebGL2&&Mt.has("EXT_color_buffer_float"));if(Le!==Ls&&Ct.convert(Le)!==Pe.getParameter(Pe.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Le===As&&(xt.isWebGL2||Mt.has("OES_texture_float")||Mt.has("WEBGL_color_buffer_float")))&&!Xe){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Me>=0&&Me<=oe.width-Ae&&Ue>=0&&Ue<=oe.height-Be&&Pe.readPixels(Me,Ue,Ae,Be,Ct.convert(Xt),Ct.convert(Le),vt)}finally{const kt=F!==null?Ot.get(F).__webglFramebuffer:null;Bt.bindFramebuffer(Pe.FRAMEBUFFER,kt)}}},this.copyFramebufferToTexture=function(oe,Me,Ue=0){const Ae=Math.pow(2,-Ue),Be=Math.floor(Me.image.width*Ae),vt=Math.floor(Me.image.height*Ae);Ht.setTexture2D(Me,0),Pe.copyTexSubImage2D(Pe.TEXTURE_2D,Ue,0,0,oe.x,oe.y,Be,vt),Bt.unbindTexture()},this.copyTextureToTexture=function(oe,Me,Ue,Ae=0){const Be=Me.image.width,vt=Me.image.height,Ft=Ct.convert(Ue.format),Et=Ct.convert(Ue.type);Ht.setTexture2D(Ue,0),Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,Ue.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,Ue.unpackAlignment),Me.isDataTexture?Pe.texSubImage2D(Pe.TEXTURE_2D,Ae,oe.x,oe.y,Be,vt,Ft,Et,Me.image.data):Me.isCompressedTexture?Pe.compressedTexSubImage2D(Pe.TEXTURE_2D,Ae,oe.x,oe.y,Me.mipmaps[0].width,Me.mipmaps[0].height,Ft,Me.mipmaps[0].data):Pe.texSubImage2D(Pe.TEXTURE_2D,Ae,oe.x,oe.y,Ft,Et,Me.image),Ae===0&&Ue.generateMipmaps&&Pe.generateMipmap(Pe.TEXTURE_2D),Bt.unbindTexture()},this.copyTextureToTexture3D=function(oe,Me,Ue,Ae,Be=0){if(b.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const vt=oe.max.x-oe.min.x+1,Ft=oe.max.y-oe.min.y+1,Et=oe.max.z-oe.min.z+1,kt=Ct.convert(Ae.format),Xt=Ct.convert(Ae.type);let Le;if(Ae.isData3DTexture)Ht.setTexture3D(Ae,0),Le=Pe.TEXTURE_3D;else if(Ae.isDataArrayTexture)Ht.setTexture2DArray(Ae,0),Le=Pe.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,Ae.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,Ae.unpackAlignment);const Xe=Pe.getParameter(Pe.UNPACK_ROW_LENGTH),at=Pe.getParameter(Pe.UNPACK_IMAGE_HEIGHT),Nt=Pe.getParameter(Pe.UNPACK_SKIP_PIXELS),_t=Pe.getParameter(Pe.UNPACK_SKIP_ROWS),ni=Pe.getParameter(Pe.UNPACK_SKIP_IMAGES),ut=Ue.isCompressedTexture?Ue.mipmaps[0]:Ue.image;Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,ut.width),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,ut.height),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,oe.min.x),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,oe.min.y),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,oe.min.z),Ue.isDataTexture||Ue.isData3DTexture?Pe.texSubImage3D(Le,Be,Me.x,Me.y,Me.z,vt,Ft,Et,kt,Xt,ut.data):Ue.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Pe.compressedTexSubImage3D(Le,Be,Me.x,Me.y,Me.z,vt,Ft,Et,kt,ut.data)):Pe.texSubImage3D(Le,Be,Me.x,Me.y,Me.z,vt,Ft,Et,kt,Xt,ut),Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,Xe),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,at),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,Nt),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,_t),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,ni),Be===0&&Ae.generateMipmaps&&Pe.generateMipmap(Le),Bt.unbindTexture()},this.initTexture=function(oe){oe.isCubeTexture?Ht.setTextureCube(oe,0):oe.isData3DTexture?Ht.setTexture3D(oe,0):oe.isDataArrayTexture||oe.isCompressedArrayTexture?Ht.setTexture2DArray(oe,0):Ht.setTexture2D(oe,0),Bt.unbindTexture()},this.resetState=function(){A=0,M=0,F=null,Bt.reset(),Tt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return us}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=e===eh?"display-p3":"srgb",i.unpackColorSpace=xi.workingColorSpace===Kl?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===ln?da:gv}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===da?ln:fs}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class UM extends kv{}UM.prototype.isWebGL1Renderer=!0;class BM extends sr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}}class HM extends zn{constructor(e,i,n,r,s,o,c,h,l){super(e,i,n,r,s,o,c,h,l),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Hn,this.magFilter=s!==void 0?s:Hn,this.generateMipmaps=!1;const p=this;function g(){p.needsUpdate=!0,e.requestVideoFrameCallback(g)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(g)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class sh extends zs{constructor(e=1,i=32,n=16,r=0,s=Math.PI*2,o=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:c},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const h=Math.min(o+c,Math.PI);let l=0;const p=[],g=new Ie,f=new Ie,y=[],x=[],S=[],v=[];for(let m=0;m<=n;m++){const w=[],b=m/n;let C=0;m===0&&o===0?C=.5/i:m===n&&h===Math.PI&&(C=-.5/i);for(let A=0;A<=i;A++){const M=A/i;g.x=-e*Math.cos(r+M*s)*Math.sin(o+b*c),g.y=e*Math.cos(o+b*c),g.z=e*Math.sin(r+M*s)*Math.sin(o+b*c),x.push(g.x,g.y,g.z),f.copy(g).normalize(),S.push(f.x,f.y,f.z),v.push(M+C,1-b),w.push(l++)}p.push(w)}for(let m=0;m<n;m++)for(let w=0;w<i;w++){const b=p[m][w+1],C=p[m][w],A=p[m+1][w],M=p[m+1][w+1];(m!==0||o>0)&&y.push(b,C,M),(m!==n-1||h<Math.PI)&&y.push(C,A,M)}this.setIndex(y),this.setAttribute("position",new Xr(x,3)),this.setAttribute("normal",new Xr(S,3)),this.setAttribute("uv",new Xr(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class kf{constructor(e=1,i=0,n=0){return this.radius=e,this.phi=i,this.theta=n,this}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Mn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ju}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ju);const Nf={type:"change"},iu={type:"start"},Of={type:"end"},Xc=new Sv,Uf=new Rs,jM=Math.cos(70*FC.DEG2RAD);class VM extends _a{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ie,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:wa.ROTATE,MIDDLE:wa.DOLLY,RIGHT:wa.PAN},this.touches={ONE:xa.ROTATE,TWO:xa.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(de){de.addEventListener("keydown",te),this._domElementKeyEvents=de},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",te),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Nf),n.update(),s=r.NONE},this.update=function(){const de=new Ie,ke=new ma().setFromUnitVectors(e.up,new Ie(0,1,0)),Ve=ke.clone().invert(),Ct=new Ie,Tt=new ma,At=new Ie,wt=2*Math.PI;return function(nt=null){const Je=n.object.position;de.copy(Je).sub(n.target),de.applyQuaternion(ke),c.setFromVector3(de),n.autoRotate&&s===r.NONE&&K(P(nt)),n.enableDamping?(c.theta+=h.theta*n.dampingFactor,c.phi+=h.phi*n.dampingFactor):(c.theta+=h.theta,c.phi+=h.phi);let ct=n.minAzimuthAngle,ot=n.maxAzimuthAngle;isFinite(ct)&&isFinite(ot)&&(ct<-Math.PI?ct+=wt:ct>Math.PI&&(ct-=wt),ot<-Math.PI?ot+=wt:ot>Math.PI&&(ot-=wt),ct<=ot?c.theta=Math.max(ct,Math.min(ot,c.theta)):c.theta=c.theta>(ct+ot)/2?Math.max(ct,c.theta):Math.min(ot,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),n.zoomToCursor&&M||n.object.isOrthographicCamera?c.radius=Ee(c.radius):c.radius=Ee(c.radius*l),de.setFromSpherical(c),de.applyQuaternion(Ve),Je.copy(n.target).add(de),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let Ke=!1;if(n.zoomToCursor&&M){let lt=null;if(n.object.isPerspectiveCamera){const It=de.length();lt=Ee(It*l);const Ii=It-lt;n.object.position.addScaledVector(C,Ii),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const It=new Ie(A.x,A.y,0);It.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),Ke=!0;const Ii=new Ie(A.x,A.y,0);Ii.unproject(n.object),n.object.position.sub(Ii).add(It),n.object.updateMatrixWorld(),lt=de.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;lt!==null&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(lt).add(n.object.position):(Xc.origin.copy(n.object.position),Xc.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Xc.direction))<jM?e.lookAt(n.target):(Uf.setFromNormalAndCoplanarPoint(n.object.up,n.target),Xc.intersectPlane(Uf,n.target))))}else n.object.isOrthographicCamera&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),Ke=!0);return l=1,M=!1,Ke||Ct.distanceToSquared(n.object.position)>o||8*(1-Tt.dot(n.object.quaternion))>o||At.distanceToSquared(n.target)>0?(n.dispatchEvent(Nf),Ct.copy(n.object.position),Tt.copy(n.object.quaternion),At.copy(n.target),Ke=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Oe),n.domElement.removeEventListener("pointerdown",Ot),n.domElement.removeEventListener("pointercancel",ei),n.domElement.removeEventListener("wheel",ce),n.domElement.removeEventListener("pointermove",Ht),n.domElement.removeEventListener("pointerup",ei),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",te),n._domElementKeyEvents=null)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,c=new kf,h=new kf;let l=1;const p=new Ie,g=new si,f=new si,y=new si,x=new si,S=new si,v=new si,m=new si,w=new si,b=new si,C=new Ie,A=new si;let M=!1;const F=[],N={};function P(de){return de!==null?2*Math.PI/60*n.autoRotateSpeed*de:2*Math.PI/60/60*n.autoRotateSpeed}function j(){return Math.pow(.95,n.zoomSpeed)}function K(de){h.theta-=de}function X(de){h.phi-=de}const ie=function(){const de=new Ie;return function(Ve,Ct){de.setFromMatrixColumn(Ct,0),de.multiplyScalar(-Ve),p.add(de)}}(),q=function(){const de=new Ie;return function(Ve,Ct){n.screenSpacePanning===!0?de.setFromMatrixColumn(Ct,1):(de.setFromMatrixColumn(Ct,0),de.crossVectors(n.object.up,de)),de.multiplyScalar(Ve),p.add(de)}}(),ae=function(){const de=new Ie;return function(Ve,Ct){const Tt=n.domElement;if(n.object.isPerspectiveCamera){const At=n.object.position;de.copy(At).sub(n.target);let wt=de.length();wt*=Math.tan(n.object.fov/2*Math.PI/180),ie(2*Ve*wt/Tt.clientHeight,n.object.matrix),q(2*Ct*wt/Tt.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(ie(Ve*(n.object.right-n.object.left)/n.object.zoom/Tt.clientWidth,n.object.matrix),q(Ct*(n.object.top-n.object.bottom)/n.object.zoom/Tt.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function pe(de){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=de:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ue(de){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=de:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function xe(de){if(!n.zoomToCursor)return;M=!0;const ke=n.domElement.getBoundingClientRect(),Ve=de.clientX-ke.left,Ct=de.clientY-ke.top,Tt=ke.width,At=ke.height;A.x=Ve/Tt*2-1,A.y=-(Ct/At)*2+1,C.set(A.x,A.y,1).unproject(n.object).sub(n.object.position).normalize()}function Ee(de){return Math.max(n.minDistance,Math.min(n.maxDistance,de))}function ye(de){g.set(de.clientX,de.clientY)}function ge(de){xe(de),m.set(de.clientX,de.clientY)}function Te(de){x.set(de.clientX,de.clientY)}function rt(de){f.set(de.clientX,de.clientY),y.subVectors(f,g).multiplyScalar(n.rotateSpeed);const ke=n.domElement;K(2*Math.PI*y.x/ke.clientHeight),X(2*Math.PI*y.y/ke.clientHeight),g.copy(f),n.update()}function et(de){w.set(de.clientX,de.clientY),b.subVectors(w,m),b.y>0?pe(j()):b.y<0&&ue(j()),m.copy(w),n.update()}function tt(de){S.set(de.clientX,de.clientY),v.subVectors(S,x).multiplyScalar(n.panSpeed),ae(v.x,v.y),x.copy(S),n.update()}function gt(de){xe(de),de.deltaY<0?ue(j()):de.deltaY>0&&pe(j()),n.update()}function Lt(de){let ke=!1;switch(de.code){case n.keys.UP:de.ctrlKey||de.metaKey||de.shiftKey?X(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):ae(0,n.keyPanSpeed),ke=!0;break;case n.keys.BOTTOM:de.ctrlKey||de.metaKey||de.shiftKey?X(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):ae(0,-n.keyPanSpeed),ke=!0;break;case n.keys.LEFT:de.ctrlKey||de.metaKey||de.shiftKey?K(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):ae(n.keyPanSpeed,0),ke=!0;break;case n.keys.RIGHT:de.ctrlKey||de.metaKey||de.shiftKey?K(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):ae(-n.keyPanSpeed,0),ke=!0;break}ke&&(de.preventDefault(),n.update())}function St(){if(F.length===1)g.set(F[0].pageX,F[0].pageY);else{const de=.5*(F[0].pageX+F[1].pageX),ke=.5*(F[0].pageY+F[1].pageY);g.set(de,ke)}}function Kt(){if(F.length===1)x.set(F[0].pageX,F[0].pageY);else{const de=.5*(F[0].pageX+F[1].pageX),ke=.5*(F[0].pageY+F[1].pageY);x.set(de,ke)}}function Ei(){const de=F[0].pageX-F[1].pageX,ke=F[0].pageY-F[1].pageY,Ve=Math.sqrt(de*de+ke*ke);m.set(0,Ve)}function Ut(){n.enableZoom&&Ei(),n.enablePan&&Kt()}function Pe(){n.enableZoom&&Ei(),n.enableRotate&&St()}function _i(de){if(F.length==1)f.set(de.pageX,de.pageY);else{const Ve=st(de),Ct=.5*(de.pageX+Ve.x),Tt=.5*(de.pageY+Ve.y);f.set(Ct,Tt)}y.subVectors(f,g).multiplyScalar(n.rotateSpeed);const ke=n.domElement;K(2*Math.PI*y.x/ke.clientHeight),X(2*Math.PI*y.y/ke.clientHeight),g.copy(f)}function Mt(de){if(F.length===1)S.set(de.pageX,de.pageY);else{const ke=st(de),Ve=.5*(de.pageX+ke.x),Ct=.5*(de.pageY+ke.y);S.set(Ve,Ct)}v.subVectors(S,x).multiplyScalar(n.panSpeed),ae(v.x,v.y),x.copy(S)}function xt(de){const ke=st(de),Ve=de.pageX-ke.x,Ct=de.pageY-ke.y,Tt=Math.sqrt(Ve*Ve+Ct*Ct);w.set(0,Tt),b.set(0,Math.pow(w.y/m.y,n.zoomSpeed)),pe(b.y),m.copy(w)}function Bt(de){n.enableZoom&&xt(de),n.enablePan&&Mt(de)}function li(de){n.enableZoom&&xt(de),n.enableRotate&&_i(de)}function Ot(de){n.enabled!==!1&&(F.length===0&&(n.domElement.setPointerCapture(de.pointerId),n.domElement.addEventListener("pointermove",Ht),n.domElement.addEventListener("pointerup",ei)),Fe(de),de.pointerType==="touch"?De(de):Ci(de))}function Ht(de){n.enabled!==!1&&(de.pointerType==="touch"?He(de):yi(de))}function ei(de){it(de),F.length===0&&(n.domElement.releasePointerCapture(de.pointerId),n.domElement.removeEventListener("pointermove",Ht),n.domElement.removeEventListener("pointerup",ei)),n.dispatchEvent(Of),s=r.NONE}function Ci(de){let ke;switch(de.button){case 0:ke=n.mouseButtons.LEFT;break;case 1:ke=n.mouseButtons.MIDDLE;break;case 2:ke=n.mouseButtons.RIGHT;break;default:ke=-1}switch(ke){case wa.DOLLY:if(n.enableZoom===!1)return;ge(de),s=r.DOLLY;break;case wa.ROTATE:if(de.ctrlKey||de.metaKey||de.shiftKey){if(n.enablePan===!1)return;Te(de),s=r.PAN}else{if(n.enableRotate===!1)return;ye(de),s=r.ROTATE}break;case wa.PAN:if(de.ctrlKey||de.metaKey||de.shiftKey){if(n.enableRotate===!1)return;ye(de),s=r.ROTATE}else{if(n.enablePan===!1)return;Te(de),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(iu)}function yi(de){switch(s){case r.ROTATE:if(n.enableRotate===!1)return;rt(de);break;case r.DOLLY:if(n.enableZoom===!1)return;et(de);break;case r.PAN:if(n.enablePan===!1)return;tt(de);break}}function ce(de){n.enabled===!1||n.enableZoom===!1||s!==r.NONE||(de.preventDefault(),n.dispatchEvent(iu),gt(de),n.dispatchEvent(Of))}function te(de){n.enabled===!1||n.enablePan===!1||Lt(de)}function De(de){switch($e(de),F.length){case 1:switch(n.touches.ONE){case xa.ROTATE:if(n.enableRotate===!1)return;St(),s=r.TOUCH_ROTATE;break;case xa.PAN:if(n.enablePan===!1)return;Kt(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(n.touches.TWO){case xa.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Ut(),s=r.TOUCH_DOLLY_PAN;break;case xa.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Pe(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(iu)}function He(de){switch($e(de),s){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;_i(de),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;Mt(de),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Bt(de),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;li(de),n.update();break;default:s=r.NONE}}function Oe(de){n.enabled!==!1&&de.preventDefault()}function Fe(de){F.push(de)}function it(de){delete N[de.pointerId];for(let ke=0;ke<F.length;ke++)if(F[ke].pointerId==de.pointerId){F.splice(ke,1);return}}function $e(de){let ke=N[de.pointerId];ke===void 0&&(ke=new si,N[de.pointerId]=ke),ke.set(de.pageX,de.pageY)}function st(de){const ke=de.pointerId===F[0].pointerId?F[1]:F[0];return N[ke.pointerId]}n.domElement.addEventListener("contextmenu",Oe),n.domElement.addEventListener("pointerdown",Ot),n.domElement.addEventListener("pointercancel",ei),n.domElement.addEventListener("wheel",ce,{passive:!1}),this.update()}}const zM=new io({jti:lo(),iat:Kh(),exp:Kh()+60*60*24,version:3,scope:{appId:"07b887be-6091-4eae-9c58-a903e0bd72f4",rooms:[{name:"*",methods:["create","close"],member:{name:"*",methods:["publish","subscribe"]}}]}}).encode("5tl2lhpB/9NzBfhkVw8vDYZeA9SiCYi7ZumfaoEHqQ0="),Bf=document.getElementById("local-video"),GM=document.getElementById("join"),qM=document.getElementById("leave"),WM=document.getElementById("room-name"),KM=document.getElementById("remote-media-area"),Hf=document.getElementById("my-id");(async()=>GM.onclick=async()=>{const t=document.getElementById("is-sender").checked,e=await Wg.Create(zM),i=await FE.FindOrCreate(e,{type:"p2p",name:WM.value}),n=await i.join();if(Hf.textContent=n.id,t){const{audio:r,video:s}=await uE.createMicrophoneAudioAndCameraStream();await n.publish(r),await n.publish(s),s.attach(Bf),await Bf.play()}else{const r=async s=>{if(s.publisher.id===n.id)return;const{stream:o}=await n.subscribe(s.id);if(o.track.kind==="video"){const c=document.createElement("video");c.autoplay=!0,c.playsInline=!0,c.muted=!0,c.setAttribute("crossorigin","anonymous"),o.attach(c),c.onloadeddata=()=>{c.play(),XM(c)}}};i.publications.forEach(r),i.onStreamPublished.add(s=>r(s.publication))}qM.onclick=async()=>{await n.leave(),await i.dispose(),Hf.textContent="",KM.innerHTML=""}})();function XM(t){const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.zIndex="9999",document.body.appendChild(e),t.style.display="none";const i=new BM,n=new pr(90,window.innerWidth/window.innerHeight,1,1100);n.position.set(0,0,.1);const r=new kv({canvas:e});r.setSize(window.innerWidth,window.innerHeight);const s=new sh(100,32,32);s.scale(-1,1,1);const o=new HM(t),c=new ih({map:o}),h=new hs(s,c);i.add(h);const l=new VM(n,r.domElement);l.enableZoom=!1,l.enablePan=!1,l.autoRotate=!1,window.addEventListener("resize",()=>{n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)});const p=()=>{requestAnimationFrame(p),l.update(),r.render(i,n)};return p(),()=>{e.remove(),r.dispose()}}
